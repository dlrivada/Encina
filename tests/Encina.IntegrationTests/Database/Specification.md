# Integration Tests - Specification Pattern

## Status: Not Implemented

## Justification

Integration tests for the Specification pattern are not implemented for the following reasons:

### 1. Specification is a Domain Pattern, Not a Data Access Component

The Specification pattern (`ISpecification<T>`, `Specification<T>`, `QuerySpecification<T>`) is a pure domain modeling pattern that:
- Encapsulates business rules as composable predicates
- Returns `Expression<Func<T, bool>>` that other components translate
- Does not interact directly with databases or external systems

The pattern itself is entirely in-memory and requires no database for testing.

### 2. SQL Translation is Covered by Unit Tests

The `SpecificationSqlBuilder<T>` classes that translate specifications to SQL:
- Are pure functions that take specifications and return SQL strings
- Do not require a database connection to verify SQL generation
- Are thoroughly tested in unit tests across all 12 providers

### 3. Repository Integration Tests Cover Real Database Execution

When specifications are used with actual databases, the `FunctionalRepository.ListAsync()` and `FunctionalRepository.FindAsync()` methods execute them. These integration tests belong in the Repository integration test category.

### 4. Adequate Coverage from Other Test Types

- **Unit Tests**: Full coverage of `Specification<T>` composition (And, Or, Not)
- **Unit Tests**: Full coverage of `SpecificationSqlBuilder` SQL generation for all 12 providers
- **Guard Tests**: Parameter validation for all public methods
- **Property Tests**: Invariant verification for specification composition (commutativity, associativity)
- **Contract Tests**: API consistency verification across all providers

### 5. Recommended Alternative

For integration testing specifications with real databases:
1. Use the Repository integration tests which exercise specifications end-to-end
2. Run provider-specific SQL validation tests:

```csharp
// Example: Verify specification SQL executes correctly on real DB
[Trait("Category", "Integration")]
public async Task FindAsync_WithSpecification_ReturnsMatchingEntities()
{
    // Arrange
    var spec = new ActiveOrdersSpec();

    // Act
    var result = await _repository.FindAsync(spec, CancellationToken.None);

    // Assert - SQL generated by SpecificationSqlBuilder was executed successfully
    result.IsRight.ShouldBeTrue();
}
```

## Related Files

- `src/Encina.DomainModeling/Specification.cs` - Base specification classes
- `src/Encina.DomainModeling/ISpecification.cs` - Specification interfaces
- `src/Encina.*/Repository/SpecificationSqlBuilder.cs` - SQL translation (ADO/Dapper)
- `src/Encina.EntityFrameworkCore/Repository/SpecificationEvaluator.cs` - EF Core evaluation
- `src/Encina.MongoDB/Repository/SpecificationFilterBuilder.cs` - MongoDB filter building
- `tests/Encina.UnitTests/*/Repository/SpecificationSqlBuilderTests.cs` - Unit tests

## Date: 2026-01-24

## Issue: #280
