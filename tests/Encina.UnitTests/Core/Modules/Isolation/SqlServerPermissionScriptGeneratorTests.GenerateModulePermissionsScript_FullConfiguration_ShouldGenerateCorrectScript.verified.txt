-- SQL Server Permission Script for Module: Orders
-- Generated by Encina Module Isolation

-- Create schema: orders
IF NOT EXISTS (SELECT 1 FROM sys.schemas WHERE name = N'orders')
BEGIN
    EXEC('CREATE SCHEMA [orders]');
    PRINT 'Created schema: orders';
END
ELSE
BEGIN
    PRINT 'Schema already exists: orders';
END
GO

-- Create login and user for module: Orders
IF NOT EXISTS (SELECT 1 FROM sys.server_principals WHERE name = N'orders_user_login')
BEGIN
    CREATE LOGIN [orders_user_login] WITH PASSWORD = N'{{Orders_Password}}';
    PRINT 'Created login: orders_user_login';
END
ELSE
BEGIN
    PRINT 'Login already exists: orders_user_login';
END
GO

IF NOT EXISTS (SELECT 1 FROM sys.database_principals WHERE name = N'orders_user')
BEGIN
    CREATE USER [orders_user] FOR LOGIN [orders_user_login];
    PRINT 'Created user: orders_user';
END
ELSE
BEGIN
    PRINT 'User already exists: orders_user';
END
GO

-- Grant permissions for module: Orders

-- Full access to module schema: orders
GRANT SELECT, INSERT, UPDATE, DELETE ON SCHEMA::[orders] TO [orders_user];
GRANT EXECUTE ON SCHEMA::[orders] TO [orders_user];
PRINT 'Granted full access on schema orders to orders_user';

-- Read-only access to shared schema: lookup
GRANT SELECT ON SCHEMA::[lookup] TO [orders_user];
PRINT 'Granted SELECT on schema lookup to orders_user';
-- Read-only access to shared schema: shared
GRANT SELECT ON SCHEMA::[shared] TO [orders_user];
PRINT 'Granted SELECT on schema shared to orders_user';

-- Read-only access to additional schema: audit
GRANT SELECT ON SCHEMA::[audit] TO [orders_user];
PRINT 'Granted SELECT on schema audit to orders_user';
GO

PRINT 'Module Orders permissions configured successfully.';
