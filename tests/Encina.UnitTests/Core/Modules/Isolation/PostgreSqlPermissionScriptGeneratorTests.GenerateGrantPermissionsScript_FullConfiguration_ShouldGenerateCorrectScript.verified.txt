-- PostgreSQL Permission Grant Script
-- Generated by Encina Module Isolation
-- This script is idempotent and can be run multiple times safely

-- Grant permissions for module: Orders

-- Full access to module schema: orders
GRANT USAGE ON SCHEMA "orders" TO "orders_user";
GRANT SELECT, INSERT, UPDATE, DELETE ON ALL TABLES IN SCHEMA "orders" TO "orders_user";
GRANT EXECUTE ON ALL FUNCTIONS IN SCHEMA "orders" TO "orders_user";
GRANT USAGE, SELECT ON ALL SEQUENCES IN SCHEMA "orders" TO "orders_user";

-- Set default privileges for future tables in orders
ALTER DEFAULT PRIVILEGES IN SCHEMA "orders" GRANT SELECT, INSERT, UPDATE, DELETE ON TABLES TO "orders_user";
ALTER DEFAULT PRIVILEGES IN SCHEMA "orders" GRANT EXECUTE ON FUNCTIONS TO "orders_user";
ALTER DEFAULT PRIVILEGES IN SCHEMA "orders" GRANT USAGE, SELECT ON SEQUENCES TO "orders_user";
DO $$ BEGIN RAISE NOTICE 'Granted full access on schema orders to orders_user'; END $$;

-- Read-only access to shared schema: lookup
GRANT USAGE ON SCHEMA "lookup" TO "orders_user";
GRANT SELECT ON ALL TABLES IN SCHEMA "lookup" TO "orders_user";
ALTER DEFAULT PRIVILEGES IN SCHEMA "lookup" GRANT SELECT ON TABLES TO "orders_user";
DO $$ BEGIN RAISE NOTICE 'Granted SELECT on schema lookup to orders_user'; END $$;
-- Read-only access to shared schema: shared
GRANT USAGE ON SCHEMA "shared" TO "orders_user";
GRANT SELECT ON ALL TABLES IN SCHEMA "shared" TO "orders_user";
ALTER DEFAULT PRIVILEGES IN SCHEMA "shared" GRANT SELECT ON TABLES TO "orders_user";
DO $$ BEGIN RAISE NOTICE 'Granted SELECT on schema shared to orders_user'; END $$;

-- Read-only access to additional schema: audit
GRANT USAGE ON SCHEMA "audit" TO "orders_user";
GRANT SELECT ON ALL TABLES IN SCHEMA "audit" TO "orders_user";
ALTER DEFAULT PRIVILEGES IN SCHEMA "audit" GRANT SELECT ON TABLES TO "orders_user";
DO $$ BEGIN RAISE NOTICE 'Granted SELECT on schema audit to orders_user'; END $$;

DO $$ BEGIN RAISE NOTICE 'Permission grants completed successfully.'; END $$;
