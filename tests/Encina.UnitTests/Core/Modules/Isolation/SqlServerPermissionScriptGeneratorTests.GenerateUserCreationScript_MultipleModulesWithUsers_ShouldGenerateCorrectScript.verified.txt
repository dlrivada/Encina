-- SQL Server User Creation Script
-- Generated by Encina Module Isolation
-- IMPORTANT: Replace {{ModuleName_Password}} placeholders with actual passwords before execution
-- This script is idempotent and can be run multiple times safely

-- Create login and user for module: Orders
IF NOT EXISTS (SELECT 1 FROM sys.server_principals WHERE name = N'orders_user_login')
BEGIN
    CREATE LOGIN [orders_user_login] WITH PASSWORD = N'{{Orders_Password}}';
    PRINT 'Created login: orders_user_login';
END
ELSE
BEGIN
    PRINT 'Login already exists: orders_user_login';
END
GO

IF NOT EXISTS (SELECT 1 FROM sys.database_principals WHERE name = N'orders_user')
BEGIN
    CREATE USER [orders_user] FOR LOGIN [orders_user_login];
    PRINT 'Created user: orders_user';
END
ELSE
BEGIN
    PRINT 'User already exists: orders_user';
END
GO

-- Create login and user for module: Payments
IF NOT EXISTS (SELECT 1 FROM sys.server_principals WHERE name = N'payments_user_login')
BEGIN
    CREATE LOGIN [payments_user_login] WITH PASSWORD = N'{{Payments_Password}}';
    PRINT 'Created login: payments_user_login';
END
ELSE
BEGIN
    PRINT 'Login already exists: payments_user_login';
END
GO

IF NOT EXISTS (SELECT 1 FROM sys.database_principals WHERE name = N'payments_user')
BEGIN
    CREATE USER [payments_user] FOR LOGIN [payments_user_login];
    PRINT 'Created user: payments_user';
END
ELSE
BEGIN
    PRINT 'User already exists: payments_user';
END
GO

PRINT 'User creation completed successfully.';
