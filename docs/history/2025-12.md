# December 2025 - Implementation History

This document captures the detailed implementation history for Encina during December 2025.

## Summary

December 2025 was a milestone month for Encina, with **39 packages** reaching production status:

| Category | Packages | Tests |
|----------|----------|-------|
| Core & Validation | 5 | 524 |
| Web Integration | 2 | 52 |
| Database Providers | 11 | 1,763 |
| Messaging Transports | 10 | - |
| Caching | 8 | 367 |
| Job Scheduling | 2 | 36 |
| Resilience | 3 | - |
| Event Sourcing | 1 | 16 |

**Total: 39 packages, 3,800+ tests**

> **Note**: 5 packages were deprecated:
> - Wolverine, NServiceBus, MassTransit, Dapr - overlapping concerns with Encina's messaging
> - EventStoreDB - Marten provides better .NET integration for Event Sourcing
>
> Code preserved in `.backup/deprecated-packages/`.

---

## Phase 1: Core & Validation (Completed)

### Encina Core

**Status**: Production Ready
**Tests**: 194/194 passing

**Features**:

- Pure Railway Oriented Programming with `Either<EncinaError, T>`
- Request/Notification dispatch with Expression tree compilation
- Pipeline pattern (Behaviors, PreProcessors, PostProcessors)
- IRequestContext for ambient context (correlation, user, tenant, metadata)
- Observability with ActivitySource and Metrics
- CQRS markers (ICommand, IQuery)
- Functional failure detection
- PublicAPI Analyzers compliance (107 public symbols documented)

### Validation Orchestrator Pattern (2025-12-23)

All validation packages now use the centralized Orchestrator pattern:

```
Encina (core)
├── Encina.Validation.IValidationProvider (interface)
├── Encina.Validation.ValidationOrchestrator (domain logic)
├── Encina.Validation.ValidationPipelineBehavior<,> (centralized behavior)
├── Encina.Validation.ValidationResult (immutable result)
└── Encina.Validation.ValidationError (record)

Encina.FluentValidation / DataAnnotations / MiniValidator
├── *ValidationProvider (implements IValidationProvider)
└── ServiceCollectionExtensions (registers orchestrator + provider)
```

### Encina.FluentValidation

**Status**: Production Ready
**Tests**: 28/28 passing

**Features**:

- Implements `FluentValidationProvider` following Orchestrator pattern
- Automatic validation before handler execution
- ROP integration with `Either<EncinaError, T>`
- Context enrichment (CorrelationId, UserId, TenantId)
- Parallel validator execution
- Comprehensive error metadata

### Encina.DataAnnotations

**Status**: Production Ready
**Tests**: 20/20 passing

**Features**:

- Implements `DataAnnotationsValidationProvider` following Orchestrator pattern
- Zero external dependencies (built-in .NET)
- Declarative attributes on properties
- Perfect for prototypes and simple apps
- Compatible with legacy code

### Encina.MiniValidator

**Status**: Production Ready
**Tests**: 20/20 passing

**Features**:

- Implements `MiniValidationProvider` following Orchestrator pattern
- Ultra-lightweight (~20KB vs 500KB FluentValidation)
- Perfect for Minimal APIs
- Uses Data Annotations under the hood
- Growing trend in the community

### Encina.GuardClauses

**Status**: Production Ready
**Tests**: 262 passing

**Features**:

- Defensive programming with Ardalis.GuardClauses
- Automatic EncinaError generation
- ROP-friendly API
- Extension methods for request properties

---

## Phase 2: Web & Messaging (Completed)

### Encina.AspNetCore

**Status**: Production Ready
**Tests**: 52/52 passing

**Features**:

- EncinaContextMiddleware for IRequestContext enrichment
- AuthorizationPipelineBehavior with [Authorize], [AllowAnonymous], resource-based auth
- ProblemDetailsExtensions for RFC 7807 (intelligent error mapping)
- IRequestContextAccessor with AsyncLocal storage
- .NET 10 compatibility

### Encina.SignalR (NEW 2025-12-21)

**Status**: Production Ready

**Features**:

- `EncinaHub` base class for SignalR hubs with Encina integration
- `[BroadcastToSignalR]` attribute for declarative notification broadcasting
- `SignalRBroadcastHandler<T>` - Generic notification handler for SignalR
- `ISignalRNotificationBroadcaster` - Service for manual broadcasting
- Support for: Method naming, target users/groups, exclude caller, conditional broadcasting
- Railway Oriented Programming integration

### Encina.Messaging (Abstractions)

**Status**: Production Ready

**Features**:

- IOutboxStore, IInboxStore, ISagaStore, IScheduledMessageStore interfaces
- OutboxOptions, InboxOptions, SagaOptions, SchedulingOptions configuration
- MessagingConfiguration for provider-agnostic setup
- Shared entities and patterns

### Encina.EntityFrameworkCore

**Status**: Production Ready
**Tests**: 33/33 passing

**Features**:

- TransactionPipelineBehavior for automatic transaction management
- Outbox pattern (reliable event publishing, at-least-once delivery)
- Inbox pattern (idempotent processing, exactly-once semantics)
- Saga orchestration (distributed transactions with compensation)
- Scheduled messages (delayed and recurring execution)
- Opt-in configuration for each pattern

---

## Phase 3: Job Scheduling (Completed)

### Encina.Hangfire

**Status**: Production Ready
**Tests**: 15/15 passing

**Features**:

- Fire-and-forget job execution
- Delayed job execution (schedule for later)
- Recurring jobs with CRON expressions
- Full ROP support with `Either<EncinaError, T>`
- Dashboard UI (provided by Hangfire)
- Simple setup, great for basic scenarios

### Encina.Quartz

**Status**: Production Ready
**Tests**: 18/18 passing

**Features**:

- Advanced CRON expression support
- Clustering and persistent storage configuration
- Misfire handling and concurrent execution control
- Runtime and startup scheduling
- Enterprise-grade job management
- Fine-grained control over job behavior

---

## Phase 4: Multi-Database Support (Completed 2025-12-18)

All 10 database provider packages completed and tested.

### SQL Dialect Translation Matrix

| Feature | SQL Server | PostgreSQL | MySQL/MariaDB | SQLite | Oracle |
|---------|-----------|------------|---------------|--------|--------|
| UTC Timestamp | `GETUTCDATE()` | `NOW() AT TIME ZONE 'UTC'` | `UTC_TIMESTAMP()` | `datetime('now')` | `SYS_EXTRACT_UTC(SYSTIMESTAMP)` |
| Result Limit | `TOP N` | `LIMIT N` | `LIMIT N` | `LIMIT N` | `FETCH FIRST N ROWS ONLY` |
| GUID Type | `UNIQUEIDENTIFIER` | `UUID` | `CHAR(36)` | `TEXT` | `RAW(16)` or `VARCHAR2(36)` |
| Large Text | `NVARCHAR(MAX)` | `TEXT` | `TEXT` | `TEXT` | `CLOB` |
| DateTime | `DATETIME2(7)` | `TIMESTAMP` | `DATETIME(6)` | `TEXT (ISO8601)` | `TIMESTAMP` |
| Parameters | `@ParameterName` | `@ParameterName` | `@ParameterName` | `@ParameterName` | `:ParameterName` |

### Database Providers

| Database | Dapper Package | ADO.NET Package | Key Features |
|----------|---------------|-----------------|--------------|
| SQL Server | Encina.Dapper.SqlServer | Encina.ADO.SqlServer | GETUTCDATE(), TOP N, UNIQUEIDENTIFIER |
| PostgreSQL | Encina.Dapper.PostgreSQL | Encina.ADO.PostgreSQL | NOW() AT TIME ZONE 'UTC', LIMIT N, UUID |
| MySQL/MariaDB | Encina.Dapper.MySQL | Encina.ADO.MySQL | UTC_TIMESTAMP(), LIMIT N, CHAR(36) |
| SQLite | Encina.Dapper.Sqlite | Encina.ADO.Sqlite | datetime('now'), LIMIT N, TEXT |
| Oracle | Encina.Dapper.Oracle | Encina.ADO.Oracle | SYS_EXTRACT_UTC(SYSTIMESTAMP), FETCH FIRST N |

**All providers support**:

- Outbox Pattern (reliable event publishing)
- Inbox Pattern (idempotent processing)
- Saga Orchestration (distributed transactions)
- Scheduled Messages (delayed/recurring execution)
- Transaction Management (ROP-aware)
- PublicAPI Analyzers compliance

**Package Dependencies**:

- SQL Server: `Microsoft.Data.SqlClient 6.1.3`
- PostgreSQL: `Npgsql 10.0.1`
- MySQL: `MySqlConnector 2.5.0`
- SQLite: `Microsoft.Data.Sqlite 10.0.1`
- Oracle: `Oracle.ManagedDataAccess.Core 23.26.0`

**Performance** (ADO.NET vs Dapper vs EF Core):

- ADO.NET: 63ms (baseline - fastest)
- Dapper: 100ms (1.59x slower)
- EF Core: 180ms (2.86x slower)

---

## Phase 5: Resilience & Service Mesh (Completed 2025-12-19)

### Encina.Extensions.Resilience

**Features**:

- Microsoft's standard resilience pipeline integration
- 5-strategy resilience pattern (rate limiter, total timeout, retry, circuit breaker, attempt timeout)
- ResiliencePipelineRegistry<string> for pipeline management
- StandardResilienceOptions with Polly v8 strategy options

**Package Dependencies**: `Polly 8.6.5`, `Microsoft.Extensions.Resilience 10.1.0`

### Encina.Refit

**Features**:

- Type-safe REST API clients integrated with Encina
- IRestApiRequest<TApiClient, TResponse> marker interface
- RestApiRequestHandler with automatic ApiException → EncinaError conversion

**Package Dependencies**: `Refit 9.0.2`, `Refit.HttpClientFactory 9.0.2`

### Encina.Dapr (DEPRECATED)

> **Deprecated**: Removed due to overlapping concerns with Encina's value proposition. Code preserved in `.backup/deprecated-packages/`.

**Features** (when active):

- Service-to-service invocation via Dapr sidecar
- Pub/Sub event publishing with cloud-agnostic abstraction
- State Management, Bindings, Secrets building blocks

**Package Dependencies**: `Dapr.Client 1.16.1`, `Dapr.AspNetCore 1.16.1`

---

## Phase 6: Caching Infrastructure (Completed 2025-12-21)

All 8 caching packages completed with 367 tests.

### Caching Packages

| Package | Purpose | Tests | Status |
|---------|---------|-------|--------|
| Encina.Caching | Core abstractions | 49 | Production |
| Encina.Caching.Memory | In-memory caching | 109 | Production |
| Encina.Caching.Hybrid | Multi-tier (L1+L2) | 56 | Production |
| Encina.Caching.Redis | StackExchange.Redis | - | Production |
| Encina.Caching.Valkey | Open-source Redis | - | Production |
| Encina.Caching.KeyDB | High-performance Redis fork | - | Production |
| Encina.Caching.Dragonfly | Modern Redis-compatible | - | Production |
| Encina.Caching.Garnet | Microsoft's Redis-compatible | - | Production |

**Key Features**:

- `ICacheProvider` abstraction for provider-agnostic caching
- `ICacheKeyGenerator` for consistent key generation
- `CachingPipelineBehavior<TRequest, TResponse>` for automatic query caching
- `[Cache]` attribute with configurable duration and key templates
- Support for cache invalidation patterns
- HybridCache integration for L1 (in-memory) + L2 (distributed) caching

---

## Phase 7: Messaging Transports (Completed 2025-12-21)

10 messaging transport packages completed (2 deprecated: Wolverine, NServiceBus).

### Messaging Transport Packages

| Package | Technology | Version | Key Features |
|---------|------------|---------|--------------|
| Encina.RabbitMQ | RabbitMQ.Client | 7.2.0 | AMQP messaging |
| Encina.AzureServiceBus | Azure.Messaging.ServiceBus | 7.20.1 | Azure cloud |
| Encina.AmazonSQS | AWSSDK.SQS + SNS | 4.0.2.3 | AWS messaging |
| Encina.Kafka | Confluent.Kafka | 2.12.0 | High-throughput streaming |
| Encina.Redis.PubSub | StackExchange.Redis | 2.8.41 | Lightweight pub/sub |
| Encina.InMemory | System.Threading.Channels | Built-in | Testing/development |
| Encina.NATS | NATS.Net | 2.6.11 | Cloud-native + JetStream |
| Encina.MQTT | MQTTnet | 5.0.1 | IoT messaging |
| Encina.gRPC | Grpc.AspNetCore | 2.71.0 | RPC-style messaging |
| Encina.GraphQL | HotChocolate | 15.1.11 | GraphQL bridge |

> **Deprecated**: Encina.Wolverine and Encina.NServiceBus removed due to overlapping concerns with Encina's message bus patterns.

**Key Features**:

- Railway Oriented Programming with `Either<EncinaError, T>` across all transports
- Consistent API pattern: `IXxxMessagePublisher` interfaces
- `IServiceCollection` extension methods for easy DI setup
- Options pattern for configuration
- Subscription support with `IAsyncDisposable` for cleanup

---

## Event Sourcing (Completed 2025-12-21)

### Encina.Marten

**Status**: Production Ready
**Tests**: 16 passing

**Features**:

- `IAggregate` / `AggregateBase` - Event sourcing abstractions
- `IAggregateRepository<TAggregate>` - Repository pattern
- `MartenAggregateRepository<TAggregate>` - Marten implementation with optimistic concurrency
- `EventPublishingPipelineBehavior<TRequest, TResponse>` - Auto-publishes domain events

**Package Dependencies**: `Marten v8.0.0-beta-1`

### Encina.EventStoreDB (DEPRECATED 2025-12-23)

> **Deprecated**: Removed in favor of Encina.Marten which provides better .NET integration.
> Marten uses PostgreSQL (no additional infrastructure) and has C# projections (vs JavaScript).
> Code preserved in `.backup/deprecated-packages/`.

**Features** (when active):

- `IAggregate` / `AggregateBase<TId>` - Event sourcing abstractions
- `IAggregateRepository<TAggregate>` - Repository pattern
- `EventStoreDbAggregateRepository<TAggregate>` - EventStoreDB implementation
- `IEventSerializer` / `JsonEventSerializer` - Event serialization
- `IEventTypeResolver` / `DefaultEventTypeResolver` - Type resolution

**Package Dependencies**: `EventStore.Client.Grpc.Streams v23.3.9`

---

## MongoDB (NEW 2025-12-21)

### Encina.MongoDB

**Status**: Production Ready

**Implemented Components**:

- `OutboxStoreMongoDB` - IOutboxStore implementation
- `InboxStoreMongoDB` - IInboxStore implementation
- `SagaStoreMongoDB` - ISagaStore implementation
- `ScheduledMessageStoreMongoDB` - IScheduledMessageStore implementation
- `MongoDbIndexCreator` - Automatic index creation on startup

**Features**:

- Opt-in configuration (UseOutbox, UseInbox, UseSagas, UseScheduling)
- Automatic index creation for optimal query performance
- TTL indexes for inbox message cleanup
- Full BSON serialization with DateTime UTC handling

**Package Dependencies**: `MongoDB.Driver 3.5.2`

---

## OpenTelemetry (Completed 2025-12-19)

### Encina.OpenTelemetry

**Status**: Production Ready
**Tests**: 71/71 passing

**Features**:

- `EncinaOpenTelemetryOptions` with ServiceName, ServiceVersion
- `MessagingActivityEnricher` for Outbox, Inbox, Sagas, Scheduling
- `MessagingEnricherPipelineBehavior<TRequest, TResponse>` for automatic enrichment
- Docker Compose observability stack (Jaeger, Prometheus, Loki, Grafana)

---

## Stream Requests (Completed 2025-12-21)

**Status**: Production Ready
**Tests**: 98/98 passing

**Features**:

- `IStreamRequest<TItem>` interface
- `IStreamRequestHandler<TRequest, TItem>` interface
- `IStreamPipelineBehavior<TRequest, TItem>` interface
- `StreamPipelineBuilder<TRequest, TItem>` for pipeline construction
- `StreamDispatcher` for handler resolution and execution
- Integration with `IEncina.Stream<TRequest, TItem>()` method

---

## LoggerMessage Delegates (Completed 2025-12-21)

Replaced all `ILogger.LogXxx()` extension methods with high-performance `LoggerMessage` source generators for CA1848 compliance.

**Packages Updated**:

| Package | Log.cs Created | Files Updated |
|---------|----------------|---------------|
| EntityFrameworkCore | 38 EventIds | TransactionPipelineBehavior, InboxPipelineBehavior, OutboxPostProcessor, OutboxProcessor |
| Dapper.SqlServer | 15 EventIds | InboxPipelineBehavior, OutboxPostProcessor, OutboxProcessor |
| Dapper.PostgreSQL | 15 EventIds | Same as above |
| Dapper.MySQL | 15 EventIds | Same as above |
| Dapper.Sqlite | 15 EventIds | Same as above |
| Dapper.Oracle | 15 EventIds | Same as above |
| ADO.SqlServer | 15 EventIds | Same as above |
| ADO.PostgreSQL | 15 EventIds | Same as above |
| ADO.MySQL | 15 EventIds | Same as above |
| ADO.Sqlite | 15 EventIds | Same as above |
| ADO.Oracle | 15 EventIds | Same as above |
| Marten | 20 EventIds | MartenAggregateRepository, EventPublishingPipelineBehavior |
| ~~MassTransit~~ | ~~12 EventIds~~ | ~~(deprecated)~~ |
| Hangfire | 7 EventIds | HangfireRequestJobAdapter, HangfireNotificationJobAdapter |
| Quartz | 9 EventIds | QuartzRequestJob, QuartzNotificationJob |

**Benefits**:

- Zero-allocation logging in hot paths
- Compile-time validation of log parameters
- Structured EventIds for monitoring
- CA1848 compliance without suppressions

---

## Test Architecture (Established 2025-12-19)

### Testcontainers Integration

**What is Testcontainers?**

- Automatic lifecycle management (start/stop/cleanup)
- Wait strategies (database ready before tests run)
- Random port assignment (no conflicts)
- Connection strings auto-generated
- Cross-platform (Windows, Linux, macOS)

### Test Type Characteristics

| Type | Dependencies | Database | Speed | Purpose |
|------|-------------|----------|-------|---------|
| Unit | Mocked | In-memory | <1ms | Isolated logic |
| Guards | N/A | N/A | <1ms | Parameter validation |
| Integration | Real | Testcontainers | 50-100ms | Real DB workflows |
| Property | Mocked | In-memory | <5ms | Invariants |
| Contract | Interface | In-memory | <10ms | API compliance |
| Load | Real | Testcontainers | Seconds | Concurrency/stress |

### Database Provider Test Coverage

- **Dapper Providers (5)**: 1,214 tests total
- **ADO Providers (5)**: 549 tests total
- **Total**: 1,763 database provider tests passing

---

## Known Issues

### MSBuild Stability

Building the full solution can cause MSBuild crashes due to parallel execution overload with the large test suite (70+ projects).

**Mitigations**:

1. Use `-maxcpucount:1` flag for single-process builds
2. Use Solution Filters (.slnf) to build only what you need

---

*Last Updated: 2025-12-21*
