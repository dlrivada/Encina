# December 2025 - Implementation History

This document captures the detailed implementation history for Encina during December 2025.

## Summary

December 2025 was a milestone month for Encina, with the project evolving from **SimpleMediator** to **Encina** and reaching **53 packages** (including CLI tool) at production status:

| Category | Packages | Planned | Tests |
|----------|----------|---------|-------|
| Core & Validation | 5 | - | 524 |
| Web Integration | 2 | - | 52 |
| Serverless | 2 | - | 255 |
| Database Providers | 11 | - | 1,763 |
| Messaging Transports | 10 | +6 | - |
| Caching | 8 | - | 367 |
| Job Scheduling | 2 | - | 36 |
| Resilience | 3 | - | - |
| Event Sourcing | 1 | - | 16 |
| Developer Tooling | 1 | - | 65 |
| EIP & Interop | - | +4 | - |

**Total: 53 packages implemented, 10 planned (via Phase 2 issues), 4,000+ tests**

> **Note**: 5 packages were deprecated:
> - Wolverine, NServiceBus, MassTransit, Dapr - overlapping concerns with Encina's messaging
> - EventStoreDB - Marten provides better .NET integration for Event Sourcing
>
> Code preserved in `.backup/deprecated-packages/`.

---

## Week 1: December 14-15 (Foundation)

### December 14 - Validation Satellite Packages

**Commits**: `21426b7`, `e8ae585`, `86bbee1`, `4595130`, `0b970b6`, `e50ad34`, `445f303`, `34ed3a3`, `3353c63`, `44853ef`

**IRequestContext Implementation**:
- Added `IRequestContext` interface for pipeline extensibility
- Implemented `RequestContext` with CorrelationId, UserId, TenantId, Metadata
- Added `IRequestContextAccessor` with AsyncLocal storage

**Validation Packages Created**:
- **SimpleMediator.FluentValidation**: Full FluentValidation integration with ROP
- **SimpleMediator.DataAnnotations**: Built-in .NET validation attributes
- **SimpleMediator.MiniValidator**: Ultra-lightweight validation (~20KB)
- **SimpleMediator.GuardClauses**: Defensive programming with Ardalis.GuardClauses

**Documentation**:
- Comprehensive READMEs for each validation package
- GuardClauses design analysis document
- Updated FEATURES_ROADMAP with validation status

---

## Week 2: December 17-18 (Database Providers)

### December 17 - Dapper & ADO.NET Providers

**Commits**: `457c3ad`, `5c85efa`, `85abaf0`

**Dapper Provider**:
- Created `SimpleMediator.Dapper` with all messaging patterns
- Implemented OutboxStore, InboxStore, SagaStore, ScheduledMessageStore
- Added test infrastructure with `SimpleMediator.Dapper.Tests`

**ADO.NET Provider**:
- Created `SimpleMediator.ADO` with pure ADO.NET implementation
- Same interface as Dapper, different implementation
- Zero ORM dependencies

### December 18 - Multi-Database Support

**Commits**: `f5e93a5`, `8fa9c40`, `87ad983`, `fd7c64b`, `e080250`, `15e7ae2`, `9d43bf8`, `6e7259f`, `cac590d`, `122a069`, `660581e`, `fc7d6e8`, `de05ce3`, `7efe416`, and many more

**Database Providers Added**:

| Database | Dapper Package | ADO.NET Package |
|----------|---------------|-----------------|
| SQL Server | SimpleMediator.Dapper.SqlServer | SimpleMediator.ADO.SqlServer |
| PostgreSQL | SimpleMediator.Dapper.PostgreSQL | SimpleMediator.ADO.PostgreSQL |
| MySQL/MariaDB | SimpleMediator.Dapper.MySQL | SimpleMediator.ADO.MySQL |
| SQLite | SimpleMediator.Dapper.Sqlite | SimpleMediator.ADO.Sqlite |
| Oracle | SimpleMediator.Dapper.Oracle | SimpleMediator.ADO.Oracle |

**SQL Dialect Translation**:
- Each provider implements dialect-specific SQL (TOP vs LIMIT, GETUTCDATE vs NOW, etc.)
- All providers share same interfaces from `SimpleMediator.Messaging`

**EntityFrameworkCore & AspNetCore**:
- Added `SimpleMediator.EntityFrameworkCore` with full messaging pattern support
- Added `SimpleMediator.AspNetCore` with middleware, authorization, Problem Details

**Infrastructure**:
- GitHub Actions workflow monitoring scripts
- SonarCloud workflow configuration
- Docker infrastructure for integration testing
- Stryker mutation testing configuration
- Standardized artifacts output paths

**Documentation**:
- Established MANDATORY 100% test coverage policy
- Unified tracking documents into single ROADMAP.md

---

## Week 3: December 19-20 (Testing & Observability)

### December 19 - OpenTelemetry & Stream Requests

**Commits**: `bbd8264`, `7954ddb`, `b501c38`, `01469f1`, `7b35ebe`, `9114592`, `0278cdc`, `34f8ac2`, and more

**OpenTelemetry Integration**:
- Created `SimpleMediator.OpenTelemetry` package
- `EncinaOpenTelemetryOptions` with ServiceName, ServiceVersion
- `MessagingActivityEnricher` for Outbox, Inbox, Sagas, Scheduling
- `MessagingEnricherPipelineBehavior<TRequest, TResponse>`
- Docker Compose observability stack (Jaeger, Prometheus, Loki, Grafana)

**Stream Requests**:
- Implemented `IStreamRequest<TItem>` interface
- `IStreamRequestHandler<TRequest, TItem>` interface
- `IStreamPipelineBehavior<TRequest, TItem>` interface
- `StreamPipelineBuilder<TRequest, TItem>` for pipeline construction
- `StreamDispatcher` for handler resolution and execution
- 98 tests passing

**Dapr Building Blocks**:
- Completed State Management, Bindings, Secrets building blocks
- (Later deprecated in Week 4)

**Comprehensive Test Suite**:
- Added 1,763 database provider tests
- Guard and Contract tests for Stream Requests (31 tests)
- Property, Integration and Load tests for Stream Requests (56 tests)
- Messaging pattern benchmarks (Outbox, Inbox, Infrastructure)

### December 20 - Test Coverage Expansion

**Commits**: `937d4a0`, `288fb9f`, `7c163dd`, `330c10c`, `15e6a34`, `21491cd`, `4cc699a`, `a1362d7`, `3c658fc`, `1e9de53`, `ef01d25`, and more

**Validation Test Coverage**:
- FluentValidation: 68 tests total
- DataAnnotations: 40% → 95% coverage
- MiniValidator: 40% → 95% coverage
- GuardClauses: 50% → 95% coverage

**Job Scheduling Tests**:
- Complete test project structure for Hangfire and Quartz
- Guard, Contract, Property, Integration, Load tests
- Job scheduling benchmarks for Quartz.NET
- Validation benchmarks comparing 4 validation approaches

**AspNetCore & EF Core Tests**:
- AspNetCore comprehensive test suite: 104 total tests
- EntityFrameworkCore comprehensive test suite: 100% coverage

**Resilience Packages**:
- Created `SimpleMediator.Extensions.Resilience`
- Created `SimpleMediator.Polly` with retry, circuit breaker, timeout
- Created `SimpleMediator.Refit` for HTTP client integration
- Complete test suite with 100% coverage

**Performance Benchmarks**:
- Provider comparison benchmarks (ADO.NET vs Dapper vs EF Core)
- Saga and Scheduling provider comparison benchmarks
- Custom FsCheck generators for property-based tests

**Crash Investigation**:
- Documented two issues identified during testing
- MSBuild stability issues with large solution

---

## Week 4: December 21 (Major Features)

### December 21 - Caching, Messaging, Event Sourcing

**Commits**: `fc276f2`, `89c7e3c`, `cf6377e`, `2b8646d`, `9271f19`, `8e5eb55`, `debdd0b`, `7e1acf3`, `9d95b83`, `f00fd59`, `b854bbe`, `34ed013`, `87adf91`, `c8403ae`, `eb88cd5`, `0af8316`, `cbdb6fb`, `6e0ac3b`, `a380937`, `e8e3578`

**Caching Infrastructure (8 packages)**:

| Package | Purpose | Tests |
|---------|---------|-------|
| SimpleMediator.Caching | Core abstractions | 49 |
| SimpleMediator.Caching.Memory | In-memory caching | 109 |
| SimpleMediator.Caching.Hybrid | Multi-tier (L1+L2) | 56 |
| SimpleMediator.Caching.Redis | StackExchange.Redis | - |
| SimpleMediator.Caching.Valkey | Open-source Redis | - |
| SimpleMediator.Caching.KeyDB | High-performance Redis fork | - |
| SimpleMediator.Caching.Dragonfly | Modern Redis-compatible | - |
| SimpleMediator.Caching.Garnet | Microsoft's Redis-compatible | - |

**Key Caching Features**:
- `ICacheProvider` abstraction for provider-agnostic caching
- `ICacheKeyGenerator` for consistent key generation
- `CachingPipelineBehavior<TRequest, TResponse>` for automatic query caching
- `[Cache]` attribute with configurable duration and key templates
- HybridCache integration for L1 (in-memory) + L2 (distributed) caching

**Messaging Transports (10 packages)**:

| Package | Technology | Version |
|---------|------------|---------|
| SimpleMediator.RabbitMQ | RabbitMQ.Client | 7.2.0 |
| SimpleMediator.AzureServiceBus | Azure.Messaging.ServiceBus | 7.20.1 |
| SimpleMediator.AmazonSQS | AWSSDK.SQS + SNS | 4.0.2.3 |
| SimpleMediator.Kafka | Confluent.Kafka | 2.12.0 |
| SimpleMediator.Redis.PubSub | StackExchange.Redis | 2.8.41 |
| SimpleMediator.InMemory | System.Threading.Channels | Built-in |
| SimpleMediator.NATS | NATS.Net | 2.6.11 |
| SimpleMediator.MQTT | MQTTnet | 5.0.1 |
| SimpleMediator.gRPC | Grpc.AspNetCore | 2.71.0 |
| SimpleMediator.GraphQL | HotChocolate | 15.1.11 |

**Event Sourcing**:
- Created `SimpleMediator.Marten` with Marten v8.0.0-beta-1
- Created `SimpleMediator.EventStoreDB` (later deprecated)
- `IAggregate` / `AggregateBase` abstractions
- `IAggregateRepository<TAggregate>` pattern
- `EventPublishingPipelineBehavior` for auto-publishing domain events

**Additional Features**:
- Parallel notification dispatch strategies (opt-in)
- Choreography-based saga abstractions (event-driven)
- MassTransit integration (later deprecated)
- Delegate cache optimization

**SignalR Integration**:
- Created `SimpleMediator.SignalR`
- `EncinaHub` base class for SignalR hubs
- `[BroadcastToSignalR]` attribute for declarative notification broadcasting
- `SignalRBroadcastHandler<T>` generic notification handler
- `ISignalRNotificationBroadcaster` service

**MongoDB Integration**:
- Created `SimpleMediator.MongoDB`
- `OutboxStoreMongoDB`, `InboxStoreMongoDB`, `SagaStoreMongoDB`, `ScheduledMessageStoreMongoDB`
- `MongoDbIndexCreator` for automatic index creation
- TTL indexes for inbox message cleanup

**LoggerMessage Source Generators**:
- Replaced all `ILogger.LogXxx()` with high-performance `LoggerMessage` source generators
- CA1848 compliance across all packages
- Zero-allocation logging in hot paths

---

## Week 5: December 22 (Renaming & Stabilization)

### December 22 - SimpleMediator → Encina

**Commits**: `cab5e04`, `2f86e28`, `b59f866`, `3e8df3b`, `14f429c`, `962e28d`, `589f5ca`, `c993620`, `f461883`, `e5732ba`, `f0c2565`, `c4e7f41`, `b375dc1`, `3eeef9b`, `0f84bef`, `10a2858`, `2cd1f0d`, `7577821`, `5cfab7c`, `b4339bc`, `f1ea1d0`, `63cdae7`, `4d4b29a`, `d900b81`, `1e9c86e`, `227647d`, `3638e6c`, `2532d03`, `5047426`, `972cf83`, `469085b`

**Major Renaming**:
- Renamed project from **SimpleMediator** to **Encina**
- Updated all namespaces, package names, and references
- Corrected error code case to lowercase (`encina.*` instead of `Encina.*`)
- Complete renaming cleanup across entire codebase

**License Change**:
- Changed license from proprietary to **MIT**

**GitHub Infrastructure**:
- Added GitHub Issue templates (bug_report, feature_request, technical_debt)
- Improved issue tracking workflow
- Added Known Issues section to CLAUDE.md

**Test Suite Fixes**:
- Comprehensive test suite fixes for validation behaviors
- Fixed namespace in SQLite IntegrationTests for CI filter
- Prevented duplicate behavior registration
- Skipped CLR-crashing load tests (Issue #5)
- Removed 10 obsolete skipped tests
- Registered IStreamRequestHandler and IStreamPipelineBehavior via assembly scanning

**CI/CD Improvements**:
- Excluded LoadTests/IntegrationTests from SonarCloud
- Temporarily excluded ContractTests/PropertyTests from SonarCloud (Issue #7)
- Added test filter for CI runs
- Fixed Quality Gate coverage and CI benchmark AOT errors

**Security Fixes**:
- Removed hardcoded passwords from configuration files
- Moved write permissions from workflow to job level

**Code Quality**:
- Suppressed Roslyn style warnings (IDE0008, IDE0058, IDE0160, IDE0011)
- Removed unnecessary usings
- Simplified outcome extraction and null handling
- Refactored loop variable declarations for consistency
- Added missing assertions to HybridCacheProvider tests (S2699)
- Resolved SonarCloud Medium Code Smells

---

## Week 6: December 23 (Orchestrator Pattern & CI Fixes)

### December 23 - Validation Orchestrator & Workflow Stabilization

**Commits**: `69389b0`, `c137e40`, `7d90827`, `bb17709`, `c9aebbe`, `d0b64a7`, `f0ebf3a`, `af9ad93`, `3cad5c4`, `5912e0f`, `05a4098`, `9123107`, `0967f02`, `e155d27`, `1db9031`, `3ee2327`, `634a0d4`, `bf86daf`, `f171f6d`, `7d579da`, `0adcc74`, `c854503`, `f9b515a`, `ef199ab`, `cf6cadb`, `fc36f4d`, `a2d0f61`, `8301a07`, `1fcca63`, `87d92a3`, `6a72163`, `c66625f`, `8b5b7e5`, `35b848f`, `8d85873`

**Validation Orchestrator Pattern**:

All validation packages now use the centralized Orchestrator pattern:

```text
Encina (core)
├── Encina.Validation.IValidationProvider (interface)
├── Encina.Validation.ValidationOrchestrator (domain logic)
├── Encina.Validation.ValidationPipelineBehavior<,> (centralized behavior)
├── Encina.Validation.ValidationResult (immutable result)
└── Encina.Validation.ValidationError (record)

Encina.FluentValidation / DataAnnotations / MiniValidator
├── *ValidationProvider (implements IValidationProvider)
└── ServiceCollectionExtensions (registers orchestrator + provider)
```

**Messaging Orchestrator/Factory Architecture**:
- Created InboxOrchestrator, OutboxOrchestrator, SagaOrchestrator, SchedulerOrchestrator
- Added factory interfaces: IInboxMessageFactory, IOutboxMessageFactory, ISagaStateFactory, IScheduledMessageFactory
- Implemented factories for all 12 providers (Dapper x5, ADO x5, EF Core, MongoDB)
- Centralized InboxPipelineBehavior and OutboxPostProcessor in Encina.Messaging

**Security Fixes**:
- Added `SqlIdentifierValidator` to prevent SQL injection (S2077)
- All store files validate table names against safe regex pattern

**Deprecations**:
- Deprecated EventStoreDB (Marten provides better .NET integration)
- Deprecated Wolverine, NServiceBus, MassTransit, Dapr (overlapping concerns)
- Code preserved in `.backup/deprecated-packages/`

**CI/CD Fixes (Many Iterations)**:
- Fixed `InboxEfCoreBenchmarks.IterationSetup()` return type (async → sync)
- Added solution filters for messaging, resilience, event-sourcing, observability
- Added VSCode tasks.json with safe build/test configs
- Lowered coverage threshold to 50% until Phase 3 work
- Lower NBomber thresholds for GitHub Actions runners
- Lower load test thresholds for GitHub Actions runners
- Improved benchmark CSV parsing and mutation report path detection
- Optimized CI by splitting heavy tasks into separate workflows
- Configured SonarQubeTestProject to fix coverage detection
- Added FluentAssertions to Encina.Tests after removing from core

**Documentation**:
- Restructured ROADMAP with 6-phase development approach
- Documented Issue #5 as blocked by .NET 10 JIT bug
- Updated CHANGELOG with 2025-12-23 fixes
- Removed obsolete CA1848 suppressions after LoggerMessage migration
- Added comprehensive Saga patterns documentation
- Converted ASCII diagrams to Mermaid for GitHub rendering
- Added comprehensive Messaging Transports documentation

**SonarCloud Configuration**:
- Excluded intentional SQL dialect duplication from analysis
- Fixed test failures in PropertyTests and ContractTests
- Corrected ADO.Oracle and ADO.Sqlite SQL scripts syntax
- Resolved security hotspots and additional code smells

---

## Week 7: December 24 (Security & Documentation)

### December 24 - Security Hotspots & Documentation Cleanup

**Commits**: `ae9c376`, `4d7dc00`, `760e27c`, `e1c68db`, `19f2402`, `5a3c712`, `9090ed0`, `2b50a1e`, `29dead5`

**Security Hotspot Fixes**:

1. **DoS Prevention (S6444)** - Added regex timeout to prevent ReDoS attacks:
   - `Encina.Caching.Hybrid/HybridCacheProvider.cs`
   - `Encina.Caching.Memory/MemoryCacheProvider.cs`
   - `Encina.Caching.Memory/MemoryPubSubProvider.cs`
   - `Encina.GuardClauses/Guards.cs`
   - `Encina.SignalR/SignalRNotificationBroadcaster.cs`
   - Added `TimeSpan.FromSeconds(1)` to all Regex constructors

2. **SQL Injection False Positives (S2077)** - Configured SonarCloud suppressions:
   - All Dapper store files: `src/Encina.Dapper.*/**/*Store*.cs`
   - All ADO store files: `src/Encina.ADO.*/**/*Store*.cs`
   - Justification: `SqlIdentifierValidator.ValidateTableName()` validates table names

3. **RCE False Positives (S1523)** - Configured SonarCloud suppressions:
   - All SQL scripts: `src/**/Scripts/*.sql`
   - Justification: Static DDL scripts, no dynamic code injection

**Code Consolidation**:
- Centralized messaging patterns with shared `Log.cs` and `TransactionPipelineBehavior.cs`
- Reduced code duplication from ~11% to 1.7%

**Error Handling Improvements**:
- Refactored Encina error handling and validation guards
- Improved null handling in InboxOrchestrator response deserialization

**Documentation Cleanup**:
- Removed state/roadmap tracking from CLAUDE.md (moved to ROADMAP.md)
- CLAUDE.md now contains only stable AI instructions

---

## Week 10: December 30 (Testing Infrastructure)

### December 30 - Encina.Testing.Fakes Package (Issue #426)

**Commits**: See git log for details

**New Package: Encina.Testing.Fakes**

Created the first package of the v0.11.0 Testing Infrastructure milestone:

**Core Components**:
- `FakeEncina` - Thread-safe in-memory IEncina implementation with:
  - Response configuration: `SetupResponse<TRequest, TResponse>()`
  - Error configuration: `SetupError<TRequest, TResponse>()`
  - Stream configuration: `SetupStream<TRequest, TItem>()`
  - Verification: `WasSent<T>()`, `WasPublished<T>()`, `WasStreamed<T>()`
  - Inspection: `GetSentRequests<T>()`, `GetPublishedNotifications<T>()`
  - Factory function support for dynamic responses
  - Order-preserving collections using `List<T>` with locking

**Fake Store Implementations**:
- `FakeOutboxStore` - IOutboxStore with verification tracking
- `FakeInboxStore` - IInboxStore with deduplication testing
- `FakeSagaStore` - ISagaStore with saga lifecycle tracking
- `FakeScheduledMessageStore` - IScheduledMessageStore for scheduling tests
- `FakeDeadLetterStore` - IDeadLetterStore for error handling tests

**DI Integration**:
- `AddFakeEncina()` - Register FakeEncina as IEncina
- `AddFakeStores()` - Register all fake stores
- `AddEncinaTestingFakes()` - Complete fake registration

**Tests**: 42 unit tests covering all functionality

**Design Decisions**:
- Changed from `ConcurrentBag` to `List` with locking to preserve insertion order
- Important for test verification where order matters
- All operations remain thread-safe for parallel test execution

### December 30 - FakeTimeProvider (Issue #433) 

**New Feature: FakeTimeProvider in Encina.Testing**

Added controllable time provider for testing time-dependent code:

**Core Components**:
- `FakeTimeProvider` - Thread-safe `TimeProvider` implementation:
  - Time manipulation: `SetUtcNow()`, `Advance()`, `AdvanceToNextDay()`, `AdvanceToNextHour()`
  - Convenience methods: `AdvanceMinutes()`, `AdvanceSeconds()`, `AdvanceMilliseconds()`
  - Frozen time scope via `Freeze()` for temporary time changes
  - `Reset()` to restore time and clear timers
  - `ActiveTimerCount` for timer verification

- `FakeTimer` - Internal timer implementation:
  - Full `ITimer` interface support
  - One-shot and periodic timer modes
  - Deterministic firing controlled by time advancement
  - Proper disposal and cleanup

**Tests**: 42 unit tests covering:
- Constructor variations (default, with time, with timezone)
- Time manipulation (SetUtcNow, Advance, convenience methods)
- Validation (negative duration, backwards time)
- Freeze scope behavior (including nested scopes)
- Reset functionality
- Timer operations (creation, firing, disposal, periodic)
- Thread safety

**Design Decisions**:
- Timers only fire when time is advanced, not automatically
- `DisposeWithoutRemoval()` method to avoid collection modification during Reset
- Thread-safe with locking for parallel test execution

### December 30 - Encina.Testing.Shouldly Package (Issue #429)

#### New Package: Encina.Testing.Shouldly

Created Shouldly-based assertion extensions as open-source alternative to FluentAssertions:

**Core Extensions**:
- `EitherShouldlyExtensions` - Main assertions for `Either<TLeft, TRight>`:
  - Success: `ShouldBeSuccess()`, `ShouldBeRight()`, with overloads for expected value and validators
  - Error: `ShouldBeError()`, `ShouldBeLeft()`, with validator overloads
  - EncinaError-specific: `ShouldBeValidationError()`, `ShouldBeNotFoundError()`, `ShouldBeAuthorizationError()`, `ShouldBeConflictError()`, `ShouldBeInternalError()`
  - `ShouldBeErrorWithCode()`, `ShouldBeErrorContaining()`
  - Async versions for all assertions

- `EitherCollectionShouldlyExtensions` - Batch operation assertions:
  - `ShouldAllBeSuccess()`, `ShouldAllBeError()`
  - `ShouldContainSuccess()`, `ShouldContainError()`
  - `ShouldHaveSuccessCount()`, `ShouldHaveErrorCount()`
  - `GetSuccesses()`, `GetErrors()` helpers

- `AggregateShouldlyExtensions` - Event sourcing assertions:
  - `ShouldHaveRaisedEvent<T>()` with predicate overloads
  - `ShouldHaveRaisedEvents<T>(count)`
  - `ShouldNotHaveRaisedEvent<T>()`
  - `ShouldHaveNoUncommittedEvents()`, `ShouldHaveUncommittedEventCount()`
  - `ShouldHaveVersion()`, `ShouldHaveId()`

**Tests**: 71 unit tests covering all assertion methods

**Design Decisions**:
- Uses explicit `if` checks instead of Shouldly's `ShouldStartWith` for case-insensitive comparison
- Foreach loops instead of `FirstOrDefault` to avoid LanguageExt bottom state issues
- Open-source alternative to FluentAssertions ($130/dev/year commercial license)

### December 30 - Encina.Testing.Respawn Package (Issue #427)

#### New Package: Encina.Testing.Respawn

Created intelligent database cleanup for integration tests using the Respawn library:

**Core Components**:
- `DatabaseRespawner` - Abstract base class with common initialization logic
- `SqlServerRespawner` - SQL Server implementation via Respawn
- `PostgreSqlRespawner` - PostgreSQL implementation via Respawn
- `MySqlRespawner` - MySQL/MariaDB implementation via Respawn
- `SqliteRespawner` - Custom implementation (Respawn doesn't support SQLite natively)
- `RespawnerFactory` - Factory for creating respawners with automatic provider detection
- `RespawnAdapter` - Enum for supported database adapters
- `RespawnOptions` - Configuration class

**RespawnOptions Features**:
- `TablesToIgnore` - Exclude specific tables from cleanup
- `SchemasToInclude` / `SchemasToExclude` - Schema filtering
- `ResetEncinaMessagingTables` - Option to preserve Outbox/Inbox/Saga tables (default: true)
- `WithReseed` - Reset identity columns (default: true)
- `CheckTemporalTables` - Handle SQL Server temporal tables
- `EncinaMessagingTables` - Static list of Encina messaging tables

**RespawnerFactory Features**:
- `Create(adapter, connectionString, options)` - Create provider-specific respawner
- `CreateSqlite(connectionString, options)` - Create SQLite respawner
- `InferAdapter(connectionString)` - Automatic provider detection from connection string
  - Detects SQL Server, PostgreSQL, MySQL, Oracle patterns
  - Uses connection string keywords: `Server=`, `Host=`, `Data Source=`, port numbers

**Builder Pattern Support**:
- `FromBuilder(Action<ConnectionStringBuilder>)` - Fluent API for connection string construction
- Integrates with provider-specific connection string builders

**Tests**: 74 unit tests covering:
- Constructor validation for all providers
- Options configuration and propagation
- Factory methods with all adapter types
- Connection string inference for SQL Server, PostgreSQL, MySQL, Oracle
- Edge cases (null, empty, whitespace connection strings)

**Test Type Justifications**:
1. **Unit Tests** ✅ - Implemented (74 tests)
2. **Integration Tests** - Would test actual database resets with real databases. Requires Docker/Testcontainers infrastructure which is available in the project (`TestInfrastructure`). **Deferred** - tests are essentially what users would write; examples provided in README.
3. **Property-Based Tests** - Not applicable. No complex invariants or algebraic properties to verify.
4. **Contract Tests** - Not applicable. Package implements Respawn library contracts, not Encina-defined interfaces.
5. **Guard Clause Tests** - Already covered in unit tests via ArgumentException validation.
6. **Load Tests** - Not applicable. Database cleanup is not performance-critical (runs between tests).
7. **Benchmarks** - Not applicable. Respawn performance is Respawn library's concern, not ours.

---

## Technical Reference

### SQL Dialect Translation Matrix

| Feature | SQL Server | PostgreSQL | MySQL/MariaDB | SQLite | Oracle |
|---------|-----------|------------|---------------|--------|--------|
| UTC Timestamp | `GETUTCDATE()` | `NOW() AT TIME ZONE 'UTC'` | `UTC_TIMESTAMP()` | `datetime('now')` | `SYS_EXTRACT_UTC(SYSTIMESTAMP)` |
| Result Limit | `TOP N` | `LIMIT N` | `LIMIT N` | `LIMIT N` | `FETCH FIRST N ROWS ONLY` |
| GUID Type | `UNIQUEIDENTIFIER` | `UUID` | `CHAR(36)` | `TEXT` | `RAW(16)` or `VARCHAR2(36)` |
| Large Text | `NVARCHAR(MAX)` | `TEXT` | `TEXT` | `TEXT` | `CLOB` |
| DateTime | `DATETIME2(7)` | `TIMESTAMP` | `DATETIME(6)` | `TEXT (ISO8601)` | `TIMESTAMP` |
| Parameters | `@ParameterName` | `@ParameterName` | `@ParameterName` | `@ParameterName` | `:ParameterName` |

### Package Dependencies

**Database Providers**:
- SQL Server: `Microsoft.Data.SqlClient 6.1.3`
- PostgreSQL: `Npgsql 10.0.1`
- MySQL: `MySqlConnector 2.5.0`
- SQLite: `Microsoft.Data.Sqlite 10.0.1`
- Oracle: `Oracle.ManagedDataAccess.Core 23.26.0`

**Performance Comparison** (ADO.NET vs Dapper vs EF Core):
- ADO.NET: 63ms (baseline - fastest)
- Dapper: 100ms (1.59x slower)
- EF Core: 180ms (2.86x slower)

### Test Architecture

| Type | Dependencies | Database | Speed | Purpose |
|------|-------------|----------|-------|---------|
| Unit | Mocked | In-memory | <1ms | Isolated logic |
| Guards | N/A | N/A | <1ms | Parameter validation |
| Integration | Real | Testcontainers | 50-100ms | Real DB workflows |
| Property | Mocked | In-memory | <5ms | Invariants |
| Contract | Interface | In-memory | <10ms | API compliance |
| Load | Real | Testcontainers | Seconds | Concurrency/stress |

---

## Known Issues

### MSBuild Stability

Building the full solution can cause MSBuild crashes due to parallel execution overload with the large test suite (70+ projects).

**Mitigations**:
1. Use `-maxcpucount:1` flag for single-process builds
2. Use Solution Filters (.slnf) to build only what you need

### CLR Crash on .NET 10 (Issue #5)

Stream load tests cause CLR crash on .NET 10 due to JIT bug.

- **Upstream Bug**: [dotnet/runtime#121736](https://github.com/dotnet/runtime/issues/121736)
- **Status**: Fixed in .NET 11, awaiting .NET 10.x backport
- **Workaround**: Set `DOTNET_JitObjectStackAllocationConditionalEscape=0`

---

## Week 8: December 25-26 (Health Checks & Sagas)

### December 25 - Saga Timeout Support & ROP Extensions

**Issue Closed**: `#38` (Saga Timeout Support)

**Saga Timeout Implementation**:
- Added `TimeoutAtUtc` property to `ISagaState` interface
- Added `SagaStatus.TimedOut` status constant
- Added `SagaErrorCodes.Timeout` error code
- Implemented `TimeoutAsync()` method in `SagaOrchestrator`
- Implemented `GetExpiredSagasAsync()` method in `ISagaStore` and all implementations
- Added `StartAsync()` overload with timeout parameter
- Added `DefaultSagaTimeout` and `ExpiredSagaBatchSize` options in `SagaOptions`
- Full implementation across all providers (EF Core, Dapper, MongoDB, ADO.NET)

**ROP Assertion Extensions** (Encina.TestInfrastructure.Extensions):
- `ShouldBeSuccess()` / `ShouldBeRight()` - Assert Either is Right
- `ShouldBeError()` / `ShouldBeLeft()` - Assert Either is Left
- `ShouldBeBottom()` / `ShouldNotBeBottom()` - Assert Either default state
- `AllShouldBeSuccess()` / `AllShouldBeError()` - Collection assertions
- `ShouldContainSuccess()` / `ShouldContainError()` - Collection contains assertions
- `ShouldBeErrorWithCode()`, `ShouldBeValidationError()`, `ShouldBeAuthorizationError()` - EncinaError assertions
- Async variants: `ShouldBeSuccessAsync()`, `ShouldBeErrorAsync()`, `ShouldBeErrorWithCodeAsync()`

**Validation Guards**:
- Added unit tests for Request and Notification validation guards

### December 26 - Health Check Infrastructure (Issue #113)

**Issue Closed**: `#35` (Health Check Abstractions), `#113` (Automatic Provider Health Checks)

**Health Check Abstractions** (Encina.Messaging.Health):
- `IEncinaHealthCheck` interface for provider-agnostic health monitoring
- `HealthCheckResult` struct with `Healthy`/`Degraded`/`Unhealthy` status
- `EncinaHealthCheck` abstract base class with exception handling
- `OutboxHealthCheck` for monitoring pending outbox messages
- `InboxHealthCheck` for monitoring inbox processing state
- `SagaHealthCheck` for detecting stuck/expired sagas
- `SchedulingHealthCheck` for monitoring overdue scheduled messages
- Configurable warning/critical thresholds for all health checks
- `CompositeEncinaHealthCheck` for aggregating multiple health checks

**ASP.NET Core Integration** (Encina.AspNetCore.Health):
- `EncinaHealthCheckAdapter` for ASP.NET Core health check integration
- Extension methods: `AddEncinaHealthChecks()`, `AddEncinaOutbox()`, `AddEncinaInbox()`, `AddEncinaSaga()`, `AddEncinaScheduling()`
- Kubernetes readiness/liveness probe compatible

**Automatic Provider Health Checks**:
- `ProviderHealthCheckOptions` for configuring provider health checks (enabled by default)
- `DatabaseHealthCheck` abstract base class for database connectivity checks
- Opt-out via `config.ProviderHealthCheck.Enabled = false`

**Database Health Checks**:

| Provider | Package | Health Check |
|----------|---------|--------------|
| PostgreSQL | Encina.Dapper.PostgreSQL | `PostgreSqlHealthCheck` |
| MySQL | Encina.Dapper.MySQL | `MySqlHealthCheck` |
| SQL Server | Encina.Dapper.SqlServer | `SqlServerHealthCheck` |
| Oracle | Encina.Dapper.Oracle | `OracleHealthCheck` |
| SQLite | Encina.Dapper.Sqlite | `SqliteHealthCheck` |
| PostgreSQL | Encina.ADO.PostgreSQL | `PostgreSqlHealthCheck` |
| MySQL | Encina.ADO.MySQL | `MySqlHealthCheck` |
| SQL Server | Encina.ADO.SqlServer | `SqlServerHealthCheck` |
| Oracle | Encina.ADO.Oracle | `OracleHealthCheck` |
| SQLite | Encina.ADO.Sqlite | `SqliteHealthCheck` |
| EF Core | Encina.EntityFrameworkCore | `EntityFrameworkCoreHealthCheck` |

**Infrastructure Health Checks**:

| Provider | Package | Health Check |
|----------|---------|--------------|
| MongoDB | Encina.MongoDB | `MongoDbHealthCheck` |
| Redis/Valkey/KeyDB | Encina.Caching.Redis | `RedisHealthCheck` |
| RabbitMQ | Encina.RabbitMQ | `RabbitMQHealthCheck` |
| Kafka | Encina.Kafka | `KafkaHealthCheck` |
| Azure Service Bus | Encina.AzureServiceBus | `AzureServiceBusHealthCheck` |
| Amazon SQS | Encina.AmazonSQS | `AmazonSQSHealthCheck` |
| NATS | Encina.NATS | `NATSHealthCheck` |
| MQTT | Encina.MQTT | `MQTTHealthCheck` |
| Marten | Encina.Marten | `MartenHealthCheck` |
| Hangfire | Encina.Hangfire | `HangfireHealthCheck` |
| Quartz.NET | Encina.Quartz | `QuartzHealthCheck` |

**Saga Not Found Handler** (Issue #43):
- `IHandleSagaNotFound<TMessage>` interface for custom handling when saga correlation fails
- `SagaNotFoundContext` with `Ignore()` and `MoveToDeadLetterAsync()` actions
- `SagaNotFoundAction` enum (`None`, `Ignored`, `MovedToDeadLetter`)
- `ISagaNotFoundDispatcher` for invoking registered handlers
- `SagaErrorCodes.HandlerCancelled` and `SagaErrorCodes.HandlerFailed` error codes

**Modular Monolith Support** (Issue #57):
- `IModule` interface for defining application modules
- `IModuleLifecycle` interface for modules with startup/shutdown hooks
- `IModuleRegistry` for runtime module discovery and lookup
- `ModuleConfiguration` for fluent module registration
- `ModuleLifecycleHostedService` for automatic lifecycle management
- `AddEncinaModules()` extension method for service registration
- Automatic handler discovery from module assemblies
- Module ordering: start in registration order, stop in reverse (LIFO)

**Module Health Checks** (Issue #114):
- `IModuleWithHealthChecks` interface for modules to expose their own health checks
- `IModuleHealthCheck` interface for module-specific health checks with `ModuleName` property
- `AddEncinaModuleHealthChecks()` extension for registering all module health checks
- `AddEncinaModuleHealthChecks<TModule>()` for registering specific module health checks
- Automatic tagging with `encina`, `ready`, and `modules` tags
- Unit tests for all module health check functionality
- Updated Encina.AspNetCore README with module health check documentation

**Health Checks Integration Guide** (Issue #115):
- Created comprehensive guide at `docs/guides/health-checks.md`
- Covers integration with `AspNetCore.HealthChecks.*` ecosystem packages
- Examples for microservice and modular monolith architectures
- Kubernetes probes configuration (liveness, readiness, startup probes)
- Recommended NuGet packages table:
  - Databases: PostgreSQL, SQL Server, MySQL, Oracle, SQLite, MongoDB, CosmosDB, DynamoDB
  - Caching: Redis, Memcached
  - Message Brokers: RabbitMQ, Kafka, Azure Service Bus, AWS SQS
  - Cloud Services: Azure Storage, Key Vault, AWS S3
  - External Services: HTTP/URLs, gRPC, SignalR
- Health Check UI integration
- Best practices for health check organization and tagging
- Linked from Encina.AspNetCore README

**Breaking Changes**:
- `EncinaErrors.Create()` and `EncinaErrors.FromException()` `details` parameter changed from `object?` to `IReadOnlyDictionary<string, object?>?` (Issue #34)
- `EncinaErrorExtensions.GetDetails()` now returns `IReadOnlyDictionary<string, object?>` instead of `Option<object>`

**Integration Tests with Testcontainers**:
- Created fixtures: `MongoDbFixture`, `RabbitMqFixture`, `KafkaFixture`, `NatsFixture`, `RedisFixture`
- Integration test projects: MongoDB, RabbitMQ, Kafka, NATS, Marten
- 21 integration tests validating health checks against real infrastructure

**Issue #116 - EF Core PropertyTests Fix**:
- Removed obsolete FsCheck 2.x files (`Generators.cs`, `OutboxStoreEFFsCheckTests.cs`)
- Fixed `SagaStatus` type ambiguity in `SagaStoreEFPropertyTests.cs`
- Fixed `SagaStatus` type ambiguity in `SagaStoreEFIntegrationTests.cs`

**Health Check Documentation**:
- Updated README.md (main) with Health Checks overview section
- Updated Encina.EntityFrameworkCore/README.md with health check documentation
- Updated Encina.Dapper.PostgreSQL/README.md with health check documentation
- Updated Encina.Hangfire/README.md with health check documentation
- Updated Encina.Quartz/README.md with health check documentation

**Delegate Cache Optimization** (Issue #49):
- Optimized `ConcurrentDictionary` access patterns with TryGetValue-before-GetOrAdd
- Added `RequestKindCache` to avoid repeated `IsAssignableFrom` type checks
- Created `CacheOptimizationBenchmarks.cs` for performance validation
- Applied to both `RequestDispatcher` and `NotificationDispatcher`

**Recoverability Pipeline** (Issue #39):

Implemented a comprehensive two-phase retry strategy for transient error handling:

| Component | Purpose |
|-----------|---------|
| `RecoverabilityOptions` | Configuration for retry policies (immediate/delayed retries, backoff, jitter) |
| `IErrorClassifier` | Interface for classifying errors as Transient/Permanent/Unknown |
| `DefaultErrorClassifier` | Default implementation with exception type, HTTP status, and message pattern matching |
| `RecoverabilityContext` | Tracks retry state, attempt history, and creates `FailedMessage` for DLQ |
| `FailedMessage` | Record containing all context for dead letter queue handling |
| `RecoverabilityPipelineBehavior<,>` | Pipeline behavior implementing immediate retry logic |
| `IDelayedRetryScheduler` | Abstraction for scheduling delayed retries |
| `IDelayedRetryStore` | Persistence abstraction for delayed retry messages |
| `DelayedRetryProcessor` | BackgroundService for processing pending delayed retries |

**Retry Strategy**:
1. **Immediate Retries** (in-memory): 3 attempts with 100ms delay, exponential backoff
2. **Delayed Retries** (persistent): 30s → 5m → 30m → 2h with jitter (±20%)
3. **Dead Letter Queue**: `OnPermanentFailure` callback for DLQ integration

**Error Classification**:
- Exception types: `TimeoutException`, `HttpRequestException` (5xx) → Transient
- Exception types: `ArgumentException`, `ValidationException`, `HttpRequestException` (4xx) → Permanent
- Message patterns: "timeout", "connection", "temporary" → Transient

**Test Coverage**: 64 unit tests covering all recoverability scenarios.

**Pending Tests** (GitHub Issues created):
- Issue #117: Integration tests (blocked until `IDelayedRetryStore` implementation exists)
- Issue #118: Property-based tests for error classification
- Issue #119: Contract tests for Recoverability interfaces

**Test Coverage Final Status**:

| Type | Completed |
|------|:---------:|
| Unit Tests | 24/24 (100%) |
| Integration Tests | 17/17 (100%) |
| Property Tests | 24/24 (100%) |
| Contract Tests | 24/24 (100%) |

### December 26 (Continued) - AggregateTestBase (Issue #46)

**Issue Closed**: `#46` (AggregateTestBase - Given/When/Then for Event Sourcing)

**AggregateTestBase Implementation** (Encina.Testing.EventSourcing):

Base class for testing event-sourced aggregates using the Given/When/Then pattern:

```csharp
public class OrderAggregateTests : AggregateTestBase<Order, OrderId>
{
    [Fact]
    public void Submit_WhenOrderCreated_ShouldProduceOrderSubmittedEvent()
    {
        Given(
            new OrderCreated(OrderId, CustomerId, Items),
            new PaymentReceived(OrderId, Amount)
        );

        When(order => order.Submit());

        Then<OrderSubmitted>(e => Assert.Equal(OrderId, e.OrderId));

        ThenState(order => Assert.Equal(OrderStatus.Submitted, order.Status));
    }
}
```

**Features**:
- `AggregateTestBase<TAggregate, TId>` - Main base class for typed aggregate identifiers
- `AggregateTestBase<TAggregate>` - Convenience class for Guid identifiers
- `Given(params object[] events)` - Set up aggregate event history
- `GivenEmpty()` - Start with fresh aggregate (for creation tests)
- `When(Action<TAggregate>)` - Execute synchronous command
- `WhenAsync(Func<TAggregate, Task>)` - Execute asynchronous command
- `Then<TEvent>()` - Assert event was raised, returns event for further assertions
- `Then<TEvent>(Action<TEvent>)` - Assert and validate event
- `ThenEvents(params Type[])` - Verify exact event sequence
- `ThenNoEvents()` - Assert no events raised (idempotency tests)
- `ThenState(Action<TAggregate>)` - Assert aggregate state
- `ThenThrows<TException>()` - Assert exception was thrown
- `ThenThrows<TException>(Action<TException>)` - Assert and validate exception
- `GetUncommittedEvents()` - Direct access to uncommitted events
- `GetUncommittedEvents<TEvent>()` - Filtered access to specific event type
- `Aggregate` property - Access to aggregate after When()

**Test Coverage**:

| Type | Count | Description |
|------|:-----:|-------------|
| Unit Tests | 30 | Core functionality coverage |
| Property Tests | 12 | FsCheck invariant verification |
| Contract Tests | 15 | Public API contract verification |
| Guard Clause Tests | 18 | Argument validation |
| **Total** | **75** | Comprehensive coverage |

**Why Some Test Types Don't Apply**:
- **Integration Tests**: N/A - Testing infrastructure, no external dependencies
- **Benchmarks**: N/A - Testing infrastructure, not performance-critical path
- **Load Tests**: N/A - Test helper class, not production code

**Dependencies Added**:
- `Encina.Testing.csproj` now references `Encina.Marten.csproj`
- Added FsCheck packages to `Encina.Testing.Tests.csproj`

### December 26 (Continued) - Automatic Rate Limiting (Issue #40)

**Issue Closed**: `#40` (Automatic Rate Limiting - detect outages and auto-throttle)

**Rate Limiting Implementation** (Encina.Polly):

Implemented adaptive rate limiting with automatic outage detection and throttling:

| Component | Purpose |
|-----------|---------|
| `RateLimitAttribute` | Configuration attribute for rate limiting policies |
| `IRateLimiter` | Interface for rate limiting operations |
| `AdaptiveRateLimiter` | Sliding window implementation with adaptive throttling |
| `RateLimitingPipelineBehavior<,>` | Pipeline behavior for automatic rate limiting |
| `RateLimitResult` | Result struct with allowed/denied status |
| `RateLimitState` | State enum (Normal, Throttled, Recovering) |

**RateLimitAttribute Configuration**:
- `MaxRequestsPerWindow` - Maximum requests allowed (default: 100)
- `WindowSizeSeconds` - Sliding window duration (default: 60)
- `ErrorThresholdPercent` - Error rate for throttling (default: 50%)
- `CooldownSeconds` - Duration in throttled state (default: 30)
- `RampUpFactor` - Capacity increase rate during recovery (default: 1.5x)
- `EnableAdaptiveThrottling` - Toggle adaptive behavior (default: true)
- `MinimumThroughputForThrottling` - Min requests before error rate applies (default: 10)

**State Machine**:
```text
Normal → (error rate > threshold) → Throttled
Throttled → (cooldown expires) → Recovering
Recovering → (consecutive successes) → Normal
Recovering → (new errors) → Throttled
```

**Features**:
- Sliding window rate limiting algorithm
- Per-key state management with `ConcurrentDictionary`
- Automatic error rate tracking
- Gradual capacity recovery
- Thread-safe operations

**Usage Example**:
```csharp
[RateLimit(MaxRequestsPerWindow = 100, WindowSizeSeconds = 60)]
[RateLimit(ErrorThresholdPercent = 50, EnableAdaptiveThrottling = true)]
public record CallExternalApiQuery(string Url) : IRequest<ApiResponse>;
```

**Test Coverage**:

| Type | Count | Description |
|------|:-----:|-------------|
| Unit Tests | 104 | Core functionality, all behaviors |
| Property Tests | 22 | FsCheck invariant verification |
| Contract Tests | 22 | Interface and API contracts |
| Guard Tests | 10 | Null argument validation |
| Load Tests | 4 | Concurrency and thread-safety |
| Benchmarks | 10 | Performance measurement |
| **Total** | **172** | Comprehensive coverage |

**Files Created**:
- `src/Encina.Polly/RateLimiting/RateLimitState.cs`
- `src/Encina.Polly/RateLimiting/RateLimitResult.cs`
- `src/Encina.Polly/RateLimiting/IRateLimiter.cs`
- `src/Encina.Polly/RateLimiting/AdaptiveRateLimiter.cs`
- `src/Encina.Polly/Attributes/RateLimitAttribute.cs`
- `src/Encina.Polly/Behaviors/RateLimitingPipelineBehavior.cs`
- `tests/Encina.Polly.Tests/RateLimitAttributeTests.cs`
- `tests/Encina.Polly.Tests/AdaptiveRateLimiterTests.cs`
- `tests/Encina.Polly.Tests/RateLimitingPipelineBehaviorTests.cs`
- `tests/Encina.Polly.PropertyTests/RateLimitingPropertyTests.cs`
- `tests/Encina.Polly.GuardTests/RateLimitingPipelineBehaviorGuardsTests.cs`
- `tests/Encina.Polly.GuardTests/AdaptiveRateLimiterGuardsTests.cs`
- `benchmarks/Encina.Polly.Benchmarks/RateLimitingBenchmarks.cs`

**Files Modified**:
- `src/Encina.Polly/ServiceCollectionExtensions.cs` - Added IRateLimiter and behavior registration
- `src/Encina/Errors/EncinaErrorCodes.cs` - Added RateLimitExceeded error code
- `src/Encina.Polly/PublicAPI.Unshipped.txt` - Added public API declarations
- `src/Encina/PublicAPI.Unshipped.txt` - Added error code declaration
- `tests/Encina.Polly.Tests/ServiceCollectionExtensionsTests.cs` - Updated for 3 behaviors
- `tests/Encina.Polly.ContractTests/BehaviorContractTests.cs` - Added rate limiting contracts
- `tests/Encina.Polly.LoadTests/ResilienceLoadTests.cs` - Added rate limiting load tests
- `benchmarks/Encina.Polly.Benchmarks/Program.cs` - Added benchmark runners

### December 26 (Continued) - Low-Ceremony Sagas (Issue #41)

**Issue Closed**: `#41` (Low-Ceremony Sagas - Wolverine-style minimal syntax)

**Low-Ceremony Sagas Implementation** (Encina.Messaging.Sagas.LowCeremony):

Implemented a fluent API for defining sagas inline without class inheritance:

| Component | Purpose |
|-----------|---------|
| `SagaDefinition` | Static factory class for creating saga definitions |
| `SagaDefinition<TData>` | Fluent builder for defining saga steps |
| `SagaStepBuilder<TData>` | Step configuration with Execute and Compensate |
| `SagaStepDefinition<TData>` | Immutable step configuration |
| `BuiltSagaDefinition<TData>` | Immutable saga definition ready for execution |
| `ISagaRunner` | Interface for executing saga definitions |
| `SagaRunner` | Implementation with full lifecycle management |
| `SagaResult<TData>` | Result record with SagaId, Data, and StepsExecuted |

**Usage Example**:
```csharp
var saga = SagaDefinition.Create<OrderData>("ProcessOrder")
    .Step("Reserve Inventory")
        .Execute(async (data, ct) =>
        {
            var result = await encina.Send(new ReserveInventory(data.OrderId), ct);
            return result.Map(r => data with { ReservationId = r.Id });
        })
        .Compensate(async (data, ct) =>
        {
            if (data.ReservationId.HasValue)
                await encina.Send(new CancelReservation(data.ReservationId.Value), ct);
        })
    .Step("Process Payment")
        .Execute(async (data, ct) =>
        {
            var result = await encina.Send(new ProcessPayment(data.OrderId), ct);
            return result.Map(r => data with { PaymentId = r.Id });
        })
        .Compensate(async (data, ct) =>
        {
            if (data.PaymentId.HasValue)
                await encina.Send(new RefundPayment(data.PaymentId.Value), ct);
        })
    .WithTimeout(TimeSpan.FromMinutes(5))
    .Build();

var result = await sagaRunner.RunAsync(saga, initialData);
```

**Features**:
- Fluent API without class inheritance required
- Sequential step execution with data flow between steps
- Automatic compensation in reverse order on failure
- Exception handling continues compensation for other steps
- Optional timeout configuration per saga
- Auto-generated step names when not specified
- Simplified overloads without `IRequestContext` parameter
- High-performance logging with `LoggerMessage` attributes
- Automatic DI registration when `UseSagas = true`

**Test Coverage**:

| Type | Count | Description |
|------|:-----:|-------------|
| Unit Tests | 45 | SagaDefinition, SagaStepBuilder, SagaRunner |
| Property Tests | 11 | FsCheck invariant verification |
| Contract Tests | 8 | ISagaRunner interface contracts |
| **Total** | **64** | Comprehensive coverage |

**Why Some Test Types Don't Apply**:
- **Integration Tests**: Covered by unit tests with mocks - `SagaRunner` delegates to existing `SagaOrchestrator` which has its own integration tests
- **Guard Clause Tests**: Included in unit tests (45 tests)
- **Load Tests**: N/A - Thin wrapper over `SagaOrchestrator`, existing saga benchmarks cover performance
- **Benchmarks**: N/A - Minimal overhead, existing saga benchmarks in `SagaProviderComparisonBenchmarks.cs` cover performance

**Files Created**:
- `src/Encina.Messaging/Sagas/LowCeremony/SagaDefinition.cs`
- `src/Encina.Messaging/Sagas/LowCeremony/SagaStepBuilder.cs`
- `src/Encina.Messaging/Sagas/LowCeremony/ISagaRunner.cs`
- `src/Encina.Messaging/Sagas/LowCeremony/SagaRunner.cs`
- `tests/Encina.Tests/Sagas/LowCeremony/SagaDefinitionTests.cs`
- `tests/Encina.Tests/Sagas/LowCeremony/SagaStepBuilderTests.cs`
- `tests/Encina.Tests/Sagas/LowCeremony/SagaRunnerTests.cs`
- `tests/Encina.Messaging.PropertyTests/Sagas/LowCeremonySagaPropertyTests.cs`
- `tests/Encina.Messaging.ContractTests/Sagas/ISagaRunnerContractTests.cs`

**Files Modified**:
- `src/Encina.Messaging/MessagingServiceCollectionExtensions.cs` - Added ISagaRunner registration
- `src/Encina.Messaging/PublicAPI.Unshipped.txt` - Added public API declarations

### December 26 (Continued) - Dead Letter Queue (Issue #42)

**Issue Closed**: `#42` (Dead Letter Queue - unified abstraction across providers)

**Dead Letter Queue Implementation** (Encina.Messaging.DeadLetter):

Implemented a comprehensive Dead Letter Queue pattern for handling permanently failed messages:

| Component | Purpose |
|-----------|---------|
| `IDeadLetterMessage` | Interface for dead letter message abstraction |
| `IDeadLetterStore` | Provider-agnostic storage abstraction |
| `IDeadLetterMessageFactory` | Factory for creating messages from failed requests |
| `DeadLetterFilter` | Query filter with factory methods |
| `DeadLetterOptions` | Configuration with retention, cleanup, integration flags |
| `DeadLetterOrchestrator` | Core orchestration logic |
| `IDeadLetterManager` | High-level management API with replay capabilities |
| `DeadLetterManager` | Implementation with reflection-based replay |
| `DeadLetterHealthCheck` | Health check with warning/critical thresholds |
| `DeadLetterCleanupProcessor` | BackgroundService for automatic cleanup |

**IDeadLetterStore Interface**:
- `AddAsync(message)` - Add message to DLQ
- `GetAsync(messageId)` - Retrieve message by ID
- `GetMessagesAsync(filter, skip, take)` - Query with pagination
- `GetCountAsync(filter)` - Count matching messages
- `MarkAsReplayedAsync(messageId, result)` - Mark as replayed
- `DeleteAsync(messageId)` - Delete single message
- `DeleteExpiredAsync()` - Cleanup expired messages

**DeadLetterFilter Factory Methods**:
- `DeadLetterFilter.All` - Empty filter (returns all)
- `DeadLetterFilter.FromSource(pattern)` - Filter by source pattern
- `DeadLetterFilter.Since(dateTime)` - Filter by timestamp
- `DeadLetterFilter.ByCorrelationId(id)` - Filter by correlation

**DeadLetterOptions Configuration**:
- `RetentionPeriod` - How long to keep messages (default: 30 days)
- `CleanupInterval` - Background cleanup frequency (default: 1 hour)
- `EnableAutomaticCleanup` - Toggle cleanup processor
- `IntegrateWithRecoverability` - Auto-DLQ from recoverability failures
- `IntegrateWithOutbox` - Auto-DLQ from outbox failures
- `IntegrateWithInbox` - Auto-DLQ from inbox failures
- `IntegrateWithScheduling` - Auto-DLQ from scheduling failures
- `IntegrateWithSagas` - Auto-DLQ from saga failures
- `OnDeadLetter` - Callback for custom notifications

**IDeadLetterManager API**:
- `ReplayAsync(messageId)` - Replay single message through pipeline
- `ReplayAllAsync(filter, maxMessages)` - Batch replay with filter
- `GetMessageAsync(messageId)` - Get single message
- `GetMessagesAsync(filter, skip, take)` - Query messages
- `GetCountAsync(filter)` - Count messages
- `GetStatisticsAsync()` - Queue statistics by source
- `DeleteAsync(messageId)` - Delete message
- `DeleteAllAsync(filter)` - Bulk delete
- `CleanupExpiredAsync()` - Manual cleanup

**DeadLetterStatistics**:
- `TotalCount` - Total messages in DLQ
- `PendingCount` - Messages awaiting replay
- `ReplayedCount` - Successfully replayed messages
- `ExpiredCount` - Expired messages
- `CountBySource` - Breakdown by source pattern
- `OldestPendingAtUtc` / `NewestPendingAtUtc` - Timestamp range

**DeadLetterSourcePatterns Constants**:
- `Recoverability` - From recoverability pipeline failures
- `Outbox` - From outbox processing failures
- `Inbox` - From inbox processing failures
- `Scheduling` - From scheduled message failures
- `Saga` - From saga execution failures
- `Choreography` - From choreography-based saga failures

**DeadLetterHealthCheck**:
- Configurable `WarningThreshold` (default: 10 messages)
- Configurable `CriticalThreshold` (default: 100 messages)
- `OldMessageThreshold` for stale message detection
- Implements `EncinaHealthCheck` base class

**Usage Example**:
```csharp
// Configure DLQ
services.AddEncinaDeadLetterQueue<DeadLetterStoreEF, DeadLetterMessageFactoryEF>(options =>
{
    options.RetentionPeriod = TimeSpan.FromDays(30);
    options.EnableAutomaticCleanup = true;
    options.IntegrateWithRecoverability = true;
    options.OnDeadLetter = async (msg, ct) =>
        await alertService.SendAlertAsync($"Message dead-lettered: {msg.RequestType}");
});

// Query statistics
var stats = await manager.GetStatisticsAsync();
Console.WriteLine($"Total: {stats.TotalCount}, Pending: {stats.PendingCount}");
Console.WriteLine($"By source: {string.Join(", ", stats.CountBySource.Select(kv => $"{kv.Key}={kv.Value}"))}");

// Replay failed messages
var result = await manager.ReplayAsync(messageId);
if (result.IsRight)
    Console.WriteLine($"Replayed successfully at {result.RightToSeq().Head().ReplayedAtUtc}");

// Batch replay from specific source
var batchResult = await manager.ReplayAllAsync(
    DeadLetterFilter.FromSource(DeadLetterSourcePatterns.Recoverability),
    maxMessages: 50);
Console.WriteLine($"Replayed {batchResult.RightToSeq().Head().SuccessCount} of {batchResult.RightToSeq().Head().TotalProcessed}");
```

**Test Coverage**:

| Type | Count | Description |
|------|:-----:|-------------|
| Unit Tests | 75 | Core functionality coverage |
| Integration Tests | 11 | End-to-end with DI container |
| Property Tests | 22 | FsCheck invariant verification |
| Contract Tests | 12 | IDeadLetterStore contract |
| **Total** | **120** | Comprehensive coverage |

**Why Some Test Types Don't Apply**:
- **Guard Clause Tests**: N/A - Simple DTOs without explicit parameter validation
- **Load Tests**: N/A - DLQ is not a hot path (only handles permanently failed messages)
- **Benchmarks**: N/A - Performance depends on underlying store provider

**Files Created**:
- `src/Encina.Messaging/DeadLetter/IDeadLetterMessage.cs`
- `src/Encina.Messaging/DeadLetter/IDeadLetterStore.cs`
- `src/Encina.Messaging/DeadLetter/IDeadLetterMessageFactory.cs`
- `src/Encina.Messaging/DeadLetter/DeadLetterFilter.cs`
- `src/Encina.Messaging/DeadLetter/DeadLetterOptions.cs`
- `src/Encina.Messaging/DeadLetter/DeadLetterSourcePatterns.cs`
- `src/Encina.Messaging/DeadLetter/DeadLetterErrorCodes.cs`
- `src/Encina.Messaging/DeadLetter/IDeadLetterManager.cs`
- `src/Encina.Messaging/DeadLetter/DeadLetterOrchestrator.cs`
- `src/Encina.Messaging/DeadLetter/DeadLetterManager.cs`
- `src/Encina.Messaging/DeadLetter/DeadLetterLog.cs`
- `src/Encina.Messaging/DeadLetter/DeadLetterCleanupProcessor.cs`
- `src/Encina.Messaging/DeadLetter/DeadLetterServiceCollectionExtensions.cs`
- `src/Encina.Messaging/Health/DeadLetterHealthCheck.cs`
- `tests/Encina.Tests/DeadLetter/DeadLetterHealthCheckTests.cs`
- `tests/Encina.Tests/DeadLetter/DeadLetterOptionsTests.cs`
- `tests/Encina.Tests/DeadLetter/DeadLetterFilterTests.cs`
- `tests/Encina.Tests/DeadLetter/DeadLetterSourcePatternsTests.cs`
- `tests/Encina.Tests/DeadLetter/DeadLetterErrorCodesTests.cs`
- `tests/Encina.Tests/DeadLetter/ReplayResultTests.cs`
- `tests/Encina.Tests/DeadLetter/DeadLetterOrchestratorTests.cs`
- `tests/Encina.Tests/DeadLetter/DeadLetterManagerTests.cs`
- `tests/Encina.Tests/Integration/DeadLetterIntegrationTests.cs`
- `tests/Encina.Messaging.PropertyTests/DeadLetter/DeadLetterPropertyTests.cs`
- `tests/Encina.Messaging.ContractTests/DeadLetter/IDeadLetterStoreContractTests.cs`

**Files Modified**:
- `src/Encina.Messaging/MessagingConfiguration.cs` - Added `UseDeadLetterQueue` and `DeadLetterOptions`
- `src/Encina.Messaging/MessagingServiceCollectionExtensions.cs` - Added DeadLetter imports

### December 26 (Continued) - Bulkhead Isolation Pattern (Issue #53)

**Issue Closed**: `#53` (Bulkhead Isolation via Polly - limit concurrent operations)

**Bulkhead Isolation Implementation** (Encina.Polly):

Implemented bulkhead isolation pattern for limiting concurrent executions per handler type:

| Component | Purpose |
|-----------|---------|
| `BulkheadAttribute` | Configuration attribute for bulkhead policies |
| `IBulkheadManager` | Interface for bulkhead management operations |
| `BulkheadManager` | SemaphoreSlim-based implementation with per-key isolation |
| `BulkheadPipelineBehavior<,>` | Pipeline behavior for automatic enforcement |
| `BulkheadAcquireResult` | Result struct with acquisition status and releaser |
| `BulkheadMetrics` | Metrics struct with utilization calculations |
| `BulkheadRejectionReason` | Enum for rejection reasons |

**BulkheadAttribute Configuration**:
- `MaxConcurrency` - Maximum parallel executions (default: 10)
- `MaxQueuedActions` - Additional requests that can wait (default: 20)
- `QueueTimeoutMs` - Maximum wait time in queue (default: 30000ms)

**IBulkheadManager Interface**:
- `TryAcquireAsync(key, config, ct)` - Acquire permit with timeout and cancellation
- `GetMetrics(key)` - Get current metrics (concurrency, queue, rejection rate)
- `Reset(key)` - Reset bulkhead state

**BulkheadAcquireResult Factory Methods**:
- `Acquired(releaser, metrics)` - Successful acquisition
- `RejectedBulkheadFull(metrics)` - Both limits reached
- `RejectedQueueTimeout(metrics)` - Queue wait timeout
- `RejectedCancelled(metrics)` - Request cancelled

**BulkheadMetrics Calculated Properties**:
- `ConcurrencyUtilization` - Percentage of concurrency capacity in use
- `QueueUtilization` - Percentage of queue capacity in use
- `RejectionRate` - Total rejection rate as percentage

**Features**:
- Thread-safe `ConcurrentDictionary` for per-key bulkhead isolation
- `SemaphoreSlim` for efficient permit management
- Automatic permit release via `IDisposable` pattern
- `TimeProvider` injection for testability
- Logging with `LoggerMessage` source generators
- Automatic DI registration as singleton via `AddEncinaPolly()`

**Usage Example**:
```csharp
// Limit payment processing to 10 concurrent executions
[Bulkhead(MaxConcurrency = 10, MaxQueuedActions = 20)]
public record ProcessPaymentCommand(PaymentData Data) : ICommand<PaymentResult>;

// Limit external API calls with custom timeout
[Bulkhead(MaxConcurrency = 5, MaxQueuedActions = 10, QueueTimeoutMs = 5000)]
public record CallExternalApiQuery(string Endpoint) : IRequest<ApiResponse>;

// No queue - immediate rejection when concurrency limit reached
[Bulkhead(MaxConcurrency = 2, MaxQueuedActions = 0)]
public record CriticalResourceCommand(Guid Id) : ICommand<Unit>;
```

**Test Coverage**:

| Type | Count | Description |
|------|:-----:|-------------|
| Unit Tests | 55 | BulkheadAttribute, BulkheadManager, BulkheadPipelineBehavior |
| Integration Tests | 3 | End-to-end with real pipeline |
| Property Tests | 6 | FsCheck invariant verification for metrics |
| Contract Tests | 20 | Interface and API contracts |
| Guard Tests | 7 | Null argument validation |
| Load Tests | 6 | Concurrency and thread-safety |
| Benchmarks | 8 | Performance measurement |
| **Total** | **105** | Comprehensive coverage |

**Files Created**:
- `src/Encina.Polly/Attributes/BulkheadAttribute.cs`
- `src/Encina.Polly/Bulkhead/IBulkheadManager.cs`
- `src/Encina.Polly/Bulkhead/BulkheadManager.cs`
- `src/Encina.Polly/Behaviors/BulkheadPipelineBehavior.cs`
- `tests/Encina.Polly.Tests/BulkheadAttributeTests.cs`
- `tests/Encina.Polly.Tests/BulkheadManagerTests.cs`
- `tests/Encina.Polly.Tests/BulkheadPipelineBehaviorTests.cs`
- `tests/Encina.Polly.GuardTests/BulkheadPipelineBehaviorGuardsTests.cs`
- `tests/Encina.Polly.GuardTests/BulkheadManagerGuardsTests.cs`
- `benchmarks/Encina.Polly.Benchmarks/BulkheadBenchmarks.cs`

**Files Modified**:
- `src/Encina.Polly/ServiceCollectionExtensions.cs` - Added IBulkheadManager and behavior registration
- `src/Encina.Polly/PublicAPI.Unshipped.txt` - Added public API declarations
- `tests/Encina.Polly.IntegrationTests/EndToEndIntegrationTests.cs` - Added bulkhead integration tests
- `tests/Encina.Polly.PropertyTests/AttributePropertyTests.cs` - Added bulkhead property tests
- `tests/Encina.Polly.ContractTests/BehaviorContractTests.cs` - Added bulkhead contract tests
- `tests/Encina.Polly.LoadTests/ResilienceLoadTests.cs` - Added bulkhead load tests

---

### December 26 (Continued) - Projections/Read Models (Issue #36)

**Issue Closed**: `#36` (Projections/Read Models - CQRS read side abstractions)

**Projection Abstractions** (Encina.Marten.Projections):

Full CQRS read side implementation with typed projection handlers and lifecycle management:

```csharp
// Define a read model
public class OrderSummary : IReadModel
{
    public Guid Id { get; set; }
    public string CustomerName { get; set; } = string.Empty;
    public decimal TotalAmount { get; set; }
    public int ItemCount { get; set; }
}

// Define a projection with multiple handlers
public class OrderSummaryProjection :
    IProjection<OrderSummary>,
    IProjectionCreator<OrderCreated, OrderSummary>,
    IProjectionHandler<OrderItemAdded, OrderSummary>,
    IProjectionDeleter<OrderCancelled, OrderSummary>
{
    public string ProjectionName => "OrderSummary";

    public OrderSummary Create(OrderCreated e, ProjectionContext ctx) =>
        new() { Id = ctx.StreamId, CustomerName = e.CustomerName };

    public OrderSummary Apply(OrderItemAdded e, OrderSummary m, ProjectionContext ctx) =>
        m with { TotalAmount = m.TotalAmount + e.Price * e.Quantity, ItemCount = m.ItemCount + e.Quantity };

    public bool ShouldDelete(OrderCancelled e, OrderSummary m, ProjectionContext ctx) => true;
}

// Register and configure
services.AddEncinaMarten(options => {
    options.Projections.EnableInlineProjections = true;
}).AddProjection<OrderSummaryProjection, OrderSummary>();
```

**Core Interfaces**:

| Interface | Purpose |
|-----------|---------|
| `IReadModel` | Marker interface with `Guid Id` property |
| `IReadModel<TId>` | Generic variant for strongly-typed identifiers |
| `IProjection<TReadModel>` | Base projection with `ProjectionName` |
| `IProjectionCreator<TEvent, TReadModel>` | Creates read model from initial event |
| `IProjectionHandler<TEvent, TReadModel>` | Applies event to existing read model |
| `IProjectionDeleter<TEvent, TReadModel>` | Conditionally deletes read model |

**Infrastructure Components**:

| Component | Purpose |
|-----------|---------|
| `ProjectionContext` | Event metadata (StreamId, SequenceNumber, Timestamp, etc.) |
| `ProjectionRegistry` | Registration and discovery of projections |
| `IReadModelRepository<T>` | CRUD operations for read models with ROP |
| `IProjectionManager` | Lifecycle and rebuild management |
| `IInlineProjectionDispatcher` | Synchronous projection updates |

**Marten Implementations**:

| Class | Purpose |
|-------|---------|
| `MartenReadModelRepository<T>` | Document storage via IDocumentSession |
| `MartenProjectionManager` | Event stream processing and rebuilds |
| `MartenInlineProjectionDispatcher` | Inline projection dispatch |

**Configuration Options**:

| Option | Default | Description |
|--------|---------|-------------|
| `EnableInlineProjections` | `false` | Enable synchronous projection updates |
| `RebuildOnStartup` | `false` | Rebuild all projections on startup |
| `DefaultBatchSize` | `1000` | Events per batch during rebuild |
| `MaxConcurrentRebuilds` | `1` | Parallel rebuilds allowed |
| `OnProjectionFaulted` | `null` | Callback for projection errors |

**Rebuild Options**:

| Option | Default | Description |
|--------|---------|-------------|
| `BatchSize` | `1000` | Events per batch |
| `DeleteExisting` | `true` | Delete existing read models before rebuild |
| `OnProgress` | `null` | Progress callback `(int percent, long events)` |
| `StartPosition` | `0` | Starting event position |
| `EndPosition` | `null` | Ending event position (null = latest) |
| `RunInBackground` | `false` | Run rebuild asynchronously |

**Projection States**:
- `Stopped`, `Starting`, `Running`, `CatchingUp`, `Rebuilding`, `Paused`, `Faulted`, `Stopping`

**Test Coverage**:

| Type | Count | Description |
|------|:-----:|-------------|
| Unit Tests | 30 | Registry, Context, Status, Options, Handlers |
| Property Tests | 22 | FsCheck invariant verification |
| Contract Tests | 11 | Interface contracts and behaviors |
| Guard Tests | 17 | Null argument validation |
| **Total** | **80** | Comprehensive coverage |

**Load Tests/Benchmarks**: Not implemented. Justification: The projection code is primarily "glue code" that routes events to handlers and persists to Marten. The actual performance depends on Marten and PostgreSQL, not on our routing logic. Hot path optimization would not provide meaningful gains.

**Files Created**:
- `src/Encina.Marten/Projections/IReadModel.cs`
- `src/Encina.Marten/Projections/IProjection.cs`
- `src/Encina.Marten/Projections/ProjectionContext.cs`
- `src/Encina.Marten/Projections/IReadModelRepository.cs`
- `src/Encina.Marten/Projections/ProjectionErrorCodes.cs`
- `src/Encina.Marten/Projections/ProjectionStatus.cs`
- `src/Encina.Marten/Projections/IProjectionManager.cs`
- `src/Encina.Marten/Projections/MartenReadModelRepository.cs`
- `src/Encina.Marten/Projections/MartenProjectionManager.cs`
- `src/Encina.Marten/Projections/ProjectionLog.cs`
- `src/Encina.Marten/Projections/ProjectionRegistry.cs`
- `src/Encina.Marten/Projections/InlineProjectionDispatcher.cs`
- `src/Encina.Marten/Projections/ProjectionOptions.cs`
- `tests/Encina.Marten.Tests/Projections/TestReadModels.cs`
- `tests/Encina.Marten.Tests/Projections/ProjectionRegistryTests.cs`
- `tests/Encina.Marten.Tests/Projections/ProjectionContextTests.cs`
- `tests/Encina.Marten.Tests/Projections/ProjectionHandlerInfoTests.cs`
- `tests/Encina.Marten.Tests/Projections/ProjectionStatusTests.cs`
- `tests/Encina.Marten.Tests/Projections/ProjectionOptionsTests.cs`
- `tests/Encina.Marten.Tests/Projections/RebuildOptionsTests.cs`
- `tests/Encina.Marten.Tests/Projections/ProjectionPropertyTests.cs`
- `tests/Encina.Marten.Tests/Projections/ProjectionContractTests.cs`
- `tests/Encina.Marten.Tests/Projections/ProjectionGuardClauseTests.cs`

**Files Modified**:
- `src/Encina.Marten/EncinaMartenOptions.cs` - Added `Projections` property
- `src/Encina.Marten/ServiceCollectionExtensions.cs` - Added `AddProjection<,>()` method and `IProjectionRegistrar`

### December 26 (Continued) - Snapshotting for Large Aggregates (Issue #52)

**Issue Closed**: `#52` (Snapshotting for large aggregates - optimize loading of event-sourced aggregates)

**Snapshot Implementation** (Encina.Marten.Snapshots):

Implemented snapshotting pattern for optimizing large aggregate loading in event-sourced systems:

```csharp
// Enable snapshotting in options
services.AddEncinaMarten(options =>
{
    options.Snapshots.Enabled = true;
    options.Snapshots.SnapshotEvery = 100;
    options.Snapshots.KeepSnapshots = 3;

    // Per-aggregate configuration
    options.Snapshots.ConfigureAggregate<Order>(
        snapshotEvery: 50,
        keepSnapshots: 5);
});

// Register snapshotable aggregate
services.AddSnapshotableAggregate<Order>();

// Aggregate must implement marker interface
public class Order : AggregateBase, ISnapshotable<Order>
{
    // ... standard aggregate implementation
}
```

**Core Interfaces**:

| Interface | Purpose |
|-----------|---------|
| `ISnapshotable<TAggregate>` | Marker interface for aggregates supporting snapshots |
| `ISnapshot<TAggregate>` | Snapshot metadata (AggregateId, Version, CreatedAtUtc) |
| `ISnapshotStore<TAggregate>` | Storage abstraction with ROP error handling |

**Snapshot Classes**:

| Class | Purpose |
|-------|---------|
| `Snapshot<TAggregate>` | Immutable snapshot with aggregate state |
| `SnapshotEnvelope<TAggregate>` | Marten document wrapper for storage |
| `SnapshotOptions` | Global and per-aggregate configuration |
| `MartenSnapshotStore<TAggregate>` | Marten-based storage implementation |
| `SnapshotAwareAggregateRepository<TAggregate>` | Repository with snapshot optimization |

**SnapshotOptions Configuration**:

| Option | Default | Description |
|--------|---------|-------------|
| `Enabled` | `false` | Toggle snapshotting globally |
| `SnapshotEvery` | `100` | Event threshold for snapshot creation |
| `KeepSnapshots` | `3` | Retention limit (0 = keep all) |
| `AsyncSnapshotCreation` | `true` | Async vs sync snapshot creation |
| `ConfigureAggregate<T>()` | - | Per-aggregate overrides |

**ISnapshotStore Interface**:
- `SaveAsync(snapshot)` - Persist snapshot to storage
- `GetLatestAsync(aggregateId)` - Retrieve most recent snapshot
- `PruneAsync(aggregateId, keepCount)` - Remove old snapshots

**SnapshotAwareAggregateRepository Behavior**:
1. **Load**: Check for latest snapshot → Load snapshot if exists → Replay only events after snapshot version → Fall back to full event replay if no snapshot
2. **Save**: Save events → Check if version threshold reached → Create snapshot asynchronously → Prune old snapshots

**Error Codes** (SnapshotErrorCodes):
- `snapshot.load_failed` - Failed to load snapshot from storage
- `snapshot.save_failed` - Failed to persist snapshot
- `snapshot.prune_failed` - Failed to prune old snapshots
- `snapshot.invalid_state` - Invalid snapshot state detected

**Logging** (LoggerMessage, EventIds 100-159):
- High-performance logging via source generators
- Structured logging for debugging and monitoring

**Test Coverage**:

| Type | Count | Description |
|------|:-----:|-------------|
| Unit Tests | 92 | Snapshot, SnapshotOptions, SnapshotEnvelope, MartenSnapshotStore, Repository |
| Property Tests | 11 | Theory-based invariant verification |
| Contract Tests | 8 | Interface behavior contracts |
| Guard Clause Tests | 12 | Null argument and range validation |
| Integration Tests | 6 | Real PostgreSQL with Testcontainers |
| **Total** | **129** | Comprehensive coverage |

**Load Tests/Benchmarks**: Not implemented. Justification:
1. Snapshotting is not a hot path (created every N events, not on every operation)
2. Main performance benefit is self-evident (snapshot + few events < replaying 1000+ events)
3. Actual storage performance depends on Marten/PostgreSQL, not our code
4. Pre-1.0 focus on design quality over micro-optimizations

**Files Created**:
- `src/Encina.Marten/Snapshots/ISnapshotable.cs`
- `src/Encina.Marten/Snapshots/ISnapshot.cs`
- `src/Encina.Marten/Snapshots/ISnapshotStore.cs`
- `src/Encina.Marten/Snapshots/SnapshotOptions.cs`
- `src/Encina.Marten/Snapshots/SnapshotErrorCodes.cs`
- `src/Encina.Marten/Snapshots/MartenSnapshotStore.cs`
- `src/Encina.Marten/Snapshots/SnapshotEnvelope.cs`
- `src/Encina.Marten/Snapshots/SnapshotLog.cs`
- `src/Encina.Marten/Snapshots/SnapshotAwareAggregateRepository.cs`
- `tests/Encina.Marten.Tests/Snapshots/TestSnapshotableAggregate.cs`
- `tests/Encina.Marten.Tests/Snapshots/SnapshotTests.cs`
- `tests/Encina.Marten.Tests/Snapshots/SnapshotOptionsTests.cs`
- `tests/Encina.Marten.Tests/Snapshots/SnapshotEnvelopeTests.cs`
- `tests/Encina.Marten.Tests/Snapshots/SnapshotErrorCodesTests.cs`
- `tests/Encina.Marten.Tests/Snapshots/MartenSnapshotStoreTests.cs`
- `tests/Encina.Marten.Tests/Snapshots/SnapshotServiceCollectionTests.cs`
- `tests/Encina.Marten.Tests/Snapshots/SnapshotPropertyTests.cs`
- `tests/Encina.Marten.Tests/Snapshots/SnapshotContractTests.cs`
- `tests/Encina.Marten.Tests/Snapshots/SnapshotGuardClauseTests.cs`
- `tests/Encina.Marten.IntegrationTests/Snapshots/TestSnapshotableAggregate.cs`
- `tests/Encina.Marten.IntegrationTests/Snapshots/MartenSnapshotStoreIntegrationTests.cs`

**Files Modified**:
- `src/Encina.Marten/EncinaMartenOptions.cs` - Added `Snapshots` property
- `src/Encina.Marten/ServiceCollectionExtensions.cs` - Added `AddSnapshotableAggregate<T>()` method
- `tests/Encina.Marten.IntegrationTests/Encina.Marten.IntegrationTests.csproj` - Added NSubstitute reference

### December 26 (Continued) - Event Versioning (Issue #37)

**Issue Closed**: `#37` (Event Versioning - Upcasters for schema evolution)

**Event Versioning Implementation** (Encina.Marten.Versioning):

Implemented comprehensive event versioning/upcasting system for handling schema evolution in event-sourced systems:

```csharp
// Define an upcaster class
public class ProductCreatedV1ToV2Upcaster
    : EventUpcaster<ProductCreatedV1, ProductCreatedV2>,
      IEventUpcaster<ProductCreatedV1, ProductCreatedV2>
{
    public override string EventTypeName => nameof(ProductCreatedV1);
    public string SourceEventTypeName => nameof(ProductCreatedV1);
    public Type SourceEventType => typeof(ProductCreatedV1);
    public Type TargetEventType => typeof(ProductCreatedV2);

    protected override ProductCreatedV2 Upcast(ProductCreatedV1 oldEvent) =>
        new(oldEvent.ProductId, oldEvent.Name, Price: 0m);

    ProductCreatedV2 IEventUpcaster<ProductCreatedV1, ProductCreatedV2>.Upcast(ProductCreatedV1 oldEvent) =>
        Upcast(oldEvent);
}

// Or use inline lambda syntax
options.EventVersioning.AddUpcaster<OrderCreatedV1, OrderCreatedV2>(
    old => new OrderCreatedV2(old.OrderId, old.CustomerName, "unknown@example.com"));

// Configure via EncinaMartenOptions
services.AddEncinaMarten(options =>
{
    options.EventVersioning
        .AddUpcaster<ProductCreatedV1ToV2Upcaster>()
        .ScanAssembly(typeof(ProductCreatedV1ToV2Upcaster).Assembly);
});
```

**Core Interfaces**:

| Interface | Purpose |
|-----------|---------|
| `IEventUpcaster` | Base interface with source event type name |
| `IEventUpcaster<TFrom, TTo>` | Strongly-typed upcaster with transformation method |

**Infrastructure Components**:

| Component | Purpose |
|-----------|---------|
| `EventUpcasterBase` | Abstract base wrapping Marten's `EventUpcaster<TFrom, TTo>` |
| `LambdaEventUpcaster<TFrom, TTo>` | Lambda-based upcaster for inline definitions |
| `EventUpcasterRegistry` | Registration and discovery of upcasters |
| `EventVersioningOptions` | Fluent configuration API |
| `ConfigureMartenEventVersioning` | `IConfigureOptions<StoreOptions>` integration |
| `VersioningLog` | High-performance logging with `LoggerMessage` |

**EventUpcasterRegistry Methods**:
- `Register<TUpcaster>()` - Register an upcaster by type
- `ScanAndRegister(assembly)` - Scan assembly for upcasters
- `HasUpcasterFor(eventTypeName)` - Check if upcaster exists
- `GetAllUpcasters()` - Get all registered upcasters
- `Count` - Number of registered upcasters

**EventVersioningOptions Fluent API**:
- `AddUpcaster<TUpcaster>()` - Add class-based upcaster
- `AddUpcaster<TFrom, TTo>(Func<TFrom, TTo>)` - Add lambda upcaster
- `ScanAssembly(assembly)` - Scan assembly for upcasters
- `ApplyTo(registry)` - Apply configuration to registry

**Error Codes** (EventVersioningErrorCodes):
- `event.versioning.upcast_failed` - Upcasting operation failed
- `event.versioning.upcaster_not_found` - No upcaster for event type
- `event.versioning.registration_failed` - Failed to register upcaster
- `event.versioning.duplicate_upcaster` - Duplicate upcaster registration
- `event.versioning.invalid_configuration` - Invalid configuration

**Logging** (LoggerMessage, EventIds 100-129):
- `ConfiguringMartenUpcasters` (100) - Start of configuration
- `AddingUpcasterToMarten` (101) - Individual upcaster registration
- `EventVersioningEnabled` (102) - Configuration complete

**Test Coverage**:

| Type | Count | Description |
|------|:-----:|-------------|
| Unit Tests | 23 | Registry, Options, Lambda, ErrorCodes, Base |
| Property Tests | 3 | FsCheck invariant verification |
| Contract Tests | 4 | Interface behavior contracts |
| Guard Clause Tests | 5 | Null argument validation |
| Integration Tests | 6 | Real PostgreSQL with Testcontainers |
| **Total** | **41** | Comprehensive coverage |

**Why Some Test Types Don't Apply**:
- **Load Tests/Benchmarks**: N/A - Upcasting is done during event deserialization (Marten's responsibility). Our code is thin wrapper with minimal overhead. The actual performance depends on Marten, not our routing code.

**Files Created**:
- `src/Encina.Marten/Versioning/ConfigureMartenEventVersioning.cs`
- `src/Encina.Marten/Versioning/VersioningLog.cs`
- `tests/Encina.Marten.Tests/Versioning/TestEvents.cs`
- `tests/Encina.Marten.Tests/Versioning/TestUpcasters.cs`
- `tests/Encina.Marten.Tests/Versioning/EventUpcasterBaseTests.cs`
- `tests/Encina.Marten.Tests/Versioning/EventUpcasterRegistryTests.cs`
- `tests/Encina.Marten.Tests/Versioning/EventVersioningOptionsTests.cs`
- `tests/Encina.Marten.Tests/Versioning/LambdaEventUpcasterTests.cs`
- `tests/Encina.Marten.Tests/Versioning/EventVersioningErrorCodesTests.cs`
- `tests/Encina.Marten.Tests/Versioning/VersioningGuardClauseTests.cs`
- `tests/Encina.Marten.Tests/Versioning/VersioningContractTests.cs`
- `tests/Encina.Marten.Tests/Versioning/VersioningPropertyTests.cs`
- `tests/Encina.Marten.IntegrationTests/Versioning/TestVersionedEvents.cs`
- `tests/Encina.Marten.IntegrationTests/Versioning/TestProductUpcasters.cs`
- `tests/Encina.Marten.IntegrationTests/Versioning/EventVersioningIntegrationTests.cs`

**Files Modified**:
- `src/Encina.Marten/ServiceCollectionExtensions.cs` - Added `IEventUpcasterRegistrar` interface and DI registration
- `src/Encina.Marten/EncinaMartenOptions.cs` - Added `EventVersioning` property (already existed)
- `src/Encina.Marten/PublicAPI.Unshipped.txt` - Added public API declarations

### December 26 (Continued) - Routing Slip Pattern (Issue #62)

**Issue Closed**: `#62` (Routing Slip Pattern - Dynamic message routing with compensation)

**Routing Slip Implementation** (Encina.Messaging.RoutingSlip):

Implemented the Routing Slip enterprise integration pattern for dynamic message routing with inline step definition and automatic compensation:

```csharp
var definition = RoutingSlipBuilder.Create<OrderData>("ProcessOrder")
    .Step("Validate Order")
        .Execute((data, ctx, ct) =>
        {
            // Validate order, dynamically add verification if needed
            if (data.Amount > 10000)
                ctx.AddStepNext(manualApprovalStep);
            return ValueTask.FromResult(Right<EncinaError, OrderData>(data));
        })
    .Step("Process Payment")
        .Execute(async (data, ctx, ct) =>
        {
            data.PaymentId = await ProcessPaymentAsync(data);
            return Right<EncinaError, OrderData>(data);
        })
        .Compensate(async (data, ctx, ct) =>
            await RefundPaymentAsync(data.PaymentId))
    .Step("Ship Order")
        .Execute(async (data, ctx, ct) =>
        {
            data.TrackingNumber = await ShipAsync(data);
            return Right<EncinaError, OrderData>(data);
        })
        .Compensate(async (data, ctx, ct) =>
            await CancelShipmentAsync(data.TrackingNumber))
    .OnCompletion(async (data, ctx, ct) =>
        await NotifyCustomerAsync(data))
    .WithTimeout(TimeSpan.FromMinutes(5))
    .Build();

var result = await runner.RunAsync(definition, new OrderData());
// result.FinalData.TrackingNumber, result.StepsExecuted, result.StepsAdded
```

**Core Interfaces**:

| Interface | Purpose |
|-----------|---------|
| `IRoutingSlipRunner` | Executes routing slip definitions |

**Infrastructure Components**:

| Component | Purpose |
|-----------|---------|
| `RoutingSlipBuilder` | Static factory and fluent API entry point |
| `RoutingSlipBuilder<TData>` | Generic builder with step configuration |
| `RoutingSlipStepBuilder<TData>` | Step configuration with Execute/Compensate |
| `BuiltRoutingSlipDefinition<TData>` | Immutable definition ready for execution |
| `RoutingSlipStepDefinition<TData>` | Single step in the itinerary |
| `RoutingSlipContext<TData>` | Context for dynamic route modification |
| `RoutingSlipActivityEntry<TData>` | Activity log entry with compensation data |
| `RoutingSlipResult<TData>` | Execution result with metrics |
| `RoutingSlipRunner` | Full runner implementation |
| `RoutingSlipOptions` | Configuration options |

**Dynamic Route Modification** (via RoutingSlipContext):
- `AddStep(step)` - Add step to end of itinerary
- `AddStepNext(step)` - Insert step immediately after current
- `InsertStep(index, step)` - Insert at specific position
- `RemoveStepAt(index)` - Remove step at position
- `ClearRemainingSteps()` - Terminate early

**RoutingSlipResult Metrics**:
- `RoutingSlipId` - Unique execution identifier
- `FinalData` - Data after all steps executed
- `StepsExecuted` - Total steps executed
- `StepsAdded` - Steps dynamically added during execution
- `StepsRemoved` - Steps skipped or removed
- `Duration` - Total execution time
- `ActivityLog` - Full activity log for audit/debugging

**Configuration Options**:

| Option | Default | Description |
|--------|---------|-------------|
| `DefaultTimeout` | 30 min | Default timeout for routing slips |
| `StuckCheckInterval` | 5 min | Interval for stuck slip detection |
| `StuckThreshold` | 10 min | Time after which slip is considered stuck |
| `BatchSize` | 100 | Max slips per processing batch |
| `ContinueCompensationOnFailure` | true | Continue with other compensations if one fails |

**Error Codes** (RoutingSlipErrorCodes):
- `routingslip.not_found` - Routing slip not found
- `routingslip.invalid_status` - Invalid status for operation
- `routingslip.step_failed` - Step execution failed
- `routingslip.compensation_failed` - Compensation failed
- `routingslip.timeout` - Execution timed out
- `routingslip.handler.cancelled` - Handler was cancelled
- `routingslip.handler.failed` - Handler threw exception

**Status Constants** (RoutingSlipStatus):
- `Running`, `Completed`, `Compensating`, `Compensated`, `Failed`, `TimedOut`

**Comparison with Saga Pattern**:

| Aspect | Saga (Issue #41) | Routing Slip (Issue #62) |
|--------|-----------------|--------------------------|
| Route Definition | Fixed at build time | Can change during execution |
| Step Addition | Not possible | `AddStep()`, `AddStepNext()`, `InsertStep()` |
| Step Removal | Not possible | `RemoveStepAt()`, `ClearRemainingSteps()` |
| Use Case | Predefined workflows | Dynamic, adaptive workflows |
| Persistence | Via `ISagaStore` | In-memory (store abstraction available) |

**Test Coverage**:

| Type | Count | Description |
|------|:-----:|-------------|
| Unit Tests | 74 | Builder, StepBuilder, Runner, Context |
| Property Tests | 63 | FsCheck invariant verification |
| Guard Clause Tests | 35 | Null argument and range validation |
| **Total** | **137** | Comprehensive coverage |

**Why Some Test Types Don't Apply**:
- **Integration Tests**: N/A - RoutingSlip is primarily in-memory execution. There's no database/external dependency. The `IRoutingSlipStore` is an optional persistence abstraction not yet implemented.
- **Contract Tests**: N/A - `IRoutingSlipRunner` is the only public interface, covered by unit tests.
- **Load Tests/Benchmarks**: N/A - Performance depends entirely on user-provided step functions, not the routing infrastructure. The pattern is about workflow composition, not hot-path performance.

**Files Created**:
- `src/Encina.Messaging/RoutingSlip/RoutingSlipErrorCodes.cs`
- `src/Encina.Messaging/RoutingSlip/RoutingSlipStatus.cs`
- `src/Encina.Messaging/RoutingSlip/RoutingSlipOptions.cs`
- `src/Encina.Messaging/RoutingSlip/IRoutingSlipState.cs`
- `src/Encina.Messaging/RoutingSlip/IRoutingSlipStore.cs`
- `src/Encina.Messaging/RoutingSlip/RoutingSlipContext.cs`
- `src/Encina.Messaging/RoutingSlip/RoutingSlipStepDefinition.cs`
- `src/Encina.Messaging/RoutingSlip/RoutingSlipActivityEntry.cs`
- `src/Encina.Messaging/RoutingSlip/RoutingSlipResult.cs`
- `src/Encina.Messaging/RoutingSlip/RoutingSlipBuilder.cs`
- `src/Encina.Messaging/RoutingSlip/RoutingSlipStepBuilder.cs`
- `src/Encina.Messaging/RoutingSlip/IRoutingSlipRunner.cs`
- `src/Encina.Messaging/RoutingSlip/RoutingSlipRunner.cs`
- `tests/Encina.Tests/RoutingSlip/RoutingSlipBuilderTests.cs`
- `tests/Encina.Tests/RoutingSlip/RoutingSlipStepBuilderTests.cs`
- `tests/Encina.Tests/RoutingSlip/RoutingSlipRunnerTests.cs`
- `tests/Encina.Tests/RoutingSlip/RoutingSlipContextTests.cs`
- `tests/Encina.Tests/PropertyTests/RoutingSlipPropertyTests.cs`
- `tests/Encina.Tests/Guards/RoutingSlipGuardsTests.cs`

**Files Modified**:
- `src/Encina.Messaging/MessagingConfiguration.cs` - Added `UseRoutingSlips` and `RoutingSlipOptions`
- `src/Encina.Messaging/MessagingServiceCollectionExtensions.cs` - Added `IRoutingSlipRunner` registration
- `src/Encina.Messaging/PublicAPI.Unshipped.txt` - Added public API declarations

---

### December 27 - Azure Functions Integration (Issue #59)

**Issue Closed**: `#59` (Azure Functions Integration - Serverless function execution)

**Azure Functions Implementation** (Encina.AzureFunctions):

Implemented comprehensive Azure Functions integration for serverless execution with full Railway Oriented Programming support:

```csharp
// Program.cs configuration
var host = new HostBuilder()
    .ConfigureFunctionsWorkerDefaults(builder =>
    {
        builder.UseEncinaMiddleware();
    })
    .ConfigureServices(services =>
    {
        services.AddEncina(typeof(Program).Assembly);
        services.AddEncinaAzureFunctions(options =>
        {
            options.CorrelationIdHeader = "X-Request-ID";
            options.EnableRequestContextEnrichment = true;
        });
    })
    .Build();

// HTTP Trigger function
[Function("CreateOrder")]
public async Task<HttpResponseData> CreateOrder(
    [HttpTrigger(AuthorizationLevel.Function, "post", Route = "orders")]
    HttpRequestData req)
{
    var command = await req.ReadFromJsonAsync<CreateOrder>();
    var result = await _encina.Send(command!);

    return await result.ToCreatedResponse(req, order => $"/orders/{order.Id}");
}
```

**Core Components**:

| Component | Purpose |
|-----------|---------|
| `EncinaAzureFunctionsOptions` | Configuration for headers, claims, error handling |
| `EncinaFunctionMiddleware` | Request context enrichment middleware |
| `FunctionContextExtensions` | Context extraction (correlation, user, tenant) |
| `HttpResponseDataExtensions` | Result-to-response conversion with ROP |
| `AzureFunctionsHealthCheck` | Health check implementation |
| `ServiceCollectionExtensions` | DI registration |

**HTTP Response Extensions**:
- `ToHttpResponseData<T>()` - Standard response conversion
- `ToCreatedResponse<T>()` - 201 Created with Location header
- `ToNoContentResponse()` - 204 No Content for void operations
- `ToProblemDetailsResponse()` - RFC 7807 Problem Details

**Error Code to HTTP Status Mapping**:

| Error Pattern | HTTP Status |
|--------------|-------------|
| `validation.*` | 400 Bad Request |
| `encina.guard.validation_failed` | 400 Bad Request |
| `authorization.unauthenticated` | 401 Unauthorized |
| `authorization.*` | 403 Forbidden |
| `*.not_found`, `*.missing` | 404 Not Found |
| `*.conflict`, `*.already_exists`, `*.duplicate` | 409 Conflict |
| Other | 500 Internal Server Error |

**Request Context Enrichment**:
- Automatic correlation ID extraction/generation
- User ID extraction from claims
- Tenant ID extraction from headers or claims
- All accessible via `FunctionContext` extensions

**Configuration Options**:

| Option | Default | Description |
|--------|---------|-------------|
| `EnableRequestContextEnrichment` | true | Toggle context enrichment |
| `CorrelationIdHeader` | X-Correlation-ID | Header name for correlation |
| `TenantIdHeader` | X-Tenant-ID | Header name for tenant |
| `UserIdClaimType` | NameIdentifier | Claim type for user ID |
| `TenantIdClaimType` | tenant_id | Claim type for tenant |
| `IncludeExceptionDetailsInResponse` | false | Include details in errors |
| `ProviderHealthCheck.Enabled` | true | Enable health check |

**Test Coverage**:

| Type | Count | Description |
|------|:-----:|-------------|
| Unit Tests | 57 | Options, ServiceCollection, HealthCheck, Extensions |
| Contract Tests | 12 | IEncinaHealthCheck contract |
| Property Tests | 13 | Error code mapping invariants |
| Guard Clause Tests | 8 | Null argument validation |
| Benchmarks | 10 | Error code mapping performance |
| **Total** | **100** | Comprehensive coverage |

**Why Some Test Types Don't Apply**:
- **Integration Tests**: Would require Azure Functions host, actual Azure resources, or complex mocking. The middleware is a thin wrapper that delegates to Azure Functions infrastructure.
- **Load Tests**: N/A - Azure Functions scaling is handled by the platform, not our code.

**Files Created**:
- `src/Encina.AzureFunctions/Encina.AzureFunctions.csproj`
- `src/Encina.AzureFunctions/EncinaAzureFunctionsOptions.cs`
- `src/Encina.AzureFunctions/ServiceCollectionExtensions.cs`
- `src/Encina.AzureFunctions/FunctionsWorkerApplicationBuilderExtensions.cs`
- `src/Encina.AzureFunctions/EncinaFunctionMiddleware.cs`
- `src/Encina.AzureFunctions/FunctionContextExtensions.cs`
- `src/Encina.AzureFunctions/HttpResponseDataExtensions.cs`
- `src/Encina.AzureFunctions/Log.cs`
- `src/Encina.AzureFunctions/Health/AzureFunctionsHealthCheck.cs`
- `src/Encina.AzureFunctions/GlobalSuppressions.cs`
- `src/Encina.AzureFunctions/PublicAPI.Shipped.txt`
- `src/Encina.AzureFunctions/PublicAPI.Unshipped.txt`
- `src/Encina.AzureFunctions/README.md`
- `tests/Encina.AzureFunctions.Tests/Encina.AzureFunctions.Tests.csproj`
- `tests/Encina.AzureFunctions.Tests/EncinaAzureFunctionsOptionsTests.cs`
- `tests/Encina.AzureFunctions.Tests/ServiceCollectionExtensionsTests.cs`
- `tests/Encina.AzureFunctions.Tests/AzureFunctionsHealthCheckTests.cs`
- `tests/Encina.AzureFunctions.Tests/HttpResponseDataExtensionsTests.cs`
- `tests/Encina.AzureFunctions.Tests/GlobalSuppressions.cs`
- `tests/Encina.AzureFunctions.ContractTests/Encina.AzureFunctions.ContractTests.csproj`
- `tests/Encina.AzureFunctions.ContractTests/HealthCheckContractTests.cs`
- `tests/Encina.AzureFunctions.PropertyTests/Encina.AzureFunctions.PropertyTests.csproj`
- `tests/Encina.AzureFunctions.PropertyTests/ErrorCodeMappingProperties.cs`
- `tests/Encina.AzureFunctions.GuardTests/Encina.AzureFunctions.GuardTests.csproj`
- `tests/Encina.AzureFunctions.GuardTests/GuardClauseTests.cs`
- `benchmarks/Encina.AzureFunctions.Benchmarks/Encina.AzureFunctions.Benchmarks.csproj`
- `benchmarks/Encina.AzureFunctions.Benchmarks/ErrorCodeMappingBenchmarks.cs`
- `benchmarks/Encina.AzureFunctions.Benchmarks/Program.cs`

**Files Modified**:
- `Directory.Packages.props` - Added Azure Functions Worker package versions
- `CHANGELOG.md` - Added Azure Functions integration entry

### December 27 (Continued) - AWS Lambda Integration (Issue #60)

**Issue Closed**: `#60` (AWS Lambda Integration)

**Encina.AwsLambda Package** - AWS Lambda integration with Railway Oriented Programming support:

| Component | Purpose |
|-----------|---------|
| `EncinaAwsLambdaOptions` | Configuration for context enrichment, header names, claim types |
| `ServiceCollectionExtensions` | DI registration via `AddEncinaAwsLambda()` |
| `ApiGatewayResponseExtensions` | Convert `Either<EncinaError, T>` to API Gateway responses |
| `SqsMessageHandler` | Process SQS batches with partial failure reporting |
| `EventBridgeHandler` | Process EventBridge events with automatic deserialization |
| `LambdaContextExtensions` | Extract correlation ID, user ID, tenant ID from context |
| `AwsLambdaHealthCheck` | Health check implementing `IEncinaHealthCheck` |

**API Gateway Response Extensions**:

| Method | Purpose |
|--------|---------|
| `ToApiGatewayResponse<T>()` | 200 OK with JSON body |
| `ToCreatedResponse<T>()` | 201 Created with Location header |
| `ToNoContentResponse()` | 204 No Content |
| `ToHttpApiResponse<T>()` | HTTP API (V2) format |
| `ToProblemDetailsResponse()` | RFC 7807 error response |

**Error Code to HTTP Status Mapping**:

| Error Code Pattern | HTTP Status |
|-------------------|-------------|
| `validation.*` | 400 Bad Request |
| `authorization.unauthenticated` | 401 Unauthorized |
| `authorization.*` | 403 Forbidden |
| `*.not_found`, `*.missing` | 404 Not Found |
| `*.conflict`, `*.already_exists`, `*.duplicate` | 409 Conflict |
| (default) | 500 Internal Server Error |

**SQS Message Handler**:

| Method | Purpose |
|--------|---------|
| `ProcessBatchAsync<TMessage, TResult>()` | Process with automatic deserialization and partial failure reporting |
| `ProcessBatchAsync()` | Process raw SQS records with partial failure reporting |
| `ProcessAllAsync()` | Process all-or-nothing (stops on first error) |
| `DeserializeMessage<T>()` | Type-safe message deserialization |

**EventBridge Handler**:

| Method | Purpose |
|--------|---------|
| `ProcessAsync<TDetail, TResult>()` | Strongly-typed event processing |
| `ProcessRawAsync<TDetail, TResult>()` | Process from raw JSON |
| `GetMetadata()` | Extract event metadata |

**Lambda Context Extensions**:

| Method | Purpose |
|--------|---------|
| `GetCorrelationId()` | From header or AWS Request ID |
| `GetUserId()` | From JWT claims |
| `GetTenantId()` | From header or claims |
| `GetAwsRequestId()` | AWS Request ID |
| `GetFunctionName()` | Function name |
| `GetRemainingTimeMs()` | Remaining execution time |

**Test Coverage**:

| Test Type | Count | Purpose |
|-----------|-------|---------|
| Unit Tests | 97 | Core functionality |
| Contract Tests | 21 | API behavior contracts |
| Property Tests | 10 | Invariant validation |
| Guard Tests | 21 | Null parameter validation |
| Benchmarks | 6 | Response creation performance |
| **Total** | **155** | Comprehensive coverage |

**Why Some Test Types Don't Apply**:
- **Integration Tests**: Would require AWS Lambda runtime, LocalStack, or complex mocking. The handlers are thin wrappers over AWS SDK types.
- **Load Tests**: N/A - AWS Lambda scaling is handled by the platform, not our code.

**Files Created**:
- `src/Encina.AwsLambda/Encina.AwsLambda.csproj`
- `src/Encina.AwsLambda/EncinaAwsLambdaOptions.cs`
- `src/Encina.AwsLambda/ServiceCollectionExtensions.cs`
- `src/Encina.AwsLambda/ApiGatewayResponseExtensions.cs`
- `src/Encina.AwsLambda/SqsMessageHandler.cs`
- `src/Encina.AwsLambda/EventBridgeHandler.cs`
- `src/Encina.AwsLambda/LambdaContextExtensions.cs`
- `src/Encina.AwsLambda/Health/AwsLambdaHealthCheck.cs`
- `src/Encina.AwsLambda/GlobalSuppressions.cs`
- `src/Encina.AwsLambda/PublicAPI.Shipped.txt`
- `src/Encina.AwsLambda/PublicAPI.Unshipped.txt`
- `src/Encina.AwsLambda/README.md`
- `tests/Encina.AwsLambda.Tests/Encina.AwsLambda.Tests.csproj`
- `tests/Encina.AwsLambda.Tests/EncinaAwsLambdaOptionsTests.cs`
- `tests/Encina.AwsLambda.Tests/ServiceCollectionExtensionsTests.cs`
- `tests/Encina.AwsLambda.Tests/ApiGatewayResponseExtensionsTests.cs`
- `tests/Encina.AwsLambda.Tests/SqsMessageHandlerTests.cs`
- `tests/Encina.AwsLambda.Tests/EventBridgeHandlerTests.cs`
- `tests/Encina.AwsLambda.Tests/LambdaContextExtensionsTests.cs`
- `tests/Encina.AwsLambda.Tests/AwsLambdaHealthCheckTests.cs`
- `tests/Encina.AwsLambda.ContractTests/Encina.AwsLambda.ContractTests.csproj`
- `tests/Encina.AwsLambda.ContractTests/ApiGatewayResponseContractTests.cs`
- `tests/Encina.AwsLambda.ContractTests/SqsHandlerContractTests.cs`
- `tests/Encina.AwsLambda.PropertyTests/Encina.AwsLambda.PropertyTests.csproj`
- `tests/Encina.AwsLambda.PropertyTests/ErrorCodeMappingProperties.cs`
- `tests/Encina.AwsLambda.GuardTests/Encina.AwsLambda.GuardTests.csproj`
- `tests/Encina.AwsLambda.GuardTests/GuardClauseTests.cs`
- `benchmarks/Encina.AwsLambda.Benchmarks/Encina.AwsLambda.Benchmarks.csproj`
- `benchmarks/Encina.AwsLambda.Benchmarks/ApiGatewayResponseBenchmarks.cs`
- `benchmarks/Encina.AwsLambda.Benchmarks/Program.cs`

**Files Modified**:
- `Directory.Packages.props` - Added AWS Lambda Core and Events package versions
- `CHANGELOG.md` - Added AWS Lambda integration entry
- `ROADMAP.md` - Updated serverless section to show AWS Lambda as complete

---

### December 27 - Durable Functions Integration (Issue #61)

**Issue Closed**: `#61`

**Durable Functions Integration** (Encina.AzureFunctions.Durable):

Added Azure Durable Functions support with Railway Oriented Programming (ROP) integration.

**Orchestration Context Extensions**:
- `CallEncinaActivityAsync<TInput, TResult>()` for calling activities that return Either directly
- `CallEncinaActivityWithResultAsync<TInput, TResult>()` for activities using ActivityResult wrapper
- `CallEncinaSubOrchestratorAsync<TInput, TResult>()` for sub-orchestrator calls with Either
- `WaitForEncinaExternalEventAsync<T>()` for waiting on external events with timeout and ROP result
- `CreateRetryOptions()` for creating TaskOptions from retry parameters
- `GetCorrelationId()` for accessing orchestration instance ID as correlation ID

**ActivityResult<T> Serializable Wrapper**:
- Serializable wrapper for Either results (Durable Functions require JSON serialization)
- `Success()` and `Failure()` factory methods
- `ToEither()` for conversion back to Either
- `ToActivityResult()` extension for Either conversion to ActivityResult

**Saga Pattern with DurableSagaBuilder**:
- `DurableSagaBuilder<TData>` fluent API for defining saga workflows
- `DurableSagaStepBuilder<TData>` for configuring individual steps
- `Step()` for adding named steps
- `Execute()` for setting activity name
- `Compensate()` for setting compensation activity
- `WithRetry()` for step-level retry configuration
- `SkipCompensationOnFailure()` for idempotent operations
- `WithTimeout()` for saga-level timeout
- `WithDefaultRetryOptions()` for default retry options across all steps
- Automatic compensation in reverse order on failure
- `DurableSaga<TData>.ExecuteAsync()` for execution
- `DurableSagaError` capturing original error and compensation results

**Fan-Out/Fan-In Extensions**:
- `FanOutAsync<TInput, TResult>()` for parallel activity execution with all results
- `FanOutAllAsync<TInput, TResult>()` requiring all parallel executions to succeed
- `FanOutFirstSuccessAsync<TInput, TResult>()` returning first successful result
- `FanOutMultipleAsync<T1, T2>()` for running different activities in parallel
- `Partition<T>()` for separating successes from failures in result collections

**Configuration & Health Check**:
- `DurableFunctionsOptions` for configuring defaults:
  - `DefaultMaxRetries`, `DefaultFirstRetryInterval`, `DefaultBackoffCoefficient`, `DefaultMaxRetryInterval`
  - `ContinueCompensationOnError`, `DefaultSagaTimeout`
  - `ProviderHealthCheck` options
- `DurableFunctionsHealthCheck` implementing `IEncinaHealthCheck`
- DI registration via `AddEncinaDurableFunctions()`

**Test Coverage**:

| Test Type | Count | Purpose |
|-----------|-------|---------|
| Unit | 124 | Core functionality |
| Contract | 58 | API contract verification |
| Property | 27 | Invariant verification |
| Guard | 19 | Null/argument validation |
| **Total** | **228** | Comprehensive coverage |

**Why Some Test Types Don't Apply**:
- **Integration Tests**: Would require Azure Durable Task runtime or emulator
- **Load Tests**: N/A - Durable Functions scaling is handled by the platform

**Files Created**:
- `src/Encina.AzureFunctions/Durable/OrchestrationContextExtensions.cs`
- `src/Encina.AzureFunctions/Durable/ActivityResult.cs`
- `src/Encina.AzureFunctions/Durable/DurableSagaBuilder.cs`
- `src/Encina.AzureFunctions/Durable/FanOutFanInExtensions.cs`
- `src/Encina.AzureFunctions/Durable/DurableFunctionsOptions.cs`
- `src/Encina.AzureFunctions/Durable/DurableFunctionsHealthCheck.cs`
- `src/Encina.AzureFunctions/Durable/DurableServiceCollectionExtensions.cs`
- `tests/Encina.AzureFunctions.Tests/Durable/ActivityResultTests.cs`
- `tests/Encina.AzureFunctions.Tests/Durable/DurableFunctionsOptionsTests.cs`
- `tests/Encina.AzureFunctions.Tests/Durable/DurableFunctionsHealthCheckTests.cs`
- `tests/Encina.AzureFunctions.Tests/Durable/DurableSagaBuilderTests.cs`
- `tests/Encina.AzureFunctions.Tests/Durable/DurableServiceCollectionExtensionsTests.cs`
- `tests/Encina.AzureFunctions.Tests/Durable/OrchestrationContextExtensionsTests.cs`
- `tests/Encina.AzureFunctions.Tests/Durable/FanOutFanInExtensionsTests.cs`
- `tests/Encina.AzureFunctions.ContractTests/Durable/DurableFunctionsHealthCheckContractTests.cs`
- `tests/Encina.AzureFunctions.ContractTests/Durable/ActivityResultContractTests.cs`
- `tests/Encina.AzureFunctions.ContractTests/Durable/DurableSagaBuilderContractTests.cs`
- `tests/Encina.AzureFunctions.ContractTests/Durable/DurableServiceCollectionContractTests.cs`
- `tests/Encina.AzureFunctions.PropertyTests/Durable/ActivityResultProperties.cs`
- `tests/Encina.AzureFunctions.PropertyTests/Durable/DurableSagaBuilderProperties.cs`
- `tests/Encina.AzureFunctions.GuardTests/Durable/DurableFunctionsGuardClauseTests.cs`

**Files Modified**:
- `Directory.Packages.props` - Added Microsoft.Azure.Functions.Worker.Extensions.DurableTask
- `src/Encina.AzureFunctions/Encina.AzureFunctions.csproj` - Added DurableTask package reference
- `src/Encina.AzureFunctions/GlobalSuppressions.cs` - Added CA1000 suppression for ActivityResult<T>
- `src/Encina.AzureFunctions/PublicAPI.Unshipped.txt` - Added all new Durable symbols
- `src/Encina.AzureFunctions/README.md` - Added Durable Functions documentation
- `CHANGELOG.md` - Added Durable Functions integration entry
- `tests/Encina.AzureFunctions.ContractTests/Encina.AzureFunctions.ContractTests.csproj` - Added packages
- `tests/Encina.AzureFunctions.PropertyTests/Encina.AzureFunctions.PropertyTests.csproj` - Added packages

---

### December 27 - Module-scoped Pipeline Behaviors

**Issue Closed**: `#58`

**Module-scoped Pipeline Behaviors** for modular monolith architectures:

Implemented the ability for pipeline behaviors to be scoped to specific modules, ensuring they only execute when the request is handled by handlers within that module.

**Core Interface**:
- `IModulePipelineBehavior<TModule, TRequest, TResponse>` - Marker interface for module-specific behaviors
- Same signature as `IPipelineBehavior` but with TModule type parameter for module association

**ModuleBehaviorAdapter**:
- Internal adapter that wraps `IModulePipelineBehavior` implementations
- Filters execution based on handler-module ownership
- Uses `IModuleHandlerRegistry` to determine if handler belongs to target module
- Skips behavior execution (passes directly to next step) if handler is not in target module

**IModuleHandlerRegistry**:
- Maps handler types to their owning modules via assembly association
- `GetModuleName(Type handlerType)` - Returns module name for a handler type
- `GetModule(Type handlerType)` - Returns module instance for a handler type
- `BelongsToModule(Type handlerType, string moduleName)` - Case-insensitive module membership check
- `BelongsToModule<TModule>(Type handlerType)` - Generic module membership check
- `NullModuleHandlerRegistry` - Null Object pattern for when modules aren't configured

**Request Context Extensions**:
- `GetModuleName()` - Retrieves current module name from context metadata
- `WithModuleName(string name)` - Sets module name in context (immutable, returns new context)
- `WithModuleName(IModule module)` - Sets module name from module instance
- `IsInModule(string moduleName)` - Case-insensitive check if context is in module
- `IsInModule<TModule>(TModule module)` - Generic check if context is in module

**DI Extension Methods**:
- `AddEncinaModuleBehavior<TModule, TRequest, TResponse, TBehavior>()` - Registers module behavior
- Overload with `ServiceLifetime` parameter for custom lifetimes (Scoped default)
- Automatically registers behavior implementation, interface, and adapter

**Assembly Scanner Fix**:
- Skip `ModuleBehaviorAdapter` during assembly scanning (3 type params vs 2 for IPipelineBehavior)
- Prevents arity mismatch error when scanning Encina assembly

**Test Coverage**:

| Test Type | Count | Purpose |
|-----------|-------|---------|
| Unit | 100 | Core functionality for all module components |

**Why Some Test Types Don't Apply**:
- **Integration Tests**: Module behaviors are tested in isolation; integration with real Encina pipeline is covered by unit tests with mocks
- **Property Tests**: Module behavior filtering is deterministic based on registry state
- **Load Tests**: N/A - Module filtering is a simple boolean check
- **Benchmarks**: N/A - Module filtering adds negligible overhead (single dictionary lookup)

**Files Created**:
- `src/Encina/Modules/IModulePipelineBehavior.cs`
- `src/Encina/Modules/ModuleBehaviorAdapter.cs`
- `src/Encina/Modules/IModuleHandlerRegistry.cs`
- `src/Encina/Modules/ModuleHandlerRegistry.cs`
- `src/Encina/Modules/RequestContextModuleExtensions.cs`
- `src/Encina/Modules/ModuleBehaviorServiceCollectionExtensions.cs`
- `tests/Encina.Tests/Modules/ModuleBehaviorAdapterTests.cs`
- `tests/Encina.Tests/Modules/ModuleHandlerRegistryTests.cs`
- `tests/Encina.Tests/Modules/RequestContextModuleExtensionsTests.cs`
- `tests/Encina.Tests/Modules/ModuleBehaviorServiceCollectionExtensionsTests.cs`

**Files Modified**:
- `src/Encina/Modules/ModuleServiceCollectionExtensions.cs` - Added IModuleHandlerRegistry registration
- `src/Encina/Core/ServiceCollectionExtensions.cs` - Added NullModuleHandlerRegistry fallback
- `src/Encina/Dispatchers/MediatorAssemblyScanner.cs` - Skip ModuleBehaviorAdapter during scanning
- `src/Encina/PublicAPI.Unshipped.txt` - Added all new public API symbols
- `CHANGELOG.md` - Added module-scoped behaviors entry
- `ROADMAP.md` - Added Module-scoped behaviors to Phase 2 completed items

---

### December 27 (Continued) - Distributed Lock Abstractions (Issue #55)

**Issue Closed**: `#55`

**Distributed Lock Abstractions** provides a provider-agnostic distributed locking system for coordinating access to shared resources across multiple processes or machines.

**Core Abstractions Package (Encina.DistributedLock)**:

| Interface/Class | Purpose |
|-----------------|---------|
| `IDistributedLockProvider` | Main provider interface with TryAcquire, Acquire, IsLocked, Extend |
| `ILockHandle` | Lock handle with Resource, AcquiredAtUtc, ExpiresAtUtc, ReleaseAsync |
| `DistributedLockOptions` | Base options with DefaultExpiry, DefaultWaitTime, DefaultRetryInterval |
| `LockAcquisitionException` | Exception for failed lock acquisitions |

**Provider Implementations**:

| Package | Backend | Use Case |
|---------|---------|----------|
| `Encina.DistributedLock.InMemory` | ConcurrentDictionary | Testing & single-instance apps |
| `Encina.DistributedLock.Redis` | StackExchange.Redis with Lua scripts | Production distributed systems |
| `Encina.DistributedLock.SqlServer` | sp_getapplock stored procedure | Database-centric applications |

**Key Design Decisions**:

1. **Safe Lock Release**: Redis implementation uses Lua scripts to ensure only the lock owner can release
2. **Lock Extension**: All providers support extending lock expiry without re-acquiring
3. **Health Checks**: Redis and SQL Server providers include ASP.NET Core health checks
4. **ROP Integration**: Lock acquisition returns `null` on timeout instead of throwing (TryAcquire pattern)

**Redis Implementation Details**:
- Uses SET NX EX for atomic lock acquisition with expiry
- Lua script for safe release (verifies ownership via unique lock value)
- Lock value includes hostname + GUID for debugging
- Health check verifies Redis connectivity

**SQL Server Implementation Details**:
- Uses sp_getapplock with TRANSACTION scope
- Requires SqlConnection with active transaction
- Lock is auto-released when transaction commits/rolls back
- Health check verifies database connectivity

**Encina.Caching Integration**:
- Updated `Encina.Caching` to reference `Encina.DistributedLock`
- Re-exports types via global using alias for backward compatibility
- `IDistributedLockProvider` now comes from dedicated package

**Test Coverage**:

| Test Type | Count | Purpose |
|-----------|-------|---------|
| Unit | 100+ | Provider functionality, DI registration, options |
| Integration | 50+ | Testcontainers with real Redis/SQL Server |
| Contract | 20+ | Interface contract verification across providers |
| Property | 30+ | FsCheck invariants for locking behavior |
| Guard | 30+ | ArgumentNullException verification |
| Load | 10+ | High-concurrency stress tests |
| Benchmark | 5+ | BenchmarkDotNet performance measurement |

**Files Created**:

Core Package:
- `src/Encina.DistributedLock/IDistributedLockProvider.cs`
- `src/Encina.DistributedLock/ILockHandle.cs`
- `src/Encina.DistributedLock/DistributedLockOptions.cs`
- `src/Encina.DistributedLock/LockAcquisitionException.cs`
- `src/Encina.DistributedLock/ServiceCollectionExtensions.cs`
- `src/Encina.DistributedLock/README.md`

InMemory Provider:
- `src/Encina.DistributedLock.InMemory/InMemoryDistributedLockProvider.cs`
- `src/Encina.DistributedLock.InMemory/InMemoryLockOptions.cs`
- `src/Encina.DistributedLock.InMemory/InMemoryLockHandle.cs`
- `src/Encina.DistributedLock.InMemory/ServiceCollectionExtensions.cs`

Redis Provider:
- `src/Encina.DistributedLock.Redis/RedisDistributedLockProvider.cs`
- `src/Encina.DistributedLock.Redis/RedisLockOptions.cs`
- `src/Encina.DistributedLock.Redis/RedisLockHandle.cs`
- `src/Encina.DistributedLock.Redis/Health/RedisDistributedLockHealthCheck.cs`
- `src/Encina.DistributedLock.Redis/ServiceCollectionExtensions.cs`

SQL Server Provider:
- `src/Encina.DistributedLock.SqlServer/SqlServerDistributedLockProvider.cs`
- `src/Encina.DistributedLock.SqlServer/SqlServerLockOptions.cs`
- `src/Encina.DistributedLock.SqlServer/SqlServerLockHandle.cs`
- `src/Encina.DistributedLock.SqlServer/Health/SqlServerDistributedLockHealthCheck.cs`
- `src/Encina.DistributedLock.SqlServer/ServiceCollectionExtensions.cs`

Test Projects:
- `tests/Encina.DistributedLock.Tests/`
- `tests/Encina.DistributedLock.Redis.Tests/`
- `tests/Encina.DistributedLock.SqlServer.Tests/`
- `tests/Encina.DistributedLock.ContractTests/`
- `tests/Encina.DistributedLock.PropertyTests/`
- `tests/Encina.DistributedLock.GuardTests/`
- `tests/Encina.DistributedLock.IntegrationTests/`
- `tests/Encina.DistributedLock.LoadTests/`
- `benchmarks/Encina.DistributedLock.Benchmarks/`

**Files Modified**:
- `src/Encina.Caching/Encina.Caching.csproj` - Added Encina.DistributedLock reference
- `src/Encina.Caching/Abstractions/IDistributedLockProvider.cs` - Re-exports from new package
- `Encina.slnx` - Added all new projects
- `CHANGELOG.md` - Added distributed lock entry
- `ROADMAP.md` - Updated Phase 2 status

---

### December 27 (Afternoon) - Content-Based Router (Issue #64)

**Overview**:
Implemented the Content-Based Router Enterprise Integration Pattern (EIP), which routes messages to handlers based on message content inspection.

**Core Abstractions**:

`IContentRouter` interface:
```csharp
public interface IContentRouter
{
    ValueTask<Either<EncinaError, ContentRouterResult<TResult>>> RouteAsync<TMessage, TResult>(
        BuiltContentRouterDefinition<TMessage, TResult> definition,
        TMessage message,
        CancellationToken cancellationToken = default)
        where TMessage : class;
}
```

**Fluent Builder API**:

`ContentRouterBuilder` provides a fluent API for defining routing rules:
- `When(condition)` / `When(name, condition)` - Add conditional routes
- `RouteTo(handler)` - Configure handler (sync/async, with/without Either)
- `WithPriority(int)` - Set route priority (lower = higher priority)
- `WithMetadata(key, value)` - Add route metadata
- `Default(handler)` - Fallback route when no conditions match

Example:
```csharp
var definition = ContentRouterBuilder.Create<Order, string>()
    .When("HighValue", o => o.Total > 10000)
        .WithPriority(1)
        .RouteTo(async (o, ct) => await ProcessHighValueOrder(o, ct))
    .When("International", o => o.IsInternational)
        .WithPriority(2)
        .RouteTo(o => Right<EncinaError, string>("InternationalHandler"))
    .Default(o => Right<EncinaError, string>("StandardHandler"))
    .Build();

var result = await router.RouteAsync(definition, order);
```

**Configuration Options**:

`ContentRouterOptions`:
- `ThrowOnNoMatch` (default: true) - Return error when no route matches
- `AllowMultipleMatches` (default: false) - Execute all matching routes
- `EvaluateInParallel` (default: false) - Parallel route execution
- `MaxDegreeOfParallelism` (default: Environment.ProcessorCount) - Concurrency limit

**DI Integration**:

```csharp
services.AddEncinaMessaging(config =>
{
    config.UseContentRouter = true;
    config.ContentRouterOptions.ThrowOnNoMatch = true;
    config.ContentRouterOptions.AllowMultipleMatches = false;
});
```

**Test Coverage**:

| Test Type | Count | Purpose |
|-----------|-------|---------|
| Unit | 45 | Router and builder functionality |
| Integration | 6 | DI container, scoped services, concurrency |
| Contract | 15 | Interface contract verification |
| Property | 12 | FsCheck invariants for routing behavior |
| Guard | 25 | ArgumentNullException verification |
| Load | 7 | High-concurrency stress tests |
| Benchmark | 4 | BenchmarkDotNet performance measurement |

**Total**: 117 tests

**Files Created**:

ContentRouter Package:
- `src/Encina.Messaging/ContentRouter/IContentRouter.cs`
- `src/Encina.Messaging/ContentRouter/ContentRouter.cs`
- `src/Encina.Messaging/ContentRouter/ContentRouterBuilder.cs`
- `src/Encina.Messaging/ContentRouter/ContentRouterOptions.cs`
- `src/Encina.Messaging/ContentRouter/ContentRouterResult.cs`
- `src/Encina.Messaging/ContentRouter/RouteDefinition.cs`
- `src/Encina.Messaging/ContentRouter/ContentRouterErrorCodes.cs`

Test Files:
- `tests/Encina.Tests/ContentRouter/ContentRouterTests.cs`
- `tests/Encina.Tests/ContentRouter/ContentRouterBuilderTests.cs`
- `tests/Encina.Tests/Guards/ContentRouterGuardsTests.cs`
- `tests/Encina.Tests/PropertyTests/ContentRouterPropertyTests.cs`
- `tests/Encina.Tests/Contracts/ContentRouterContractTests.cs`
- `tests/Encina.Tests/Integration/ContentRouterIntegrationTests.cs`
- `tests/Encina.Tests/LoadTests/ContentRouterLoadTests.cs`
- `benchmarks/Encina.Benchmarks/ContentRouterBenchmarks.cs`

**Files Modified**:
- `src/Encina.Messaging/MessagingConfiguration.cs` - Added `UseContentRouter` flag
- `src/Encina.Messaging/MessagingServiceCollectionExtensions.cs` - Added DI registration
- `CHANGELOG.md` - Added Content-Based Router entry
- `ROADMAP.md` - Updated Phase 2 status

---

### December 27 (Evening) - Scatter-Gather Pattern (Issue #63)

**Status**: ✅ Completed

Implemented the Scatter-Gather Enterprise Integration Pattern (EIP), which distributes requests to multiple handlers in parallel or sequentially and aggregates results based on configurable strategies.

**Key Features**:

1. **Scatter-Gather Runner** (`IScatterGatherRunner`):
   - Executes scatter handlers concurrently or sequentially
   - Supports timeout and cancellation
   - Returns `Either<EncinaError, ScatterGatherResult<TResponse>>`

2. **Fluent Builder API** (`ScatterGatherBuilder`):
   - Type-safe configuration with three-level hierarchy
   - `ScatterTo()` for adding handlers with name and delegate
   - `WithPriority()` / `WithMetadata()` for handler configuration
   - `ExecuteInParallel()` / `ExecuteSequentially()` for execution mode
   - `WithTimeout()` for operation-level timeout

3. **Four Gather Strategies** (`GatherStrategy`):
   - `WaitForAll` - Wait for all handlers, fail on any failure
   - `WaitForFirst` - Return on first successful response, cancel remaining
   - `WaitForQuorum` - Return when quorum count reached
   - `WaitForAllAllowPartial` - Wait for all, tolerate partial failures

4. **Aggregation Methods** (`GatherBuilder`):
   - `TakeFirst()` - Return first successful response
   - `TakeMin(selector)` / `TakeMax(selector)` - Return min/max by selector
   - `Aggregate(handler)` / `AggregateSuccessful(handler)` - Custom aggregation

5. **Result Types**:
   - `ScatterGatherResult<TResponse>` - Final aggregated result with metrics
   - `ScatterExecutionResult<TResponse>` - Individual handler result

6. **High-Performance Logging**:
   - Source-generated `LoggerMessage` methods (EventIds 600-615)
   - Detailed execution tracing for scatter/gather phases

**Test Coverage**:
- 131 tests across all test types
- Unit tests: 51 builder tests, 16 runner tests
- Property-based tests: 15 invariant tests
- Contract tests: 7 interface contract tests
- Guard clause tests: 8 parameter validation tests
- Load tests: 6 concurrency and performance tests
- Benchmarks: 6 performance scenarios

**Example Usage**:
```csharp
// Price aggregation from multiple suppliers
var definition = ScatterGatherBuilder.Create<PriceRequest, decimal>("PriceAggregator")
    .ScatterTo("SupplierA", async (req, ct) => await GetPriceFromA(req, ct))
    .ScatterTo("SupplierB", async (req, ct) => await GetPriceFromB(req, ct))
    .ScatterTo("SupplierC", async (req, ct) => await GetPriceFromC(req, ct))
    .ExecuteInParallel()
    .WithTimeout(TimeSpan.FromSeconds(10))
    .GatherAll()
    .TakeMin(price => price)  // Get lowest price
    .Build();

var result = await runner.ExecuteAsync(definition, new PriceRequest("SKU123"));
result.Match(
    Right: r => Console.WriteLine($"Best price: {r.Response} from {r.SuccessCount} suppliers"),
    Left: e => Console.WriteLine($"Error: {e.Message}"));
```

**Files Created**:
- `src/Encina.Messaging/ScatterGather/GatherStrategy.cs`
- `src/Encina.Messaging/ScatterGather/ScatterGatherErrorCodes.cs`
- `src/Encina.Messaging/ScatterGather/ScatterGatherOptions.cs`
- `src/Encina.Messaging/ScatterGather/ScatterExecutionResult.cs`
- `src/Encina.Messaging/ScatterGather/ScatterGatherResult.cs`
- `src/Encina.Messaging/ScatterGather/ScatterDefinition.cs`
- `src/Encina.Messaging/ScatterGather/BuiltScatterGatherDefinition.cs`
- `src/Encina.Messaging/ScatterGather/IScatterGatherRunner.cs`
- `src/Encina.Messaging/ScatterGather/ScatterGatherLog.cs`
- `src/Encina.Messaging/ScatterGather/ScatterGatherBuilder.cs`
- `src/Encina.Messaging/ScatterGather/ScatterGatherRunner.cs`
- `tests/Encina.Tests/ScatterGather/ScatterGatherBuilderTests.cs`
- `tests/Encina.Tests/ScatterGather/ScatterGatherRunnerTests.cs`
- `tests/Encina.Tests/Guards/ScatterGatherGuardsTests.cs`
- `tests/Encina.Tests/PropertyTests/ScatterGatherPropertyTests.cs`
- `tests/Encina.Tests/Contracts/ScatterGatherContractTests.cs`
- `tests/Encina.Tests/LoadTests/ScatterGatherLoadTests.cs`
- `benchmarks/Encina.Benchmarks/ScatterGatherBenchmarks.cs`

**Files Modified**:
- `src/Encina.Messaging/MessagingConfiguration.cs` - Added `UseScatterGather` flag and `ScatterGatherOptions`
- `src/Encina.Messaging/MessagingServiceCollectionExtensions.cs` - Added DI registration for `IScatterGatherRunner`
- `benchmarks/Encina.Benchmarks/ContentRouterBenchmarks.cs` - Added CA1822 pragma suppression
- `CHANGELOG.md` - Added Scatter-Gather entry
- `ROADMAP.md` - Updated Phase 2 status

**EIP Block Completed**:
With Scatter-Gather, the Enterprise Integration Patterns block in Phase 2 is now complete:
- ✅ Recoverability Pipeline (Issue #39)
- ✅ Rate Limiting (Issue #40)
- ✅ Dead Letter Queue (Issue #42)
- ✅ Bulkhead Isolation (Issue #53)
- ✅ Routing Slip (Issue #62)
- ✅ Scatter-Gather (Issue #63)
- ✅ Content-Based Router (Issue #64)

---

## December 27 - CLI Scaffolding Tool (Issue #47)

Implemented `Encina.Cli`, a command-line scaffolding tool for quickly creating Encina projects and generating code.

**Features**:
- `encina new <template> <name>` - Create new Encina projects
  - Templates: `api`, `worker`, `console`
  - Options: `--database`, `--caching`, `--transport`, `--output`, `--force`
- `encina generate handler <name>` - Generate command handlers
  - Options: `--response`, `--output`, `--namespace`
- `encina generate query <name> --response <type>` - Generate query handlers
- `encina generate saga <name> --steps <steps>` - Generate saga definitions
- `encina generate notification <name>` - Generate notifications and handlers
- `encina add <category> <provider>` - Add Encina packages
  - Categories: `caching`, `database`, `transport`, `validation`, `resilience`, `observability`

**Technology Stack**:
- System.CommandLine 2.0.1 for command-line parsing
- Spectre.Console for terminal UI
- Packaged as .NET global tool

**Files Created**:
- `src/Encina.Cli/Encina.Cli.csproj`
- `src/Encina.Cli/Program.cs`
- `src/Encina.Cli/Commands/NewCommand.cs`
- `src/Encina.Cli/Commands/GenerateCommand.cs`
- `src/Encina.Cli/Commands/AddCommand.cs`
- `src/Encina.Cli/Services/ProjectScaffolder.cs`
- `src/Encina.Cli/Services/CodeGenerator.cs`
- `src/Encina.Cli/Services/PackageManager.cs`
- `tests/Encina.Cli.Tests/` - 21 unit tests
- `tests/Encina.Cli.GuardTests/` - 44 guard clause tests

**Test Coverage**: 65 tests (unit + guard)

**Notes**:
- Tests for load/benchmarks not applicable - CLI tool is not a high-performance hot path
- Integration tests deferred - would require complex file system setup for each template

---

*Last Updated: 2025-12-27*

## December 28 - Advanced Messaging Patterns Research & Issues

Conducted comprehensive research on messaging patterns and created 15 new issues for Phase 2 based on:
- Analysis of popular .NET messaging frameworks (MassTransit, Wolverine 4.0, NServiceBus, Rebus)
- Patterns from other ecosystems (Java Spring, Node.js, Go)
- 2024-2025 trends in event-driven architecture
- Community demand analysis from .NET forums and GitHub

### New Labels Created

| Label | Color | Description |
|-------|-------|-------------|
| `area-scheduling` | #DAA520 | Scheduling and recurring message patterns |
| `area-saga` | #8B008B | Saga and Process Manager patterns |
| `area-encryption` | #800000 | Message encryption and data protection |
| `area-scalability` | #FF8C00 | Horizontal scaling and consumer patterns |

### Issues Created (15)

All issues assigned to **Phase 2: Functionality** milestone with appropriate labels:

| Issue | Title | Priority | Complexity | Key Labels |
|-------|-------|----------|------------|------------|
| #121 | Message Batching / Batch Handlers | High | Medium | `area-messaging`, `area-performance` |
| #122 | Claim Check Pattern for Large Payloads | High | Medium | `area-messaging`, `new-package`, `cloud-aws` |
| #123 | Message Priority / Priority Queue Pattern | Medium | Low | `area-messaging`, `area-eip` |
| #124 | Enhanced Message Deduplication Strategies | Medium | Medium | `area-messaging`, `area-resilience` |
| #125 | Multi-Tenancy Messaging Support | High | High | `area-multitenancy`, `area-compliance` |
| #126 | Message TTL (Time-To-Live) & Expiration | Medium | Low | `area-messaging`, `area-resilience` |
| #127 | Request/Response Pattern (RPC over Messaging) | Medium | Medium | `area-messaging`, `area-interop` |
| #128 | Enhanced Saga Visibility & Process Manager | Medium | Medium | `area-saga`, `area-observability` |
| #129 | Message Encryption & Security | Medium | High | `area-encryption`, `area-security`, `new-package` |
| #130 | Competing Consumers Management | Medium | High | `area-scalability`, `area-cloud-native` |
| #131 | Backpressure & Flow Control | Medium | Medium | `area-resilience`, `area-performance` |
| #132 | Enhanced Distributed Context Propagation | Medium | Low | `area-observability`, `area-interop` |
| #133 | Recurring Messages (Cron-style Scheduling) | Medium | Low | `area-scheduling`, `area-eip` |
| #134 | Message Versioning & Upcasting | Medium | Medium | `area-event-sourcing`, `area-eip` |
| #135 | Enhanced Poison Message Detection | Low | Low | `area-resilience`, `area-observability` |

### Research Sources

Key references consulted:
- [Wolverine 4.0 Multi-Tenancy](https://jeremydmiller.com/2025/05/15/wolverine-4-is-bringing-multi-tenancy-to-ef-core/)
- [MassTransit v9 Announcement](https://masstransit.io/introduction/v9-announcement)
- [Azure Claim-Check Pattern](https://learn.microsoft.com/en-us/azure/architecture/patterns/claim-check)
- [Azure Competing Consumers](https://learn.microsoft.com/en-us/azure/architecture/patterns/competing-consumers)
- [Event Versioning Patterns](https://event-driven.io/en/simple_events_versioning_patterns/)
- [OpenTelemetry Context Propagation](https://opentelemetry.io/docs/concepts/context-propagation/)
- [Azure Multi-tenant Messaging](https://learn.microsoft.com/en-us/azure/architecture/guide/multitenant/approaches/messaging)

### New Packages Planned

Based on the issues, 6 new packages are planned:

| Package | Issue | Description |
|---------|-------|-------------|
| `Encina.ClaimCheck` | #122 | Core abstractions for Claim Check pattern |
| `Encina.ClaimCheck.AzureBlob` | #122 | Azure Blob Storage provider |
| `Encina.ClaimCheck.AmazonS3` | #122 | AWS S3 provider |
| `Encina.Encryption` | #129 | Core abstractions for message encryption |
| `Encina.Encryption.AzureKeyVault` | #129 | Azure Key Vault provider |
| `Encina.Encryption.AwsKms` | #129 | AWS KMS provider |

### Documentation Updated

- `docs/INVENTORY.md` - Added new Messaging Patterns section with 15 planned features
- `ROADMAP.md` - Added Advanced Messaging section to Phase 2
- `CHANGELOG.md` - Added detailed entries for all 15 new issues

### Priority Summary

| Priority | Count | Issues |
|----------|-------|--------|
| High | 3 | #121, #122, #125 |
| Medium | 11 | #123, #124, #126-#134 |
| Low | 1 | #135 |

### Next Steps

1. **High Priority**: Implement Message Batching (#121) - already demanded by Wolverine parity
2. **High Priority**: Implement Claim Check (#122) - addresses real cost/size problems
3. **High Priority**: Implement Multi-Tenancy (#125) - major SaaS market requirement

---

### December 28 (Continued) - Advanced Resilience Patterns Research

**Research Session**: Comprehensive market research for resilience patterns in modern distributed systems.

**Research Scope**:
- .NET ecosystem: Polly v8, Microsoft.Extensions.Resilience
- Java ecosystem: Resilience4j patterns
- Service meshes: Istio, Linkerd, Dapr resiliency
- Industry patterns: Netflix OSS, Uber, FusionCache, BentoCache

**Issues Created** (10 total, Issues #136-#145):

| Issue | Pattern | Priority | Inspiration |
|-------|---------|----------|-------------|
| **#136** | Hedging Pattern | P0 - Critical | Polly v8, Istio |
| **#137** | Fallback / Graceful Degradation | P0 - Critical | Resilience4j, Polly |
| **#138** | Load Shedding with Priority | P1 - High | Netflix, Uber |
| **#139** | Adaptive Concurrency Control | P1 - High | Netflix concurrency-limits |
| **#140** | Cache Stampede Prevention | P2 - Medium | FusionCache, BentoCache |
| **#141** | Cascading Timeout Coordination | P2 - Medium | gRPC deadline propagation |
| **#142** | Health Checks Standardization | P2 - Medium | Kubernetes probes |
| **#143** | Observability-Resilience Correlation | P2 - Medium | OpenTelemetry |
| **#144** | Backpressure / Flow Control | P3 - Low | Reactive Streams |
| **#145** | Chaos Engineering Integration | P3 - Low | Polly v8 chaos strategies |

**Key Pattern Details**:

1. **Hedging Pattern (#136)**:
   - Parallel redundant requests for latency reduction
   - First successful response wins
   - Latency percentile-based triggering (P95, P99)
   - Integration with OpenTelemetry for tracing

2. **Load Shedding with Priority (#138)**:
   - Request priority levels: Critical, Degraded, BestEffort, Bulk
   - Adaptive shedding based on CPU/memory/latency metrics
   - Netflix concurrency-limits integration approach

3. **Adaptive Concurrency Control (#139)**:
   - Netflix's concurrency-limits library concepts
   - AIMD algorithm for dynamic adjustment
   - TCP Vegas-style congestion control for services
   - Gradient-based limit adjustment

4. **Cache Stampede Prevention (#140)**:
   - Distributed locking for cache miss serialization
   - Stale-while-revalidate pattern
   - Probabilistic early expiration to spread load

**New Labels Created**:
- `area-polly` - Polly v8 integration and resilience strategies
- `netflix-pattern` - Patterns inspired by Netflix OSS
- `industry-best-practice` - Industry-proven patterns from major tech companies

**Documentation Updated**:
- `docs/INVENTORY.md` - Added Resilience Patterns section with 10 planned features
- `ROADMAP.md` - Added "Advanced Resilience" section to Phase 2
- `CHANGELOG.md` - Added detailed entries for all 10 new issues

**Research Sources**:
- [Polly v8 Hedging Strategy](https://www.pollydocs.org/strategies/hedging.html)
- [Resilience4j Documentation](https://resilience4j.readme.io/)
- [Netflix Concurrency Limits](https://github.com/Netflix/concurrency-limits)
- [FusionCache Thundering Herd](https://github.com/ZiggyCreatures/FusionCache)
- [Uber Load Shedding](https://www.uber.com/en-US/blog/)
- [Istio Traffic Management](https://istio.io/latest/docs/concepts/traffic-management/)

**Priority Summary**:

| Priority | Count | Issues |
|----------|-------|--------|
| P0 - Critical | 2 | #136, #137 |
| P1 - High | 2 | #138, #139 |
| P2 - Medium | 4 | #140, #141, #142, #143 |
| P3 - Low | 2 | #144, #145 |

---

### December 29 - Advanced Scheduling Patterns Research

**Issues Created**: `#146` through `#160` (15 new Scheduling Pattern enhancements)

**Research Methodology**:
Comprehensive research conducted on scheduling patterns and improvements based on:
- Popular .NET libraries: MassTransit, Hangfire, Quartz.NET, Wolverine
- Cross-platform solutions: Temporal, Azure Durable Functions, AWS Step Functions
- Node.js ecosystem: BullMQ, Agenda, Bull
- Enterprise patterns: Meta FOQS, Uber Cadence, Apache Airflow
- .NET community demand analysis (Stack Overflow, Reddit r/dotnet, GitHub Issues)

**Issues Summary Table**:

| Issue | Feature | Priority | Inspiration |
|-------|---------|----------|-------------|
| **#146** | Cancellation & Update API | P0 - Critical | MassTransit, Hangfire |
| **#147** | Priority Queue Support | P0 - Critical | Meta FOQS, BullMQ |
| **#148** | Idempotency Keys | P0 - Critical | Temporal, Durable Functions |
| **#149** | Dead Letter Queue Integration | P1 - High | Hangfire, Quartz |
| **#150** | Timezone-Aware Scheduling | P1 - High | Hangfire, Quartz.NET |
| **#151** | Rate Limiting for Scheduled | P1 - High | Meta FOQS, Redis Queue |
| **#152** | Dependency Chains | P1 - High | Apache Airflow, Temporal |
| **#153** | Observability & Metrics | P2 - Medium | OpenTelemetry, Jaeger |
| **#154** | Batch Scheduling | P2 - Medium | MassTransit, Hangfire |
| **#155** | Delayed Message Visibility | P2 - Medium | Amazon SQS |
| **#156** | Scheduling Persistence Providers | P2 - Medium | Hangfire, Quartz.NET |
| **#157** | Execution Windows | P2 - Medium | Quartz.NET, Enterprise schedulers |
| **#158** | Schedule Templates | P3 - Low | Hangfire, Enterprise patterns |
| **#159** | Webhook Notifications | P3 - Low | Modern SaaS patterns |
| **#160** | Multi-Region Scheduling | P3 - Low | Meta FOQS, Uber Cadence |

**Key Pattern Details**:

1. **Cancellation & Update API (#146)**:
   - `CancelAsync(messageId)` - Cancel scheduled message
   - `RescheduleAsync(messageId, newScheduledAt)` - Update schedule time
   - `UpdatePayloadAsync(messageId, newPayload)` - Modify message content
   - `CancelManyAsync(filter)` - Batch cancellation with filters
   - Status tracking: Pending, Cancelled, Executed, Failed

2. **Priority Queue Support (#147)**:
   - Priority levels: Critical (0), High (1), Normal (2), Low (3), Background (4)
   - Anti-starvation mechanism via aging
   - Priority boost for waiting messages
   - Per-priority processing quotas
   - Inspired by Meta FOQS architecture

3. **Idempotency Keys (#148)**:
   - User-provided idempotency keys
   - Automatic duplicate detection before scheduling
   - Configurable TTL for idempotency records
   - Integration with existing Inbox pattern

4. **Dead Letter Queue Integration (#149)**:
   - Automatic move to DLQ after max retries
   - Scheduling-specific DLQ filters
   - Replay capabilities for scheduled messages
   - Integration with existing `DeadLetterManager`

5. **Timezone-Aware Scheduling (#150)**:
   - IANA timezone database support (via TimeZoneInfo or NodaTime)
   - DST transition handling strategies
   - Recurring schedule timezone persistence
   - `ScheduleAtLocal(dateTime, timezone)` API

6. **Dependency Chains (#152)**:
   - DAG-based job dependencies
   - `DependsOn(params Guid[] predecessors)` API
   - Parallel execution of independent jobs
   - Failure propagation options
   - Inspired by Apache Airflow task dependencies

7. **Multi-Region Scheduling (#160)**:
   - Leader election per region
   - Cross-region coordination via distributed locks
   - Region-aware message routing
   - Inspired by Meta FOQS global architecture

**Labels Applied**:

All 15 issues received comprehensive labels:
- `enhancement` - New feature
- `phase-2-functionality` - Milestone assignment
- `area-scheduling` - Primary area
- `area-messaging` - Related area (most issues)
- `area-ddd` - Domain patterns (applicable issues)
- `area-integration` - Integration concerns
- `area-observability` - Metrics/tracing issues
- `area-resilience` - Error handling issues
- `industry-best-practice` - Proven patterns
- `meta-pattern` - Meta/Facebook-inspired (#147, #151, #160)
- `priority-critical` / `priority-high` / `priority-medium` / `priority-low`
- `complexity-medium` / `complexity-high`

**New Label Created**:
- `meta-pattern` - Patterns inspired by Meta/Facebook infrastructure (FOQS, etc.)

**Documentation Updated**:
- `docs/INVENTORY.md` - Added Scheduling Patterns section with 15 planned improvements
- `ROADMAP.md` - Added "Advanced Scheduling" section to Phase 2
- `CHANGELOG.md` - Added detailed entries for all 15 new issues

**Research Sources**:
- [MassTransit Scheduling](https://masstransit.io/documentation/configuration/scheduling)
- [Hangfire Documentation](https://docs.hangfire.io/)
- [Quartz.NET Features](https://www.quartz-scheduler.net/)
- [Temporal Workflow Scheduling](https://docs.temporal.io/workflows#scheduled-workflow)
- [Azure Durable Functions Timers](https://learn.microsoft.com/en-us/azure/azure-functions/durable/durable-functions-timers)
- [BullMQ Priority Queue](https://docs.bullmq.io/guide/jobs/prioritized)
- [Meta FOQS Architecture (Engineering Blog)](https://engineering.fb.com/)
- [Apache Airflow DAGs](https://airflow.apache.org/docs/apache-airflow/stable/core-concepts/dags.html)

**Priority Summary**:

| Priority | Count | Issues |
|----------|-------|--------|
| P0 - Critical | 3 | #146, #147, #148 |
| P1 - High | 4 | #149, #150, #151, #152 |
| P2 - Medium | 5 | #153, #154, #155, #156, #157 |
| P3 - Low | 3 | #158, #159, #160 |

### December 29 (Continued) - Advanced Testing Patterns Research

**Issues Created**: `#161` through `#173` (13 new Testing Pattern enhancements)

**Research Methodology**:
Comprehensive research conducted on testing patterns and improvements based on:
- .NET testing ecosystem: xUnit, NUnit, TUnit, Testcontainers
- Data generation: Bogus, AutoBogus, AutoFixture
- Mocking: WireMock.NET, NSubstitute, Moq
- Snapshot testing: Verify, ApprovalTests
- Architecture testing: ArchUnitNET (inspired by Java's ArchUnit)
- Mutation testing: Stryker.NET
- CI/CD: GitHub Actions best practices 2025
- Community demand: Reddit r/dotnet, Stack Overflow, GitHub discussions

**Issues Summary Table**:

| Issue | Feature | Priority | Inspiration |
|-------|---------|----------|-------------|
| **#161** | Test Data Generation (Bogus) | P2 - Medium | Bogus, AutoBogus |
| **#162** | Testcontainers Integration | P1 - High | Testcontainers .NET |
| **#163** | Database Reset (Respawn) | P2 - Medium | Respawn, Jimmy Bogard |
| **#164** | HTTP Mocking (WireMock) | P2 - Medium | WireMock.NET |
| **#165** | Snapshot Testing (Verify) | P2 - Medium | Verify, Simon Cropp |
| **#166** | Architecture Testing | P3 - Low | ArchUnitNET |
| **#167** | Handler Registration Tests | P1 - High | MediatR patterns |
| **#168** | Pipeline Testing Utilities | P1 - High | Custom |
| **#169** | Messaging Pattern Helpers | P1 - High | Custom |
| **#170** | Improved Assertions | P2 - Medium | Shouldly |
| **#171** | TUnit Support | P3 - Low | TUnit Framework |
| **#172** | Mutation Testing (Stryker) | P2 - Medium | Stryker.NET |
| **#173** | CI/CD Workflow Templates | P3 - Low | GitHub Actions |

**Key Pattern Details**:

1. **Testcontainers Integration (#162)**:
   - Pre-configured fixtures: `SqlServerContainerFixture`, `PostgreSqlContainerFixture`
   - `MongoDbContainerFixture`, `RedisContainerFixture`
   - Integration with existing `EncinaFixture`
   - GitHub Actions CI/CD compatible
   - New package: `Encina.Testing.Testcontainers`

2. **Handler Registration Tests (#167)**:
   - `EncinaRegistrationAssertions.AllRequestsShouldHaveHandlers(assembly)`
   - `EncinaRegistrationAssertions.AllNotificationsShouldHaveHandlers(assembly)`
   - `RegistrationVerifier` fluent API
   - Early detection of missing handler registrations

3. **Pipeline Testing Utilities (#168)**:
   - `PipelineTestContext<TRequest, TResponse>` for pipeline testing
   - `WithBehavior<T>()`, `WithoutBehavior<T>()`, `WithMockedHandler()`
   - `VerifyBehaviorCalled<T>(Times)` verification
   - `PipelineTest.For<TRequest, TResponse>()` factory

4. **Messaging Pattern Helpers (#169)**:
   - `OutboxTestHelper`: `CaptureMessages()`, `VerifyMessagePublished<T>()`
   - `InboxTestHelper`: `SimulateIdempotentMessage()`, `VerifyProcessedOnce()`
   - `SagaTestBase<TSaga, TData>`: Given/When/Then for sagas
   - `SchedulingTestHelper`: `AdvanceTimeAndGetDue()`, `VerifyCronNextExecution()`

5. **TUnit Support (#171)**:
   - Source-generated test discovery (no reflection)
   - 10-200x faster test execution
   - NativeAOT compatible (aligns with #50)
   - New package: `Encina.Testing.TUnit`

**New Labels Created**:

| Label | Description | Color |
|-------|-------------|-------|
| `area-testing` | Testing utilities and frameworks | #9932CC |
| `testing-integration` | Integration testing utilities | #27AE60 |
| `testing-unit` | Unit testing utilities | #3498DB |
| `testing-mocking` | Mocking and stubbing utilities | #E74C3C |
| `testing-snapshot` | Snapshot and approval testing | #F39C12 |
| `testing-data-generation` | Test data generation and fixtures | #1ABC9C |
| `area-mutation-testing` | Mutation testing and test quality | #FF6B6B |
| `area-architecture-testing` | Architecture rules and verification | #9B59B6 |
| `area-ci-cd` | CI/CD pipelines and automation | #2088FF |
| `area-docker` | Docker and containerization | #2496ED |
| `aot-compatible` | NativeAOT and trimming compatible | #7D3C98 |

**New Packages Planned**:

| Package | Issue | Description |
|---------|-------|-------------|
| `Encina.Testing.Testcontainers` | #162 | Docker fixtures for databases |
| `Encina.Testing.DataGeneration` | #161 | Test data generation with Bogus |
| `Encina.Testing.WireMock` | #164 | HTTP mocking with WireMock.NET |
| `Encina.Testing.Architecture` | #166 | Architecture testing with ArchUnitNET |
| `Encina.Testing.TUnit` | #171 | TUnit framework support |

**Documentation Updated**:
- `docs/INVENTORY.md` - Added Testing Patterns section with 13 planned improvements
- `ROADMAP.md` - Added "Advanced Testing" section to Phase 2
- `CHANGELOG.md` - Added detailed entries for all 13 new issues

**Research Sources**:
- [Testcontainers for .NET](https://testcontainers.com/guides/getting-started-with-testcontainers-for-dotnet/)
- [Bogus vs AutoFixture](https://matthewregis.dev/posts/comparing-fake-data-generator-with-bogus-vs-autofixture)
- [Respawn by Jimmy Bogard](https://github.com/jbogard/Respawn)
- [WireMock.NET](https://github.com/wiremock/WireMock.Net)
- [Verify by Simon Cropp](https://github.com/VerifyTests/Verify)
- [ArchUnitNET](https://github.com/TNG/ArchUnitNET)
- [TUnit Framework](https://tunit.dev/)
- [Stryker.NET Mutation Testing](https://stryker-mutator.io/docs/stryker-net/introduction/)
- [Milan Jovanovic Testing Guides](https://www.milanjovanovic.tech/blog)

**Priority Summary**:

| Priority | Count | Issues |
|----------|-------|--------|
| P1 - High | 4 | #162, #167, #168, #169 |
| P2 - Medium | 6 | #161, #163, #164, #165, #170, #172 |
| P3 - Low | 3 | #166, #171, #173 |

---

### December 29 - Advanced Observability Research (15 new issues)

**Issues Created**: `#174` - `#188`

**Context**: Comprehensive research on observability patterns and best practices to enhance Encina's `Encina.OpenTelemetry` package. Research covered:
- MassTransit v9 OpenTelemetry integration
- Wolverine native OpenTelemetry support
- OpenTelemetry .NET SDK and semantic conventions
- .NET Aspire Dashboard and service defaults
- Dapr observability building blocks
- Azure Monitor/App Insights patterns
- AWS ADOT and X-Ray integration
- Prometheus/Grafana ecosystem

**New Issues Summary**:

| Issue | Title | Priority | New Package |
|-------|-------|----------|-------------|
| **#174** | Real Metrics Collection (EncinaMetrics) | Alta | No |
| **#175** | Correlation & Causation ID Support | Alta | No |
| **#176** | Baggage Propagation Utilities | Alta | No |
| **#177** | Missing Semantic Convention Attributes | Media | No |
| **#178** | Encina.OpenTelemetry.AzureMonitor | Media | ✅ |
| **#179** | Encina.OpenTelemetry.AwsXRay | Media | ✅ |
| **#180** | Encina.OpenTelemetry.Prometheus | Media | ✅ |
| **#181** | Encina.HealthChecks Package | Alta | ✅ |
| **#182** | Encina.Serilog.OpenTelemetry | Media | ✅ |
| **#183** | Sampling Behaviors | Media | No |
| **#184** | Request Tracing Behavior | Media | No |
| **#185** | Error Recording Enhancements | Media | No |
| **#186** | Distributed Context Properties | Media | No |
| **#187** | Grafana Dashboards | Media | No |
| **#188** | Aspire Dashboard Integration Guide | Baja | No |

**High-Priority Improvements**:

1. **Real Metrics Collection (#174)**:
   - Full `IEncinaMetrics` implementation with `System.Diagnostics.Metrics`
   - Zero-allocation metrics via native .NET APIs
   - Histograms: `encina.request.duration`, `encina.handler.duration`
   - Counters: `encina.requests.total`, `encina.errors.total`
   - Gauges: `encina.active.handlers`, `encina.pending.outbox`
   - Inspired by MassTransit metrics, Wolverine OpenTelemetry

2. **Correlation & Causation ID Support (#175)**:
   - CorrelationId propagation through entire pipeline
   - CausationId for tracking message causation chains
   - Extension methods: `SetCorrelationId()`, `SetCausationId()`
   - Standard headers for all messaging transports
   - Inspired by NServiceBus, MassTransit conversation tracking

3. **Baggage Propagation Utilities (#176)**:
   - W3C Baggage support in `IRequestContext`
   - `AddBaggage()`, `GetBaggage()`, `GetAllBaggage()` helpers
   - Automatic propagation to downstream handlers
   - Activity.Baggage integration
   - Inspired by OpenTelemetry Baggage spec, .NET Aspire

4. **Encina.HealthChecks Package (#181)**:
   - Dedicated health checks package
   - Kubernetes probes: liveness, readiness, startup
   - Health check aggregation
   - Pattern-specific health checks for all Encina features

**Cloud Provider Integrations**:

1. **Azure Monitor (#178)**:
   - New package: `Encina.OpenTelemetry.AzureMonitor`
   - Azure Application Insights integration
   - Native Azure Monitor exporters
   - Live Metrics Stream support

2. **AWS X-Ray (#179)**:
   - New package: `Encina.OpenTelemetry.AwsXRay`
   - AWS X-Ray via AWS Distro for OpenTelemetry (ADOT)
   - AWS Lambda instrumentation
   - AWS distributed tracing

3. **Prometheus (#180)**:
   - New package: `Encina.OpenTelemetry.Prometheus`
   - Native `/metrics` endpoint
   - OpenMetrics format
   - Grafana integration

**Labels Used**:
- `area-observability` - All issues
- `area-opentelemetry` - OTel-specific
- `cloud-azure` - Azure integration (#178)
- `cloud-aws` - AWS integration (#179)
- `area-cloud-native` - Cloud-native patterns (#180, #181)
- `new-package` - New packages (#178, #179, #180, #181, #182)
- `industry-best-practice` - Industry patterns (#174, #175, #176)
- `documentation` - Documentation issues (#187, #188)
- `priority-high` - High priority (#174, #175, #176, #181)
- `priority-medium` - Medium priority (most issues)
- `priority-low` - Low priority (#188)
- `complexity-low`, `complexity-medium` - Complexity estimates

**New Label Created**:
- `cloud-azure` - Azure cloud platform (to match existing `cloud-aws` and `cloud-gcp`)

**New Packages Planned**:

| Package | Issue | Description |
|---------|-------|-------------|
| `Encina.OpenTelemetry.AzureMonitor` | #178 | Azure Monitor/App Insights integration |
| `Encina.OpenTelemetry.AwsXRay` | #179 | AWS X-Ray via ADOT integration |
| `Encina.OpenTelemetry.Prometheus` | #180 | Native Prometheus metrics endpoint |
| `Encina.HealthChecks` | #181 | Dedicated health checks package |
| `Encina.Serilog.OpenTelemetry` | #182 | Serilog to OpenTelemetry bridge |

**Documentation Updated**:
- `docs/INVENTORY.md` - Added Observability Patterns section with 15 planned improvements
- `ROADMAP.md` - Added "Advanced Observability" section to Phase 2
- `CHANGELOG.md` - Added detailed entries for all 15 new issues

**Research Sources**:
- [MassTransit Diagnostics](https://masstransit.io/documentation/configuration/observability)
- [Wolverine OpenTelemetry](https://wolverine.netlify.app/guide/logging.html)
- [OpenTelemetry .NET](https://opentelemetry.io/docs/languages/net/)
- [OTel Semantic Conventions for Messaging](https://opentelemetry.io/docs/specs/semconv/messaging/)
- [.NET Aspire Dashboard](https://learn.microsoft.com/en-us/dotnet/aspire/fundamentals/dashboard/overview)
- [Azure Monitor OpenTelemetry](https://learn.microsoft.com/en-us/azure/azure-monitor/app/opentelemetry-overview)
- [AWS ADOT](https://aws.amazon.com/otel/)
- [Prometheus .NET Client](https://github.com/prometheus-net/prometheus-net)

**Priority Summary**:

| Priority | Count | Issues |
|----------|-------|--------|
| P1 - High | 4 | #174, #175, #176, #181 |
| P2 - Medium | 10 | #177, #178, #179, #180, #182, #183, #184, #185, #186, #187 |
| P3 - Low | 1 | #188 |

---

### December 29 (Continued) - Web/API Integration Patterns Research (18 new issues)

**Context**: Final research session of December 2025 focused on Web/API Integration patterns. Conducted comprehensive analysis of current ASP.NET Core 10 features, .NET ecosystem trends, and community demand from r/dotnet, Stack Overflow, and industry frameworks.

**Research Methodology**:
1. Analyzed current Encina Web/API packages (AspNetCore, AwsLambda, AzureFunctions, GraphQL, gRPC, Refit)
2. Researched .NET 10 new features (SSE, OpenAPI 3.1, built-in validation)
3. Studied popular frameworks (FastEndpoints, Carter, Wolverine, HotChocolate)
4. Reviewed cross-platform patterns (NestJS, FastAPI, Spring Boot)
5. Analyzed community demand on r/dotnet and Stack Overflow (December 2025)
6. Identified emerging patterns (AI/LLM integration, BFF, Vertical Slice Architecture)

**Issues Created (18 total, all in Phase 2: Functionality)**:

| Issue | Title | Priority | Complexity |
|-------|-------|----------|------------|
| #189 | Server-Sent Events (SSE) Support | High | Low |
| #190 | REPR Pattern Support | High | Medium |
| #191 | Problem Details RFC 9457 | High | Low |
| #192 | API Versioning Helpers | High | Medium |
| #193 | Minimal APIs Organization | High | Low |
| #194 | Encina.SignalR Package | High | Medium |
| #195 | GraphQL/HotChocolate Full Integration | High | High |
| #196 | gRPC Improvements | Medium | High |
| #197 | Rate Limiting Pipeline Behavior | High | Medium |
| #198 | OpenAPI 3.1 Enhanced | Medium | Medium |
| #199 | BFF Pattern Support | Medium | High |
| #200 | AI/LLM Integration Patterns | Medium | High |
| #201 | Vertical Slice Architecture Templates | Medium | Low |
| #202 | WebHook Support | Medium | Medium |
| #203 | Health Aggregation Endpoint | Medium | Low |
| #204 | Passkey Authentication | Low | Medium |
| #205 | Google Cloud Functions | Low | Medium |
| #206 | Cloudflare Workers | Low | High |

**Labels Applied**:
- `enhancement` - All issues
- `area-web-api` - All issues
- `area-aspnetcore` - Core ASP.NET issues (#189-#193, #197, #198, #202, #203, #204)
- `area-realtime` - Real-time issues (#189, #194)
- `area-graphql` - GraphQL issue (#195)
- `area-grpc` - gRPC issue (#196)
- `area-serverless` - Serverless issues (#205, #206)
- `new-package` - Issues requiring new packages (#194, #199, #200, #205, #206)
- `dotnet-10` - .NET 10 specific features (#189, #198, #204)
- `industry-best-practice` - Industry patterns (#189, #190, #191, #192, #197, #198, #200)
- `netflix-pattern` - Netflix-inspired patterns (#195, #199)
- `aot-compatible` - NativeAOT compatible (#189, #196)
- `priority-high`, `priority-medium`, `priority-low` - Priority levels
- `complexity-low`, `complexity-medium`, `complexity-high` - Complexity estimates

**New Labels Created (8)**:

| Label | Description | Color |
|-------|-------------|-------|
| `area-ai-ml` | AI/ML and LLM integration patterns | #7B68EE |
| `area-bff` | Backend for Frontend patterns | #20B2AA |
| `area-openapi` | OpenAPI/Swagger documentation and generation | #85EA2D |
| `area-webhooks` | Webhook receiving and sending patterns | #FF6B6B |
| `area-rate-limiting` | Rate limiting and throttling patterns | #FFA07A |
| `area-health-checks` | Health checks and readiness probes | #32CD32 |
| `area-authentication` | Authentication patterns (Passkeys, OAuth, etc.) | #8B0000 |
| `cloud-cloudflare` | Cloudflare Workers and services | #F38020 |

**New Packages Planned (10)**:

| Package | Issue | Description |
|---------|-------|-------------|
| `Encina.SignalR` | #194 | Real-time bidirectional communication |
| `Encina.AspNetCore.BFF` | #199 | Backend for Frontend pattern support |
| `Encina.AI` | #200 | Core AI/LLM abstractions |
| `Encina.AI.OpenAI` | #200 | OpenAI provider |
| `Encina.AI.Azure` | #200 | Azure OpenAI provider |
| `Encina.AI.Anthropic` | #200 | Anthropic Claude provider |
| `Encina.AI.Ollama` | #200 | Ollama local models provider |
| `Encina.AI.SemanticKernel` | #200 | Semantic Kernel adapter |
| `Encina.GoogleCloudFunctions` | #205 | Google Cloud Functions integration |
| `Encina.CloudflareWorkers` | #206 | Cloudflare Workers edge computing |

**Documentation Updated**:
- `docs/INVENTORY.md` - Added Web/API Integration Patterns section with 18 planned improvements
- `ROADMAP.md` - Added "Web/API Integration" section to Phase 2
- `CHANGELOG.md` - Added detailed entries for all 18 new issues

**Research Sources**:
- [ASP.NET Core 10 Release Notes](https://learn.microsoft.com/en-us/aspnet/core/release-notes/aspnetcore-10.0)
- [Server-Sent Events in .NET 10](https://www.milanjovanovic.tech/blog/server-sent-events-in-aspnetcore-and-dotnet-10)
- [REPR Design Pattern](https://deviq.com/design-patterns/repr-design-pattern/)
- [Vertical Slice Architecture](https://www.milanjovanovic.tech/blog/vertical-slice-architecture)
- [FastEndpoints](https://fast-endpoints.com/)
- [Carter Library](https://github.com/CarterCommunity/Carter)
- [HotChocolate Documentation](https://chillicream.com/docs/hotchocolate)
- [RFC 9457: Problem Details](https://www.rfc-editor.org/rfc/rfc9457.html)
- [Asp.Versioning](https://github.com/dotnet/aspnet-api-versioning)
- [Microsoft.Extensions.AI](https://devblogs.microsoft.com/dotnet/introducing-microsoft-extensions-ai-preview/)
- [BFF Pattern - Microsoft](https://learn.microsoft.com/en-us/azure/architecture/patterns/backends-for-frontends)
- [Rate Limiting in ASP.NET Core](https://learn.microsoft.com/en-us/aspnet/core/performance/rate-limit)

**Key Findings from Research**:

1. **Industry Trends (2025)**:
   - Vertical Slice Architecture is the recommended pattern for new .NET projects
   - REPR pattern replaces bloated MVC controllers
   - Server-Sent Events gaining traction as simpler alternative to WebSockets for unidirectional streaming
   - AI/LLM integration is the fastest-growing area in 2025

2. **Current State of Encina Web/API**:
   - AspNetCore, AwsLambda, AzureFunctions: Production-ready
   - Refit: Well-integrated
   - GraphQL: Basic bridge only, needs HotChocolate integration
   - gRPC: Reflection-based, needs strong typing
   - SignalR: Documented but NOT implemented

3. **Community Demand (r/dotnet, December 2025)**:
   - API versioning: Very high demand
   - Rate limiting: High demand
   - Real-time (SSE/SignalR): Medium-high demand
   - AI/LLM integration: Medium-high, growing rapidly

**Priority Summary**:

| Priority | Count | Issues |
|----------|-------|--------|
| P1 - High | 9 | #189, #190, #191, #192, #193, #194, #195, #197 |
| P2 - Medium | 6 | #196, #198, #199, #200, #201, #202, #203 |
| P3 - Low | 3 | #204, #205, #206 |

**Recommended Implementation Order**:

1. **Immediate (Q1 2026)**: #194 (SignalR - missing), #189 (SSE), #190 (REPR), #192 (Versioning), #191 (RFC 9457)
2. **Short-term (Q2 2026)**: #197 (Rate Limiting), #195 (GraphQL), #198 (OpenAPI)
3. **Medium-term (Q3-Q4 2026)**: #200 (AI/LLM), #196 (gRPC), #201 (VSA Templates)

---

### December 29 (Continued) - Advanced Distributed Lock Patterns Research (20 new issues)

**Context**: Comprehensive research session focused on expanding Encina's Distributed Lock capabilities. Current implementation includes 4 packages (Core, InMemory, Redis, SqlServer). Research identified major gaps compared to industry-leading libraries.

**Research Methodology**:
1. Analyzed leading .NET distributed lock libraries:
   - **DistributedLock by madelson** - 14 backend providers, unified interface, ~2.8M downloads
   - **RedLock.net** - RedLock algorithm implementation for Redis HA
   - **Medallion.Threading** - Alternative locking library
2. Studied cross-platform coordination systems:
   - **HashiCorp Consul** - Session-based locking, leader election
   - **etcd** - Lease-based locking, watch primitives
   - **Apache ZooKeeper** - Ephemeral nodes, distributed coordination recipes
3. Analyzed cloud-native locking patterns:
   - **Azure Blob Storage leases** - 60s max, renewable
   - **AWS DynamoDB Locking Client** - Conditional writes, TTL
4. Reviewed academic patterns:
   - **Martin Kleppmann** - Fencing tokens for split-brain prevention
   - **Two-Phase Locking** - Multi-resource atomicity
5. Community demand analysis:
   - r/dotnet, Stack Overflow (December 2025)
   - GitHub Issues on DistributedLock, RedLock.net

**Issues Created (20 total, all in Phase 2: Functionality)**:

| Issue | Title | Priority | Category |
|-------|-------|----------|----------|
| **#207** | PostgreSQL Provider (pg_advisory_lock) | HIGH | Backend |
| **#208** | MySQL Provider (GET_LOCK) | MEDIUM | Backend |
| **#209** | Azure Blob Storage Provider (leases) | MEDIUM | Backend |
| **#210** | DynamoDB Provider (conditional writes) | MEDIUM | Backend |
| **#211** | Consul Provider (session-based) | MEDIUM | Backend |
| **#212** | etcd Provider (lease-based) | MEDIUM | Backend |
| **#213** | ZooKeeper Provider (ephemeral nodes) | LOW | Backend |
| **#214** | Oracle Provider (DBMS_LOCK) | LOW | Backend |
| **#215** | Distributed Semaphores | HIGH | Pattern |
| **#216** | Leader Election | HIGH | Pattern |
| **#217** | Read/Write Locks | MEDIUM | Pattern |
| **#218** | Fencing Tokens | MEDIUM | Pattern |
| **#219** | Multi-Resource Locks | LOW | Pattern |
| **#220** | DistributedLockPipelineBehavior | HIGH | Pipeline |
| **#221** | LeaderElectionPipelineBehavior | HIGH | Pipeline |
| **#222** | OpenTelemetry Integration | MEDIUM | Observability |
| **#223** | Auto-extend Locks | MEDIUM | Feature |
| **#224** | Lock Metadata | LOW | Feature |
| **#225** | Lock Queuing & Fairness | LOW | Feature |
| **#226** | RedLock Algorithm | MEDIUM | Feature |

**Key Pattern Details**:

1. **PostgreSQL Provider (#207)** - HIGH Priority:
   - `pg_advisory_lock(key)` for exclusive locks
   - `pg_advisory_lock_shared(key)` for shared locks
   - `pg_try_advisory_lock()` for non-blocking
   - Session-level vs transaction-level lock APIs
   - No table required, uses native PostgreSQL locking
   - Most requested database provider (after SQL Server)

2. **Azure Blob Storage Provider (#209)**:
   - Blob lease acquisition (15-60s, max 60s duration)
   - Auto-renewal via background thread
   - `IAzureBlobLockProvider` specialized interface
   - Health checks for lease monitoring
   - Inspired by Azure SDK, Medallion.Threading

3. **DynamoDB Provider (#210)**:
   - Conditional writes with `attribute_not_exists`
   - TTL-based automatic expiration
   - Heartbeat mechanism for lease extension
   - Fence tokens for consistency
   - Inspired by AWS DynamoDB Locking Client

4. **Distributed Semaphores (#215)** - HIGH Priority:
   ```csharp
   public interface IDistributedSemaphore
   {
       Task<IAsyncDisposable?> TryAcquireAsync(string resource, int maxCount, TimeSpan expiry, CancellationToken ct);
       Task<int> GetAvailableCountAsync(string resource, CancellationToken ct);
   }
   ```
   - Allow N concurrent holders (configurable)
   - Use cases: rate limiting, connection pooling, resource throttling
   - Implementations: Redis (Lua scripts), PostgreSQL, SQL Server

5. **Leader Election (#216)** - HIGH Priority:
   ```csharp
   public interface ILeaderElectionProvider
   {
       Task<ILeadershipLease> AcquireLeadershipAsync(string electionName, CancellationToken ct);
       Task<bool> IsLeaderAsync(string electionName, CancellationToken ct);
       IAsyncEnumerable<LeadershipChange> WatchLeadershipAsync(string electionName, CancellationToken ct);
   }
   ```
   - Single leader guarantee across cluster
   - Change notifications via IAsyncEnumerable
   - Automatic lease renewal
   - Use cases: singleton services, scheduled job coordination

6. **Fencing Tokens (#218)**:
   - Monotonically increasing token with each lock acquisition
   - Storage rejects operations with stale tokens
   - Prevents split-brain scenarios with expired locks
   - Inspired by Martin Kleppmann "Designing Data-Intensive Applications"

7. **DistributedLockPipelineBehavior (#220)** - HIGH Priority:
   ```csharp
   [DistributedLock("{request.EntityId}", ExpirySeconds = 30)]
   public class UpdateEntityCommand : ICommand<Unit> { ... }
   ```
   - Declarative attribute for handlers
   - Key template with property placeholders
   - Configurable expiry, retry, wait timeouts
   - Automatic lock acquisition/release around handler

8. **LeaderElectionPipelineBehavior (#221)** - HIGH Priority:
   ```csharp
   [RequiresLeadership("scheduler-leader")]
   public class ProcessScheduledMessagesCommand : ICommand<Unit> { ... }
   ```
   - Handler only executes on current leader node
   - Non-leaders receive predefined fallback response
   - Use cases: singleton scheduled jobs, exclusive processors

9. **RedLock Algorithm (#226)**:
   - Consensus across N/2+1 Redis instances
   - Clock drift compensation
   - Automatic retry with jitter on partial acquisition
   - High availability without single point of failure
   - `IRedLockProvider` as wrapper around `IDistributedLockProvider`

**Labels Applied**:

All 20 issues received comprehensive labels:
- `enhancement` - All issues
- `phase-2-functionality` - Milestone assignment
- `area-distributed-lock` - Primary area
- `area-messaging-patterns` - Related patterns
- `area-microservices` - Microservices context
- `area-cloud-native` - Cloud patterns (#209, #210, #211, #212)
- `cloud-azure` - Azure-specific (#209)
- `cloud-aws` - AWS-specific (#210)
- `area-database` - Database providers (#207, #208, #213, #214)
- `area-leader-election` - Leader election (#211, #216, #221)
- `area-semaphore` - Semaphore patterns (#215)
- `area-coordination` - Coordination primitives (#211, #212, #213)
- `area-pipeline` - Pipeline behaviors (#220, #221)
- `area-observability` - Observability (#222)
- `area-performance` - Performance (#223, #225)
- `area-security` - Security patterns (#218)
- `area-resilience` - Resilience patterns (#226)
- `industry-best-practice` - Industry patterns
- `priority-high`, `priority-medium`, `priority-low` - Priority levels
- `new-package` - All backend providers require new packages

**New Labels Created (5)**:

| Label | Description | Color |
|-------|-------------|-------|
| `area-distributed-lock` | Distributed locking patterns | #8B0000 |
| `area-leader-election` | Leader election and coordination | #FF6347 |
| `area-semaphore` | Distributed semaphores and counting locks | #FF7F50 |
| `area-coordination` | Distributed coordination primitives | #CD5C5C |
| `area-pipeline` | Pipeline behaviors and middleware | #DC143C |

**New Packages Planned (8)**:

| Package | Issue | Description |
|---------|-------|-------------|
| `Encina.DistributedLock.PostgreSQL` | #207 | pg_advisory_lock implementation |
| `Encina.DistributedLock.MySQL` | #208 | GET_LOCK implementation |
| `Encina.DistributedLock.AzureBlob` | #209 | Azure Blob leases |
| `Encina.DistributedLock.DynamoDB` | #210 | DynamoDB conditional writes |
| `Encina.DistributedLock.Consul` | #211 | Consul sessions |
| `Encina.DistributedLock.Etcd` | #212 | etcd leases |
| `Encina.DistributedLock.ZooKeeper` | #213 | ZK ephemeral nodes |
| `Encina.DistributedLock.Oracle` | #214 | DBMS_LOCK |

**Documentation Updated**:
- `docs/INVENTORY.md` - Expanded Section 8 (Distributed Lock) with 20 new issues, interfaces, and packages
- `ROADMAP.md` - Added "Advanced Distributed Lock" section to Phase 2
- `CHANGELOG.md` - Added detailed entries for all 20 new issues with implementation details

**Research Sources**:
- [DistributedLock by madelson](https://github.com/madelson/DistributedLock) - .NET ecosystem leader
- [RedLock.net](https://github.com/samcook/RedLock.net) - RedLock algorithm implementation
- [HashiCorp Consul](https://developer.hashicorp.com/consul/docs/dynamic-app-config/sessions) - Session-based locking
- [etcd.io Distributed Locks](https://etcd.io/docs/v3.5/dev-guide/api_reference_v3/) - Lease-based coordination
- [Apache ZooKeeper Recipes](https://zookeeper.apache.org/doc/current/recipes.html) - Coordination recipes
- [AWS DynamoDB Locking Client](https://github.com/awslabs/amazon-dynamodb-lock-client) - Cloud-native locking
- [Azure Blob Leases](https://learn.microsoft.com/en-us/rest/api/storageservices/lease-blob) - Blob storage coordination
- [Martin Kleppmann - Fencing Tokens](https://martin.kleppmann.com/2016/02/08/how-to-do-distributed-locking.html) - Split-brain prevention
- [PostgreSQL Advisory Locks](https://www.postgresql.org/docs/current/explicit-locking.html#ADVISORY-LOCKS) - Native database locks

**Priority Summary**:

| Priority | Count | Issues |
|----------|-------|--------|
| HIGH | 6 | #207, #215, #216, #220, #221 |
| MEDIUM | 8 | #208, #209, #210, #211, #212, #217, #218, #222, #223, #226 |
| LOW | 6 | #213, #214, #219, #224, #225 |

**Recommended Implementation Order**:

1. **Immediate (High Priority)**:
   - #207 (PostgreSQL) - Most requested database after SQL Server
   - #220 (DistributedLockPipelineBehavior) - Declarative API for handlers
   - #215 (Distributed Semaphores) - Core coordination primitive
   - #216 (Leader Election) - Critical for singleton services

2. **Short-term (Medium Priority)**:
   - #209 (Azure Blob) - Cloud-native locking for Azure users
   - #210 (DynamoDB) - Cloud-native locking for AWS users
   - #222 (OpenTelemetry) - Observability for existing locks
   - #226 (RedLock) - High availability for Redis users

3. **Medium-term (Lower Priority)**:
   - #208 (MySQL), #211 (Consul), #212 (etcd) - Additional backends
   - #217 (Read/Write), #218 (Fencing), #223 (Auto-extend) - Advanced features

---

### December 29 - Advanced Validation Patterns Research (Issues #227-#236)

**Research Session**: Comprehensive analysis of validation patterns for Encina based on:
- Current .NET ecosystem trends (FluentValidation, Validot, MiniValidator)
- Cross-platform patterns (TypeScript Zod, Rust validator crate)
- OWASP security guidelines
- DDD best practices (Value Objects, Always-Valid Domain Model)
- Industry patterns from Netflix, Meta, and enterprise frameworks

**Issues Created (10)**:

| Issue | Title | Priority | Complexity |
|-------|-------|----------|------------|
| **#227** | Source-Generated Validation | High | Very High |
| **#228** | Domain/Value Object Validation | High | Medium |
| **#229** | Consolidate ValidationPipelineBehavior | Critical | Low |
| **#230** | Enhanced Async/Cross-Field Validation | Medium | Medium |
| **#231** | OpenAPI Schema Validation | Medium | High |
| **#232** | Security-Focused Validation (OWASP) | High | Medium |
| **#233** | Validation Error Localization | Medium | Medium |
| **#234** | Validation Result Aggregation | Low | Low |
| **#235** | Zod-like Schema Builder | Low | High |
| **#236** | Two-Phase Validation Pattern | Medium | Medium |

**Key Findings from Analysis**:

1. **Technical Debt Identified (#229)**: Each validation provider (FluentValidation, DataAnnotations, MiniValidator) has its own duplicated `ValidationPipelineBehavior` instead of using the centralized one in `Encina/Validation/`. This violates DRY and the documented orchestrator pattern.

2. **Source Generators Trend (#227)**: NativeAOT and trimming compatibility are increasingly important. Source-generated validation (like Validot) provides:
   - ~1.6x faster execution
   - ~4.7x less memory usage
   - Zero reflection overhead

3. **Security Focus (#232)**: OWASP guidelines indicate that proper input validation prevents >90% of injection attacks. Encina should provide first-class security validators.

4. **DDD Integration (#228)**: Always-Valid Domain Model is a fundamental principle. Value Objects with ROP factory methods (`Either<EncinaError, T>`) align perfectly with Encina's design philosophy.

5. **Cross-Platform Patterns (#235)**: TypeScript's Zod library has proven the value of chainable, fluent schema builders with type inference.

**New Packages Planned (5)**:

| Package | Issue | Description |
|---------|-------|-------------|
| `Encina.Validation.Generators` | #227 | Source-generated validators, NativeAOT-compatible |
| `Encina.Validation.Domain` | #228 | Value Objects with Always-Valid Domain Model |
| `Encina.Validation.OpenApi` | #231 | OpenAPI 3.1 contract validation |
| `Encina.Validation.Security` | #232 | OWASP-compliant sanitization and validation |
| `Encina.Validation.Schema` | #235 | Zod-inspired fluent schema builder |

**Labels Applied**:

All issues received comprehensive labels:
- `enhancement` or `technical-debt` - Issue type
- `phase-2-functionality` - Milestone assignment
- `area-validation` - Primary area
- `priority-critical`, `priority-high`, `priority-medium`, `priority-low` - Priority levels
- `complexity-low` to `complexity-very-high` - Effort estimation
- `new-package` - Packages requiring creation
- Additional area labels:
  - `area-source-generators` (new) - #227
  - `area-performance` - #227
  - `area-ddd` - #228, #236
  - `area-pipeline` - #229, #234, #236
  - `area-database` - #230
  - `area-openapi` - #231
  - `area-security` - #232
  - `area-aspnetcore` - #233
  - `area-interop` - #235
  - `area-architecture-testing` - #236
  - `industry-best-practice` - #227, #228, #231, #232, #235
  - `aot-compatible` - #227
  - `dotnet-10` - #227

**New Label Created**:

| Label | Description | Color |
|-------|-------------|-------|
| `area-source-generators` | Source generators and compile-time code generation | #7B68EE |

**Documentation Updated**:
- `docs/INVENTORY.md` - Expanded Section 6 (Validation) with 10 new issues, interfaces, and packages
- `ROADMAP.md` - Added "Advanced Validation" section to Phase 2
- `CHANGELOG.md` - Added detailed entries for all 10 new validation issues

**Research Sources**:
- [Validot - Performance-first validation](https://github.com/bartoszlenar/Validot)
- [Microsoft Options Validation Source Generator](https://learn.microsoft.com/en-us/dotnet/core/extensions/options-validation-generator)
- [OWASP Input Validation Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Input_Validation_Cheat_Sheet.html)
- [OWASP ASVS V5: Validation, Sanitization, Encoding](https://github.com/OWASP/ASVS)
- [Always-Valid Domain Model - Enterprise Craftsmanship](https://enterprisecraftsmanship.com/posts/always-valid-domain-model/)
- [Domain Model Validation - Kamil Grzybek](https://www.kamilgrzybek.com/blog/posts/domain-model-validation)
- [Value Objects in .NET - Milan Jovanovic](https://www.milanjovanovic.tech/blog/value-objects-in-dotnet-ddd-fundamentals)
- [Zod - TypeScript-first schema validation](https://github.com/colinhacks/zod)
- zod-rs - Rust implementation (crate discontinued)
- [FluentValidation Localization](https://docs.fluentvalidation.net/en/latest/localization.html)
- [FluentValidation Async](https://docs.fluentvalidation.net/en/latest/async.html)
- [Rethinking MediatR Validation](https://goatreview.com/rethinking-mediatr-pipeline-validation-pattern/)

**Priority Summary**:

| Priority | Count | Issues |
|----------|-------|--------|
| CRITICAL | 1 | #229 (Technical Debt) |
| HIGH | 3 | #227, #228, #232 |
| MEDIUM | 4 | #230, #231, #233, #236 |
| LOW | 2 | #234, #235 |

**Recommended Implementation Order**:

1. **Immediate (Critical/High Priority)**:
   - #229 (Consolidate Behaviors) - Low effort, fixes architecture issue
   - #232 (Security Validation) - High value for production systems
   - #228 (Value Objects) - Core DDD infrastructure

2. **Short-term (High Priority)**:
   - #227 (Source Generators) - NativeAOT trend, significant value

3. **Medium-term (Medium Priority)**:
   - #230 (Async/Cross-Field) - Common use cases
   - #231 (OpenAPI) - API-first development
   - #233 (Localization) - Enterprise requirement
   - #236 (Two-Phase) - Architecture pattern

4. **Long-term (Lower Priority)**:
   - #234 (Aggregation) - Nice-to-have
   - #235 (Zod-like) - Experimental API

---

### December 29 - Message Transport Patterns Research (Issues #237-#265)

**Research Session**: Comprehensive analysis of message transport patterns for Encina based on:
- .NET messaging ecosystem (MassTransit, NServiceBus, Wolverine, Rebus)
- Enterprise Integration Patterns (Hohpe & Woolf)
- Cloud-native messaging (AWS, Azure, GCP)
- Open-source technologies (Apache Kafka, Pulsar, Redis Streams)
- Community demand on r/dotnet, Stack Overflow, and GitHub discussions (December 2025)

**Issues Created (29 total, all in Phase 2: Functionality)**:

#### New Message Transports (6 issues)

| Issue | Title | Priority | Complexity |
|-------|-------|----------|------------|
| **#237** | Google Cloud Pub/Sub Transport | High | Medium |
| **#238** | AWS EventBridge Transport | High | Medium |
| **#239** | Apache Pulsar Transport | Medium | High |
| **#240** | Redis Streams Transport | High | Medium |
| **#241** | Apache ActiveMQ Artemis Transport | Medium | Medium |
| **#242** | Dapr Transport | Medium | Medium |

**Transport Implementation Details**:

1. **Google Cloud Pub/Sub (#237)** - HIGH Priority:
   - `IMessageTransportPubSub` interface with dead-lettering and ordering keys
   - Exactly-once delivery (Preview feature), flow control
   - Schema validation, message filtering, BigQuery subscriptions
   - New package: `Encina.Transport.GooglePubSub`

2. **AWS EventBridge (#238)** - HIGH Priority:
   - Event bus publishing with partner/custom buses
   - Content-based filtering with event patterns
   - Archive and replay, cross-account delivery
   - Schema discovery integration
   - New package: `Encina.Transport.EventBridge`

3. **Apache Pulsar (#239)**:
   - Exclusive, Shared, Failover, Key_Shared subscription types
   - Topic compaction, tiered storage, geo-replication
   - Schema registry with Avro/Protobuf/JSON
   - Pulsar Functions integration for stream processing
   - New package: `Encina.Transport.Pulsar`

4. **Redis Streams (#240)** - HIGH Priority:
   - `XADD`/`XREAD`/`XREADGROUP` command integration
   - Consumer groups with automatic rebalancing
   - Stream trimming (`MAXLEN`, `MINID`)
   - Pending Entry List (PEL) management
   - New package: `Encina.Transport.RedisStreams`

5. **Apache ActiveMQ Artemis (#241)**:
   - AMQP 1.0 and CORE protocol support
   - Scheduled messages, last-value queues, ring queues
   - Message grouping, large message support
   - Divert and bridge configurations
   - New package: `Encina.Transport.ActiveMQ`

6. **Dapr Transport (#242)**:
   - Component-based pub/sub (40+ broker implementations)
   - CloudEvents format native support
   - Bulk publish, per-message metadata
   - Subscriber routing rules
   - New package: `Encina.Transport.Dapr`

#### Enterprise Integration Patterns (9 issues)

| Issue | Title | Priority | Complexity |
|-------|-------|----------|------------|
| **#243** | Message Translator | High | Medium |
| **#244** | Content Enricher | High | Medium |
| **#245** | Splitter Pattern | High | Medium |
| **#246** | Aggregator Pattern | High | High |
| **#247** | Claim Check Pattern | Medium | Medium |
| **#248** | Async Request-Reply | High | Medium |
| **#249** | Competing Consumers | High | Medium |
| **#250** | Message Filter | Medium | Low |
| **#251** | Priority Queue | Medium | Medium |

**EIP Implementation Details**:

1. **Message Translator (#243)**:
   ```csharp
   public interface IMessageTranslator<TFrom, TTo>
   {
       ValueTask<Either<EncinaError, TTo>> TranslateAsync(TFrom source, CancellationToken ct);
       ValueTask<Either<EncinaError, TFrom>> ReverseTranslateAsync(TTo target, CancellationToken ct);
   }
   ```
   - Bidirectional translation support
   - AutoMapper and Mapster integration

2. **Content Enricher (#244)**:
   ```csharp
   public interface IContentEnricher<TMessage>
   {
       ValueTask<Either<EncinaError, TMessage>> EnrichAsync(TMessage message, CancellationToken ct);
   }
   ```
   - Async enrichment from external services
   - Caching support for enrichment data

3. **Splitter Pattern (#245)**:
   ```csharp
   public interface IMessageSplitter<TComposite, TPart>
   {
       IAsyncEnumerable<TPart> SplitAsync(TComposite composite, CancellationToken ct);
   }
   ```
   - Correlation ID propagation
   - Sequential and parallel splitting

4. **Aggregator Pattern (#246)**:
   ```csharp
   public interface IMessageAggregator<TPart, TResult>
   {
       ValueTask<Either<EncinaError, TResult>> AggregateAsync(IEnumerable<TPart> parts, CancellationToken ct);
   }
   ```
   - Time-based and count-based completion conditions
   - Correlation strategies (CorrelationId, custom keys)

5. **Claim Check Pattern (#247)**:
   ```csharp
   public interface IClaimCheckStore
   {
       ValueTask<Either<EncinaError, string>> CheckInAsync<T>(T payload, CancellationToken ct);
       ValueTask<Either<EncinaError, T>> CheckOutAsync<T>(string claimToken, CancellationToken ct);
   }
   ```
   - Azure Blob, S3, local filesystem providers
   - Automatic check-in/check-out with message metadata

6. **Async Request-Reply (#248)**:
   - Reply-to queue management
   - Timeout handling with continuation tokens
   - Correlation-based response matching

7. **Competing Consumers (#249)**:
   - `ICompetingConsumerPool` interface
   - Dynamic scaling based on queue depth
   - Affinity and stickiness options

8. **Message Filter (#250)**:
   - Predicate-based filtering
   - Dead-letter routing for filtered messages

9. **Priority Queue (#251)**:
   - `IMessagePriority` interface for priority assignment
   - Multiple priority levels configuration
   - Fair scheduling to prevent starvation

#### Advanced Transport Features (8 issues)

| Issue | Title | Priority | Complexity |
|-------|-------|----------|------------|
| **#252** | Message Batching | High | Medium |
| **#253** | Native Delayed Delivery | High | Medium |
| **#254** | Message Deduplication | High | Medium |
| **#255** | Partitioning | Medium | High |
| **#256** | Consumer Groups | Medium | High |
| **#257** | Bidirectional Streaming | Medium | High |
| **#258** | Message Compression | Medium | Low |
| **#259** | Schema Registry Integration | Medium | High |

**Advanced Features Details**:

1. **Message Batching (#252)**:
   - `BatchPublisher<TMessage>` with configurable batch size/timeout
   - Async flush with backpressure
   - Per-transport batch optimization

2. **Native Delayed Delivery (#253)**:
   - `IDelayedDeliveryTransport` interface
   - `DelayUntil(DateTimeOffset)`, `DelayFor(TimeSpan)` methods
   - Fallback to Encina.Scheduling when not supported

3. **Message Deduplication (#254)**:
   - `IDeduplicationStrategy` interface
   - Content-hash, Message-ID, custom key strategies
   - Configurable deduplication window

4. **Partitioning (#255)**:
   - `IPartitionKeyProvider<TMessage>` interface
   - Consistent hashing for partition assignment
   - Partition affinity for stateful consumers

5. **Consumer Groups (#256)**:
   - `IConsumerGroup` interface
   - Automatic partition assignment and rebalancing
   - Offset tracking and commit strategies

6. **Bidirectional Streaming (#257)**:
   - `IStreamingTransport<TRequest, TResponse>` interface
   - Client and server streaming modes
   - Flow control and backpressure

7. **Message Compression (#258)**:
   - `IMessageCompressor` interface
   - Gzip, Brotli, LZ4, Snappy algorithms
   - Content-encoding negotiation

8. **Schema Registry Integration (#259)**:
   - `ISchemaRegistry` interface
   - Confluent Schema Registry, AWS Glue support
   - Compatibility checks (BACKWARD, FORWARD, FULL)

#### Transport Interoperability (3 issues)

| Issue | Title | Priority | Complexity |
|-------|-------|----------|------------|
| **#260** | CloudEvents Format Support | High | Medium |
| **#261** | NServiceBus Interoperability | Medium | High |
| **#262** | MassTransit Interoperability | Medium | High |

**Interoperability Details**:

1. **CloudEvents Format (#260)** - HIGH Priority:
   - `ICloudEventsSerializer` interface
   - Structured and binary content modes
   - Extension attributes support
   - CNCF standard compliance

2. **NServiceBus Interoperability (#261)**:
   - Message format translation
   - Header mapping (NServiceBus ↔ Encina)
   - Gateway pattern for gradual migration

3. **MassTransit Interoperability (#262)**:
   - Envelope format translation
   - Consumer adapter patterns
   - Saga state migration utilities

#### Transport Observability (3 issues)

| Issue | Title | Priority | Complexity |
|-------|-------|----------|------------|
| **#263** | Transport Health Checks | High | Low |
| **#264** | Transport Metrics | High | Medium |
| **#265** | Transport Distributed Tracing | High | Medium |

**Observability Details**:

1. **Transport Health Checks (#263)** - HIGH Priority:
   - `ITransportHealthCheck` interface per transport
   - Connection state, queue depth, consumer lag
   - ASP.NET Core Health Checks integration

2. **Transport Metrics (#264)** - HIGH Priority:
   - Messages sent/received/failed per transport
   - Latency histograms (P50, P95, P99)
   - OpenTelemetry Metrics integration

3. **Transport Distributed Tracing (#265)** - HIGH Priority:
   - W3C Trace Context propagation
   - Span creation for publish/consume operations
   - Baggage propagation for cross-service context

**New Labels Created (12)**:

| Label | Description | Color |
|-------|-------------|-------|
| `transport-rabbitmq` | RabbitMQ transport provider | #FF6600 |
| `transport-kafka` | Apache Kafka transport provider | #231F20 |
| `transport-azure-sb` | Azure Service Bus transport provider | #0078D4 |
| `transport-sqs` | AWS SQS transport provider | #FF9900 |
| `transport-redis` | Redis transport provider | #DC382D |
| `transport-nats` | NATS transport provider | #27AAE1 |
| `transport-pulsar` | Apache Pulsar transport provider | #188FFF |
| `transport-grpc` | gRPC transport provider | #244C5A |
| `transport-dapr` | Dapr transport provider | #0D2192 |
| `transport-eventbridge` | AWS EventBridge transport provider | #FF9900 |
| `transport-pubsub` | Google Cloud Pub/Sub transport provider | #4285F4 |
| `transport-activemq` | Apache ActiveMQ Artemis transport provider | #C03434 |

**Labels Applied to All Issues**:
- `enhancement` - New feature
- `phase-2-functionality` - Milestone assignment
- `area-messaging-patterns` - Primary area
- `area-transports` - Transport-related
- `industry-best-practice` - Industry patterns (most issues)
- `cloud-aws`, `cloud-gcp`, `cloud-azure` - Cloud-specific issues
- `area-cloud-native` - Cloud-native patterns
- `area-microservices` - Microservices context
- `area-observability` - Observability issues (#263, #264, #265)
- Transport-specific labels for each issue

**New Packages Planned (10)**:

| Package | Issue | Description |
|---------|-------|-------------|
| `Encina.Transport.GooglePubSub` | #237 | Google Cloud Pub/Sub integration |
| `Encina.Transport.EventBridge` | #238 | AWS EventBridge integration |
| `Encina.Transport.Pulsar` | #239 | Apache Pulsar integration |
| `Encina.Transport.RedisStreams` | #240 | Redis Streams integration |
| `Encina.Transport.ActiveMQ` | #241 | Apache ActiveMQ Artemis integration |
| `Encina.Transport.Dapr` | #242 | Dapr pub/sub abstraction |
| `Encina.Transport.SchemaRegistry` | #259 | Schema registry integration |
| `Encina.Interop.NServiceBus` | #261 | NServiceBus bridge |
| `Encina.Interop.MassTransit` | #262 | MassTransit bridge |
| `Encina.Messaging.EIP` | #243-#251 | Enterprise Integration Patterns |

**Documentation Updated**:
- `docs/INVENTORY.md` - Added complete Message Transport Patterns section with all 29 issues
- `ROADMAP.md` - Added 5 new sections to Phase 2 (Transports, EIP, Advanced Features, Interoperability, Observability)
- `CHANGELOG.md` - Added detailed entries for all 29 new issues

**Research Sources**:
- [MassTransit Transports](https://masstransit.io/documentation/transports) - Multi-transport patterns
- [NServiceBus Transports](https://docs.particular.net/transports/) - Enterprise messaging
- [Wolverine Transports](https://wolverine.netlify.app/) - Modern .NET messaging
- [Enterprise Integration Patterns](https://www.enterpriseintegrationpatterns.com/) - Hohpe & Woolf catalog
- [Apache Kafka Streams](https://kafka.apache.org/documentation/streams/) - Stream processing
- [Redis Streams](https://redis.io/docs/latest/develop/data-types/streams/) - Redis-native streaming
- [CloudEvents Specification](https://cloudevents.io/) - CNCF event format standard
- [Dapr Pub/Sub](https://docs.dapr.io/developing-applications/building-blocks/pubsub/) - Cloud-agnostic messaging
- [Google Cloud Pub/Sub](https://cloud.google.com/pubsub/docs) - GCP messaging
- [AWS EventBridge](https://docs.aws.amazon.com/eventbridge/) - AWS event routing

**Priority Summary**:

| Priority | Count | Issues |
|----------|-------|--------|
| HIGH | 15 | #237, #238, #240, #243, #244, #245, #246, #248, #249, #252, #253, #254, #260, #263, #264, #265 |
| MEDIUM | 14 | #239, #241, #242, #247, #250, #251, #255, #256, #257, #258, #259, #261, #262 |

**Recommended Implementation Order**:

1. **Immediate (High Priority)**:
   - #260 (CloudEvents) - CNCF standard, enables interoperability
   - #263, #264, #265 (Observability) - Critical for production readiness
   - #237, #238, #240 (GCP/AWS/Redis transports) - High-demand cloud providers
   - #243-#246 (Core EIP) - Fundamental integration patterns

2. **Short-term (Medium Priority)**:
   - #252-#254 (Batching, Delayed, Dedup) - Performance and reliability
   - #248, #249 (Async Reply, Competing Consumers) - Common patterns
   - #239, #241, #242 (Pulsar, ActiveMQ, Dapr) - Additional transports

3. **Medium-term (Lower Priority)**:
   - #255-#257 (Partitioning, Groups, Streaming) - Advanced features
   - #261, #262 (Interoperability) - Migration support
   - #258, #259 (Compression, Schema Registry) - Optimization

---

### December 29 (Evening) - Advanced Caching Patterns Research (Issues #266-#278)

**Context**: Comprehensive research session focused on caching patterns, identifying gaps between Encina's current implementation and industry leaders like FusionCache and HybridCache .NET 9.

**Research Methodology**:
1. Analyzed current Encina caching implementation (8 packages, 3 behaviors)
2. Studied FusionCache features (most popular .NET caching library 2025)
3. Reviewed HybridCache .NET 9 GA announcement and features
4. Investigated cache stampede solutions and industry patterns
5. Researched multi-tenant caching for SaaS architectures
6. Examined OpenTelemetry cache metrics standards

**Findings - Gap Analysis**:

| Feature | FusionCache | HybridCache | Encina Current | Gap |
|---------|-------------|-------------|----------------|-----|
| Eager Refresh | ✅ | ❌ | ❌ | HIGH |
| Fail-Safe | ✅ | ❌ | ❌ | HIGH |
| Backplane | ✅ | ✅ (implicit) | Basic Pub/Sub | MEDIUM |
| Tag Invalidation | ✅ | ✅ | Pattern-only | MEDIUM |
| Stampede Protection | ✅ | ✅ (single-flight) | Basic locks | HIGH |
| Cache Warming | ✅ | ❌ | ❌ | MEDIUM |
| Soft/Hard Timeouts | ✅ | ❌ | ❌ | MEDIUM |
| Auto-Recovery | ✅ | ❌ | Graceful degradation | MEDIUM |

**Issues Created (13 total)**:

#### High Priority (4 issues)

| Issue | Title | Complexity | Labels |
|-------|-------|------------|--------|
| **#266** | Cache Stampede Protection | Medium | `pattern-stampede-protection`, `area-resilience`, `area-performance`, `industry-best-practice` |
| **#267** | Eager Refresh / Background Refresh | Medium | `pattern-stale-while-revalidate`, `area-performance`, `fustioncache-inspired`, `industry-best-practice` |
| **#268** | Fail-Safe / Stale-While-Revalidate | Medium | `pattern-stale-while-revalidate`, `area-resilience`, `fustioncache-inspired`, `industry-best-practice` |
| **#270** | Cache Backplane for Multi-Node Sync | High | `pattern-backplane`, `area-coordination`, `area-microservices`, `fustioncache-inspired`, `transport-redis` |

**#266 - Cache Stampede Protection**:
- Single-Flight pattern: Coalesce multiple identical requests
- Probabilistic Early Expiration (PER): Renew before expiration probabilistically
- TTL Jitter: Random variation prevents synchronized cache misses
- Replaces and supersedes #140

**#267 - Eager Refresh**:
- EagerRefreshThreshold property on [Cache] attribute
- Background refresh when request arrives after threshold (e.g., 80% of TTL)
- User always receives cached response immediately
- Factory runs asynchronously, updates cache when done

**#268 - Fail-Safe**:
- Serve stale data when factory fails or times out
- FailSafeDurationSeconds: Extended TTL for emergency scenarios
- SoftTimeoutMs: Return stale if factory slow, continue in background
- HardTimeoutMs: Absolute factory timeout

**#270 - Cache Backplane**:
- ICacheBackplane interface for L1 synchronization
- Actions: Set, Remove, RemoveByTag, RemoveByPattern, Invalidate
- Redis implementation with Pub/Sub
- Modes: InvalidationOnly, SmallValueReplication, FullReplication

#### Medium Priority (7 issues)

| Issue | Title | Complexity | Labels |
|-------|-------|------------|--------|
| **#269** | Cache Warming / Pre-warming | Medium | `area-performance`, `area-scalability`, `industry-best-practice` |
| **#271** | Enhanced Tag-Based Invalidation | Low | `area-messaging`, `industry-best-practice` |
| **#272** | Read/Write-Through Patterns | Medium | `pattern-read-through`, `pattern-write-through`, `pattern-cache-aside`, `area-database` |
| **#273** | Cache Metrics OpenTelemetry | Low | `area-observability`, `area-health-checks`, `industry-best-practice` |
| **#275** | Multi-Tenant Cache Policies | Medium | `area-multi-tenancy`, `area-security`, `area-rate-limiting`, `industry-best-practice` |
| **#278** | Auto-Recovery / Self-Healing | Medium | `pattern-circuit-breaker`, `area-resilience`, `area-health-checks`, `fustioncache-inspired` |

**#269 - Cache Warming**:
- ICacheWarmer interface with Priority
- [CacheWarmer] attribute for query marking
- CacheWarmingHostedService for startup warming
- Strategies: Sequential, Parallel, TopHeavy, AccessPattern

**#271 - Tag-Based Invalidation**:
- Tags property on [Cache] attribute
- [CacheTag] attribute for dynamic tags from response
- RemoveByTagAsync, RemoveByTagsAsync on ICacheProvider
- Redis Sets for O(1) tag lookup

**#272 - Read/Write-Through**:
- CacheStrategy enum: CacheAside, ReadThrough, WriteThrough, WriteBehind
- Write-Behind with IWriteBehindQueue and background flush
- WriteBehindHostedService for periodic persistence

**#273 - Cache Metrics**:
- Counters: encina.cache.hits, misses, sets, removals, evictions
- Histograms: latency, value_size_bytes
- Gauges: size_bytes, entry_count
- OpenTelemetry integration via ICacheMetrics

**#275 - Multi-Tenant Policies**:
- CacheTenantPolicy per subscription tier
- ITenantCachePolicyProvider for dynamic resolution
- ICacheTenantQuotaEnforcer for quota tracking
- TenantIsolationLevel: KeyPrefix, Database, Instance

**#278 - Auto-Recovery**:
- Retry with exponential backoff
- Circuit breaker for cache operations
- ICacheConnectionManager for reconnection
- FallbackStrategy: SkipCache, UseLocalMemory, UseSecondaryProvider

#### Low Priority (2 issues)

| Issue | Title | Complexity | Labels |
|-------|-------|------------|--------|
| **#274** | Advanced Serialization Options | Low | `area-performance`, `aot-compatible` |
| **#276** | Cache Diagnostics & Debugging | Low | `area-health-checks`, `area-web-api` |
| **#277** | New Providers (Memcached, MemoryPack) | Medium | `aot-compatible`, `area-performance`, `new-package` |

**#274 - Advanced Serialization**:
- Per-type serializer configuration
- MemoryPack support (NativeAOT, 10x faster than MessagePack)
- Zstd compression (better ratio than LZ4)
- Smart compression based on payload size

**#276 - Cache Diagnostics**:
- HTTP headers: X-Cache-Status, X-Cache-Key, X-Cache-Age, X-Cache-TTL
- Diagnostic endpoints: /cache/stats, /cache/keys, /cache/key/{key}
- ICacheInspector API for programmatic inspection
- Cache debugger middleware

**#277 - New Providers**:
- Encina.Caching.Memcached - Pure Memcached
- Encina.Caching.MemoryPack - AOT serialization package
- Encina.Caching.Pogocache - New 2025 cache (evaluate when stable)

**New Labels Created (8)**:

| Label | Description | Color |
|-------|-------------|-------|
| `pattern-stampede-protection` | Cache stampede and thundering herd protection | #DC143C |
| `pattern-stale-while-revalidate` | Stale-While-Revalidate caching pattern | #20B2AA |
| `pattern-read-through` | Read-Through caching pattern | #20B2AA |
| `pattern-write-through` | Write-Through caching pattern | #20B2AA |
| `pattern-cache-aside` | Cache-Aside caching pattern | #20B2AA |
| `pattern-backplane` | Cache backplane synchronization pattern | #9370DB |
| `pattern-circuit-breaker` | Circuit Breaker resilience pattern | #DC143C |
| `fustioncache-inspired` | Pattern inspired by FusionCache library | #FF6347 |

**Issue Closed**:
- **#140** (Cache Stampede Prevention) closed as duplicate of #266

**Documentation Updated**:
- `docs/INVENTORY.md` - Added complete Caching Patterns section with all 13 issues
- `ROADMAP.md` - Added Advanced Caching section to Phase 2
- `CHANGELOG.md` - Added detailed entries for all 13 new issues and 8 new labels

**Research Sources**:
- [FusionCache](https://github.com/ZiggyCreatures/FusionCache) - Eager refresh, fail-safe, backplane, auto-recovery
- [HybridCache .NET 9](https://devblogs.microsoft.com/dotnet/hybrid-cache-is-now-ga/) - Tag invalidation, L1+L2
- [Thundering Herd Solutions](https://howtech.substack.com/p/thundering-herd-problem-cache-stampede) - Stampede prevention patterns
- [Cache Warming Strategies 2025](https://newsletter.scalablethread.com/p/how-to-optimize-performance-with) - Pre-warming patterns
- [OpenTelemetry Cache Metrics](https://uptrace.dev/blog/opentelemetry-metrics-cache-stats.html) - Hit rate, latency metrics
- [Multi-tenant Azure Cache](https://learn.microsoft.com/en-us/azure/architecture/guide/multitenant/service/cache-redis) - SaaS caching patterns
- [.NET Serialization Comparison 2025](https://medium.com/@niravinfo/net-serialization-smackdown-json-vs-messagepack-vs-protobuf-who-rules-your-bytes) - MessagePack vs MemoryPack

**Recommended Implementation Order**:

1. **Immediate (Closes major gaps with FusionCache)**:
   - #266 (Stampede Protection) - Critical for high-load scenarios
   - #267 (Eager Refresh) - Improves latency without code changes
   - #268 (Fail-Safe) - Resilience for production systems
   - #270 (Backplane) - Essential for multi-node deployments

2. **Short-term (Enhances developer experience)**:
   - #269 (Cache Warming) - Eliminates cold starts
   - #271 (Tag Invalidation) - Better than glob patterns
   - #273 (Metrics) - Production observability

3. **Medium-term (Optimization and polish)**:
   - #272 (Read/Write-Through) - Alternative strategies
   - #275 (Multi-tenant) - SaaS-specific
   - #278 (Auto-recovery) - Complements #268
   - #274, #276, #277 - Tooling and optimization

---

## Session: December 29 - Database Providers Patterns Research

### Context

User requested research on potential improvements for Database Providers Patterns in Encina. Investigation covered:
- .NET database patterns and trends 2025
- Popular libraries: Ardalis.Specification, EFCore.BulkExtensions, Marten, Debezium
- Frameworks: MassTransit, Wolverine, NServiceBus database integration
- Community demand analysis: r/dotnet, Stack Overflow, dev.to, Lobsters

### Issues Created (16)

#### Data Access Patterns (Issues #279-#281)

| Issue | Title | Priority | Complexity |
|-------|-------|----------|------------|
| **#279** | Generic Repository Pattern (IRepository<TEntity, TId>) | Critical | Medium |
| **#280** | Specification Pattern (ISpecification<T>) | Critical | Medium |
| **#281** | Unit of Work Pattern (IUnitOfWork) | High | Medium |

**#279 - Generic Repository Pattern**:
- Unified `IRepository<TEntity, TId>` interface for CRUD operations
- `IReadRepository<TEntity, TId>` for CQRS read scenarios
- Provider implementations: RepositoryEF, RepositoryDapper, RepositoryMongoDB
- Integration with Specification Pattern for complex queries
- Inspired by [Ardalis.Specification](https://github.com/ardalis/Specification)

**#280 - Specification Pattern**:
- `ISpecification<T>` with Criteria, Includes, OrderBy, Paging
- `Specification<T>` base class with fluent API
- `ISpecificationEvaluator<T>` per provider (EF Core, Dapper, MongoDB)
- Eliminates lambda expression duplication

**#281 - Unit of Work Pattern**:
- `IUnitOfWork` with SaveChangesAsync, BeginTransactionAsync, CommitAsync, RollbackAsync
- Repository factory method
- Implementations for EF Core, Dapper, MongoDB

#### Multi-Tenancy (Issue #282)

| Issue | Title | Priority | Complexity |
|-------|-------|----------|------------|
| **#282** | Multi-Tenancy Database Support | Critical | High |

**#282 - Multi-Tenancy Database Support**:
- Abstractions: `ITenantProvider`, `ITenantEntity`, `TenantInfo`
- Isolation strategies:
  - Shared Schema (TenantId column)
  - Schema per Tenant
  - Database per Tenant
- Tenant resolvers: Header, Subdomain, JWT Claim, Route
- New packages planned:
  - `Encina.Tenancy` - Core abstractions
  - `Encina.Tenancy.SharedSchema`
  - `Encina.Tenancy.SchemaIsolation`
  - `Encina.Tenancy.DatabaseIsolation`
  - `Encina.Tenancy.AspNetCore`

#### Performance Patterns (Issues #283-#284, #289-#291, #294)

| Issue | Title | Priority | Complexity |
|-------|-------|----------|------------|
| **#283** | Read/Write Database Separation | High | Medium |
| **#284** | Bulk Operations | Critical | Medium |
| **#289** | Database Sharding Abstractions | Low | Very High |
| **#290** | Connection Pool Management & Resilience | Medium | Medium |
| **#291** | Query Caching Interceptor | Medium | Medium |
| **#294** | Cursor-based Pagination [RESEARCH] | High | Medium |

**#284 - Bulk Operations** (Critical performance feature):
- `IBulkOperations<TEntity>`: BulkInsertAsync, BulkUpdateAsync, BulkDeleteAsync, BulkMergeAsync
- **Benchmarks**:
  - SaveChanges(): ~17,000 seconds for 1M rows
  - SqlBulkCopy: ~25 seconds for 1M rows (**680x faster**)
- Inspired by [EFCore.BulkExtensions](https://github.com/borisdj/EFCore.BulkExtensions)

**#294 - Cursor-based Pagination**:
- Research issue to investigate keyset vs offset pagination
- Offset: O(n) - performance degrades with page number
- Cursor: O(1) - consistent performance regardless of position
- GraphQL Relay Connection spec compatibility
- Use cases: Infinite scroll, real-time feeds, public APIs

#### Audit & Compliance Patterns (Issues #285-#286)

| Issue | Title | Priority | Complexity |
|-------|-------|----------|------------|
| **#285** | Soft Delete & Temporal Tables | High | Low |
| **#286** | Audit Trail Pattern | High | Low |

**#285 - Soft Delete & Temporal Tables**:
- `ISoftDeletable`: IsDeleted, DeletedAtUtc, DeletedBy
- Global query filter for automatic filtering
- `ITemporalRepository<TEntity, TId>` for SQL Server temporal tables
- Queries: GetAsOfAsync, GetHistoryAsync

**#286 - Audit Trail Pattern**:
- `IAuditableEntity`: CreatedAtUtc, CreatedBy, ModifiedAtUtc, ModifiedBy
- `AuditInterceptor` for automatic SaveChanges population
- Integration with `IRequestContext.UserId`

#### Domain Model Patterns (Issues #287, #292-#293)

| Issue | Title | Priority | Complexity |
|-------|-------|----------|------------|
| **#287** | Optimistic Concurrency Abstractions | High | Low |
| **#292** | Domain Entity Base Classes | High | Low |
| **#293** | Pagination Abstractions | Critical | Low |

**#292 - Domain Entity Base Classes**:
- `Entity<TId>` with equality, domain events collection
- `AggregateRoot<TId>` with audit + concurrency
- `DomainEventDispatcher` SaveChanges interceptor
- Integration with `INotification` and Outbox pattern

**#293 - Pagination Abstractions**:
- `PagedResult<T>` with TotalCount, TotalPages, HasNext/Previous
- `PaginationOptions`, `SortedPaginationOptions`
- `IPagedSpecification<T>` integration

#### Integration Patterns (Issue #288)

| Issue | Title | Priority | Complexity |
|-------|-------|----------|------------|
| **#288** | Change Data Capture (CDC) Integration | Medium | High |

**#288 - CDC Integration**:
- `ChangeEvent<T>` with Operation, Before, After, Metadata
- New packages planned:
  - `Encina.CDC` - Core abstractions
  - `Encina.CDC.Debezium` - Debezium/Kafka integration
  - `Encina.CDC.SqlServer` - SQL Server native CDC
  - `Encina.CDC.PostgreSQL` - PostgreSQL logical replication
- Complements Outbox pattern for legacy system integration

### Labels Created (10)

| Label | Description | Color |
|-------|-------------|-------|
| `area-repository` | Repository pattern and data access abstractions | #8B4513 |
| `area-unit-of-work` | Unit of Work and transaction patterns | #CD853F |
| `area-cqrs` | CQRS and read/write separation patterns | #4682B4 |
| `area-bulk-operations` | Bulk insert, update, delete operations | #FF6347 |
| `area-audit` | Audit trails and change tracking | #9370DB |
| `area-cdc` | Change Data Capture patterns | #20B2AA |
| `area-sharding` | Database sharding and horizontal partitioning | #FF8C00 |
| `area-pagination` | Pagination patterns (offset, cursor, keyset) | #32CD32 |
| `area-concurrency` | Concurrency control and conflict resolution | #BA55D3 |
| `area-connection-pool` | Connection pooling and management | #5F9EA0 |

### Labels Updated on Existing Issues

All 16 new issues were enriched with relevant existing labels:
- `industry-best-practice` - All 16 issues (proven patterns)
- `aot-compatible` - 6 issues (NativeAOT/trimming compatible)
- `area-compliance`/`area-gdpr` - 4 issues (regulatory compliance)
- `area-scalability` - 5 issues (horizontal scaling patterns)
- `area-cloud-native` - 4 issues (cloud-native patterns)

### Documentation Updated

- `docs/INVENTORY.md` - Added complete "Patrones de Data Access Planificados" section
- `ROADMAP.md` - Added "Database Providers Patterns" to Phase 2
- `CHANGELOG.md` - Added detailed entries for all 16 issues and 10 new labels

### Research Sources

- [Ardalis.Specification](https://github.com/ardalis/Specification) - Specification pattern gold standard
- [EFCore.BulkExtensions](https://github.com/borisdj/EFCore.BulkExtensions) - Bulk operations benchmarks
- [Debezium](https://debezium.io/) - Change Data Capture
- [Azure Multi-Tenant Patterns](https://learn.microsoft.com/en-us/azure/architecture/guide/multitenant/approaches/storage-data)
- [EF Core Temporal Tables](https://learn.microsoft.com/en-us/ef/core/providers/sql-server/temporal-tables)
- [Cursor Pagination at Slack](https://slack.engineering/evolving-api-pagination-at-slack/)
- [GraphQL Relay Connection Spec](https://relay.dev/graphql/connections.htm)
- [Use The Index, Luke - Pagination](https://use-the-index-luke.com/no-offset)
- [Milan Jovanovic Blog](https://www.milanjovanovic.tech/blog/fast-sql-bulk-inserts-with-csharp-and-ef-core)

### Recommended Implementation Order

1. **Immediate (Closes critical gaps)**:
   - #279 (Generic Repository) + #280 (Specification) - Data access foundations
   - #293 (Pagination) - Basic but missing
   - #284 (Bulk Operations) - Critical for ETL performance
   - #282 (Multi-Tenancy) - Essential for SaaS

2. **Short-term (Developer experience)**:
   - #281 (Unit of Work) - Complex transactions
   - #292 (Domain Entity Base) - DDD foundations
   - #285 + #286 (Soft Delete + Audit) - Compliance

3. **Medium-term (Optimization)**:
   - #283 (Read/Write Separation) - Read scaling
   - #287 (Optimistic Concurrency) - Conflict handling
   - #290 + #291 (Pool + Query Cache) - Performance
   - #294 (Cursor Pagination) - Research and decision

4. **Long-term (Advanced scenarios)**:
   - #288 (CDC) - Legacy system integration
   - #289 (Sharding) - Only if truly necessary

---

## December 29 - Advanced DDD & Workflow Patterns Research (Session 2)

### Context

Extensive research session to identify missing Core Patterns for Encina based on:
- Analysis of leading .NET frameworks (MassTransit, Wolverine, NServiceBus, Orleans)
- Enterprise Integration Patterns (EIP) book
- Modern workflow orchestration tools (Azure Durable Functions, Temporal)
- .NET community demand in December 2025
- Comparative analysis with Java ecosystem (Axon Framework, Spring Modulith)
- AI/ML integration trends (Microsoft Agent Framework, Semantic Kernel)

### New Issues Created (13 total: #295-#307)

#### High Priority - DDD Patterns (5 issues)

| Issue | Pattern | Complexity | Inspired By |
|-------|---------|------------|-------------|
| **#295** | Specification Pattern | Medium | Ardalis.Specification |
| **#296** | Process Manager Pattern | High | EIP, NServiceBus |
| **#297** | State Machine Pattern (FSM) | Medium | Stateless, MassTransit Automatonymous |
| **#298** | Claim Check Pattern | Low | EIP |
| **#299** | Anti-Corruption Layer (ACL) | Medium | Eric Evans DDD |

#### Medium Priority - Cross-Cutting Concerns (5 issues)

| Issue | Pattern | Complexity | Inspired By |
|-------|---------|------------|-------------|
| **#300** | Feature Flag Integration | Low | Microsoft.FeatureManagement |
| **#301** | Priority Queue Support | Low | Azure Service Bus, RabbitMQ |
| **#302** | Batching/Bulk Operations | Medium | Kafka, Wolverine |
| **#303** | Durable Execution | High | Azure Durable Functions, Temporal |
| **#304** | Multi-Tenancy Pipeline | Medium | Azure Multi-Tenant Patterns |

#### Low Priority - Emerging Patterns (3 issues)

| Issue | Pattern | Complexity | Inspired By |
|-------|---------|------------|-------------|
| **#305** | AI Agent Orchestration | High | Microsoft Agent Framework, Semantic Kernel |
| **#306** | Integration Events | Medium | Spring Modulith 2.0 |
| **#307** | Request Versioning | Medium | Marten Event Upcasting |

### New Labels Created (12)

| Label | Description | Color |
|-------|-------------|-------|
| `pattern-specification` | Specification pattern for query composition | #2E8B57 |
| `pattern-process-manager` | Process Manager workflow orchestration | #8B008B |
| `pattern-state-machine` | Finite State Machine pattern | #3CB371 |
| `pattern-claim-check` | Claim Check pattern for large payloads | #DAA520 |
| `pattern-acl` | Anti-Corruption Layer pattern | #B22222 |
| `pattern-feature-flags` | Feature Flags/Toggles pattern | #32CD32 |
| `pattern-durable-execution` | Durable Execution and checkpointing | #0D2192 |
| `pattern-versioning` | Request/Event versioning pattern | #6F42C1 |
| `area-feature-management` | Feature flag management | #32CD32 |
| `area-workflow` | Workflow and process orchestration | #8B008B |
| `temporal-inspired` | Pattern inspired by Temporal.io | #0D2192 |
| `masstransit-inspired` | Pattern inspired by MassTransit | #8B008B |

### Labels Applied to New Issues

All 13 issues were enriched with both existing and new labels:

- `industry-best-practice` - 8 issues (proven enterprise patterns)
- `area-eip` - 4 issues (Enterprise Integration Patterns)
- `area-ddd` - 5 issues (Domain-Driven Design)
- `area-workflow` - 5 issues (workflow orchestration)
- `area-saga` - 3 issues (saga-related)
- `cloud-azure` - 3 issues (Azure integration)
- `masstransit-inspired` - 2 issues
- `temporal-inspired` - 1 issue
- `new-package` - 1 issue (AI Agents)

### Documentation Updated

- `docs/INVENTORY.md` - Added new section "2.5. Advanced DDD & Workflow Patterns" with complete details
- `ROADMAP.md` - Added "Advanced DDD & Workflow Patterns" to Phase 2 with all 13 issues
- `CHANGELOG.md` - Added detailed entries for all 13 issues and 12 new labels

### Research Sources

#### .NET Frameworks
- [Ardalis.Specification](https://github.com/ardalis/Specification) - Specification pattern gold standard
- [Stateless](https://github.com/dotnet-state-machine/stateless) - State machine library (6k+ stars)
- [MassTransit](https://masstransit.io/documentation/patterns/saga) - Saga state machines, Automatonymous
- [Wolverine](https://wolverine.netlify.app/) - Critter Stack, messaging patterns
- [NServiceBus](https://docs.particular.net/architecture/workflows) - Process Manager, workflows

#### Enterprise Integration Patterns
- [Process Manager](https://www.enterpriseintegrationpatterns.com/patterns/messaging/ProcessManager.html)
- [Claim Check](https://www.enterpriseintegrationpatterns.com/patterns/messaging/StoreInLibrary.html)
- [Saga and Process Manager](https://event-driven.io/en/saga_process_manager_distributed_transactions/)

#### Workflow & Durable Execution
- [Azure Durable Functions](https://learn.microsoft.com/en-us/azure/azure-functions/durable/durable-functions-overview)
- [Temporal](https://temporal.io/) - Durable workflow engine
- [Durable Task Framework](https://github.com/Azure/durabletask)

#### Cross-Cutting
- [Microsoft.FeatureManagement](https://github.com/microsoft/FeatureManagement-Dotnet) - Feature flags
- [Anti-Corruption Layer - Azure](https://learn.microsoft.com/en-us/azure/architecture/patterns/anti-corruption-layer)
- [Multi-Tenancy Patterns](https://learn.microsoft.com/en-us/azure/architecture/guide/multitenant/considerations/tenancy-models)

#### AI/ML & Emerging
- [Microsoft Agent Framework](https://learn.microsoft.com/en-us/agent-framework/) - AI agent orchestration (Oct 2025)
- [Semantic Kernel](https://learn.microsoft.com/en-us/semantic-kernel/) - LLM integration
- [Spring Modulith 2.0](https://spring.io/projects/spring-modulith) - Integration events

### Recommended Implementation Order

1. **Immediate (Alta Prioridad - DDD foundations)**:
   - #295 (Specification) - Complementa repository pattern existente
   - #297 (State Machine) - Competir con MassTransit Automatonymous
   - #298 (Claim Check) - Bajo esfuerzo, alto impacto

2. **Short-term (Alta-Media Prioridad)**:
   - #296 (Process Manager) - Workflows complejos
   - #299 (ACL) - Integraciones enterprise
   - #300 (Feature Flags) - DevOps moderno

3. **Medium-term (Media Prioridad)**:
   - #301 + #302 (Priority + Batching) - Performance
   - #303 (Durable Execution) - Long-running workflows
   - #304 (Multi-Tenancy) - Mercado SaaS

4. **Long-term (Post 1.0 evaluation)**:
   - #305 (AI Agents) - Evaluar madurez Microsoft Agent Framework
   - #306 (Integration Events) - Cuando Module System sea más adoptado
   - #307 (Request Versioning) - Necesario post-1.0 para compatibility

### Statistics Update

| Metric | Before | After |
|--------|--------|-------|
| Issues Phase 2 (DDD & Workflow) | 0 | 13 (#295-#307) |
| Labels (patterns) | 6 | 14 (+8 pattern-*) |
| Labels (areas) | ~45 | ~49 (+4 new areas) |
| Labels (inspired-by) | 2 | 4 (+2 new) |

---

### December 29 (Continued) - Advanced EDA Patterns Research

**Focus**: Comprehensive research on Event-Driven Architecture patterns based on community demand in 2025, analysis of competing frameworks (MassTransit, Wolverine 5.0, Axon Framework, Temporal.io, Debezium), and industry best practices from Netflix, Uber, and Stripe.

**Issues Created**: 12 new issues (#308-#319) for Advanced EDA Patterns

| Issue | Pattern | Priority | Complexity | Labels |
|-------|---------|----------|------------|--------|
| **#308** | CDC (Change Data Capture) | Alta | Alta | `area-cdc`, `industry-best-practice` |
| **#309** | Schema Registry Integration | Alta | Media | `area-schema-registry`, `transport-kafka` |
| **#310** | Event Mesh / Event Gateway | Alta | Alta | `area-cloud-native`, `area-integration` |
| **#311** | Claim Check Pattern | Media | Media | `area-eip`, `cloud-azure`, `cloud-aws` |
| **#312** | Domain vs Integration Events | Alta | Baja | `area-ddd`, `area-modular-monolith` |
| **#313** | Event Correlation & Causation | Alta | Baja | `area-observability`, `netflix-pattern` |
| **#314** | Temporal Queries (Time Travel) | Media | Media | `area-event-sourcing`, `area-compliance` |
| **#315** | Durable Execution / Workflow Engine | Alta | Muy Alta | `temporal-pattern`, `uber-pattern` |
| **#316** | Event Enrichment Pipeline | Alta | Baja | `area-event-sourcing`, `area-performance` |
| **#317** | Process Manager Pattern | Media | Media | `area-saga`, `area-coordination` |
| **#318** | Event Streaming Abstractions | Media | Media | `area-event-streaming`, `transport-kafka` |
| **#319** | Idempotency Key Generator | Alta | Baja | `area-idempotency`, `stripe-pattern` |

#### New Labels Created (6)

| Label | Description | Color |
|-------|-------------|-------|
| `area-schema-registry` | Schema Registry and event schema governance | #9B59B6 |
| `area-event-streaming` | Event streaming and persistent log patterns | #1ABC9C |
| `area-idempotency` | Idempotency and exactly-once processing | #3498DB |
| `uber-pattern` | Pattern inspired by Uber engineering | #000000 |
| `stripe-pattern` | Pattern inspired by Stripe engineering | #635BFF |
| `temporal-pattern` | Pattern inspired by Temporal.io | #8B5CF6 |

#### Research Sources Analyzed

**Frameworks & Libraries**:
- MassTransit v9 (2025) - Now commercial license, v8 remains MIT
- Wolverine 5.0 (Oct 2025) - MIT licensed, new interoperability features
- Axon Framework - Event sourcing and CQRS patterns
- Temporal.io - Durable execution platform
- Debezium - CDC leader with Quarkus integration

**Industry Patterns**:
- Netflix: Event streaming, correlation, idempotency
- Uber: Durable execution, idempotency keys
- Stripe: Idempotency key patterns for APIs

**Key References**:
- [MassTransit Licensing Change 2025](https://github.com/MassTransit/MassTransit)
- [Wolverine 5.0 Release](https://jeremydmiller.com/2025/10/23/wolverine-5-0-is-here/)
- [Temporal Durable Execution](https://temporal.io/how-temporal-works)
- [Event Versioning Strategies](https://theburningmonk.com/)
- [Debezium CQRS Pattern](https://debezium.io/blog/2025/11/28/cqrs/)
- [Idempotent Consumer Pattern in .NET](https://www.milanjovanovic.tech/blog)

#### Planned Packages

| Package | Description |
|---------|-------------|
| `Encina.CDC` | Core CDC abstractions |
| `Encina.CDC.Debezium` | Debezium embedded engine |
| `Encina.CDC.SqlServer` | SQL Server Change Tracking |
| `Encina.CDC.PostgreSQL` | PostgreSQL logical replication |
| `Encina.SchemaRegistry` | Schema Registry abstractions |
| `Encina.SchemaRegistry.Confluent` | Confluent Schema Registry |
| `Encina.SchemaRegistry.Azure` | Azure Event Hubs Schema Registry |
| `Encina.EventMesh` | Event Mesh core |
| `Encina.EventMesh.CloudEvents` | CloudEvents specification support |
| `Encina.ClaimCheck` | Claim Check core |
| `Encina.ClaimCheck.AzureBlob` | Azure Blob Storage |
| `Encina.ClaimCheck.S3` | Amazon S3 |
| `Encina.DurableExecution` | Workflow engine core |
| `Encina.DurableExecution.EntityFrameworkCore` | EF Core persistence |

#### Documentation Updates

- **docs/INVENTORY.md**: Added new section "2.6. Advanced EDA Patterns" with detailed descriptions
- **ROADMAP.md**: Added "Advanced EDA Patterns" section in Phase 2
- **CHANGELOG.md**: Documented all 12 new issues and 6 new labels

#### Recommended Implementation Order

1. **Quick Wins (Alta Prioridad - Baja Complejidad)**:
   - #312 (Domain/Integration Events) - Fundamental para DDD
   - #313 (Correlation/Causation) - Observabilidad crítica
   - #316 (Event Enrichment) - Performance de proyecciones
   - #319 (Idempotency Keys) - Base para exactly-once

2. **High Value (Alta Prioridad - Media/Alta Complejidad)**:
   - #308 (CDC) - Integración enterprise
   - #309 (Schema Registry) - Governance de eventos
   - #311 (Claim Check) - Large payloads

3. **Strategic (Media Prioridad)**:
   - #310 (Event Mesh) - Arquitectura empresarial
   - #314 (Temporal Queries) - Auditoría avanzada
   - #317 (Process Manager) - Workflows complejos
   - #318 (Event Streaming) - Streaming patterns

4. **Major Investment (Alta Complejidad)**:
   - #315 (Durable Execution) - Implementar post-quick-wins

#### Statistics Update (EDA)

| Metric | Before | After |
|--------|--------|-------|
| Issues Phase 2 (EDA Patterns) | 0 | 12 (#308-#319) |
| Labels (areas) | ~49 | ~52 (+3 new areas) |
| Labels (inspired-by) | 4 | 7 (+3 new) |
| Planned Packages (EDA) | 0 | ~14 |

---

### December 27 - Advanced Event Sourcing Patterns Research

**Focus**: Comprehensive research on Event Sourcing patterns based on .NET ecosystem analysis (Marten, EventStoreDB, Eventuous), cross-platform frameworks (Axon Framework, Eventuate), and 2025 community demand for production-ready event sourcing features.

**Issues Created**: 13 new issues (#320-#332) for Advanced Event Sourcing Patterns

| Issue | Pattern | Tier | Priority | Complexity |
|-------|---------|------|----------|------------|
| **#320** | Decider Pattern (Functional ES) | 1 | Alta | Media |
| **#321** | Causation & Correlation IDs | 1 | Alta | Baja |
| **#322** | Crypto-Shredding GDPR | 1 | Alta | Alta |
| **#323** | Advanced Snapshot Strategies | 1 | Alta | Media |
| **#324** | Blue-Green Projection Rebuild | 1 | Alta | Alta |
| **#325** | Multi-Tenancy for Event Streams | 1 | Alta | Alta |
| **#326** | Temporal Queries (Time Travel) | 2 | Media | Media |
| **#327** | Event Archival & Compaction | 2 | Media | Alta |
| **#328** | Bi-Temporal Modeling | 3 | Baja | Alta |
| **#329** | Event Stream Explorer CLI | 2 | Media | Media |
| **#330** | Actor-Based Event Sourcing | 3 | Baja | Muy Alta |
| **#331** | EventQL & Preconditions | 3 | Baja | Alta |
| **#332** | Tri-Temporal Modeling | 3 | Baja | Muy Alta |

#### Tier Classification

- **Tier 1 (Critical - Pre-1.0)**: Core patterns essential for production event sourcing (#320-#325)
- **Tier 2 (Post-1.0)**: Advanced features for enterprise scenarios (#326-#327, #329)
- **Tier 3 (Nice-to-Have)**: Specialized patterns for specific domains (#328, #330-#332)

#### New Labels Created (8)

| Label | Description | Color |
|-------|-------------|-------|
| `pattern-decider` | Decider pattern for functional event sourcing | #7C3AED |
| `pattern-crypto-shredding` | Crypto-shredding for GDPR compliance | #DC2626 |
| `pattern-blue-green` | Blue-green deployment patterns | #059669 |
| `pattern-temporal-query` | Temporal query patterns (time travel) | #0891B2 |
| `pattern-snapshot` | Snapshot strategy patterns | #EA580C |
| `area-archival` | Event archival and data lifecycle | #6B7280 |
| `area-developer-experience` | Developer experience and tooling | #8B5CF6 |
| `marten-integration` | Marten-specific integration | #4F46E5 |

#### Research Sources Analyzed

**Primary .NET Frameworks**:
- **Marten 7.x** (2025) - Document DB + Event Store for PostgreSQL
- **EventStoreDB** - Purpose-built event store database
- **Eventuous** - Modern .NET event sourcing library
- **EventSourcingDB** - Emerging TypeScript/Node.js framework with cross-pollination ideas

**Cross-Platform Analysis**:
- **Axon Framework** (Java) - Decider pattern, comprehensive CQRS/ES
- **Eventuate** - Chris Richardson's microservices patterns
- **Temporal.io** - Durable execution concepts applicable to ES

**Key Patterns Researched**:
1. **Decider Pattern**: Functional approach with pure `Decide`/`Evolve` functions (Jérémie Chassaing, Oskar Dudycz)
2. **Crypto-Shredding**: GDPR compliance via key deletion instead of event mutation
3. **Bi/Tri-Temporal Modeling**: System time, business time, and decision time tracking
4. **Blue-Green Projections**: Zero-downtime projection rebuilds
5. **Actor-Based ES**: Orleans/Akka-inspired event-sourced grains

**Key References**:
- [Decider Pattern - thinkbeforecoding](https://thinkbeforecoding.com/post/2021/12/17/functional-event-sourcing-decider)
- [Marten Documentation](https://martendb.io/documents/)
- [EventStoreDB Projections](https://www.eventstore.com/)
- [Oskar Dudycz - Event Sourcing .NET](https://event-driven.io/)
- [GDPR & Event Sourcing](https://www.michielrook.nl/2017/11/forget-me-please-event-sourcing-gdpr/)
- [Axon Framework Concepts](https://docs.axoniq.io/)

#### Planned Enhancements to Encina.Marten

| Feature | Description |
|---------|-------------|
| `IDecider<TCommand, TEvent, TState>` | Functional decider abstraction |
| `CausationId` / `CorrelationId` | Automatic metadata tracking |
| `Encina.Marten.GDPR` | Crypto-shredding package |
| `SnapshotStrategy` enum | EventCount, TimeInterval, BusinessBoundary, Composite |
| `IProjectionRebuilder` | Blue-green projection rebuild service |
| `TenancyMode` enum | Conjoined, Dedicated, SchemaPerTenant |
| `LoadAtAsync<T>(id, pointInTime)` | Point-in-time aggregate reconstruction |
| `IEventArchivalPolicy` | Hot/warm/cold storage tiering |
| `encina-cli event-stream` | Interactive event stream explorer |
| `ActorAggregateBase<TState>` | Orleans-inspired actor aggregates |
| `EventQL` | Domain-specific query language for events |

#### Documentation Updates

- **docs/INVENTORY.md**: Added section "Event Sourcing Patterns Planificados (Phase 2) - Diciembre 2025"
- **ROADMAP.md**: Added "Advanced Event Sourcing Patterns" section with all 13 issues
- **CHANGELOG.md**: Documented all 13 issues and 8 new labels with detailed descriptions

#### Recommended Implementation Order

1. **Foundation (Tier 1 - Core ES)**:
   - #320 (Decider Pattern) - Functional ES foundation
   - #321 (Causation/Correlation) - Observability must-have
   - #323 (Snapshots) - Performance optimization

2. **Compliance & Enterprise (Tier 1)**:
   - #322 (Crypto-Shredding) - GDPR compliance
   - #324 (Blue-Green Rebuild) - Zero-downtime ops
   - #325 (Multi-Tenancy) - SaaS enablement

3. **Advanced Queries (Tier 2)**:
   - #326 (Temporal Queries) - Audit & debugging
   - #327 (Archival) - Data lifecycle
   - #329 (CLI Explorer) - Developer experience

4. **Specialized (Tier 3 - Post-1.0 evaluation)**:
   - #328 (Bi-Temporal) - Financial/legal domains
   - #330 (Actor-Based) - High-concurrency scenarios
   - #331 (EventQL) - Advanced querying
   - #332 (Tri-Temporal) - Decision audit trails

#### Statistics Update (Event Sourcing)

| Metric | Before | After |
|--------|--------|-------|
| Issues Phase 2 (Event Sourcing) | 0 | 13 (#320-#332) |
| Labels (patterns) | ~14 | ~18 (+4 pattern-*) |
| Labels (areas) | ~52 | ~54 (+2 new areas) |
| Labels (integration) | ~10 | ~11 (+1 marten-integration) |

---

### December 29 - Advanced CQRS Patterns Research (Session 2)

**Issues Created**: #333-#344 (12 issues)

Following the Event Sourcing research earlier in the day, a second research session focused on identifying gaps and improvements for Encina's CQRS Patterns implementation based on analysis of competing frameworks, community demands, and industry best practices.

#### Context: MediatR Commercial Transition

In **July 2025**, MediatR transitioned to a commercial license, creating significant market opportunity for open-source alternatives. This research identifies patterns from:

- **Wolverine** (open-source MediatR alternative) - Convention-based discovery, zero-interface handlers
- **Brighter** - Request timeout strategies, policy-based error handling
- **Axon Framework** (Java) - Request versioning, upcasting, event-driven architecture
- **MassTransit** - Batch processing, message composition patterns
- **GraphQL ecosystem** - Cursor-based pagination standards

#### Issues Created (#333-#344)

| Issue | Title | Priority | Complexity | Inspiration |
|-------|-------|----------|------------|-------------|
| **#333** | Zero-Interface Handlers | Alta | Media | Wolverine |
| **#334** | Idempotency Pipeline Behavior | Alta | Media | Brighter/MassTransit |
| **#335** | Request Timeout Behavior | Alta | Media | Brighter |
| **#336** | Cursor-Based Pagination | Alta | Media | GraphQL/Relay |
| **#337** | Request Versioning | Media | Alta | Axon Framework |
| **#338** | Multi-Tenant Context Middleware | Media | Media | Enterprise demand |
| **#339** | Batch Command Processing | Media | Alta | MassTransit |
| **#340** | Request Enrichment | Media | Baja | Industry patterns |
| **#341** | Notification Fanout Strategies | Media | Media | Axon/MassTransit |
| **#342** | Request Composition | Baja | Media | GraphQL DataLoader |
| **#343** | Handler Discovery Analyzers | Baja | Alta | Roslyn ecosystem |
| **#344** | Progressive CQRS Adoption Guide | Media | Baja | Community demand |

#### Priority Tiers

- **Tier 1 (High Priority)**: #333-#336 - Core patterns with immediate demand due to MediatR transition
- **Tier 2 (Medium Priority)**: #337-#341 - Enterprise patterns for production systems
- **Tier 3 (Lower Priority)**: #342-#344 - Developer experience and advanced composition

#### New Labels Created (6)

| Label | Description | Color |
|-------|-------------|-------|
| `wolverine-inspired` | Patterns inspired by Wolverine framework | #10B981 |
| `brighter-inspired` | Patterns inspired by Brighter framework | #3B82F6 |
| `axon-inspired` | Patterns inspired by Axon Framework (Java) | #8B5CF6 |
| `graphql-inspired` | Patterns inspired by GraphQL ecosystem | #E535AB |
| `pattern-batch-processing` | Batch processing patterns | #F59E0B |
| `pattern-request-composition` | Request composition patterns | #6366F1 |

#### Research Sources Analyzed

**Primary .NET Frameworks**:
- **Wolverine 3.x** (2025) - JasperFx's open-source MediatR alternative
- **Brighter 10.x** - Paramore's command processor with policy support
- **MassTransit 8.x** - Distributed application framework

**Cross-Platform Analysis**:
- **Axon Framework** (Java) - Comprehensive CQRS/ES with versioning support
- **GraphQL Relay** - Cursor-based pagination specification
- **gRPC patterns** - Request enrichment from metadata

**Community Analysis**:
- Reddit r/dotnet threads on MediatR alternatives (July-December 2025)
- GitHub discussions on Wolverine adoption
- Dev.to articles on CQRS patterns in production

#### Detailed Feature Descriptions

**#333 Zero-Interface Handlers** (Wolverine-inspired):
```csharp
// Convention-based discovery - no IRequestHandler interface needed
public class OrderHandler
{
    public async Task<Either<EncinaError, Order>> Handle(CreateOrder cmd)
    {
        // Handler discovered by convention
    }
}
```

**#334 Idempotency Pipeline Behavior**:
```csharp
// Lightweight deduplication at pipeline level
[Idempotent(TTL = 3600)]
public record ProcessPayment(Guid PaymentId, decimal Amount) : IRequest<PaymentResult>;
```

**#335 Request Timeout Behavior** (Brighter-inspired):
```csharp
// Per-request timeout configuration
[Timeout(milliseconds: 5000, FallbackStrategy = TimeoutFallback.Cancel)]
public record LongRunningQuery : IRequest<Result>;
```

**#336 Cursor-Based Pagination** (GraphQL-inspired):
```csharp
// O(1) performance pagination
public record PagedQuery<T> : IRequest<Connection<T>>
{
    public string? After { get; init; }
    public string? Before { get; init; }
    public int First { get; init; } = 10;
}
```

**#337 Request Versioning** (Axon-inspired):
```csharp
// Version evolution with upcasting
[RequestVersion(2)]
public record CreateOrderV2 : IRequest<Order>, IUpcastable<CreateOrderV1>
{
    public static CreateOrderV2 Upcast(CreateOrderV1 v1) => new() { /* ... */ };
}
```

**#339 Batch Command Processing** (MassTransit-inspired):
```csharp
// Process multiple commands in single transaction
public interface IBatchHandler<TRequest, TResponse>
{
    Task<IEnumerable<Either<EncinaError, TResponse>>> HandleBatch(
        IEnumerable<TRequest> requests, CancellationToken ct);
}
```

#### Documentation Updates

- **docs/INVENTORY.md**: Added "Advanced CQRS Patterns - Nuevas Issues (29 Diciembre 2025)" section
- **ROADMAP.md**: Added "Advanced CQRS Patterns" to Phase 2: Functionality
- **CHANGELOG.md**: Documented all 12 issues and 6 new labels

#### Statistics Update (CQRS Patterns)

| Metric | Before | After |
|--------|--------|-------|
| Issues Phase 2 (CQRS) | 0 | 12 (#333-#344) |
| Labels (*-inspired) | 4 | 8 (+4 framework-inspired) |
| Labels (pattern-*) | ~18 | ~20 (+2 new patterns) |

#### Recommended Implementation Order

1. **Foundation (Tier 1 - Immediate)**:
   - #333 (Zero-Interface Handlers) - Wolverine migration path
   - #334 (Idempotency) - Production reliability
   - #335 (Timeout) - SLA compliance
   - #336 (Cursor Pagination) - API performance

2. **Enterprise (Tier 2)**:
   - #337 (Versioning) - Long-running systems
   - #338 (Multi-Tenant) - SaaS enablement
   - #339 (Batch Processing) - Throughput optimization
   - #340 (Enrichment) - Cross-cutting concerns
   - #341 (Fanout Strategies) - Event distribution

3. **Developer Experience (Tier 3)**:
   - #342 (Composition) - Advanced query patterns
   - #343 (Analyzers) - Compile-time validation
   - #344 (Adoption Guide) - Documentation

---

### December 29, 2025 (Session 2) - Vertical Slice Architecture Patterns Research

**Focus**: Research and issue creation for Vertical Slice Architecture patterns based on 2025 community trends

#### Research Conducted

Comprehensive analysis of .NET ecosystem patterns based on:
- **Libraries**: Wolverine, NServiceBus, MassTransit, Rebus, Microsoft.FeatureManagement
- **Frameworks**: Ardalis.Specification, Finbuckle.MultiTenant
- **Community**: Reddit, Stack Overflow, Milan Jovanovic Blog, Jimmy Bogard
- **Architecture**: Modular Monolith patterns (kgrzybek/modular-monolith-with-ddd)

**Key Findings**:
- Feature flags are "most requested" feature for SaaS in 2025
- Multi-tenancy lacks native mediator integration
- Modular Monolith is recommended architecture for new projects (before microservices)
- Domain vs Integration Events separation is a critical DDD pattern poorly handled

#### Issues Created (12)

| # | Title | Priority | Complexity | Key Labels |
|---|-------|----------|------------|------------|
| **#345** | Feature Flags Integration | Alta | Media | `saas-essential`, `aot-compatible` |
| **#346** | Multi-Tenancy Support | Alta | Alta | `saas-essential`, `area-security` |
| **#347** | Specification Pattern | Media | Baja | `area-ddd`, `aot-compatible` |
| **#348** | API Versioning Integration | Media | Media | `area-openapi`, `industry-best-practice` |
| **#349** | Request Batching | Media | Media | `area-scalability`, `area-performance` |
| **#350** | Domain vs Integration Events | Alta | Media | `area-ddd`, `area-microservices` |
| **#351** | Audit Trail Behavior | Media | Baja | `area-gdpr`, `area-compliance` |
| **#352** | Modular Monolith Support | Alta | Alta | `saas-essential`, `area-modular-monolith` |
| **#353** | CDC Integration | Baja | Alta | `area-event-sourcing`, `area-realtime` |
| **#354** | Enhanced Streaming | Baja | Media | `area-streaming`, `aot-compatible` |
| **#355** | Enhanced Idempotency | Media | Baja | `area-idempotency`, `area-resilience` |
| **#356** | Policy-Based Authorization | Media | Media | `saas-essential`, `area-authorization` |

All issues added to **Phase 2: Functionality** milestone.

#### Labels Created (9 New)

| Label | Description | Color |
|-------|-------------|-------|
| `area-feature-flags` | Feature flags and feature toggles patterns | #FFD700 |
| `area-authorization` | Authorization and access control patterns | #B22222 |
| `area-streaming` | Streaming and IAsyncEnumerable patterns | #00CED1 |
| `area-batching` | Request batching and bulk operations | #FF8C00 |
| `area-specification` | Specification pattern for queries | #2E8B57 |
| `area-versioning` | API versioning patterns | #1E90FF |
| `area-auditing` | Audit trail and logging patterns | #FF6347 |
| `area-domain-events` | Domain events and integration events | #6B8E23 |
| `saas-essential` | Essential pattern for SaaS applications | #9400D3 |

#### New Packages Planned (13)

| Package | Issue | Description |
|---------|-------|-------------|
| `Encina.FeatureFlags` | #345 | Feature flags with Microsoft.FeatureManagement |
| `Encina.MultiTenancy` | #346 | Multi-tenant resolution and isolation |
| `Encina.MultiTenancy.EntityFrameworkCore` | #346 | EF Core tenant query filters |
| `Encina.Specification` | #347 | Specification pattern abstractions |
| `Encina.Specification.EntityFrameworkCore` | #347 | EF Core specification evaluator |
| `Encina.AspNetCore.Versioning` | #348 | API versioning for handlers |
| `Encina.Batching` | #349 | Batch command/query processing |
| `Encina.Auditing` | #351 | Audit trail abstractions |
| `Encina.Auditing.EntityFrameworkCore` | #351 | EF Core audit store |
| `Encina.Modules` | #352 | Modular monolith support |
| `Encina.CDC` | #353 | CDC abstractions |
| `Encina.CDC.SqlServer` | #353 | SQL Server CDC provider |
| `Encina.CDC.Debezium` | #353 | Debezium/Kafka CDC provider |

#### Documentation Updated

- `docs/INVENTORY.md` - Added "Vertical Slice Architecture Patterns" section with full details
- `ROADMAP.md` - Added VSA patterns to Phase 2 functionality list
- `CHANGELOG.md` - Added 12 new issues and 9 new labels to Unreleased section
- `docs/history/2025-12.md` - This session summary

#### Statistics Update (VSA Patterns)

| Metric | Before | After |
|--------|--------|-------|
| Issues Phase 2 (VSA) | 0 | 12 (#345-#356) |
| Labels (area-*) | ~60 | ~69 (+9 new) |
| Labels (saas-*) | 0 | 1 (`saas-essential`) |
| Total Issues Phase 2 | 147 | 159 (+12) |

#### Recommended Implementation Order (VSA)

1. **SaaS Critical (Tier 1 - Immediate)**:
   - #345 (Feature Flags) - Trunk-based development
   - #346 (Multi-Tenancy) - SaaS foundation
   - #350 (Domain/Integration Events) - DDD best practice
   - #352 (Modular Monolith) - Architecture 2025

2. **Enterprise Features (Tier 2)**:
   - #351 (Audit Trail) - Compliance
   - #355 (Idempotency) - API reliability
   - #356 (Authorization) - Security
   - #347 (Specification) - Query patterns

3. **Advanced (Tier 3)**:
   - #348 (API Versioning) - API evolution
   - #349 (Batching) - Throughput

4. **Specialized (Tier 4)**:
   - #353 (CDC) - Real-time sync
   - #354 (Streaming) - Performance

## Week 9: December 29 (Modular Monolith Architecture Patterns)

### December 29 - Modular Monolith Research & Issues

**Issues Created**: `#357`, `#358`, `#359`, `#360`, `#361`, `#362`, `#363`, `#364`, `#365`, `#366`

**Context**: Comprehensive research on Modular Monolith architecture patterns based on analysis of:
- **ABP Framework** - Full-featured modular monolith framework with multi-tenancy
- **Wolverine** - Modern .NET messaging framework
- **NestJS** - Module system inspiration (TypeScript)
- **Orchard Core** - Modular CMS platform
- **Milan Jovanović** - Modular Monolith best practices and articles
- **kgrzybek/modular-monolith-with-ddd** - Reference implementation
- **Orleans Lifecycle** - Module lifecycle patterns
- **.NET Community 2025 trends** - Most requested features for enterprise/SaaS applications

**New Issues Created (10)**:

| Issue | Title | Priority | Complexity | New Packages |
|-------|-------|----------|------------|--------------|
| **#357** | Multi-Tenancy Support | Alta | Alta | `Encina.MultiTenancy`, `Encina.MultiTenancy.EntityFrameworkCore`, `Encina.MultiTenancy.AspNetCore` |
| **#358** | Inter-Module Communication (Integration Events) | Alta | Alta | - |
| **#359** | Data Isolation per Module | Alta | Alta | `Encina.Modular.Data`, `Encina.Modular.Data.Analyzers` |
| **#360** | Module Lifecycle Enhancement | Media | Media | - |
| **#361** | Feature Flags Integration | Media | Media | `Encina.FeatureManagement`, `Encina.FeatureManagement.AspNetCore` |
| **#362** | Module Testing Utilities | Media | Media | - |
| **#363** | Anti-Corruption Layer (ACL) Support | Media | Media | - |
| **#364** | Module Health & Readiness Checks | Media | Baja | - |
| **#365** | Vertical Slice Architecture Support | Media | Media | - |
| **#366** | Module Versioning | Baja | Media | - |

**Key Patterns Identified**:

##### Multi-Tenancy (#357)
- `ITenantContext` for tenant identification
- `ITenantResolver` with 6 strategies (Header, Subdomain, QueryString, Route, Claim, Cookie)
- `DataIsolationLevel` enum: RowLevel, Schema, Database
- `TenantContextPipelineBehavior` for automatic propagation
- EF Core `TenantQueryFilter` integration
- **Critical for SaaS applications**

##### Inter-Module Communication (#358)
- `IDomainEvent` vs `IIntegrationEvent` distinction (DDD best practice)
- `IIntegrationEventBus` for in-memory inter-module communication
- `IModulePublicApi<TModule>` for module contracts
- Outbox integration for reliability
- **Microservices migration path**

##### Data Isolation per Module (#359)
- `[ModuleSchema("orders")]` attribute for schema declaration
- `IModuleDbContext<TModule>` interface
- Roslyn analyzer for cross-module access detection (ENC001, ENC002, ENC003)
- Runtime query boundary enforcement
- **Enterprise architecture requirement**

##### Module Lifecycle (#360)
- Automatic module discovery
- `[DependsOn(typeof(OtherModule))]` for dependencies
- Topological sort for startup order
- Expanded lifecycle hooks (Orleans-inspired)
- Module exports (NestJS-inspired)

##### Feature Flags (#361)
- `[FeatureGate("FeatureName")]` attribute
- `FeatureGatePipelineBehavior` with short-circuit
- `[FallbackHandler]` for fallback handlers
- Azure App Configuration support
- **Trunk-based development enabler**

##### Module Testing (#362)
- `ModuleTestBase<TModule>` for isolated testing
- `WithMockedModule<TApi>()` helpers
- `ModuleArchitecture.Analyze()` for architecture tests
- Integration with ArchUnitNET patterns

##### Anti-Corruption Layer (#363)
- `IAntiCorruptionLayer<TExternal, TInternal>` interface
- `[ModuleAdapter(From, To)]` for inter-module adapters
- `[ExternalSystemAdapter("LegacyERP")]` for external systems
- Auto-discovery of adapters

##### Module Health (#364)
- `IModuleHealthCheck` per-module health checks
- Dependency-aware health propagation
- Per-module endpoints: `/health/{moduleName}`
- Kubernetes readiness/liveness integration

##### Vertical Slice (#365)
- `[VerticalSlice("Orders/PlaceOrder")]` attribute
- `[SlicePipeline(...)]` for slice-scoped behaviors
- CLI generator: `encina generate slice`
- Feature folder convention

##### Module Versioning (#366)
- `[ModuleVersion("2.0")]` and `[ModuleApiVersion]` attributes
- `[Deprecated]` with removal version
- Roslyn analyzer for deprecated usage (ENC010)
- Version compatibility validation

**Labels Created/Used**:

| Label | Description |
|-------|-------------|
| `area-modular-monolith` | Modular Monolith architecture patterns |
| `area-multitenancy` | Multi-tenancy patterns and isolation |
| `area-data-isolation` | Data isolation and schema separation |
| `area-module-system` | Module system, lifecycle, and discovery |
| `area-feature-flags` | Feature flags and toggles |
| `area-acl` | Anti-Corruption Layer patterns |
| `area-vertical-slice` | Vertical Slice Architecture patterns |
| `area-versioning` | API and module versioning |
| `roslyn-analyzer` | Requires Roslyn analyzer implementation |
| `saas-enabler` | Enables SaaS application development |
| `industry-best-practice` | Industry-proven pattern |
| `area-architecture-testing` | Architecture rules and verification |

**Documentation Updated**:
- `docs/INVENTORY.md` - New section "Modular Monolith Architecture Patterns - Nuevas Issues (29 Diciembre 2025)"
- `ROADMAP.md` - Added Modular Monolith Architecture Patterns to Phase 2
- `CHANGELOG.md` - Added 10 new feature descriptions in Unreleased section

**Issue Statistics Update**:

| Metric | Before | After |
|--------|--------|-------|
| Issues Phase 2 (VSA) | 12 (#345-#356) | 12 (#345-#356) |
| Issues Phase 2 (Modular Monolith) | 0 | 10 (#357-#366) |
| Total Issues Phase 2 | 159 | 169+ |
| Planned New Packages | ~90 | 97+ (+7 new) |

#### Recommended Implementation Order (Modular Monolith)

1. **SaaS Critical (Tier 1 - Immediate)**:
   - #357 (Multi-Tenancy) - Critical for SaaS
   - #358 (Integration Events) - DDD/microservices path
   - #359 (Data Isolation) - Enterprise architecture

2. **Module System (Tier 2)**:
   - #360 (Module Lifecycle) - Foundation
   - #361 (Feature Flags) - Trunk-based development
   - #362 (Module Testing) - Developer productivity

3. **Advanced (Tier 3)**:
   - #363 (ACL) - External integration
   - #364 (Health Checks) - Cloud-native
   - #365 (Vertical Slice) - Architecture formalization

4. **Nice-to-have (Tier 4)**:
   - #366 (Module Versioning) - API evolution

---

### December 29 (Continued) - Domain Modeling Building Blocks (Issues #367-#381)

**Overview**:
Research session to identify and plan Domain-Driven Design (DDD) tactical patterns for Encina, based on community demand analysis and comparison with popular .NET libraries like Vogen, Ardalis.Specification, and StronglyTypedId.

**Community Demand Analysis (December 2025)**:

| Library | NuGet Downloads | Pattern |
|---------|-----------------|---------|
| Vogen | ~5M | Value Objects + source generation |
| Ardalis.Specification | ~7M | Specification pattern for EF Core |
| StronglyTypedId | ~3M | Strongly typed IDs with source generation |
| MediatR | ~200M | CQRS/Mediator (Encina already has this) |

**Gap Analysis**:
Encina has excellent infrastructure patterns (Outbox, Inbox, Saga, Scheduling) but lacks domain modeling building blocks that developers expect.

**Issues Created (15 total)**:

| Issue | Pattern | Priority | Package |
|-------|---------|----------|---------|
| #367 | Value Objects | P0 | `Encina.DomainModeling` |
| #368 | Domain Events | P0 | `Encina.DomainModeling` |
| #369 | Entity Base Class | P0 | `Encina.DomainModeling` |
| #370 | Aggregate Root | P1 | `Encina.DomainModeling` |
| #371 | Specifications | P1 | `Encina.Specifications` |
| #372 | Business Rules | P1 | `Encina.DomainModeling` |
| #373 | Integration Events | P1 | `Encina.DomainModeling` |
| #374 | Strongly Typed IDs | P2 | `Encina.DomainModeling` |
| #375 | Soft Delete | P2 | `Encina.DomainModeling` |
| #376 | Auditing | P2 | `Encina.DomainModeling` |
| #377 | Domain Service | P2 | `Encina.DomainModeling` |
| #378 | ACL (Anti-Corruption Layer) | P3 | `Encina.DomainModeling` |
| #379 | Bounded Context Support | P3 | `Encina` |
| #380 | Generic Repository | P3 | `Encina.DomainModeling` |
| #381 | Fluent Domain DSL | P3 | `Encina.DomainModeling` |

**New Labels Created**:

| Label | Color | Purpose |
|-------|-------|---------|
| `area-domain-modeling` | #2E8B57 | Domain Modeling building blocks |
| `area-specifications` | #4682B4 | Specification pattern |
| `foundational` | #FFD700 | Building blocks for other patterns |

**Labels Applied**:
- All issues: `enhancement`, `phase-2-functionality`, `area-domain-modeling`
- Where applicable: `aot-compatible`, `foundational`, `industry-best-practice`
- Specific: `area-compliance`, `area-gdpr`, `area-auditing`, `area-specifications`, `area-acl`

**Proposed Package Architecture**:

```text
Encina.DomainModeling (main package)
├── ValueObject<T>
├── Entity<TId>
├── AggregateRoot<TId>
├── DomainEvent
├── IntegrationEvent
├── IBusinessRule
├── IDomainService
├── StronglyTypedId<T>
├── ISoftDeletable
├── IAuditable
└── FluentDomainBuilder

Encina.Specifications (specification pattern)
├── Specification<T>
├── ISpecification<T>
└── SpecificationEvaluator

Encina.Specifications.EntityFrameworkCore
└── EF Core query translation
```

**Key Design Decisions**:

1. **ROP Integration**: All domain operations return `Either<EncinaError, T>`
2. **Record-Based Value Objects**: Use C# records for immutability and equality
3. **NativeAOT Compatible**: Avoid reflection where possible, use source generators
4. **Provider-Agnostic**: Works with EF Core, Dapper, ADO.NET
5. **Separation of Concerns**: Specifications in separate package for opt-in usage

**Example Code Patterns**:

```csharp
// ValueObject
public abstract record ValueObject<T> where T : ValueObject<T>
{
    protected abstract IEnumerable<object> GetEqualityComponents();
}

// Entity
public abstract class Entity<TId> : IEquatable<Entity<TId>>
{
    public TId Id { get; protected set; } = default!;
    private readonly List<DomainEvent> _domainEvents = [];
    public IReadOnlyList<DomainEvent> DomainEvents => _domainEvents.AsReadOnly();
}

// AggregateRoot
public abstract class AggregateRoot<TId> : Entity<TId>, IAggregateRoot
{
    protected void RaiseDomainEvent(DomainEvent @event) => _domainEvents.Add(@event);
    public void ClearDomainEvents() => _domainEvents.Clear();
}

// Specification
public abstract class Specification<T>
{
    public abstract Expression<Func<T, bool>> ToExpression();
    public bool IsSatisfiedBy(T entity) => ToExpression().Compile()(entity);
    public Specification<T> And(Specification<T> other) => new AndSpecification<T>(this, other);
    public Specification<T> Or(Specification<T> other) => new OrSpecification<T>(this, other);
    public Specification<T> Not() => new NotSpecification<T>(this);
}

// Business Rule with ROP
public interface IBusinessRule
{
    string Code { get; }
    string Message { get; }
    Either<EncinaError, Unit> IsSatisfied();
}
```

**Comparison with Existing Encina.Marten**:

| Feature | Encina.Marten | New Encina.DomainModeling |
|---------|---------------|---------------------------|
| Target | Event sourcing only | All domain models |
| Aggregate | `AggregateBase` (ES-specific) | `AggregateRoot<TId>` (general) |
| Domain Events | Stored as events | Published via mediator |
| ID Types | `Guid` only | Generic `TId` |
| Provider | Marten/PostgreSQL | Provider-agnostic |

**Documentation Updated**:
- `docs/INVENTORY.md` - Added section 2.8 "Domain Modeling Building Blocks"
- `ROADMAP.md` - Added Domain Modeling Building Blocks to Phase 2
- `CHANGELOG.md` - Added 15 new feature descriptions in Unreleased section

**Issue Statistics Update**:

| Metric | Before | After |
|--------|--------|-------|
| Issues Phase 2 (Modular Monolith) | 10 (#357-#366) | 10 (#357-#366) |
| Issues Phase 2 (Domain Modeling) | 0 | 15 (#367-#381) |
| Total Issues | 171 | 186 |
| Planned New Packages | 97+ | 100+ (+3 new) |

**New Packages Identified**:
1. `Encina.DomainModeling` - Core domain modeling building blocks
2. `Encina.Specifications` - Specification pattern abstractions
3. `Encina.Specifications.EntityFrameworkCore` - EF Core specification evaluator

#### Recommended Implementation Order (Domain Modeling)

1. **Foundation (Tier 1 - Immediate)**:
   - #367 (Value Objects) - Most requested pattern
   - #369 (Entity) - Base for all domain entities
   - #368 (Domain Events) - Core DDD pattern

2. **Core Patterns (Tier 2)**:
   - #370 (Aggregate Root) - DDD central concept
   - #371 (Specifications) - Query encapsulation
   - #372 (Business Rules) - Domain validation

3. **Integration (Tier 3)**:
   - #373 (Integration Events) - Cross-boundary communication
   - #374 (Strongly Typed IDs) - Type safety
   - #376 (Auditing) - Compliance requirement

4. **Infrastructure (Tier 4)**:
   - #375 (Soft Delete) - Data retention
   - #377 (Domain Service) - Complex operations
   - #380 (Generic Repository) - Data access abstraction

5. **Advanced (Tier 5 - Nice-to-have)**:
   - #378 (ACL) - External system integration
   - #379 (Bounded Context) - Large system organization
   - #381 (Fluent DSL) - Developer experience enhancement

---

### December 29 (Session 3) - Microservices Architecture Patterns Research

**Research Focus**: What microservices patterns are missing from Encina and most demanded by the .NET community in 2025?

**Research Methodology**:
1. Analyzed current Encina INVENTORY.md to identify existing microservices capabilities
2. Conducted web research on latest trends in MassTransit, Wolverine, NServiceBus, Dapr, Orleans
3. Reviewed community discussions, Stack Overflow, GitHub issues, Reddit r/dotnet
4. Analyzed patterns from Netflix, Uber, Stripe, and other scale companies
5. Cross-referenced with Enterprise Integration Patterns (EIP) and DDD best practices

**Key Findings**:

| Pattern | Current Status | Community Demand | Recommendation |
|---------|---------------|------------------|----------------|
| Service Discovery | ❌ Missing | Very High | CRITICAL - Add immediately |
| BFF / API Gateway | ❌ Missing | Very High | CRITICAL - Essential for modern arch |
| Domain vs Integration Events | ⚠️ Partial | High | CRITICAL - Improve abstractions |
| Multi-Tenancy | ⚠️ Partial | High | HIGH - SaaS-critical |
| Anti-Corruption Layer | ❌ Missing | High | HIGH - Legacy integration |
| Dapr Integration | ❌ Deprecated | High | HIGH - Restore (CNCF graduated) |
| Virtual Actors (Orleans) | ❌ Missing | Medium-High | MEDIUM - Specific use cases |
| API Versioning | ⚠️ Partial | Medium | MEDIUM - API evolution |
| Enhanced Deduplication | ⚠️ Partial | Medium | MEDIUM - Inbox improvement |
| Sidecar Pattern | ❌ Missing | Medium | MEDIUM - Kubernetes-native |
| Process Manager | ⚠️ Partial (Saga) | Medium | MEDIUM - Hybrid pattern |
| Eventual Consistency | ❌ Missing | Low-Medium | LOW - Nice-to-have |

**Sources Consulted**:
- [Microsoft Microservices Patterns](https://learn.microsoft.com/en-us/azure/architecture/microservices/design/patterns)
- [Wolverine for MediatR Users](https://jeremydmiller.com/2025/01/28/wolverine-for-mediatr-users/)
- [Dapr CNCF Blog](https://www.cncf.io/blog/2025/12/09/building-microservices-the-easy-way-with-dapr/)
- [Orleans Virtual Actors](https://visualstudiomagazine.com/articles/2025/12/16/busy-net-developers-guide-to-orleans.aspx)
- [Code-Maze: Rebus vs NServiceBus vs MassTransit](https://code-maze.com/aspnetcore-comparison-of-rebus-nservicebus-and-masstransit/)
- [Multi-Tenant Architecture 2025](https://www.aalpha.net/blog/multi-tenant-architecture-in-microservices/)
- [Idempotency Best Practices 2025](https://medium.com/@chinmayshringi4/why-idempotency-is-critical-for-reliable-modern-systems-in-2025-ea591a466aa0)

**Issues Created** (12 new issues: #382-#393):

| Issue | Pattern | Priority | Complexity | Key Labels |
|-------|---------|----------|------------|------------|
| #382 | Service Discovery | Critical | Medium | `foundational`, `new-package`, `area-service-discovery` |
| #383 | BFF / API Gateway | Critical | High | `pattern-bff`, `yarp-integration`, `new-package` |
| #384 | Domain vs Integration Events | Critical | Low | `area-domain-events`, `foundational` |
| #385 | Multi-Tenancy | High | High | `saas-essential`, `area-multi-tenancy`, `new-package` |
| #386 | Anti-Corruption Layer | High | Medium | `pattern-acl`, `area-interop`, `new-package` |
| #387 | Dapr Integration | High | Medium | `dapr-integration`, `kubernetes-native`, `new-package` |
| #388 | Virtual Actors (Orleans) | Medium | High | `orleans-integration`, `area-actors`, `new-package` |
| #389 | API Versioning | Medium | Low | `area-versioning`, `pattern-versioning` |
| #390 | Enhanced Deduplication | Medium | Low | `area-idempotency`, `area-pipeline` |
| #391 | Sidecar/Ambassador | Medium | Medium | `pattern-sidecar`, `kubernetes-native`, `new-package` |
| #392 | Process Manager | Medium | Medium | `pattern-process-manager`, `area-saga` |
| #393 | Eventual Consistency | Low | Medium | `area-concurrency`, `marten-integration` |

**New Labels Created** (10 new labels):

| Label | Description | Color |
|-------|-------------|-------|
| `area-service-discovery` | Service discovery and registry patterns | #00CED1 |
| `area-configuration` | Configuration management and externalization | #708090 |
| `orleans-integration` | Microsoft Orleans integration | #512BD4 |
| `dapr-integration` | Dapr runtime integration | #0D2192 |
| `yarp-integration` | Microsoft YARP reverse proxy integration | #512BD4 |
| `consul-integration` | HashiCorp Consul integration | #CA2171 |
| `aspire-integration` | .NET Aspire integration | #512BD4 |
| `kubernetes-native` | Kubernetes-native patterns and deployment | #326CE5 |
| `pattern-sidecar` | Sidecar and Ambassador patterns | #326CE5 |
| `pattern-bff` | Backend for Frontend pattern | #20B2AA |

**Proposed Package Structure** (16 new packages):

```text
Encina.ServiceDiscovery                  # Service discovery abstractions
├── Encina.ServiceDiscovery.Consul       # HashiCorp Consul backend
├── Encina.ServiceDiscovery.Kubernetes   # Kubernetes DNS/API backend
└── Encina.ServiceDiscovery.Aspire       # .NET Aspire integration

Encina.BFF                               # BFF/API Gateway abstractions
├── Encina.BFF.YARP                      # Microsoft YARP integration
└── Encina.BFF.Aggregation               # Response aggregation

Encina.MultiTenancy                      # Multi-tenancy core
└── Encina.MultiTenancy.EntityFrameworkCore  # EF Core tenant filtering

Encina.AntiCorruption                    # Anti-Corruption Layer pattern

Encina.Dapr                              # Dapr core integration
├── Encina.Dapr.StateStore               # Dapr State Store as persistence
└── Encina.Dapr.PubSub                   # Dapr Pub/Sub as transport

Encina.Actors                            # Actor abstractions
└── Encina.Orleans                       # Orleans integration

Encina.Sidecar                           # Sidecar pattern support
```

**Key Decision: Dapr Re-Planning**:

Dapr was previously deprecated with the rationale "Infrastructure concerns belong at platform level". However, research showed:
- Dapr graduated as a CNCF project (October 2024)
- Dapr is the most recommended microservices framework in 2025 community discussions
- Provides building blocks, not just infrastructure concerns
- High integration potential with Encina's Saga, Outbox, and transport patterns
- Strong .NET support via Dapr.Client NuGet package

**Decision**: Re-plan Dapr integration (Issue #387) with:
- State Store as alternative backend for Outbox/Inbox/Saga stores
- Pub/Sub as message transport option
- Workflows as Saga orchestration backend
- Actors integration

**Documentation Updated**:
- `docs/INVENTORY.md` - Added complete "Microservices Architecture Patterns" section
- `ROADMAP.md` - Added Microservices patterns to Phase 2, updated Dapr deprecation note
- `CHANGELOG.md` - Added 12 new features with detailed descriptions

**Issue Statistics Update**:

| Metric | Before | After |
|--------|--------|-------|
| Issues Phase 2 (Domain Modeling) | 15 (#367-#381) | 15 (#367-#381) |
| Issues Phase 2 (Microservices) | 0 | 12 (#382-#393) |
| Total Phase 2 Issues | 186 | 198 |
| Planned New Packages | 100+ | 116+ (+16 new) |
| Total Labels | 164 | 174 (+10 new) |

**Implementation Priority (Microservices)**:

1. **Immediate (Critical - Foundational)**:
   - #382 Service Discovery - Fundamental pattern missing
   - #383 BFF/API Gateway - Very high demand 2025
   - #384 Domain vs Integration Events - DDD architecture

2. **Short Term (High - Enterprise/SaaS)**:
   - #385 Multi-Tenancy - SaaS-critical
   - #386 Anti-Corruption Layer - Legacy integration
   - #387 Dapr Integration - CNCF leader

3. **Medium Term (Medium - Advanced Patterns)**:
   - #388 Orleans/Actors - High concurrency
   - #389-#392 Various pipeline improvements

4. **Long Term (Low - Nice-to-Have)**:
   - #393 Eventual Consistency helpers

---

### December 29 (Session 4) - Security Patterns Research

**Research Focus**: What security patterns are missing from Encina and most demanded by the .NET community in 2025 for enterprise applications?

**Research Sources**:
- Spring Security architecture and features
- NestJS Guards and Interceptors
- MediatR authorization patterns
- OWASP Top 10 2021 and Cheat Sheet Series
- Netflix security patterns
- Microsoft Security Best Practices
- NIST Cybersecurity Framework
- Stripe/Uber security implementations
- r/dotnet and Stack Overflow discussions (December 2025)

**Existing Implementation Analysis**:
- Found only `AuthorizationPipelineBehavior` in `Encina.AspNetCore`
- Uses ASP.NET Core's built-in `IAuthorizationService` with `[Authorize]` attributes
- No field-level encryption, PII masking, audit trail, or OWASP-specific validation

**Issues Created**: `#394`, `#395`, `#396`, `#397`, `#398`, `#399`, `#400`, `#401`

| Issue | Pattern | Priority | Complexity |
|-------|---------|----------|------------|
| #394 | Security Core (RBAC/ABAC/Permissions) | Critical | High |
| #395 | Audit Trail Logging | Critical | High |
| #396 | Field-Level Encryption | High | High |
| #397 | PII Masking | High | Medium |
| #398 | Anti-Tampering (HMAC/RSA) | High | Medium |
| #399 | Input Sanitization (OWASP) | High | Medium |
| #400 | Secrets Management | Medium | High |
| #401 | ABAC Engine | Medium | Very High |

**New Labels Created**:
| Label | Description | Color |
|-------|-------------|-------|
| `area-security` | Security patterns and authentication/authorization | #B22222 |
| `owasp-pattern` | Based on OWASP security best practices | #DC143C |

**Packages Planned** (11 new):
```text
Encina.Security                          # Core security abstractions
├── Encina.Security.Audit                # Audit trail logging
├── Encina.Security.Encryption           # Field-level encryption
├── Encina.Security.PII                  # PII masking
├── Encina.Security.AntiTampering        # Request signing
├── Encina.Security.Sanitization         # Input/output sanitization
├── Encina.Security.Secrets              # Secrets management core
│   ├── Encina.Security.Secrets.AzureKeyVault
│   ├── Encina.Security.Secrets.AwsSecretsManager
│   └── Encina.Security.Secrets.HashiCorpVault
└── Encina.Security.ABAC                 # Attribute-Based Access Control
```

**Key Design Decisions**:

1. **Pipeline Behavior First**: All security patterns implemented as pipeline behaviors for declarative configuration
2. **Attribute-Based**: `[Authorize]`, `[Encrypt]`, `[PII]`, `[Sanitize]`, `[Auditable]` for opt-in security
3. **Cloud-Agnostic**: Support for Azure Key Vault, AWS KMS, HashiCorp Vault, GCP Secret Manager
4. **OWASP Alignment**: Sanitization patterns based on OWASP Input Validation Cheat Sheet
5. **Crypto-Shredding Ready**: Encryption pattern supports GDPR "right to be forgotten" via key deletion

---

### December 29 (Session 5) - Compliance Patterns Research (GDPR & EU Laws)

**Research Focus**: What compliance patterns are needed to ensure 100% GDPR and EU regulation compliance for distributed architectures where data may circulate through multiple servers, potentially outside the EU?

**Research Sources**:
- GDPR Official Text (Articles 5-49)
- European Data Protection Board (EDPB) Guidelines
- Schrems II Decision (C-311/18) implications
- NIS2 Directive (EU 2022/2555)
- EU AI Act (EU 2024/1689)
- UK ICO Guidance
- CNIL (France) Best Practices
- OneTrust GDPR Resources
- Privacy by Design 7 Foundational Principles
- ENISA Pseudonymization Techniques
- r/dotnet, r/gdpr, Stack Overflow (December 2025)

**Key Compliance Concepts Identified**:
- **Data Subject Rights** (Arts. 15-22): Access, Rectification, Erasure, Portability, Restriction, Objection
- **Consent Management** (Art. 7): Explicit, granular, withdrawable, versioned consent
- **Data Residency vs Sovereignty**: Physical location vs legal jurisdiction
- **Record of Processing Activities (RoPA)** (Art. 30): Mandatory documentation
- **Breach Notification** (Arts. 33-34): 72-hour DPA notification, subject notification for high-risk
- **Privacy by Design** (Art. 25): Default privacy, data minimization
- **Data Protection Impact Assessment (DPIA)** (Art. 35): High-risk processing assessment
- **Cross-Border Transfers** (Chapter V): SCCs, BCRs, adequacy decisions
- **Pseudonymization** (Art. 4(5)): Reversible with key, crypto-shredding

**Existing Implementation Analysis**:
- Found Retention references in Dead Letter and Inbox patterns
- No GDPR-specific abstractions, consent management, or data subject rights handling
- No data residency enforcement or cross-border transfer validation

**Issues Created**: `#402` through `#415` (14 issues)

| Issue | Pattern | GDPR Article | Priority | Complexity |
|-------|---------|--------------|----------|------------|
| #402 | GDPR Core (RoPA) | Art. 30 | Critical | High |
| #403 | Consent Management | Art. 7 | Critical | High |
| #404 | Data Subject Rights | Arts. 15-22 | Critical | Very High |
| #405 | Data Residency | Chapter V, Schrems II | Critical | Very High |
| #406 | Retention Policies | Art. 5(1)(e) | High | High |
| #407 | Anonymization | Art. 4(5) | High | High |
| #408 | Breach Notification | Arts. 33-34 | High | High |
| #409 | DPIA Automation | Art. 35 | Medium | High |
| #410 | Processor Agreements | Art. 28 | Medium | Medium |
| #411 | Privacy by Design | Art. 25 | Medium | Medium |
| #412 | Cross-Border Transfer | Chapter V | Medium | High |
| #413 | Lawful Basis | Art. 6 | Medium | Medium |
| #414 | NIS2 Directive | EU 2022/2555 | Medium | Very High |
| #415 | EU AI Act | EU 2024/1689 | Medium | Very High |

**New Labels Created** (6 new):
| Label | Description | Color |
|-------|-------------|-------|
| `area-compliance` | Regulatory compliance patterns (GDPR, NIS2, AI Act) | #4B0082 |
| `eu-regulation` | Related to European Union regulations | #4169E1 |
| `pattern-data-masking` | Data masking and PII protection | #9370DB |
| `pattern-consent-management` | Consent management and tracking | #9370DB |
| `pattern-data-sovereignty` | Data residency and sovereignty | #9370DB |
| `area-data-protection` | Data protection and privacy features | #4B0082 |

**Packages Planned** (14 new):
```text
Encina.Compliance.GDPR                   # Core GDPR abstractions
├── Encina.Compliance.Consent            # Consent management
├── Encina.Compliance.DataSubjectRights  # Arts. 15-22 rights
├── Encina.Compliance.DataResidency      # Data sovereignty
├── Encina.Compliance.Retention          # Data lifecycle
├── Encina.Compliance.Anonymization      # Pseudonymization
├── Encina.Compliance.BreachNotification # 72-hour notification
├── Encina.Compliance.DPIA               # Impact assessment
├── Encina.Compliance.ProcessorAgreements# Art. 28 DPA
├── Encina.Compliance.PrivacyByDesign    # Art. 25 enforcement
├── Encina.Compliance.CrossBorderTransfer# SCCs, BCRs
├── Encina.Compliance.LawfulBasis        # Art. 6 tracking
├── Encina.Compliance.NIS2               # Cybersecurity directive
└── Encina.Compliance.AIAct              # AI governance
```

**Key Design Decisions**:

1. **Pipeline Behaviors**: All compliance checks implemented as behaviors for automatic enforcement
2. **Attribute-Based**: `[RequireConsent("purpose")]`, `[DataResidency("EU")]`, `[Anonymize]`
3. **Crypto-Shredding**: Delete encryption key = data is "forgotten" (Art. 17 support)
4. **Multi-Region Routing**: `DataResidencyPipelineBehavior` for automatic geo-routing
5. **SLA Monitoring**: 30-day deadline tracking for Data Subject Rights requests
6. **Cloud Provider Mapping**: AWS, Azure, GCP region mapping for residency enforcement

**Label Updates for Session Issues**:

After creating the 22 issues (#394-#415), labels were updated based on new labels discovered in the repository (now 184+ labels):

| Issue | Additional Labels Added |
|-------|------------------------|
| #394 | `area-authentication`, `area-authorization`, `area-pipeline`, `industry-best-practice`, `owasp-pattern`, `aot-compatible` |
| #395 | `area-pipeline`, `industry-best-practice`, `area-auditing`, `area-gdpr`, `eu-regulation` |
| #396 | `area-encryption`, `area-pipeline`, `industry-best-practice`, `owasp-pattern`, `area-gdpr`, `area-data-protection`, `pattern-crypto-shredding` |
| #397 | `area-pipeline`, `industry-best-practice`, `area-gdpr`, `area-data-protection`, `pattern-data-masking`, `eu-regulation` |
| #398-#399 | `area-pipeline`, `industry-best-practice`, `owasp-pattern` |
| #400 | `area-pipeline`, `industry-best-practice`, `cloud-azure`, `cloud-gcp`, `area-cloud-native` |
| #401 | `area-authorization`, `area-pipeline`, `industry-best-practice`, `netflix-pattern`, `area-cloud-native` |
| #402-#413 | `area-gdpr`, `eu-regulation`, `area-data-protection`, and pattern-specific labels |
| #414 | `eu-regulation`, `area-data-protection`, `owasp-pattern`, `area-cloud-native` |
| #415 | `eu-regulation`, `area-data-protection`, `area-ai-ml`, `industry-best-practice` |

**Documentation Updated**:
- `docs/INVENTORY.md` - Added "Security Patterns" and "Compliance Patterns (GDPR & EU Laws)" sections
- `ROADMAP.md` - Added Security and Compliance patterns to Phase 2
- `CHANGELOG.md` - Added 22 new features with detailed descriptions
- `docs/history/2025-12.md` - Added Sessions 4 and 5 documentation

**Issue Statistics Update**:

| Metric | Before | After |
|--------|--------|-------|
| Issues Phase 2 (Microservices) | 12 (#382-#393) | 12 (#382-#393) |
| Issues Phase 2 (Security) | 0 | 8 (#394-#401) |
| Issues Phase 2 (Compliance) | 0 | 14 (#402-#415) |
| Total Phase 2 Issues | 198 | 220 |
| Planned New Packages | 116+ | 141+ (+25 new) |
| Total Labels | 174 | 182+ (+8 new) |

**Implementation Priority (Security)**:

1. **Immediate (Critical - Foundation)**:
   - #394 Security Core - Base abstractions
   - #395 Audit - Universal compliance requirement

2. **Short Term (High - Data Protection)**:
   - #396 Encryption - Sensitive data
   - #397 PII - GDPR essential
   - #398 AntiTampering - API security
   - #399 Sanitization - OWASP Top 10

3. **Medium Term (Medium - Advanced)**:
   - #400 Secrets - Cloud-native
   - #401 ABAC - Enterprise authorization

**Implementation Priority (Compliance)**:

1. **Immediate (Critical - GDPR Foundation)**:
   - #402 GDPR Core - Base for all compliance
   - #403 Consent - Art. 7
   - #404 DataSubjectRights - Arts. 15-22
   - #405 DataResidency - Schrems II

2. **Short Term (High - Data Lifecycle)**:
   - #406 Retention - Storage limitation
   - #407 Anonymization - Privacy by default
   - #408 BreachNotification - 72-hour requirement

3. **Medium Term (Medium - Advanced)**:
   - #409-#413 Various GDPR enhancements

4. **Long Term (Extensions)**:
   - #414 NIS2 - Cybersecurity directive
   - #415 AIAct - AI governance

---

### December 29 (Session 6) - .NET Aspire Integration Patterns Research

**Context**: Research into .NET Aspire ecosystem, community demands (from GitHub discussions, Reddit, StackOverflow), and integration opportunities for Encina. Analysis of Aspire Roadmap 2025-2026, Community Toolkit patterns, and successful integrations like MassTransit and Wolverine.

**Key Findings from Research**:
- Testing is "the largest gap" according to official Aspire roadmap (#10644)
- Dapr + Aspire is the most demanded combination for microservices
- Service Defaults centralize cross-cutting concerns (OpenTelemetry, health checks, resilience)
- Multi-repo support is "a popular community ask"
- MCP (Model Context Protocol) support added in Aspire 13.1 for AI agents

**New Issues Created** (10 total):

| Issue | Title | Priority | Complexity |
|-------|-------|----------|------------|
| #416 | Encina.Aspire.Hosting | Medium | High |
| #417 | Encina.Aspire.ServiceDefaults | **High** | Medium |
| #418 | Encina.Aspire.Testing | **High** | High |
| #419 | Encina.Aspire.Dashboard | Medium | Medium |
| #420 | Encina.Dapr | Medium | High |
| #421 | Encina.Aspire.Deployment | Low | High |
| #422 | Encina.Aspire.AI | Low | Very High |
| #423 | Modular Monolith Support | Medium | High |
| #424 | Multi-Repo Support | Medium | Medium |
| #425 | Hot Reload Support | Medium | Medium |

**New Labels Created**:

| Label | Description | Color |
|-------|-------------|-------|
| `area-aspire` | Aspire hosting, orchestration, and deployment | #512BD4 |
| `area-mcp` | Model Context Protocol and AI agent integration | #8B5CF6 |
| `area-hot-reload` | Hot reload and live code updates | #F59E0B |

**Labels Applied to Issues**:

| Issue | Key Labels |
|-------|------------|
| #416 | `aspire-integration`, `area-aspire`, `new-package`, `foundational`, `area-cloud-native`, `area-developer-experience`, `area-service-discovery` |
| #417 | `aspire-integration`, `area-aspire`, `new-package`, `foundational`, `industry-best-practice`, `area-health-checks`, `area-observability`, `area-resilience` |
| #418 | `aspire-integration`, `area-aspire`, `new-package`, `testing-integration`, `area-testing`, `area-developer-experience` |
| #419 | `aspire-integration`, `area-aspire`, `new-package`, `area-observability`, `area-health-checks`, `area-developer-experience` |
| #420 | `dapr-integration`, `new-package`, `pattern-sidecar`, `area-cloud-native`, `industry-best-practice`, `area-microservices`, `area-service-discovery` |
| #421 | `aspire-integration`, `area-aspire`, `new-package`, `kubernetes-native`, `cloud-azure`, `area-docker`, `area-ci-cd` |
| #422 | `aspire-integration`, `area-aspire`, `new-package`, `area-ai-ml`, `area-mcp`, `area-developer-experience` |
| #423 | `aspire-integration`, `area-aspire`, `area-modular-monolith`, `area-vertical-slice`, `area-module-system`, `industry-best-practice` |
| #424 | `aspire-integration`, `area-aspire`, `area-service-discovery`, `area-microservices`, `area-developer-experience` |
| #425 | `aspire-integration`, `area-aspire`, `area-hot-reload`, `area-developer-experience`, `area-performance` |

**New Packages Planned** (7):
- `Encina.Aspire.Hosting` - AppHost integration
- `Encina.Aspire.ServiceDefaults` - Service Defaults extension
- `Encina.Aspire.Testing` - Testing integration
- `Encina.Aspire.Dashboard` - Dashboard extensions
- `Encina.Dapr` - Dapr building blocks
- `Encina.Aspire.Deployment` - Deployment publishers
- `Encina.Aspire.AI` - AI/MCP integration

**Documentation Updated**:
- `docs/INVENTORY.md` - Added ".NET Aspire Integration Patterns" section (#416-#425)
- `ROADMAP.md` - Added Aspire integration to Phase 2 features
- `CHANGELOG.md` - Added 10 new Aspire features with detailed descriptions
- `docs/history/2025-12.md` - Added Session 6 documentation

**Issue Statistics Update**:

| Metric | Before | After |
|--------|--------|-------|
| Issues Phase 2 (Aspire) | 0 | 10 (#416-#425) |
| Total Phase 2 Issues | 220 | 230 |
| Planned New Packages | 141+ | 148+ (+7 new) |
| Total Labels | 182+ | 185+ (+3 new) |

**Implementation Priority (Aspire)**:

1. **Immediate (High Priority)**:
   - #417 ServiceDefaults - Centralizes cross-cutting concerns
   - #418 Testing - "Largest gap" per Aspire roadmap

2. **Short Term (Medium Priority)**:
   - #416 Hosting - Foundation for dashboard and commands
   - #420 Dapr - Most demanded Aspire combination
   - #419 Dashboard - Improves observability

3. **Medium Term (Medium Priority)**:
   - #423 Modular Monolith - Trending architecture 2025
   - #424 Multi-Repo - High enterprise demand
   - #425 Hot Reload - Developer experience

4. **Long Term (Low Priority)**:
   - #421 Deployment - azd already automates much
   - #422 AI - Experimental, roadmap 2026

**References Used**:
- [Aspire Roadmap 2025-2026](https://github.com/dotnet/aspire/discussions/10644)
- [Aspire End of Year Update December 2025](https://github.com/dotnet/aspire/discussions/13608)
- [Aspire Service Defaults](https://learn.microsoft.com/en-us/dotnet/aspire/fundamentals/service-defaults)
- [Aspire Community Toolkit](https://github.com/CommunityToolkit/Aspire)
- [Dapr + Aspire Integration](https://www.diagrid.io/blog/net-aspire-dapr-what-are-they-and-how-they-complement-each-other)
- [Booking Modular Monolith Example](https://github.com/meysamhadeli/booking-modular-monolith)
- [VerticalCleanModularMicroservices by Ardalis](https://github.com/ardalis/VerticalCleanModularMicroservices)

### December 29 (Continued) - TDD Patterns Research & Issues

**Focus**: Advanced TDD patterns research based on .NET community trends, leading testing libraries, and best practices for 2025.

**Issues Created**: 12 new issues (#426-#437) covering advanced testing patterns.

#### TDD Patterns Issues Summary

| Issue | Title | Priority | Complexity |
|-------|-------|----------|------------|
| **#426** | Encina.Testing.Fakes | Alta | Baja |
| **#427** | Encina.Testing.Respawn | Alta | Baja |
| **#428** | Encina.Testing.WireMock | Alta | Media |
| **#429** | Encina.Testing.Shouldly | Alta | Baja |
| **#430** | Encina.Testing.Verify | Media | Media |
| **#431** | Encina.Testing.Bogus | Media | Media |
| **#432** | Encina.Testing.Architecture | Media | Media |
| **#433** | FakeTimeProvider | Media | Baja |
| **#434** | BDD Specification Testing | Baja | Media |
| **#435** | Encina.Testing.FsCheck | Baja | Alta |
| **#436** | Encina.Testing.Pact | Baja | Alta |
| **#437** | Stryker.NET Configuration | Baja | Baja |

#### New Labels Created

| Label | Description | Color |
|-------|-------------|-------|
| `testing-property-based` | Property-based testing and invariant verification | #9B59B6 |
| `testing-contract` | Contract testing and consumer-driven contracts | #8E44AD |
| `testing-bdd` | Behavior-driven development and Given/When/Then patterns | #A569BD |
| `testing-time-control` | Time manipulation and FakeTimeProvider for testing | #7D3C98 |
| `testing-assertions` | Assertion libraries and fluent assertions | #6C3483 |
| `testing-database-reset` | Database cleanup and reset between tests | #5B2C6F |

#### New Packages Planned (9)

| Package | Issue | Description |
|---------|-------|-------------|
| `Encina.Testing.Fakes` | #426 | Test doubles for IEncina and messaging stores |
| `Encina.Testing.Respawn` | #427 | Database reset with Respawn integration |
| `Encina.Testing.WireMock` | #428 | HTTP API mocking |
| `Encina.Testing.Shouldly` | #429 | Open-source assertions (FluentAssertions alternative) |
| `Encina.Testing.Verify` | #430 | Snapshot testing integration |
| `Encina.Testing.Bogus` | #431 | Realistic test data generation |
| `Encina.Testing.Architecture` | #432 | Architecture testing with ArchUnitNET |
| `Encina.Testing.FsCheck` | #435 | Property-based testing extensions |
| `Encina.Testing.Pact` | #436 | Consumer-Driven Contract Testing |

#### High Priority Issues Detail

**#426 - Encina.Testing.Fakes**:
- `FakeEncina : IEncina` with configurable handlers
- `WithHandler<TRequest, TResponse>()`, `WithError<TRequest>()`
- Verification: `VerifySent<TRequest>(times)`, `VerifyPublished<TNotification>(times)`
- `FakeOutboxStore`, `FakeInboxStore`, `FakeSagaStore`, `FakeScheduledMessageStore`
- Thread-safe, in-memory implementations

**#427 - Encina.Testing.Respawn**:
- `RespawnDatabaseFixture<TContainer>` base class
- FK-aware deterministic deletion (3x faster than truncate)
- `ResetDatabaseAsync()` for fast test isolation
- Integration with existing Testcontainers fixtures
- Providers: SQL Server, PostgreSQL, MySQL, Oracle, SQLite

**#428 - Encina.Testing.WireMock**:
- `EncinaWireMockFixture : IAsyncLifetime`
- Fluent stubbing: `StubGet()`, `StubPost()`, `StubFault()`, `StubDelay()`
- `FaultType`: ConnectionReset, EmptyResponse, MalformedResponse, Timeout
- Verification: `VerifyCallMade()`, `VerifyNoCallsMade()`, `GetReceivedRequests()`

**#429 - Encina.Testing.Shouldly**:
- Open-source alternative to FluentAssertions (commercial license since Jan 2025)
- `ShouldBeSuccess()`, `ShouldBeError()` for `Either<EncinaError, T>`
- EncinaError-specific: `ShouldBeValidationError()`, `ShouldBeNotFoundError()`
- Collection assertions: `ShouldAllBeSuccess()`, `ShouldAllBeError()`
- Async support: `ShouldBeSuccessAsync()`, `ShouldBeErrorAsync()`

#### Research Sources

**Community Trends .NET 2025**:
- [FluentAssertions licensing change](https://towardsdev.com/should-you-pay-for-fluentassertions-a-comparison-with-shouldly-ed59e142e850)
- [Microsoft .NET Testing Best Practices](https://learn.microsoft.com/en-us/dotnet/core/testing/unit-testing-best-practices)
- [Testcontainers Best Practices](https://www.milanjovanovic.tech/blog/testcontainers-best-practices-dotnet-integration-testing)
- [Stryker.NET Mutation Testing](https://stryker-mutator.io/docs/stryker-net/introduction/)

**Leading Libraries Analyzed**:
- [Verify](https://github.com/VerifyTests/Verify) - 2.5K+ stars, de-facto snapshot testing
- [Bogus](https://github.com/bchavez/Bogus) - 8K+ stars, realistic data generation
- [Respawn](https://github.com/jbogard/Respawn) - 1.5K+ stars, intelligent DB reset
- [WireMock.NET](https://github.com/wiremock/WireMock.Net) - 1.3K+ stars, HTTP mocking
- [Shouldly](https://github.com/shouldly/shouldly) - 2K+ stars, readable assertions
- [ArchUnitNET](https://github.com/TNG/ArchUnitNET) - 800+ stars, architecture testing
- [FsCheck](https://fscheck.github.io/FsCheck/) - 1.1K+ stars, property-based testing
- [PactNet](https://github.com/pact-foundation/pact-net) - 800+ stars, contract testing

**Frameworks Inspiring Design**:
- MediatR testing patterns
- MassTransit test harness
- Wolverine test support
- Vertical Slice Architecture testing (mehdihadeli/tdd-sample)

**Issue Statistics Update**:

| Metric | Before | After |
|--------|--------|-------|
| Issues Phase 2 (TDD Patterns) | 13 | 25 (+12 new: #426-#437) |
| Total Phase 2 Issues | 230 | 242 |
| Planned New Packages | 148+ | 157+ (+9 new) |
| Total Labels | 185+ | 191+ (+6 new) |

**Implementation Priority (TDD Patterns)**:

1. **Immediate (High Priority)**:
   - #426 Fakes - Foundational for unit testing
   - #427 Respawn - Essential for integration testing
   - #428 WireMock - External API testing
   - #429 Shouldly - Open-source assertions

2. **Short Term (Medium Priority)**:
   - #430 Verify - Snapshot testing
   - #431 Bogus - Data generation
   - #432 Architecture - Rules enforcement
   - #433 FakeTimeProvider - Time control

3. **Medium Term (Low Priority)**:
   - #434 BDD Specs - Handler testing
   - #435 FsCheck - Property-based testing
   - #436 Pact - Contract testing
   - #437 Stryker - Mutation testing

---

### December 29 (Session 7) - Developer Tooling & DX Research

**Focus**: Research into developer experience improvements based on community feedback, competitor analysis (Wolverine, MassTransit, Hangfire), and modern .NET tooling trends.

**Issues Created**: 11 new issues (#438-#448) covering developer tooling and DX.

#### Developer Tooling Issues Summary

| Issue | Title | Priority | Complexity | New Package |
|-------|-------|----------|------------|-------------|
| **#438** | Roslyn Analyzers & Code Fixes | Alta | Alta | `Encina.Analyzers` |
| **#439** | Saga Visualizer | Media | Media | - |
| **#440** | .NET Aspire Integration | Alta | Media | `Encina.Aspire`, `Encina.Aspire.Hosting` |
| **#441** | Enhanced Exception Formatting | Media | Baja | `Encina.Diagnostics` |
| **#442** | Hot Reload Support | Media | Media | - |
| **#443** | AI-Ready Request Tracing | Media | Media | - |
| **#444** | Enhanced Testing Fixtures | Media | Media | - |
| **#445** | Developer Dashboard | Alta | Alta | `Encina.Dashboard` |
| **#446** | OpenAPI Integration | Media | Media | `Encina.OpenApi` |
| **#447** | Dev Containers Support | Baja | Baja | - |
| **#448** | Interactive Documentation | Baja | Media | - |

#### New Labels Created (6)

| Label | Description | Color |
|-------|-------------|-------|
| `area-analyzers` | Roslyn analyzers and code fixes | #5C2D91 |
| `area-visualization` | Visualization and diagram generation | #9B59B6 |
| `area-dashboard` | Developer dashboard and monitoring UI | #E74C3C |
| `area-diagnostics` | Diagnostics, error formatting, and debugging aids | #E67E22 |
| `area-devcontainers` | Dev Containers and Codespaces support | #0DB7ED |
| `area-documentation-site` | Documentation website and interactive docs | #3498DB |

#### New Packages Planned (6)

| Package | Issue | Description |
|---------|-------|-------------|
| `Encina.Analyzers` | #438 | Roslyn analyzers (ENC001-ENC010) and code fixes |
| `Encina.Aspire` | #440 | .NET Aspire integration |
| `Encina.Aspire.Hosting` | #440 | AppHost resource integration |
| `Encina.Dashboard` | #445 | Developer dashboard web UI (Hangfire-style) |
| `Encina.Diagnostics` | #441 | Exception formatting and pretty-print |
| `Encina.OpenApi` | #446 | OpenAPI spec auto-generation |

#### High Priority Issues Detail

**#438 - Encina.Analyzers**:
- 10+ Roslyn analyzers: ENC001 (CancellationToken), ENC002 (Validator missing), ENC003 (Saga compensation)
- Code fixes: generate handler skeleton, add CancellationToken, implement IIdempotentRequest
- Compatible with NativeAOT and Source Generators
- Configurable severity via `.editorconfig`
- Inspiration: Roslynator, awesome-analyzers

**#440 - Encina.Aspire**:
- `EncinaResource` as first-class Aspire resource
- Dashboard panel for Outbox, Inbox, Sagas, Cache
- Health checks automatically registered
- OTLP pre-configured for traces and metrics
- Service discovery integration

**#445 - Developer Dashboard**:
- Local web UI for development debugging
- Panels: Handlers, Pipeline, Outbox, Inbox, Sagas, Cache, Errors
- Real-time updates via SignalR
- Actions: Retry Outbox, Cancel Saga, Invalidate Cache
- Authentication optional for production safety
- Inspiration: Hangfire Dashboard, Aspire Dashboard

#### Medium Priority Issues Detail

**#439 - Saga Visualizer**:
- Generate diagrams from saga definitions
- Formats: Mermaid, Graphviz (DOT), PlantUML
- Runtime state highlighting
- CLI: `encina visualize saga <SagaName> --output mermaid`

**#441 - Enhanced Exception Formatting**:
- Pretty-print for `EncinaError` with box-drawing characters
- Demystified stack traces (Ben.Demystifier-inspired)
- Validation errors grouped by property
- ANSI colors with plain text fallback
- Spectre.Console integration optional

**#442 - Hot Reload Support**:
- Integration with `MetadataUpdateHandler.ClearCache`
- Pipeline cache invalidation
- Handler registry refresh
- Development-only (no production impact)

**#443 - AI-Ready Request Tracing**:
- Automatic request/response serialization in traces
- PII redaction: `[Trace(RedactProperties = ["CreditCard", "SSN"])]`
- AI-compatible JSON export format
- Sampling strategies: errors always, slow requests, random rate

**#444 - Enhanced Testing Fixtures**:
- `EncinaTestFixture` fluent builder
- Either assertions: `ShouldBeSuccess()`, `ShouldBeError()`
- Time-travel for sagas: `AdvanceTimeBy(TimeSpan.FromHours(24))`
- Outbox assertions: `OutboxShouldContain<OrderCreatedEvent>()`
- Snapshot testing integration with Verify

**#446 - OpenAPI Integration**:
- Auto-generate OpenAPI spec from Commands/Queries
- `app.MapEncinaEndpoints()` for endpoint generation
- FluentValidation constraints → OpenAPI schema
- OpenAPI 3.1 support (.NET 10)

#### Research Sources

**Competitor Analysis**:
- [Wolverine DX](https://wolverine.netlify.app/) - Zero-config, hot reload, diagnostics
- [MassTransit Saga Visualizer](https://github.com/MassTransit/MassTransit/discussions/3411)
- [Hangfire Dashboard](https://www.hangfire.io/)
- [.NET Aspire Dashboard](https://aspire.dev/)

**Roslyn Analyzers**:
- [Roslynator](https://github.com/dotnet/roslynator)
- [awesome-analyzers](https://github.com/cybermaxs/awesome-analyzers)
- [How to write a Roslyn Analyzer](https://learn.microsoft.com/en-us/dotnet/csharp/roslyn-sdk/)

**Developer Experience Patterns**:
- [Ben.Demystifier](https://github.com/benaadams/Ben.Demystifier)
- [elmah.io Stack Trace Formatter](https://elmah.io/tools/stack-trace-formatter/)
- [FluentAssertions](https://fluentassertions.com/)
- [Verify Snapshot Testing](https://github.com/VerifyTests/Verify)

#### Issue Statistics Update

| Metric | Before | After |
|--------|--------|-------|
| Issues Phase 2 (Developer Tooling) | 0 | 11 (+11 new: #438-#448) |
| Total Phase 2 Issues | 242 | 253 |
| Planned New Packages | 157+ | 163+ (+6 new) |
| Total Labels | 191+ | 197+ (+6 new) |

#### Implementation Priority (Developer Tooling)

1. **Immediate (High Priority)**:
   - #438 Analyzers - Compile-time error detection
   - #440 Aspire - Modern .NET stack integration
   - #445 Dashboard - Development visibility

2. **Short Term (Medium Priority)**:
   - #441 Diagnostics - Low complexity, high impact
   - #444 Testing Fixtures - Testing DX
   - #439 Saga Visualizer - Documentation/debugging

3. **Medium Term (Medium Priority)**:
   - #442 Hot Reload - Inner loop improvement
   - #443 AI Tracing - Modern debugging
   - #446 OpenAPI - API-first development

4. **Long Term (Low Priority)**:
   - #447 Dev Containers - Onboarding
   - #448 Documentation - Community growth

---

### December 29 (Session 8) - Cloud-Native Patterns Research

**Research Focus**: Investigation of cloud-native patterns and integrations essential for modern Kubernetes and cloud deployments. Analyzed .NET Aspire, Dapr, Kubernetes patterns, and SaaS enablers.

**Research Sources**:
- [.NET Aspire Documentation](https://learn.microsoft.com/en-us/dotnet/aspire/)
- [Dapr .NET Integration](https://docs.dapr.io/developing-applications/sdks/dotnet/)
- [Dapr + Aspire Integration](https://www.diagrid.io/blog/net-aspire-dapr-what-are-they-and-how-they-complement-each-other)
- [Kubernetes Health Probes](https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/)
- [.NET Graceful Shutdown in Kubernetes](https://github.com/dotnet/dotnet-docker/blob/main/samples/kubernetes/graceful-shutdown/graceful-shutdown.md)
- [Multi-Tenancy Patterns Azure](https://learn.microsoft.com/en-us/azure/architecture/guide/saas-multitenant-solution-architecture/)
- [Outbox CDC Debezium](https://debezium.io/blog/2019/02/19/reliable-microservices-data-exchange-with-the-outbox-pattern/)
- [Microsoft Orleans](https://learn.microsoft.com/en-us/dotnet/orleans/)
- [HashiCorp Consul Service Discovery](https://developer.hashicorp.com/consul/docs/use-case/service-discovery)
- [Feature Flag Tools 2025](https://www.flagsmith.com/blog/top-7-feature-flag-tools)
- [Secrets Management Tools 2025](https://www.pulumi.com/blog/secrets-management-tools-guide/)

**Issues Created** (11 new):

| Issue | Title | Priority | Complexity | New Packages |
|-------|-------|----------|------------|--------------|
| #449 | Encina.Aspire | High | Medium | 1 |
| #450 | Encina.Dapr | High | High | 1 |
| #451 | Encina.FeatureFlags | Medium | Medium | 5 (providers) |
| #452 | Encina.Secrets | Medium | Low | 4 (providers) |
| #453 | Encina.ServiceDiscovery | Medium | Medium | 3 (providers) |
| #454 | Encina.HealthChecks | Medium | Low | 1 |
| #455 | Encina.GracefulShutdown | Medium | Low | 1 |
| #456 | Encina.MultiTenancy | Medium | High | 1 |
| #457 | Encina.CDC | Low | High | 3 (providers) |
| #458 | Encina.ApiVersioning | Low | Medium | 1 |
| #459 | Encina.Orleans | Low | High | 1 |

#### Key Patterns Identified

**#449 - Encina.Aspire** (.NET Aspire Integration):
- `AddEncinaAspireDefaults()` extension method
- Service Discovery for distributed handlers
- OpenTelemetry pre-configured for pipeline
- Health checks for Outbox, Inbox, Sagas
- Aspire Dashboard integration

**#450 - Encina.Dapr** (Dapr Building Blocks):
- `DaprSagaStore`, `DaprOutboxStore`, `DaprInboxStore` via Dapr State API
- `DaprOutboxPublisher` via Dapr Pub/Sub (any broker)
- `DaprDistributedLockProvider` via Dapr Lock API
- Cloud-agnostic: same code on AWS, Azure, GCP, on-prem
- Secrets injection via `[DaprSecret]` attribute

**#451 - Encina.FeatureFlags** (Feature Flags):
- `IFeatureFlagProvider` abstraction
- `[Feature("key")]` attribute for handler injection
- Providers: ConfigCat, LaunchDarkly, Azure App Configuration, OpenFeature
- Caching with configurable TTL
- IRequestContext integration for targeting

**#452 - Encina.Secrets** (Secrets Management):
- `ISecretsProvider` abstraction
- `[Secret("key")]` attribute for DI injection
- Providers: Azure Key Vault, AWS Secrets Manager, HashiCorp Vault, Dapr
- Secret rotation monitoring (optional)

**#453 - Encina.ServiceDiscovery** (Service Discovery):
- `IServiceDiscoveryProvider` abstraction
- Load balancing: RoundRobin, Random, LeastConnections
- Providers: Kubernetes DNS, Consul, Aspire
- `IEncina.SendToService<>()` extension methods

**#454 - Encina.HealthChecks** (Kubernetes Health Probes):
- `OutboxHealthCheck`, `InboxHealthCheck`, `SagaHealthCheck`, `HandlerHealthCheck`
- Separate endpoints: `/health/live`, `/health/ready`, `/health/startup`
- Configurable thresholds per check

**#455 - Encina.GracefulShutdown** (K8s Graceful Termination):
- `IInFlightRequestTracker` for active request tracking
- `InFlightTrackingBehavior` pipeline behavior
- Pre-stop delay, Outbox flush before shutdown

**#456 - Encina.MultiTenancy** (Multi-Tenancy):
- Tenant resolution: Header, Subdomain, Route, Claim, Custom
- Data isolation: Row, Schema, Database
- Tenant-aware stores for all messaging patterns
- GDPR data residency support

**#457 - Encina.CDC** (Change Data Capture):
- `ICdcProvider` abstraction
- Providers: SQL Server CDC, PostgreSQL Logical, Debezium
- Near real-time, minimal database load

**#458 - Encina.ApiVersioning** (Handler Versioning):
- `[ApiVersion("1.0")]` attribute
- Version resolution: Header, Query, Path, MediaType
- Deprecation with Sunset header

**#459 - Encina.Orleans** (Orleans Integration):
- `IGrainHandler<,>` interface
- Saga grains with Orleans state and reminders
- Scheduling via grain timers

#### Labels Used

Existing labels applied:
- `kubernetes-native`, `aspire-integration`, `dapr-integration`, `orleans-integration`
- `area-health-checks`, `area-service-discovery`, `area-feature-flags`
- `cloud-aws`, `cloud-azure`, `cloud-gcp`
- `saas-essential`, `saas-enabler`
- `area-cdc`, `area-versioning`, `area-actors`
- `industry-best-practice`, `foundational`
- `consul-integration`, `area-multitenancy`, `area-gdpr`

#### Issue Statistics Update

| Metric | Before | After |
|--------|--------|-------|
| Issues Phase 2 (Cloud-Native) | 0 | 11 (+11 new: #449-#459) |
| Total Phase 2 Issues | 253 | 264 |
| Planned New Packages | 163+ | 185+ (+22 new) |

#### Implementation Priority (Cloud-Native)

1. **Immediate (High Priority)**:
   - #449 Aspire - Official Microsoft cloud-native stack
   - #450 Dapr - CNCF graduated, multi-cloud demand

2. **Short Term (Medium Priority)**:
   - #454 HealthChecks - Low complexity, K8s essential
   - #455 GracefulShutdown - Low complexity, K8s essential
   - #451 FeatureFlags - Progressive deployment

3. **Medium Term (Medium Priority)**:
   - #452 Secrets - Security best practice
   - #453 ServiceDiscovery - Microservices fundamental
   - #456 MultiTenancy - SaaS market

4. **Long Term (Low Priority)**:
   - #457 CDC - High complexity, polling alternative
   - #458 ApiVersioning - API evolution
   - #459 Orleans - High-concurrency niche

---

### December 29 (Session 2) - Clean Architecture Patterns Research

#### Context

After reviewing the current state of Encina's architecture patterns, a deep research was conducted on Clean Architecture patterns currently in high demand in the .NET community (December 2025). The research included:

- Community discussions on Reddit, .NET Blogs, and conferences
- Analysis of Wolverine 5.0 new features (Partitioned Sequential Messaging)
- Functional programming patterns in .NET (FluentResults, language-ext)
- Jimmy Bogard's Vertical Slice Architecture updates
- Ardalis.Specification and DDD building blocks

#### Issues Created (10 initially, 8 closed as duplicates)

Initial research identified 10 potential improvements for Clean Architecture patterns. Upon verification against existing issues, **8 were closed as duplicates** of previously planned features:

| Closed Issue | Duplicate Of | Pattern |
|-------------|--------------|---------|
| #460 | #367 | Value Objects Base Class |
| #461 | #374 | Strongly Typed IDs |
| #462 | #350 | Domain vs Integration Events |
| #463 | #347, #295 | Specification Pattern |
| #464 | #379, #477 | Bounded Context Boundaries |
| #465 | #365 | Vertical Slice Architecture |
| #466 | #377, #473 | Domain Services |
| #467 | #166, #432 | Architecture Tests |

#### New Unique Issues (2)

Two genuinely new patterns were identified and added:

| Issue | Pattern | Description | Priority | Complexity |
|-------|---------|-------------|----------|------------|
| **#468** | Result Pattern Extensions | Fluent API for `Either<EncinaError, T>`: Combine, Accumulate, async chains, HTTP conversion | Medium | Low |
| **#469** | Partitioned Sequential Messaging | Sequential processing per partition key (SagaId, TenantId) with parallel cross-partition | Medium | High |

##### #468 - Result Pattern Extensions (Either Fluent API)

Enhances Railway Oriented Programming ergonomics with:

- `EitherCombineExtensions`: Combine 2-5 results into tuples
- `EitherAccumulateExtensions`: Collect all errors instead of fail-fast
- `EitherAsyncExtensions`: `BindAsync()`, `MapAsync()`, `TapAsync()` for async chains
- `EitherHttpExtensions`: `ToProblemDetails()`, `ToActionResult()`, `ToResult()` for Minimal APIs
- `EitherConditionalExtensions`: `When()`, `Ensure()`, `OrElse()` for conditional logic

**Inspiration**: FluentResults, language-ext, CSharpFunctionalExtensions

##### #469 - Partitioned Sequential Messaging

Ensures messages with the same partition key (e.g., SagaId, TenantId, AggregateId) are processed sequentially, while different partitions process in parallel:

- `IPartitionedMessage` with `PartitionKey`
- Specialized: `ISagaPartitionedMessage`, `ITenantPartitionedMessage`, `IAggregatePartitionedMessage`
- `IPartitionedQueueManager` using System.Threading.Channels
- Optional `IPartitionStore` for durability

**Inspiration**: Wolverine 5.0 (August 2025), Actor Model pattern

#### New Labels Created (6)

| Label | Description | Color |
|-------|-------------|-------|
| `area-value-objects` | Value Objects and domain primitives | #2E8B57 |
| `area-strongly-typed-ids` | Strongly Typed IDs and identity patterns | #2E8B57 |
| `area-specification-pattern` | Specification pattern for queries | #2E8B57 |
| `area-domain-services` | Domain Services abstraction | #2E8B57 |
| `area-result-pattern` | Result/Either pattern and functional error handling | #9932CC |
| `area-bounded-context` | Bounded Context and module boundaries | #2E8B57 |

#### Documentation Updates

- `docs/INVENTORY.md` - Added "Clean Architecture Patterns - ROP Extensions" section with #468, #469
- `ROADMAP.md` - Added "Clean Architecture Patterns" section to Phase 2
- `CHANGELOG.md` - Added Clean Architecture Patterns to Unreleased section

#### Key Insights from Research

1. **Existing Coverage is Comprehensive**: Most Clean Architecture patterns were already planned in previous sessions (#367-#381 Domain Modeling, #345-#366 VSA/Modular Monolith)

2. **Gap Identified**: ROP ergonomics (`Either` extensions) were missing - now addressed in #468

3. **Wolverine Influence**: Partitioned Sequential Messaging (#469) is a cutting-edge pattern from Wolverine 5.0 that solves real concurrency issues in saga/multi-tenant scenarios

4. **Community Trends 2025**:
   - Functional programming in .NET continues growing
   - Vertical Slice Architecture mainstream adoption
   - Modular Monolith as microservices stepping stone
   - FluentAssertions license change driving Shouldly adoption

---

### December 29 (Session 3) - Hexagonal Architecture Patterns Research

**Research Focus**: Comprehensive investigation of Hexagonal Architecture (Ports & Adapters) patterns for Encina, covering .NET ecosystem trends, ABP Framework, Wolverine, Ardalis.Specification, and community demand analysis.

#### Research Methodology

1. **Codebase Analysis**: Reviewed existing Encina architecture and INVENTORY.md
2. **Framework Analysis**: ABP Framework, Wolverine, Ardalis.Specification, Clean Architecture templates
3. **Community Research**: Stack Overflow, Reddit r/dotnet, GitHub trending
4. **Documentation Review**: Microsoft Learn, AWS Prescriptive Guidance

#### Issues Created (10)

| Issue | Title | Priority | Complexity | Key Labels |
|-------|-------|----------|------------|------------|
| **#470** | Domain Events vs Integration Events Separation | Critical | Low | `foundational`, `area-domain-events`, `clean-architecture` |
| **#471** | Specification Pattern for Query Encapsulation | Critical | Medium | `ardalis-inspired`, `pattern-specification`, `foundational` |
| **#472** | Value Objects & Aggregate Base Classes | Critical | Medium | `area-value-objects`, `area-domain-modeling`, `foundational` |
| **#473** | Domain Services Abstraction | High | Low | `abp-inspired`, `area-domain-services`, `foundational` |
| **#474** | Anti-Corruption Layer (ACL) Pattern | High | Medium | `pattern-acl`, `area-hexagonal`, `area-integration` |
| **#475** | Ports & Adapters Factory Pattern | High | Medium | `area-ports-adapters`, `area-hexagonal`, `foundational` |
| **#476** | Vertical Slice + Hexagonal Hybrid Architecture | Medium | Low | `wolverine-inspired`, `area-vertical-slice` |
| **#477** | Bounded Context & Module Boundaries | Medium | Low | `area-bounded-context`, `area-module-system`, `saas-enabler` |
| **#478** | Result/DTO Mapping with ROP Semantics | Medium | Low | `area-dto-mapping`, `area-result-pattern` |
| **#479** | Application Services Interface Formalization | Medium | Low | `abp-inspired`, `area-application-services` |

#### New Packages Proposed

| Package | Description | Issues |
|---------|-------------|--------|
| **Encina.DDD** | Core DDD building blocks: ValueObject, AggregateRoot, DomainEvent, Domain/Application Services | #470, #472, #473, #478, #479 |
| **Encina.Specifications** | Specification pattern core abstractions | #471 |
| **Encina.Specifications.EFCore** | EF Core implementation for specifications | #471 |
| **Encina.Hexagonal** | Ports, Adapters, Anti-Corruption Layer | #474, #475 |

#### Labels Created (7)

| Label | Description | Color |
|-------|-------------|-------|
| `area-application-services` | Application Services and use case orchestration | #2E8B57 |
| `area-ports-adapters` | Ports and Adapters (Hexagonal Architecture) patterns | #4169E1 |
| `area-hexagonal` | Hexagonal Architecture patterns and infrastructure | #6A5ACD |
| `area-dto-mapping` | DTO mapping and object transformation patterns | #9370DB |
| `clean-architecture` | Clean Architecture patterns and structure | #32CD32 |
| `abp-inspired` | Pattern inspired by ABP Framework | #FF6B6B |
| `ardalis-inspired` | Pattern inspired by Steve Smith (Ardalis) libraries | #FF8C00 |

#### Relationship with Existing Issues

The new Hexagonal Architecture issues complement and in some cases consolidate existing issues:

| New Issue | Related Issues | Relationship |
|-----------|----------------|--------------|
| #470 (Domain vs Integration Events) | #350, #312, #384 | Consolidation and formalization |
| #471 (Specification) | #347, #371, #280, #295 | Definitive implementation |
| #472 (Value Objects/Aggregates) | #367, #370, #374 | Complement with base classes |
| #473 (Domain Services) | #377 | Formalization |
| #474 (ACL) | #378, #386, #363, #299 | Definitive implementation |
| #476 (Vertical Slices) | #365 | Extension with hexagonal |
| #477 (Bounded Context) | #379 | Extension with module system |
| #478 (DTO Mapping) | #468 | Specific complement |

#### Documentation Updates

- `docs/INVENTORY.md` - Added "Hexagonal Architecture Patterns" section with #470-#479
- `ROADMAP.md` - Added "Hexagonal Architecture Patterns" section to Phase 2
- `CHANGELOG.md` - Added Hexagonal Architecture Patterns to Unreleased section
- Updated statistics: 10 new issues in Phase 2

#### Key Insights from Research

1. **High Community Demand**:
   - Ardalis.Specification has ~9M NuGet downloads
   - ABP Framework's distinction between Domain/Application Services is widely adopted
   - Hexagonal Architecture is the foundation of Clean Architecture

2. **Patterns Prioritized by Industry Need**:
   - Domain Events vs Integration Events: Critical for microservices (Microsoft Learn emphasis)
   - Specification Pattern: High demand, used in Microsoft's eShopOnWeb
   - Value Objects: Core DDD pattern, prevents primitive obsession

3. **Framework Inspiration**:
   - ABP Framework: Domain Services, Application Services, Bounded Contexts
   - Wolverine: Vertical Slice Architecture, event handling
   - Ardalis: Specification pattern implementation

4. **2025 Community Trends**:
   - Vertical Slice + Clean Architecture hybrid is recommended approach
   - Modular Monolith gaining traction as microservices stepping stone
   - Strong emphasis on DDD building blocks for enterprise applications

### December 29 (Session 4) - AI/LLM Patterns Research

**Research Focus**: AI and LLM integration patterns for .NET applications

**Investigation Sources**:
- Microsoft.Extensions.AI (GA) - Unified AI abstractions
- Microsoft.Extensions.VectorData (GA) - Vector store abstractions
- Semantic Kernel Agent Orchestration - Multi-agent patterns
- Model Context Protocol (MCP) - C# SDK official release
- Azure Prompt Shields - AI security and guardrails
- Community demand analysis (r/dotnet, Stack Overflow, December 2025)

**12 New Issues Created** (#481-#492):

| Issue | Title | Priority | Package |
|-------|-------|----------|---------|
| #481 | MCP (Model Context Protocol) Support | HIGH | `Encina.MCP` |
| #482 | Semantic Caching Pipeline Behavior | HIGH | `Encina.AI.Caching.*` |
| #483 | AI Guardrails & Safety Pipeline | HIGH | `Encina.AI.Safety` |
| #484 | RAG Pipeline Patterns | HIGH | `Encina.AI.RAG` |
| #485 | Token Budget & Cost Management | MEDIUM | - |
| #486 | LLM Observability Integration | HIGH | - |
| #487 | Multi-Agent Orchestration Patterns | MEDIUM | `Encina.Agents` |
| #488 | Structured Output Handler | MEDIUM | - |
| #489 | Function Calling Orchestration | MEDIUM | - |
| #490 | Vector Store Abstraction | HIGH | `Encina.VectorData.*` |
| #491 | Prompt Management & Versioning | LOW | - |
| #492 | AI Streaming Pipeline Enhancement | MEDIUM | - |

**Key Findings**:
- MCP has become industry standard (adopted by OpenAI, Anthropic, Microsoft)
- Semantic caching reduces LLM costs by 40-70% (GPTCache, ScyllaDB research)
- Prompt injection is OWASP #1 threat for LLMs - guardrails essential
- RAG is the most demanded pattern in LLM applications
- Vector databases are foundation for modern AI apps
- LLM Observability is a distinct category with specific metrics (tokens, TTFT, cost)
- Multi-agent orchestration is maturing (Semantic Kernel + AutoGen merger)
- Microsoft.Extensions.AI and VectorData are now GA (December 2025)

**New Packages Planned** (14 total):
- `Encina.MCP` - Model Context Protocol server/client
- `Encina.AI.Safety` - Guardrails and content moderation
- `Encina.AI.Safety.Azure` - Azure Prompt Shields provider
- `Encina.AI.Safety.AWS` - AWS Bedrock Guardrails provider
- `Encina.AI.RAG` - RAG pipeline patterns
- `Encina.Agents` - Multi-agent orchestration
- `Encina.VectorData` - Vector store abstraction
- `Encina.VectorData.Qdrant` - Qdrant provider
- `Encina.VectorData.AzureSearch` - Azure AI Search provider
- `Encina.VectorData.Milvus` - Milvus provider
- `Encina.VectorData.Chroma` - Chroma provider
- `Encina.VectorData.InMemory` - In-memory provider (dev/testing)
- `Encina.AI.Caching.Redis` - Semantic caching with Redis
- `Encina.AI.Caching.Qdrant` - Semantic caching with Qdrant

**Documents Updated**:
- `docs/INVENTORY.md` - New section "18. AI/LLM Patterns" with full details
- `ROADMAP.md` - AI/LLM Patterns section in Phase 2
- `CHANGELOG.md` - 12 new AI/LLM features documented

---

### December 29 (Session 7) - Phase 2 Milestone Reorganization

**Motivation**: Phase 2 had grown to 364 open issues, making it impossible to track progress or achieve tangible milestones. The monolithic milestone needed to be divided into manageable, incremental releases.

**Action Taken**: Reorganized Phase 2 into 10 incremental milestones (v0.10.0 → v0.19.0).

**New Milestones Created**:

| Milestone | Issues | Focus |
|-----------|--------|-------|
| [v0.10.0 - DDD Foundations](https://github.com/dlrivada/Encina/milestone/7) | 31 | Value Objects, Entities, Aggregates, Specifications, ACL |
| [v0.11.0 - Testing Infrastructure](https://github.com/dlrivada/Encina/milestone/8) | 25 | Fakes, Respawn, WireMock, Shouldly, Bogus |
| [v0.12.0 - Database & Repository](https://github.com/dlrivada/Encina/milestone/9) | 22 | Repository, UoW, Bulk Ops, Pagination |
| [v0.13.0 - Security & Compliance](https://github.com/dlrivada/Encina/milestone/10) | 25 | Security, GDPR, NIS2, AI Act |
| [v0.14.0 - Cloud-Native & Aspire](https://github.com/dlrivada/Encina/milestone/11) | 23 | Aspire, Dapr, Orleans, HealthChecks |
| [v0.15.0 - Messaging & EIP](https://github.com/dlrivada/Encina/milestone/12) | 71 | EIP, Transports, Process Manager |
| [v0.16.0 - Multi-Tenancy & Modular](https://github.com/dlrivada/Encina/milestone/13) | 21 | Multi-Tenancy, Modular Monolith |
| [v0.17.0 - AI/LLM Patterns](https://github.com/dlrivada/Encina/milestone/14) | 16 | MCP, RAG, Semantic Cache, Agents |
| [v0.18.0 - Developer Experience](https://github.com/dlrivada/Encina/milestone/15) | 43 | Analyzers, Dashboard, OpenAPI |
| [v0.19.0 - Observability & Resilience](https://github.com/dlrivada/Encina/milestone/16) | 87 | OpenTelemetry, Caching, Locks |

**Total: 364 issues redistributed across 10 milestones**

**Documents Updated**:
- `ROADMAP.md` - New Phase 2 section with milestone table and details
- `CHANGELOG.md` - Milestone reorganization recorded in Unreleased
- `README.md` - Roadmap section updated with milestone table
- `docs/INVENTORY.md` - Statistics and Features Pendientes sections updated

**Path to 1.0.0**:
```
v0.10.0 → v0.19.0 (Phase 2 subdivided)
         ↓
Phase 3: Testing & Quality (15 issues)
         ↓
Phase 4: Code Quality (5 issues)
         ↓
Phase 5: Documentation (13 issues)
         ↓
Phase 6: Release (13 issues)
         ↓
        1.0.0
```

---

### December 29 - DDD Foundations - Encina.DomainModeling Package

**Issues Closed**: `#367` (Value Objects), `#369` (Entity Base Class), `#374` (Strongly Typed IDs), `#312` (Domain Events), `#299` (Anti-Corruption Layer)

**Package Created**: `Encina.DomainModeling` - Core DDD tactical pattern building blocks

**Entity Base Class** (Issue #369):
- `IEntity` and `IEntity<TId>` interfaces
- `Entity<TId>` abstract base class with identity-based equality
- Equality operators (`==`, `!=`) with proper null handling
- `GetHashCode()` based on type and Id
- `ToString()` returning "TypeName Id=value"

**Value Objects** (Issue #367):
- `ValueObject` abstract base class with structural equality
- `GetEqualityComponents()` for defining equality
- `SingleValueObject<TValue>` for wrapping primitives
- Implicit conversion operators for SingleValueObject
- `IComparable<T>` implementation for ordering

**Strongly Typed IDs** (Issue #374):
- `IStronglyTypedId` and `IStronglyTypedId<TValue>` interfaces
- `StronglyTypedId<TValue>` base class with equality and comparison
- `GuidStronglyTypedId<TSelf>` with `New()`, `From()`, `TryParse()`, `Empty`
- `IntStronglyTypedId<TSelf>` with `From()`, `TryParse()`
- `LongStronglyTypedId<TSelf>` with `From()`, `TryParse()`
- `StringStronglyTypedId<TSelf>` with `From()` and null/whitespace validation
- Uses LanguageExt `Option<T>` for `TryParse()` return type

**AggregateRoot**:
- `IAggregateRoot` and `IAggregateRoot<TId>` interfaces
- `AggregateRoot<TId>` with `DomainEvents` collection and `RaiseDomainEvent()`
- `ClearDomainEvents()` for post-persistence clearing
- `AuditableAggregateRoot<TId>` with `CreatedAtUtc`, `CreatedBy`, `ModifiedAtUtc`, `ModifiedBy`
- `SoftDeletableAggregateRoot<TId>` with `IsDeleted`, `DeletedAtUtc`, `DeletedBy`, `Delete()`, `Restore()`

**Domain Events vs Integration Events** (Issue #312):
- `IDomainEvent` interface with `EventId` and `OccurredAtUtc`
- `DomainEvent` abstract record with auto-generated values
- `RichDomainEvent` with `CorrelationId`, `CausationId`, `AggregateId`, `AggregateVersion`, `EventVersion`
- `IIntegrationEvent` interface with `EventVersion` for cross-boundary communication
- `IntegrationEvent` abstract record base class

**Anti-Corruption Layer** (Issue #299):
- `IDomainEventToIntegrationEventMapper<TDomainEvent, TIntegrationEvent>` interface
- Maps domain events to integration events for external publishing

**Auditing Interfaces**:
- `IAuditable` - CreatedAtUtc, CreatedBy, ModifiedAtUtc, ModifiedBy
- `ISoftDeletable` - IsDeleted, DeletedAtUtc, DeletedBy
- `IConcurrencyAware` - RowVersion for optimistic concurrency
- `IVersioned` - Version number for event sourcing/tracking

**Code Analysis Suppressions**:
- CA1000 (static members on generic types) - Justified for factory methods like `New()`, `From()`
- CA1036 (comparison operators) - DDD types don't need `<`, `>` operators

**Test Coverage**:

| Type | Count | Description |
|------|:-----:|-------------|
| Unit Tests | 61 | Core functionality coverage |
| Property Tests | 63 | FsCheck equality/comparison invariants |
| Contract Tests | 89 | Public API contract verification |
| Guard Tests | 44 | Null/empty argument validation |
| **Total** | **257** | Comprehensive coverage |

**Why Some Test Types Don't Apply**:
- **Integration Tests**: N/A - Pure in-memory domain modeling, no I/O
- **Benchmarks**: N/A - Simple object creation, not performance-critical
- **Load Tests**: N/A - No concurrency concerns, synchronous operations

**Files Created**:
```
src/Encina.DomainModeling/
├── Encina.DomainModeling.csproj
├── IEntity.cs
├── Entity.cs
├── ValueObject.cs
├── StronglyTypedId.cs
├── IAggregateRoot.cs
├── AggregateRoot.cs
├── IDomainEvent.cs
├── IIntegrationEvent.cs
├── IAuditable.cs
├── GlobalSuppressions.cs
├── PublicAPI.Shipped.txt
└── PublicAPI.Unshipped.txt

tests/Encina.DomainModeling.Tests/
├── EntityTests.cs
├── ValueObjectTests.cs
├── StronglyTypedIdTests.cs
└── AggregateRootTests.cs

tests/Encina.DomainModeling.PropertyTests/
├── EntityProperties.cs
├── ValueObjectProperties.cs
├── StronglyTypedIdProperties.cs
└── AggregateRootProperties.cs

tests/Encina.DomainModeling.ContractTests/
├── EntityContracts.cs
├── ValueObjectContracts.cs
├── StronglyTypedIdContracts.cs
├── AggregateRootContracts.cs
└── DomainEventContracts.cs

tests/Encina.DomainModeling.GuardTests/
├── EntityGuardTests.cs
├── ValueObjectGuardTests.cs
├── StronglyTypedIdGuardTests.cs
└── AggregateRootGuardTests.cs
```

**Duplicate Issues Consolidated**:
- ACL duplicates closed: #474, #386, #378, #363 → kept #299
- Domain Events duplicates closed: #470, #384, #350 → kept #312
- Specification duplicates closed: #471, #371, #347 → kept #295

---

### December 29 - DDD Foundations P2: Advanced Patterns

**Issues Closed**: `#295` (Specification Pattern), `#372` (Business Rules), `#377` (Domain Service Marker), `#299` (Anti-Corruption Layer - expanded), `#468` (Result Pattern Extensions)

**Specification Pattern** (Issue #295 - consolidates #347, #371, #471):
- `Specification<T>` abstract base class with expression-based criteria
- `IsSatisfiedBy(T entity)` method for in-memory evaluation
- `ToExpression()` for LINQ/EF Core integration
- Composition operators: `And()`, `Or()`, `Not()` methods
- Implicit conversion to `Expression<Func<T, bool>>`
- `QuerySpecification<T>` for complex queries with:
  - `Includes` collection for eager loading
  - `OrderBy`/`OrderByDescending` with `ThenBy`/`ThenByDescending`
  - `Skip`/`Take` for pagination
  - `AsNoTracking` and `AsSplitQuery` options
  - `Selector` for projections

**Business Rules Pattern** (Issue #372):
- `IBusinessRule` interface with `IsSatisfied`, `ErrorMessage`, `ErrorCode`
- `BusinessRule` abstract base class
- `BusinessRuleError` record for individual rule failures
- `AggregateBusinessRuleError` for collecting multiple violations
- `BusinessRuleViolationException` for throwing violations
- Extension methods: `Check()`, `CheckFirst()`, `CheckAll()`, `ThrowIfNotSatisfied()`
- Full ROP support: returns `Either<BusinessRuleError, Unit>`
- Separation from input validation (semantic difference: domain invariants vs input format)

**Domain Service Marker** (Issue #377):
- `IDomainService` marker interface
- Enables DI auto-discovery via assembly scanning
- Semantic clarity for domain layer services
- No implementation requirements (pure marker)

**Anti-Corruption Layer Pattern** (Issue #299 - expanded):
- `IAntiCorruptionLayer<TExternal, TDomain>` interface for sync translation
- `IAsyncAntiCorruptionLayer<TExternal, TDomain>` for async translation
- `AntiCorruptionLayerBase<TExternal, TDomain>` abstract base with:
  - `TranslateToDomain(TExternal external)` returns `Either<TranslationError, TDomain>`
  - `TranslateToExternal(TDomain domain)` returns `Either<TranslationError, TExternal>`
  - `TranslateToDomainAsync()` and `TranslateToExternalAsync()` async variants
- `TranslationError` record with `Message`, `ErrorCode`, `ExternalType`, `InnerException`
- Protects domain from external system changes

**Result Pattern Extensions** (Issue #468):
- Fluent API for `Either<TError, T>` from LanguageExt:
  - `Map()` - Transform success value
  - `Bind()` - Chain operations that return Either
  - `Combine()` - Combine two Either values into tuple
  - `Ensure()` - Validate with predicate, return error on failure
  - `When()` - Conditional map based on predicate
  - `Unless()` - Conditional map when predicate is false
  - `Tap()` - Execute side effect on success
  - `TapError()` - Execute side effect on failure
  - `OnSuccess()` - Alias for Tap
  - `OnFailure()` - Alias for TapError
  - `GetOrDefault()` - Get value or default
  - `GetOrElse()` - Get value or compute from error
  - `OrElse()` - Alternative Either on failure
  - `Recover()` - Transform error back to success
  - `ToAsync()` - Convert to EitherAsync
  - Async variants for all extension methods

**Test Coverage**:

| Type | Count | Description |
|------|:-----:|-------------|
| Unit Tests | 175 | Core functionality |
| Property Tests | 115 | FsCheck invariants for Specification, BusinessRule, Either |
| Contract Tests | 188 | Public API verification |
| Guard Tests | 80 | Null/empty argument validation |
| **Total** | **558** | Comprehensive coverage |

**Property Tests Added**:
- `SpecificationProperties.cs` - And/Or/Not composition, commutativity, associativity, De Morgan's laws
- `BusinessRuleProperties.cs` - IsSatisfied consistency, Check extensions, error codes
- `EitherExtensionsProperties.cs` - Monad laws (identity, composition, associativity), Combine, Ensure

**Contract Tests Added**:
- `SpecificationContracts.cs` - Abstract class, methods, QuerySpecification properties
- `BusinessRuleContracts.cs` - IBusinessRule, BusinessRule, extensions, errors
- `AntiCorruptionLayerContracts.cs` - Interfaces, base class, TranslationError
- `DomainServiceContracts.cs` - Marker interface contract
- `EitherExtensionsContracts.cs` - Static class, extension methods

**Files Created**:
```
src/Encina.DomainModeling/
├── Specification.cs         # Specification<T> and QuerySpecification<T>
├── BusinessRule.cs          # IBusinessRule, BusinessRule, errors, extensions
├── IDomainService.cs        # Marker interface
├── AntiCorruptionLayer.cs   # ACL interfaces and base class
└── EitherExtensions.cs      # Fluent API for Either<TError, T>

tests/Encina.DomainModeling.PropertyTests/
├── SpecificationProperties.cs
├── BusinessRuleProperties.cs
└── EitherExtensionsProperties.cs

tests/Encina.DomainModeling.ContractTests/
├── SpecificationContracts.cs
├── BusinessRuleContracts.cs
├── AntiCorruptionLayerContracts.cs
├── DomainServiceContracts.cs
└── EitherExtensionsContracts.cs
```

**Why Some Test Types Don't Apply**:
- **Integration Tests**: N/A - Pure in-memory domain modeling, no I/O
- **Benchmarks**: N/A - Simple object operations, not performance-critical
- **Load Tests**: N/A - No concurrency concerns, synchronous operations

---

### December 29 - DDD Foundations P3: Events & Repository Infrastructure

**Issues Closed**: `#368` (Rich Domain Events), `#373` (Integration Events), `#380` (Generic Repository)

**Rich Domain Events - Envelope Pattern** (Issue #368):
- `IDomainEventMetadata` interface for event metadata contract:
  - `CorrelationId`, `CausationId` for event tracing
  - `UserId`, `TenantId` for multi-tenancy support
  - `AdditionalMetadata` dictionary for extensibility
- `DomainEventMetadata` immutable record implementation:
  - `Empty` static property for metadata-free events
  - `WithCorrelation()`, `WithCausation()`, `ForUser()`, `ForTenant()` factory methods
  - `With()` method for adding custom metadata
- `DomainEventEnvelope<TEvent>` generic envelope:
  - Wraps any `IDomainEvent` with metadata
  - `EnvelopeId` (Guid) for unique envelope identification
  - `EnvelopeCreatedAtUtc` for envelope creation timestamp
- Extension methods in `DomainEventEnvelopeExtensions`:
  - `WithMetadata()` - Wrap event in envelope with metadata
  - `WithEmptyMetadata()` - Wrap event without metadata
  - `WithCorrelation()`, `WithCausation()` - Quick correlation setup
  - `Unwrap()` - Extract event from envelope
  - `GetMetadataValue()` - Safe metadata dictionary access

**Integration Events Pattern** (Issue #373):
- `IAsyncDomainEventToIntegrationEventMapper<TDomain, TIntegration>` for async mapping:
  - `MapAsync()` method with CancellationToken support
  - Use for database lookups, external service calls
- `IFallibleDomainEventToIntegrationEventMapper<TDomain, TIntegration, TError>`:
  - Returns `Either<TError, TIntegration>` for ROP support
  - Explicit error handling for mapping failures
- `IntegrationEventMappingError` record:
  - `MissingField<TDomain, TIntegration>()` - Required field missing
  - `ValidationFailed<TDomain, TIntegration>()` - Business validation failed
  - `LookupFailed<TDomain, TIntegration>()` - External lookup failed
- `IIntegrationEventPublisher` interface:
  - `PublishAsync<TEvent>()` - Single event publishing
  - `PublishManyAsync<TEvent>()` - Batch publishing
- `IFallibleIntegrationEventPublisher<TError>`:
  - Returns `Either<TError, Unit>` for ROP error handling
- `IntegrationEventPublishError` record:
  - `SerializationFailed<TEvent>()` - JSON/serialization error
  - `OutboxStoreFailed<TEvent>()` - Outbox persistence error
  - `BrokerFailed<TEvent>()` - Message broker error
- Extension methods in `IntegrationEventMappingExtensions`:
  - `MapTo()` - Sync mapping via mapper
  - `MapToAsync()` - Async mapping via async mapper
  - `MapAll()` - Batch sync mapping
  - `MapAllAsync()` - Batch async mapping
  - `TryMapTo()` - Safe mapping returning `Option<TIntegration>`
  - `Compose()` - Compose two mappers into single mapper

**Generic Repository Pattern** (Issue #380):
- `IReadOnlyRepository<TEntity, TId>` for query operations:
  - `GetByIdAsync()` - Returns `Option<TEntity>` (ROP-friendly)
  - `FindAsync()` - Query by `Specification<TEntity>`
  - `GetPagedAsync()` - Paginated results
  - `CountAsync()`, `ExistsAsync()` - Counting/existence checks
- `IRepository<TEntity, TId>` extends IReadOnlyRepository:
  - `AddAsync()`, `AddRangeAsync()` - Insert operations
  - `Update()`, `UpdateRange()` - Sync update (Unit of Work pattern)
  - `Remove()`, `RemoveRange()` - Sync delete
- `IAggregateRepository<TAggregate, TId>` extends IRepository:
  - Type constraint to `IAggregateRoot<TId>`
  - Same operations, aggregates-only semantics
- `PagedResult<T>` record for pagination:
  - `Items`, `PageNumber`, `PageSize`, `TotalCount` properties
  - `TotalPages` computed: `Math.Ceiling(TotalCount / PageSize)`
  - `HasPreviousPage` / `HasNextPage` for navigation
  - `IsEmpty` convenience property
  - `Empty()` factory methods with optional parameters
  - `Map<TResult>()` for transforming items
- `RepositoryError` record for operation failures:
  - `NotFound<TEntity, TId>()` - Entity not found
  - `AlreadyExists<TEntity, TId>()` - Duplicate key
  - `ConcurrencyConflict<TEntity, TId>()` - Optimistic concurrency
  - `InvalidPagination<TEntity>()` - Bad page parameters
  - `OperationFailed<TEntity>()` - Generic DB error
- `EntityNotFoundException` exception class:
  - For scenarios requiring exception-based error handling
  - `EntityType` and `EntityId` properties for context
- Extension methods in `RepositoryExtensions`:
  - `GetByIdOrThrowAsync()` - Get or throw EntityNotFoundException
  - `GetByIdOrErrorAsync()` - Returns `Either<RepositoryError, TEntity>`

**Test Coverage**:

| Type | Count | Description |
|------|:-----:|-------------|
| Unit Tests | 175 | Core functionality (unchanged) |
| Property Tests | 154 | +39 new for envelope, events, repository |
| Contract Tests | 291 | +103 new for all P3 features |
| Guard Tests | 80 | Null/empty argument validation (unchanged) |
| **Total** | **700** | +142 from P2's 558 |

**Property Tests Added**:
- `DomainEventEnvelopeProperties.cs`:
  - Metadata factory methods (Empty, WithCorrelation, ForUser, ForTenant)
  - Envelope creation preserves event data
  - Extension methods (WithMetadata, Unwrap, GetMetadataValue)
- `IntegrationEventProperties.cs`:
  - MappingError factory methods (MissingField, ValidationFailed, LookupFailed)
  - PublishError factory methods (SerializationFailed, OutboxStoreFailed, BrokerFailed)
  - MapTo/MapAll extensions with TestMapper
  - TryMapTo returns None on null mapper, Some on success
- `RepositoryProperties.cs`:
  - PagedResult TotalPages calculation
  - HasPreviousPage/HasNextPage correctness
  - Empty() factory methods
  - Map() transformation
  - RepositoryError factory methods
  - EntityNotFoundException properties

**Contract Tests Added**:
- `DomainEventEnvelopeContracts.cs`:
  - IDomainEventMetadata interface structure
  - DomainEventMetadata record properties and methods
  - DomainEventEnvelope<T> generic record
  - DomainEventEnvelopeExtensions static class
- `IntegrationEventExtensionsContracts.cs`:
  - IAsyncDomainEventToIntegrationEventMapper interface
  - IFallibleDomainEventToIntegrationEventMapper interface
  - IntegrationEventMappingError record and factories
  - IIntegrationEventPublisher interface
  - IFallibleIntegrationEventPublisher interface
  - IntegrationEventPublishError record and factories
  - IntegrationEventMappingExtensions static class
- `RepositoryContracts.cs`:
  - IReadOnlyRepository interface methods
  - IRepository interface methods
  - IAggregateRepository interface constraints
  - PagedResult record and computed properties
  - RepositoryError record and factories
  - EntityNotFoundException class
  - RepositoryExtensions static class

**Files Created**:
```
src/Encina.DomainModeling/
├── DomainEventEnvelope.cs       # Envelope pattern with metadata
├── IntegrationEventExtensions.cs # Async/fallible mappers, publishers
└── Repository.cs                 # Generic repository interfaces

tests/Encina.DomainModeling.PropertyTests/
├── DomainEventEnvelopeProperties.cs
├── IntegrationEventProperties.cs
└── RepositoryProperties.cs

tests/Encina.DomainModeling.ContractTests/
├── DomainEventEnvelopeContracts.cs
├── IntegrationEventExtensionsContracts.cs
└── RepositoryContracts.cs
```

**Files Modified**:
- `Encina.DomainModeling.csproj` - Added `<NoWarn>` for RS0016/RS0017/RS0026/RS0036/RS0037 (pre-1.0 relaxed API tracking)
- `GlobalSuppressions.cs` - Added CA1000 suppression for `PagedResult<T>.Empty()`

**Why Some Test Types Don't Apply**:
- **Integration Tests**: N/A - Pure in-memory domain modeling, no I/O
- **Benchmarks**: N/A - Simple object operations, not performance-critical
- **Load Tests**: N/A - No concurrency concerns, synchronous operations

---

### December 29 - DDD Foundations P4: Clean Architecture Patterns

**Issues Closed**: `#475` (Ports & Adapters), `#478` (Result/DTO Mapping), `#479` (Application Services)

**Ports & Adapters Factory Pattern** (Issue #475):
- `IPort` marker interface for hexagonal architecture boundaries
- `IInboundPort` - Ports driven by external actors (controllers, handlers)
- `IOutboundPort` - Ports that drive external systems (repositories, APIs)
- `IAdapter<TPort>` - Marker interface for adapter implementations
- `AdapterBase<TPort>` abstract base class with:
  - `Execute<T>()` - Sync operation with logging and error handling
  - `ExecuteAsync<T>()` - Async operation with cancellation support
  - Returns `Either<AdapterError, T>` for ROP-friendly error handling
- `AdapterError` record with factory methods:
  - `OperationFailed<TPort>()` - Generic adapter operation failure
  - `Cancelled<TPort>()` - Operation cancellation
  - `NotFound<TPort>()` - External resource not found
  - `CommunicationFailed<TPort>()` - External system communication error
  - `ExternalError<TPort>()` - External system returned error
- `PortRegistrationExtensions` for DI:
  - `AddPort<TPort, TAdapter>()` - Register port/adapter pair
  - `AddPort<TPort>(factory)` - Register with factory function
  - `AddPortsFromAssembly()` - Assembly scanning for auto-registration
  - `AddPortsFromAssemblies()` - Scan multiple assemblies

**Result/DTO Mapping with ROP Semantics** (Issue #478):
- `IResultMapper<TDomain, TDto>` - Sync mapper with `Either<MappingError, TDto>`
- `IAsyncResultMapper<TDomain, TDto>` - Async mapper with CancellationToken
- `IBidirectionalMapper<TDomain, TDto>` - Two-way mapping with `MapToDomain()`
- `IAsyncBidirectionalMapper<TDomain, TDto>` - Async bidirectional variant
- `MappingError` record with factory methods:
  - `NullProperty<TSource, TTarget>()` - Required property is null
  - `ValidationFailed<TSource, TTarget>()` - Business validation failed
  - `ConversionFailed<TSource, TTarget>()` - Type conversion error
  - `EmptyCollection<TSource, TTarget>()` - Empty required collection
  - `OperationFailed<TSource, TTarget>()` - Unexpected mapping failure
- `ResultMapperExtensions`:
  - `MapAll()` - Map collection, fail on first error
  - `MapAllCollectErrors()` - Map collection, collect all errors
  - `MapAllAsync()` - Async collection mapping
  - `TryMap()` - Safe mapping returning `Option<TDto>`
  - `Compose()` - Chain two mappers into single mapper
- `ResultMapperRegistrationExtensions`:
  - `AddResultMapper<TDomain, TDto, TMapper>()` - Register sync mapper
  - `AddAsyncResultMapper<TDomain, TDto, TMapper>()` - Register async mapper
  - `AddResultMappersFromAssembly()` - Assembly scanning

**Application Services Interface** (Issue #479):
- `IApplicationService` marker interface for use case orchestration
- `IApplicationService<TInput, TOutput>` - Typed service with `ExecuteAsync()`
- `IApplicationService<TOutput>` - Parameterless service (scheduled tasks)
- `IVoidApplicationService<TInput>` - Service returning `Either<Error, Unit>`
- `ApplicationServiceError` record with factory methods:
  - `NotFound<TService>()` - Entity lookup failure
  - `ValidationFailed<TService>()` - Input validation error
  - `BusinessRuleViolation<TService>()` - Domain rule violated
  - `ConcurrencyConflict<TService>()` - Optimistic concurrency error
  - `InfrastructureFailure<TService>()` - Infrastructure operation failed
  - `Unauthorized<TService>()` - Authorization failure
  - `FromAdapterError<TService>()` - Convert from adapter error
  - `FromMappingError<TService>()` - Convert from mapping error
  - `FromRepositoryError<TService>()` - Convert from repository error
- `ApplicationServiceExtensions`:
  - `ToApplicationServiceError<TService>()` - Extension for error conversion
- `ApplicationServiceRegistrationExtensions`:
  - `AddApplicationService<TService>()` - Register service
  - `AddApplicationServicesFromAssembly()` - Assembly scanning

**Test Coverage**:

| Type | Count | Description |
|------|:-----:|-------------|
| Unit Tests | 175 | Core functionality (unchanged) |
| Property Tests | 192 | +38 new for ports, mappers, app services |
| Contract Tests | 378 | +87 new for all P4 features |
| Guard Tests | 80 | Null/empty argument validation (unchanged) |
| **Total** | **825** | +125 from P3's 700 |

**Property Tests Added**:
- `PortsAndAdaptersProperties.cs`:
  - AdapterError factory methods (OperationFailed, Cancelled, NotFound, etc.)
  - AdapterBase Execute/ExecuteAsync behavior
  - Port registration with DI
- `ResultMapperProperties.cs`:
  - MappingError factory methods
  - IResultMapper Map success/failure
  - MapAll/MapAllCollectErrors behavior
  - TryMap returns Option appropriately
  - Compose chains mappers correctly
- `ApplicationServiceProperties.cs`:
  - ApplicationServiceError factory methods
  - IApplicationService ExecuteAsync behavior
  - IVoidApplicationService returns Unit
  - Error conversion methods

**Contract Tests Added**:
- `PortsAndAdaptersContracts.cs`:
  - IPort/IInboundPort/IOutboundPort hierarchy
  - IAdapter<TPort> generic constraints
  - AdapterBase abstract class structure
  - AdapterError record and factories
  - PortRegistrationExtensions static class
- `ResultMapperContracts.cs`:
  - IResultMapper/IAsyncResultMapper interfaces
  - IBidirectionalMapper/IAsyncBidirectionalMapper
  - MappingError record and factories
  - ResultMapperExtensions static class
  - ResultMapperRegistrationExtensions
- `ApplicationServiceContracts.cs`:
  - IApplicationService marker and typed interfaces
  - IVoidApplicationService returns Either<Error, Unit>
  - ApplicationServiceError record and all factories
  - ApplicationServiceExtensions
  - ApplicationServiceRegistrationExtensions

**Files Created**:
```
src/Encina.DomainModeling/
├── PortsAndAdapters.cs      # IPort, IAdapter, AdapterBase, AdapterError
├── ResultMapper.cs          # IResultMapper, MappingError, extensions
└── ApplicationService.cs    # IApplicationService, ApplicationServiceError

tests/Encina.DomainModeling.PropertyTests/
├── PortsAndAdaptersProperties.cs
├── ResultMapperProperties.cs
└── ApplicationServiceProperties.cs

tests/Encina.DomainModeling.ContractTests/
├── PortsAndAdaptersContracts.cs
├── ResultMapperContracts.cs
└── ApplicationServiceContracts.cs
```

**Files Modified**:
- `Encina.DomainModeling.csproj` - Added Microsoft.Extensions.DependencyInjection.Abstractions, Logging.Abstractions
- `GlobalSuppressions.cs` - Added CA1848 suppression for AdapterBase logging
- `Encina.DomainModeling.PropertyTests.csproj` - Added DI and Logging packages

**Why Some Test Types Don't Apply**:
- **Integration Tests**: N/A - Pure in-memory domain modeling, no I/O
- **Benchmarks**: N/A - Simple object operations, not performance-critical
- **Load Tests**: N/A - No concurrency concerns, synchronous operations

---

### December 29 - DDD Foundations P5: Strategic DDD & Architecture Patterns

**Issues Closed**: `#379` (Bounded Context helpers), `#381` (Domain Language DSL), `#476` (Vertical Slice + Hexagonal Hybrid), `#477` (Bounded Context & Module Boundaries)

**v0.10.0 - DDD Foundations milestone is now COMPLETE!**

**Bounded Context Patterns** (Issues #379, #477):
- `BoundedContextAttribute` - Mark types with bounded context membership
- `ContextRelationship` enum - All DDD context relationships:
  - `Conformist`, `AntiCorruptionLayer`, `SharedKernel`, `CustomerSupplier`
  - `PublishedLanguage`, `SeparateWays`, `Partnership`, `OpenHost`
- `ContextRelation` record - Stores upstream/downstream context with relationship type
- `ContextMap` class - Document relationships between contexts:
  - `AddRelation()` - Generic relation with type
  - `AddSharedKernel()`, `AddCustomerSupplier()`, `AddPublishedLanguage()` - Convenience methods
  - `GetContextNames()` - List all contexts in the map
  - `GetRelationsFor()` - Get all relations involving a context
  - `GetUpstreamDependencies()`, `GetDownstreamConsumers()` - Directional queries
  - `ToMermaidDiagram()` - Generate visual diagram of context relationships
- `BoundedContextModule` abstract class - Modular monolith module base:
  - `Name`, `Description` - Module identification
  - `Dependencies` - Other modules this one depends on
  - `ConfigureServices()` - DI registration for module
- `IBoundedContextModule` interface - Module contract
- `BoundedContextValidator` - Validate module dependencies:
  - Detect circular dependencies
  - Detect orphaned consumers (missing dependencies)
- `BoundedContextError` record with factory methods:
  - `OrphanedConsumer()` - Consumer without provider
  - `CircularDependency()` - Cycle detected in dependencies
  - `ValidationFailed()` - Generic validation failure
- `BoundedContextExtensions`:
  - `GetBoundedContextName<T>()` - Get context name from attribute
  - `AddBoundedContextModules()` - Register all modules
  - `ValidateBoundedContexts()` - Validate dependencies

**Domain Language DSL** (Issue #381):
- `DomainBuilder<T, TBuilder>` - CRTP fluent builder:
  - `Build()` - Returns `Either<DomainBuilderError, T>`
  - `BuildOrThrow()` - Builds or throws on failure
  - `TryBuild()` - Returns `Option<T>`
- `AggregateBuilder<TAggregate, TId, TBuilder>` - Aggregate-aware builder:
  - `AddRule()` - Add business rule for validation
  - `AddRuleWhen()` - Conditional rule with factory
  - `CreateAggregate()` - Abstract method for actual creation
- `DomainBuilderError` record with factory methods:
  - `MissingValue()` - Required property not set
  - `ValidationFailed()` - Validation condition not met
  - `BusinessRulesViolated()` - Business rules broken
  - `InvalidState()` - Builder in invalid state
- `DomainDslExtensions` - Fluent specification checks:
  - `Is()`, `Satisfies()` - Entity satisfies specification
  - `Violates()` - Entity does not satisfy specification
  - `Passes()`, `Fails()` - Business rule checks
  - `EnsureValid()` - Validate condition, return Either
  - `EnsureNotNull()`, `EnsureNotEmpty()` - Common validations
- **Common Domain Types**:
  - `Quantity` struct - Non-negative integer quantity:
    - `Create()` returns Either, `From()` throws on invalid
    - `Zero`, `One` static properties
    - `Add()`, `Subtract()`, `Multiply()` operations (Subtract floors at 0)
    - `IsZero`, `IsPositive`, `IsGreaterThan()` checks
    - Operators: `+`, `-`, `*`, `==`, `!=`, `<`, `>`, `<=`, `>=`
  - `Percentage` struct - 0-100 percentage value:
    - `Create()` returns Either, `From()` throws on invalid
    - `Zero`, `Half`, `Full` static properties
    - `ApplyTo()` - Apply percentage to amount
    - `AsFraction` - Get 0-1 value
    - `Complement` - Get 100 minus value
  - `DateRange` struct - Date range with start/end:
    - `Create()` returns Either, `From()` throws on invalid
    - `SingleDay()`, `Days()` factory methods
    - `TotalDays` - Number of days in range (inclusive)
    - `Contains()`, `Overlaps()`, `FullyContains()` checks
    - `Intersect()` - Get overlapping range as Option
    - `ExtendBy()` - Extend end date by days
  - `TimeRange` struct - Time range with start/end:
    - `Create()` returns Either, `From()` throws on invalid
    - `Duration` - TimeSpan between start and end
    - `Contains()`, `Overlaps()` checks

**Vertical Slice + Hexagonal Hybrid** (Issue #476):
- `FeatureSlice` abstract class - Base for vertical slices:
  - `FeatureName` - Required slice identifier
  - `Description` - Optional description
  - `RoutePrefix` - Optional API route prefix
  - `ConfigureServices()` - DI registration for slice
- `IFeatureSliceWithEndpoints` - Slices with HTTP endpoints:
  - `EndpointConfiguratorTypes` - Endpoint configurator types to resolve
- `IFeatureSliceWithDependencies` - Inter-slice dependencies:
  - `Dependencies` - Collection of `SliceDependency`
- `SliceDependency` record - Dependency on another slice:
  - `SliceName` - Name of required slice
  - `IsOptional` - Whether dependency is optional
- `FeatureSliceConfiguration` - Fluent slice configuration:
  - `AddSlice<TSlice>()` - Add slice by type
  - `AddSlice(instance)` - Add slice instance
  - `AddSlicesFromAssembly()` - Scan assembly for slices
  - `ValidateDependencies` - Enable/disable validation
- `FeatureSliceExtensions`:
  - `AddFeatureSlices()` - Register slices with configuration action
  - `AddFeatureSlice<TSlice>()` - Register single slice
  - `AddFeatureSlicesFromAssembly()` - Scan and register
  - `GetFeatureSlices()` - Retrieve all registered slices
  - `GetFeatureSlice(name)` - Retrieve slice by name
- `FeatureSliceError` record with factory methods:
  - `MissingDependency()` - Required slice not registered
  - `CircularDependency()` - Cycle detected in slice dependencies
  - `RegistrationFailed()` - Slice registration exception
- **Use Case Handlers**:
  - `IUseCaseHandler` - Marker interface
  - `IUseCaseHandler<TInput, TOutput>` - Handler with input/output:
    - `HandleAsync()` returns `Task<TOutput>`
  - `IUseCaseHandler<TInput>` - Command handler (void output):
    - `HandleAsync()` returns `Task`
  - `UseCaseHandlerExtensions`:
    - `AddUseCaseHandler<THandler>()` - Register specific handler
    - `AddUseCaseHandlersFromAssembly()` - Scan and register handlers

**Test Coverage**:

| Type | Count | Description |
|------|:-----:|-------------|
| Unit Tests | 175 | Core functionality (unchanged) |
| Property Tests | 275 | +83 new for bounded context, DSL, slices |
| Contract Tests | 531 | +153 new for all P5 features |
| Guard Tests | 80 | Null/empty argument validation (unchanged) |
| **Total** | **1061** | +236 from P4's 825 |

**Property Tests Added**:
- `BoundedContextProperties.cs`:
  - ContextMap relation management
  - SharedKernel/CustomerSupplier/PublishedLanguage convenience methods
  - GetContextNames, GetRelationsFor, GetUpstreamDependencies
  - ToMermaidDiagram output validation
  - BoundedContextAttribute storage
  - BoundedContextError factory methods
- `DomainDslProperties.cs`:
  - Quantity Create/From, arithmetic, comparisons
  - Percentage Create/From, ApplyTo, AsFraction, Complement
  - DateRange Create/From, Contains, Overlaps, Intersect, ExtendBy
  - TimeRange Create/From, Duration, Contains, Overlaps
  - DSL extensions: Is, Satisfies, Violates, Passes, Fails
  - EnsureValid, EnsureNotNull, EnsureNotEmpty
  - DomainBuilderError factory methods
- `FeatureSliceProperties.cs`:
  - FeatureSlice registration and retrieval
  - FeatureSliceConfiguration fluent API
  - SliceDependency validation
  - FeatureSliceError factory methods
  - UseCaseHandler registration

**Contract Tests Added**:
- `BoundedContextContracts.cs`:
  - BoundedContextAttribute structure
  - ContextRelationship enum values
  - ContextRelation record properties
  - ContextMap methods and fluent API
  - BoundedContextModule abstract class
  - IBoundedContextModule interface
  - BoundedContextValidator methods
  - BoundedContextError record and factories
  - BoundedContextExtensions static class
- `DomainDslContracts.cs`:
  - DomainBuilder<T,TBuilder> abstract class
  - AggregateBuilder hierarchy
  - DomainBuilderError record and factories
  - DomainDslExtensions static class and all methods
  - Quantity struct and all members
  - Percentage struct and all members
  - DateRange struct and all members
  - TimeRange struct and all members
- `FeatureSliceContracts.cs`:
  - FeatureSlice abstract class
  - IFeatureSliceWithEndpoints interface
  - IFeatureSliceWithDependencies interface
  - SliceDependency record
  - FeatureSliceConfiguration class
  - FeatureSliceExtensions static class
  - FeatureSliceError record and factories
  - IUseCaseHandler interfaces
  - UseCaseHandlerExtensions static class

**Files Created**:
```
src/Encina.DomainModeling/
├── BoundedContext.cs    # BoundedContextAttribute, ContextMap, BoundedContextModule, etc.
├── DomainDsl.cs         # DomainBuilder, Quantity, Percentage, DateRange, TimeRange
└── FeatureSlice.cs      # FeatureSlice, IUseCaseHandler, SliceDependency

tests/Encina.DomainModeling.PropertyTests/
├── BoundedContextProperties.cs
├── DomainDslProperties.cs
└── FeatureSliceProperties.cs

tests/Encina.DomainModeling.ContractTests/
├── BoundedContextContracts.cs
├── DomainDslContracts.cs
└── FeatureSliceContracts.cs
```

**Technical Notes**:
- Renamed `Ensure<T>()` to `EnsureValid<T>()` to avoid ambiguity with `EitherExtensions.Ensure<TError, T>()`
- Property tests use `IsValid()` helper to filter whitespace-only strings from FsCheck
- FeatureSlice registration adds both concrete type and FeatureSlice base type for retrieval

**Why Some Test Types Don't Apply**:
- **Integration Tests**: N/A - Pure in-memory domain modeling, no I/O
- **Benchmarks**: N/A - Simple object operations, not performance-critical
- **Load Tests**: N/A - No concurrency concerns, synchronous operations

---

### December 29 - Validation Architecture Consolidation (Issue #229)

**v0.10.0 - DDD Foundations milestone COMPLETE with this final issue!**

**Problem**: DRY violation with duplicate ValidationPipelineBehavior implementations:
- `Encina.FluentValidation.ValidationPipelineBehavior` - Direct FluentValidation integration
- `Encina.DataAnnotations.DataAnnotationsValidationBehavior` - Direct DataAnnotations integration
- `Encina.MiniValidator.MiniValidationBehavior` - Direct MiniValidator integration

Each bypassed the centralized `ValidationOrchestrator` and `IValidationProvider` abstraction.

**Solution**: Consolidate on the single `Encina.Validation.ValidationPipelineBehavior<,>` from the core package.

**Files Deleted**:
- `src/Encina.FluentValidation/ValidationPipelineBehavior.cs`
- `src/Encina.DataAnnotations/DataAnnotationsValidationBehavior.cs`
- `src/Encina.MiniValidator/MiniValidationBehavior.cs`

**Test Files Deleted** (obsolete, tested deleted behaviors):
- `tests/Encina.FluentValidation.Tests/ValidationPipelineBehaviorTests.cs`
- `tests/Encina.FluentValidation.Tests/Guards/ValidationPipelineBehaviorGuardsTests.cs`
- `tests/Encina.FluentValidation.PropertyTests/ValidationPipelineBehaviorPropertyTests.cs`
- `tests/Encina.FluentValidation.ContractTests/ValidationPipelineBehaviorContractTests.cs`
- `tests/Encina.FluentValidation.IntegrationTests/ValidationPipelineBehaviorIntegrationTests.cs`
- `tests/Encina.FluentValidation.LoadTests/ValidationPipelineBehaviorLoadTests.cs`
- `tests/Encina.DataAnnotations.Tests/DataAnnotationsValidationBehaviorTests.cs`
- `tests/Encina.DataAnnotations.Tests/Guards/DataAnnotationsValidationBehaviorGuardsTests.cs`
- `tests/Encina.DataAnnotations.PropertyTests/DataAnnotationsValidationBehaviorPropertyTests.cs`
- `tests/Encina.DataAnnotations.ContractTests/DataAnnotationsValidationBehaviorContractTests.cs`
- `tests/Encina.DataAnnotations.IntegrationTests/DataAnnotationsValidationBehaviorIntegrationTests.cs`
- `tests/Encina.DataAnnotations.LoadTests/DataAnnotationsValidationBehaviorLoadTests.cs`
- `tests/Encina.MiniValidator.Tests/MiniValidationBehaviorTests.cs`
- `tests/Encina.MiniValidator.Tests/Guards/MiniValidationBehaviorGuardsTests.cs`
- `tests/Encina.MiniValidator.PropertyTests/MiniValidationBehaviorPropertyTests.cs`
- `tests/Encina.MiniValidator.ContractTests/MiniValidationBehaviorContractTests.cs`
- `tests/Encina.MiniValidator.IntegrationTests/MiniValidationBehaviorIntegrationTests.cs`
- `tests/Encina.MiniValidator.LoadTests/MiniValidationBehaviorLoadTests.cs`

**Files Modified**:
- `src/Encina.FluentValidation/PublicAPI.Unshipped.txt` - Removed behavior entries
- `src/Encina.DataAnnotations/PublicAPI.Unshipped.txt` - Removed behavior entries
- `src/Encina.MiniValidator/PublicAPI.Unshipped.txt` - Removed behavior entries
- `benchmarks/Encina.Benchmarks/ValidationBenchmarks.cs` - Use centralized behavior with proper ServiceCollection extensions

**ServiceCollectionExtensions Already Correct**:
All three packages were already correctly registering the centralized behavior:
- `Encina.FluentValidation`: Uses `EncinaValidation.ValidationPipelineBehavior<,>`
- `Encina.DataAnnotations`: Uses `ValidationPipelineBehavior<,>` with `using Encina.Validation`
- `Encina.MiniValidator`: Uses `ValidationPipelineBehavior<,>` with `using Encina.Validation`

**Architecture After Consolidation**:
```text
Encina (core)
├── Encina.Validation.IValidationProvider (interface)
├── Encina.Validation.ValidationOrchestrator (domain logic)
├── Encina.Validation.ValidationPipelineBehavior<,> (SINGLE centralized behavior)
├── Encina.Validation.ValidationResult (immutable result)
└── Encina.Validation.ValidationError (record)

Encina.FluentValidation / DataAnnotations / MiniValidator
├── *ValidationProvider (implements IValidationProvider)
└── ServiceCollectionExtensions (registers orchestrator + provider + centralized behavior)
```

**Breaking Changes**:
- `Encina.FluentValidation.ValidationPipelineBehavior<,>` removed - use `Encina.Validation.ValidationPipelineBehavior<,>`
- `Encina.DataAnnotations.DataAnnotationsValidationBehavior<,>` removed
- `Encina.MiniValidator.MiniValidationBehavior<,>` removed

**Migration Path**:
No action needed if using `AddEncinaFluentValidation()`, `AddDataAnnotationsValidation()`, or `AddMiniValidation()` extension methods - they already register the centralized behavior.

**Why Test Types Not Created**:
- The existing tests in `Encina.Tests` and `Encina.ContractTests` already cover `ValidationPipelineBehavior<,>` in the core package
- Integration/property/guard tests for providers remain in respective test projects testing `IValidationProvider` implementations
- No new code was written, only duplicates removed

---

### December 30 - Encina.Testing.WireMock Package (Issue #428)

**New Package**: HTTP API mocking for integration tests using WireMock.NET.

**Files Created**:
```text
src/Encina.Testing.WireMock/
├── Encina.Testing.WireMock.csproj
├── EncinaWireMockFixture.cs      # xUnit fixture with fluent API
├── WireMockContainerFixture.cs   # Docker-based via Testcontainers
├── FaultType.cs                  # Fault simulation enum
├── PublicAPI.Shipped.txt
└── PublicAPI.Unshipped.txt

tests/Encina.Testing.WireMock.Tests/
├── Encina.Testing.WireMock.Tests.csproj
├── EncinaWireMockFixtureTests.cs  # 33 unit tests
├── FaultTypeTests.cs              # 4 enum tests
└── ReceivedRequestTests.cs        # Record tests
```

**Key Components**:
- `EncinaWireMockFixture` - xUnit fixture with fluent stubbing API:
  - HTTP method stubs: `StubGet()`, `StubPost()`, `StubPut()`, `StubPatch()`, `StubDelete()`
  - `Stub()` with request configuration for advanced matching
  - `StubSequence()` for sequential responses
  - `StubFault()` for EmptyResponse, MalformedResponse, Timeout simulation
  - `StubDelay()` for testing timeout handling
  - `VerifyCallMade()`, `VerifyNoCallsMade()` for request verification
  - `GetReceivedRequests()` returns `ReceivedRequest` records
  - `CreateClient()` for pre-configured HttpClient
- `WireMockContainerFixture` - Docker-based WireMock via Testcontainers:
  - Automatic container lifecycle with `IAsyncLifetime`
  - `CreateAdminClient()` for REST API access
  - `CreateClient()` for HttpClient
  - Full isolation for CI/CD environments
- `FaultType` enum: EmptyResponse, MalformedResponse, Timeout
- `ReceivedRequest` record: Path, Method, Headers, Body, Timestamp

**Dependencies Added to Directory.Packages.props**:
- `WireMock.Net` v1.19.0
- `WireMock.Net.Testcontainers` v1.14.0

**Test Results**: 37 tests passing
- 33 fixture tests covering all stub types, verification, reset, and error cases
- 4 enum tests for FaultType values

**Why Some Test Types Don't Apply**:
- **Integration Tests**: The unit tests already use real WireMock.Net (in-process), effectively integration tests
- **Property Tests**: N/A - Fixture behavior is deterministic, no invariants to verify
- **Contract Tests**: N/A - No interfaces to verify contract compliance
- **Guard Tests**: Covered inline in unit tests (argument validation)
- **Load/Benchmark Tests**: N/A - Not a performance-critical path

---

### December 30 (cont.) - Encina.Testing.Bogus (Issue #431)

**Issue Closed**: `#431`

**Package**: `Encina.Testing.Bogus`

Realistic test data generation with Bogus integration for Encina applications.

**Core Components**:

| Component | Purpose |
|-----------|---------|
| `EncinaFaker<T>` | Base faker class with reproducibility (seed: 12345) |
| `OutboxMessageFaker` | Generate outbox messages for testing |
| `InboxMessageFaker` | Generate inbox messages for idempotency testing |
| `SagaStateFaker` | Generate saga states for orchestration testing |
| `ScheduledMessageFaker` | Generate scheduled messages for scheduling tests |

**Extension Methods** (`EncinaFakerExtensions`):
- Identifiers: `CorrelationId()`, `UserId()`, `TenantId()`, `IdempotencyKey()`
- Message types: `NotificationType()`, `RequestType()`, `SagaType()`, `SagaStatus()`
- UTC timestamps: `RecentUtc()`, `SoonUtc()`
- JSON: `JsonContent(propertyCount)`

**OutboxMessageFaker Features**:
- `AsProcessed()` - Generate processed messages
- `AsFailed(retryCount)` - Generate failed messages with error info
- `WithNotificationType()`, `WithContent()` - Customization

**InboxMessageFaker Features**:
- `AsProcessed(response)` - Generate with cached response
- `AsFailed(retryCount)` - Generate failed messages
- `AsExpired()` - Generate expired messages for cleanup tests
- `WithMessageId()`, `WithRequestType()` - Customization

**SagaStateFaker Features**:
- `AsCompleted()`, `AsCompensating()`, `AsFailed()`, `AsTimedOut()` - Lifecycle states
- `WithSagaType()`, `WithSagaId()`, `WithData()`, `AtStep()` - Customization

**ScheduledMessageFaker Features**:
- `AsDue()` - Generate messages ready for execution
- `AsRecurring(cron)` - Generate recurring with cron expression
- `AsRecurringExecuted()` - Generate with last execution timestamp
- `ScheduledAt()`, `WithRequestType()`, `WithContent()` - Customization

**Fake Implementations**:
- `FakeOutboxMessage` - Implements `IOutboxMessage`
- `FakeInboxMessage` - Implements `IInboxMessage`
- `FakeSagaState` - Implements `ISagaState`
- `FakeScheduledMessage` - Implements `IScheduledMessage`

**Dependencies Added to Directory.Packages.props**:
- `Bogus` v35.6.1

**Test Results**: 75 tests passing
- `EncinaFakerTests` - 21 tests for base class and extensions
- `OutboxMessageFakerTests` - 13 tests for outbox messages
- `InboxMessageFakerTests` - 14 tests for inbox messages
- `SagaStateFakerTests` - 14 tests for saga states
- `ScheduledMessageFakerTests` - 13 tests for scheduled messages

**Why Some Test Types Don't Apply**:
- **Integration Tests**: N/A - Fakers don't require external resources
- **Property Tests**: N/A - Bogus library handles randomization invariants
- **Contract Tests**: N/A - Internal implementations, no public interface contracts
- **Guard Tests**: Covered inline in unit tests
- **Load/Benchmark Tests**: N/A - Test data generation is not performance-critical

---

### December 30 (cont.) - Encina.Aspire.Testing (Issue #418)

**Issue Closed**: `#418`

**Package**: `Encina.Aspire.Testing`

Integration testing support for Encina-based applications using .NET Aspire's `DistributedApplicationTestingBuilder`.

**Core Components**:

| Component | Purpose |
|-----------|---------|
| `WithEncinaTestSupport()` | Extension for DistributedApplicationTestingBuilder |
| `EncinaTestSupportOptions` | Configuration for test behavior |
| `EncinaTestContext` | Centralized access to test state and operations |
| `DistributedApplicationExtensions` | Assertion and inspection helpers |
| `FailureSimulationExtensions` | Failure simulation for resilience testing |

**Configuration Options**:
- `ClearOutboxBeforeTest`, `ClearInboxBeforeTest`, `ResetSagasBeforeTest` - Data cleanup
- `ClearScheduledMessagesBeforeTest`, `ClearDeadLetterBeforeTest` - Additional cleanup
- `DefaultWaitTimeout`, `PollingInterval` - Wait operation settings

**Assertion Extensions**:
- `AssertOutboxContainsAsync<T>()` - Verify outbox contains notification type
- `AssertInboxProcessedAsync()` - Verify inbox message was processed
- `AssertSagaCompletedAsync<T>()`, `AssertSagaCompensatedAsync<T>()` - Saga lifecycle
- `AssertDeadLetterContainsAsync<T>()` - Dead letter verification

**Wait Helpers**:
- `WaitForOutboxProcessingAsync()` - Wait for all outbox messages to be processed
- `WaitForSagaCompletionAsync<T>()` - Wait for specific saga to complete

**Inspection Helpers**:
- `GetPendingOutboxMessages()`, `GetRunningSagas<T>()`, `GetDeadLetterMessages()`
- `GetEncinaTestContext()`, `GetOutboxStore()`, `GetSagaStore()`

**Failure Simulation**:
- `SimulateSagaTimeout()`, `SimulateSagaFailure()` - Saga failure scenarios
- `SimulateOutboxMessageFailure()`, `SimulateOutboxDeadLetter()` - Outbox failures
- `SimulateInboxMessageFailure()`, `SimulateInboxExpiration()` - Inbox failures
- `AddToDeadLetterAsync()` - Directly add messages to dead letter store

**Dependencies Added to Directory.Packages.props**:
- `Aspire.Hosting.Testing` v13.1.0

**Test Results**: 34 tests passing
- `EncinaTestSupportOptionsTests` - 8 tests for configuration defaults
- `EncinaTestContextTests` - 15 tests for context and cleanup
- `DistributedApplicationTestingBuilderExtensionsTests` - 11 tests for builder extension

**Why Some Test Types Don't Apply**:
- **Integration Tests**: Would require full Aspire AppHost setup (complex infrastructure)
- **Property Tests**: N/A - Assertion/configuration logic, not data invariants
- **Contract Tests**: N/A - Extension methods, not public interfaces
- **Guard Tests**: Covered inline with ArgumentNullException checks
- **Load/Benchmark Tests**: N/A - Test infrastructure is not performance-critical

---

### December 30 (cont.) - Encina.Testing.Verify (Issue #430)

**Issue Closed**: `#430`

**Package**: `Encina.Testing.Verify`

**Description**: Snapshot testing integration with Verify. Provides helpers for snapshot testing Either results, aggregates, sagas, and messaging entities with automatic scrubbing of timestamps and IDs.

**Files Created**:
```text
src/Encina.Testing.Verify/
├── Encina.Testing.Verify.csproj
├── EncinaVerifySettings.cs        # Settings with scrubbers and converters
├── EncinaVerify.cs                # Static helper methods
├── EncinaErrorConverter.cs        # Argon JSON converter for EncinaError
├── PublicAPI.Shipped.txt
├── PublicAPI.Unshipped.txt
└── README.md

tests/Encina.Testing.Verify.Tests/
├── Encina.Testing.Verify.Tests.csproj
├── ModuleInitializer.cs           # Initializes EncinaVerifySettings
├── EncinaVerifySettingsTests.cs
├── EncinaVerifyTests.cs           # Either, Outbox, Saga tests
├── AggregateVerifyTests.cs        # Aggregate event tests
└── (9 .verified.txt snapshot files)
```

**Key Features**:

| Feature | Description |
|---------|-------------|
| `EncinaVerifySettings.Initialize()` | Configures Verify with Encina-specific scrubbers (idempotent) |
| `PrepareEither<TLeft, TRight>()` | Prepare Either results for snapshot verification |
| `ExtractSuccess<TResponse>()` | Extract success value or throw InvalidOperationException |
| `ExtractError<TResponse>()` | Extract error or throw InvalidOperationException |
| `PrepareUncommittedEvents()` | Prepare aggregate uncommitted events with metadata |
| `PrepareOutboxMessages()` | Prepare outbox messages for verification |
| `PrepareInboxMessages()` | Prepare inbox messages for verification |
| `PrepareSagaState()` | Prepare saga state for verification |
| `PrepareScheduledMessages()` | Prepare scheduled messages for verification |
| `PrepareDeadLetterMessages()` | Prepare dead letter messages for verification |

**Automatic Scrubbing**:
- **Timestamps**: All Encina UTC timestamp properties (CreatedAtUtc, ProcessedAtUtc, etc.)
- **ISO 8601**: Timestamps in content replaced with `[TIMESTAMP]`
- **GUIDs**: Replaced with deterministic placeholders (Guid_1, Guid_2, etc.)
- **Stack Traces**: Removed from error messages for stable snapshots

**Dependencies**:
- Verify v28.8.0
- Verify.Xunit v28.8.0 (for xUnit test framework)
- Encina core libraries

**Test Coverage**:
- **Unit Tests**: 18 tests covering all public methods
- **Integration Tests**: N/A - Library wraps Verify, tested via unit tests
- **Property Tests**: N/A - Snapshot testing is deterministic by design
- **Contract Tests**: N/A - Simple static helper API
- **Guard Tests**: Covered inline (ArgumentNullException checks)
- **Load/Benchmark Tests**: N/A - Test infrastructure is not performance-critical

---

### December 30 (cont.) - Encina.Testing.Architecture (Issue #432)

**Issue Closed**: `#432`

**Package**: `Encina.Testing.Architecture`

**Description**: Architecture testing rules using ArchUnitNET. Provides pre-built rules for enforcing clean architecture patterns, handler dependencies, sealed classes, and layer separation.

**Files Created**:
```text
src/Encina.Testing.Architecture/
├── Encina.Testing.Architecture.csproj
├── EncinaArchitectureRules.cs        # Static class with pre-built rules
├── EncinaArchitectureTestBase.cs     # Abstract test class with pre-defined tests
├── EncinaArchitectureRulesBuilder.cs # Fluent builder for rule composition
├── PublicAPI.Shipped.txt
├── PublicAPI.Unshipped.txt
└── README.md

tests/Encina.Testing.Architecture.Tests/
├── Encina.Testing.Architecture.Tests.csproj
├── EncinaArchitectureRulesTests.cs
├── EncinaArchitectureRulesBuilderTests.cs
├── ArchitectureVerificationResultTests.cs
├── ArchitectureRuleViolationTests.cs
├── ArchitectureRuleExceptionTests.cs
├── GlobalSuppressions.cs
└── TestTypes/
    ├── TestHandler.cs
    ├── TestNotification.cs
    ├── TestBehavior.cs
    └── TestValidator.cs
```

**Key Features**:

| Feature | Description |
|---------|-------------|
| `HandlersShouldNotDependOnInfrastructure()` | Handlers should use abstractions, not EF Core, Dapper, etc. |
| `HandlersShouldBeSealed()` | Handler classes should be sealed |
| `NotificationsShouldBeSealed()` | Notifications and events should be sealed |
| `BehaviorsShouldBeSealed()` | Pipeline behaviors should be sealed |
| `ValidatorsShouldFollowNamingConvention()` | Validators should end with "Validator" |
| `DomainShouldNotDependOnMessaging(namespace)` | Domain layer should not depend on Encina.Messaging |
| `DomainShouldNotDependOnApplication(domain, app)` | Domain should not depend on Application layer |
| `ApplicationShouldNotDependOnInfrastructure(app, infra)` | Application should not depend on Infrastructure |
| `CleanArchitectureLayersShouldBeSeparated(...)` | Combined rule for all layer separations |
| `RepositoryInterfacesShouldResideInDomain(namespace)` | Repository interfaces should be in Domain |
| `RepositoryImplementationsShouldResideInInfrastructure(namespace)` | Repository implementations should be in Infrastructure |

**Classes**:

| Class | Description |
|-------|-------------|
| `EncinaArchitectureRules` | Static class with pre-built architecture rules |
| `EncinaArchitectureTestBase` | Abstract test class with pre-defined test methods |
| `EncinaArchitectureRulesBuilder` | Fluent builder for custom rule composition |
| `ArchitectureRuleViolation` | Record for rule violation details (RuleName, Message) |
| `ArchitectureVerificationResult` | Result with `IsSuccess`, `IsFailure`, `Violations` |
| `ArchitectureRuleException` | Exception with formatted violation messages |

**Dependencies**:
- TngTech.ArchUnitNET v0.12.3
- TngTech.ArchUnitNET.xUnit v0.13.1
- xunit.core
- Encina core library

**Test Coverage**:
- **Unit Tests**: 57 tests covering all public methods
- **Integration Tests**: N/A - Library wraps ArchUnitNET, tested via unit tests
- **Property Tests**: N/A - Architecture rules are deterministic
- **Contract Tests**: N/A - Simple rule API
- **Guard Tests**: Covered inline (ArgumentException, ArgumentNullException checks)
- **Load/Benchmark Tests**: N/A - Test infrastructure is not performance-critical

---

## Week 10: December 30 (Testing Framework Migration)

### December 30 - FluentAssertions to Shouldly Migration

**Issue**: #495 - Replace FluentAssertions with Shouldly

**Motivation**:
FluentAssertions adopted commercial licensing in January 2025 ($130/developer/year), making it unsuitable for open-source projects. Shouldly remains MIT-licensed and provides similar functionality.

**Migration Scope**:
- 114 test projects updated
- ~1,500+ assertion statements migrated
- All test types covered: Unit, Integration, Contract, Property, Guard, Load

**Key Syntax Mappings**:

| FluentAssertions | Shouldly |
|------------------|----------|
| `.Should().Be(x)` | `.ShouldBe(x)` |
| `.Should().BeTrue()` | `.ShouldBeTrue()` |
| `.Should().BeFalse()` | `.ShouldBeFalse()` |
| `.Should().BeNull()` | `.ShouldBeNull()` |
| `.Should().NotBeNull()` | `.ShouldNotBeNull()` |
| `.Should().HaveCount(n)` | `.Count.ShouldBe(n)` |
| `.Should().Contain(x)` | `.ShouldContain(x)` |
| `.Should().BeEmpty()` | `.ShouldBeEmpty()` |
| `.Should().Throw<T>()` | `Should.Throw<T>(act)` |
| `.Should().ThrowAsync<T>()` | `await Should.ThrowAsync<T>(async () => ...)` |
| `FluentActions.Invoking(...)` | `Should.Throw<T>(() => ...)` |

**Edge Cases Handled**:
1. `Func<T>` to `Action` conversion for `Should.Throw<T>()` (wrap return value in `_ =`)
2. Struct types (e.g., `EncinaError`, `HealthCheckResult`) cannot use `ShouldNotBeNull()`
3. `IEnumerable` `.Count` is a method, not property - use `.Count().ShouldBe(n)`
4. `ShouldAllBe()` expects `Func<T, bool>`, not void - use predicates like `r => r.IsRight`
5. Collection expressions `[...]` preferred over `new[] { }` for CA1861 compliance

**Custom Extensions** (`Encina.Testing.Shouldly`):
- `ShouldBeSuccess()` / `ShouldBeRight()` - Assert `Either` is Right
- `ShouldBeError()` / `ShouldBeLeft()` - Assert `Either` is Left
- `AllShouldBeSuccess()` - All items in collection should be Right
- `ShouldContainSuccess()` / `ShouldContainError()` - Collection assertions
- `ShouldBeErrorWithCode()` - Assert specific `EncinaError` code

**Test Results**:
- Encina.Tests: 1,038 passed
- Encina.DomainModeling.Tests: 175 passed
- All core test projects compiling and passing

---

## Week 11: December 31 (Domain Model Faker Extensions)

### December 31 - Domain Model Faker Extensions (Issue #161)

**Issue Closed**: `#161` (Test Data Generation with Bogus - Domain Model Fakers)

Extended `Encina.Testing.Bogus` with domain model faker support following CodeRabbit's recommendation to extend the existing package rather than creating a new one.

**Implementation Approach**:
- Followed CodeRabbit analysis recommendation: extend existing `Encina.Testing.Bogus` package
- Used manual Bogus (not AutoBogus) for seed reproducibility
- Extension methods on `Randomizer` and `Date` classes for easy integration
- Full XML documentation with examples

**New Extension Methods** (EncinaFakerExtensions.cs):

| Method | Purpose | Return Type |
|--------|---------|-------------|
| `EntityId<TId>()` | Generic entity ID generation | Guid, int, long, string |
| `GuidEntityId()` | Generate non-empty GUID | Guid |
| `IntEntityId(min, max)` | Generate positive integer ID | int |
| `LongEntityId(min, max)` | Generate positive long ID | long |
| `StringEntityId(length, prefix)` | Generate alphanumeric ID | string |
| `StronglyTypedIdValue<TValue>()` | Generic value for StronglyTypedId | TValue |
| `GuidStronglyTypedIdValue()` | GUID for StronglyTypedId<Guid> | Guid |
| `IntStronglyTypedIdValue(min, max)` | int for StronglyTypedId<int> | int |
| `LongStronglyTypedIdValue(min, max)` | long for StronglyTypedId<long> | long |
| `StringStronglyTypedIdValue(length, prefix)` | string for StronglyTypedId<string> | string |
| `QuantityValue(min, max)` | Non-negative quantity | int |
| `PercentageValue(min, max, decimals)` | Percentage 0-100 | decimal |
| `DateRangeValue(daysInPast, daysSpan)` | Date range tuple | (DateOnly, DateOnly) |
| `TimeRangeValue(minHourSpan, maxHourSpan)` | Time range tuple | (TimeOnly, TimeOnly) |

**Key Design Decisions**:
1. **All IDs must be positive** - Entity IDs are never 0 or negative (business invariant)
2. **Seed reproducibility** - Same seed produces same values across runs
3. **Guard clauses** - All parameters validated with `ArgumentOutOfRangeException`
4. **Type-switch pattern** - `EntityId<TId>()` uses pattern matching for type dispatch
5. **Extension methods** - Extend Bogus `Randomizer` and `Date` for natural API

**Test Coverage**:

| Type | Count | Description |
|------|:-----:|-------------|
| Unit Tests | 54 | All extension methods, guards, edge cases |
| Property Tests | 23 | FsCheck invariant verification |
| **Total** | **77** | New tests for domain model extensions |

**Why Some Test Types Don't Apply**:
- **Integration Tests**: N/A - Pure extension methods, no external dependencies
- **Contract Tests**: N/A - These are extensions on Bogus types, not Encina interfaces
- **Guard Clause Tests**: Already covered in unit tests with dedicated guard tests
- **Load Tests**: N/A - Not performance-critical, simple value generation
- **Benchmarks**: N/A - No complex algorithms, just random value generation

**Files Modified**:
- `src/Encina.Testing.Bogus/EncinaFaker.cs` - Added ~400 lines of extension methods in 3 regions
- `src/Encina.Testing.Bogus/README.md` - Added domain model faker documentation

**Files Created**:
- `tests/Encina.Testing.Bogus.Tests/EncinaFakerExtensionsTests.cs` - 54 unit tests
- `tests/Encina.Testing.Bogus.PropertyTests/Encina.Testing.Bogus.PropertyTests.csproj` - New project
- `tests/Encina.Testing.Bogus.PropertyTests/EncinaFakerExtensionsProperties.cs` - 23 property tests

**Property Test Invariants Verified**:
1. `IntEntityId_AlwaysPositive` - Entity IDs are always >= 1
2. `IntEntityId_WithinRange_RespectsBounds` - Range parameters are honored
3. `GuidEntityId_NeverEmpty` - GUIDs are never Guid.Empty
4. `StringEntityId_NeverEmpty` - String IDs are never null/empty
5. `QuantityValue_AlwaysNonNegative` - Quantities are >= 0
6. `PercentageValue_AlwaysBetweenZeroAndHundred` - Percentages in valid range
7. `DateRangeValue_EndAlwaysAfterOrEqualStart` - Date ranges are valid
8. `TimeRangeValue_EndAlwaysAfterStart` - Time ranges are valid
9. `SameSeed_ProducesSameX` - Reproducibility verified for all methods
10. `DifferentSeeds_ProduceDifferentX` - Different seeds produce different results

**Usage Examples**:

```csharp
// Entity ID generation
var randomizer = new Randomizer(12345);
var orderId = randomizer.GuidEntityId();
var customerId = randomizer.IntEntityId(1, 10000);
var productSku = randomizer.StringEntityId(8, "SKU");

// Strongly-typed ID values
var value = randomizer.StronglyTypedIdValue<Guid>();
var userId = randomizer.IntStronglyTypedIdValue(1, 999999);

// Value objects
var quantity = randomizer.QuantityValue(1, 100);
var discount = randomizer.PercentageValue(0, 50, decimals: 2);

// Date/Time ranges
var faker = new Faker { Random = new Randomizer(12345) };
var (startDate, endDate) = faker.Date.DateRangeValue(daysInPast: 30);
var (startTime, endTime) = faker.Date.TimeRangeValue(minHourSpan: 2);
```

### December 31 (Continued) - Testcontainers Integration (Issue #162)

**Issue**: `#162` (Testcontainers Integration for Database Testing)

Created `Encina.Testing.Testcontainers` package for spinning up real database instances in Docker during integration tests.

#### New Package: Encina.Testing.Testcontainers

Pre-configured xUnit fixtures for Docker-based integration testing:

| Fixture | Database | Default Image |
|---------|----------|---------------|
| `SqlServerContainerFixture` | SQL Server | `mcr.microsoft.com/mssql/server:2022-latest` |
| `PostgreSqlContainerFixture` | PostgreSQL | `postgres:17-alpine` |
| `MySqlContainerFixture` | MySQL | `mysql:9.1` |
| `MongoDbContainerFixture` | MongoDB | `mongo:7` |
| `RedisContainerFixture` | Redis | `redis:7-alpine` |

**Additional Components**:
- `ConfiguredContainerFixture<TContainer>` - Generic fixture for custom-configured containers
- `EncinaContainers` - Static factory class with default and custom configuration support

**Key Features**:
- All fixtures implement `IAsyncLifetime` for xUnit integration
- Properties: `Container`, `ConnectionString`, `IsRunning`
- Guard against accessing before initialization (throws `InvalidOperationException`)
- Automatic cleanup with `WithCleanUp(true)`
- Factory methods with custom configuration overloads

**Test Coverage**:

| Type | Count | Description |
|------|:-----:|-------------|
| Unit Tests | 33 | Fixture lifecycle, factory methods, guards |
| **Total** | **33** | All tests passing |

**Why Some Test Types Don't Apply**:
- **Integration Tests**: Would require Docker running - these ARE the integration testing tools
- **Property-Based Tests**: N/A - No complex invariants, just container lifecycle management
- **Contract Tests**: N/A - Implements Testcontainers library interfaces
- **Guard Clause Tests**: Already covered in unit tests
- **Load Tests**: N/A - Container startup is inherently slow (by design)
- **Benchmarks**: N/A - Container performance is Testcontainers' concern

**Files Created**:
- `src/Encina.Testing.Testcontainers/Encina.Testing.Testcontainers.csproj`
- `src/Encina.Testing.Testcontainers/SqlServerContainerFixture.cs`
- `src/Encina.Testing.Testcontainers/PostgreSqlContainerFixture.cs`
- `src/Encina.Testing.Testcontainers/MySqlContainerFixture.cs`
- `src/Encina.Testing.Testcontainers/MongoDbContainerFixture.cs`
- `src/Encina.Testing.Testcontainers/RedisContainerFixture.cs`
- `src/Encina.Testing.Testcontainers/ConfiguredContainerFixture.cs`
- `src/Encina.Testing.Testcontainers/EncinaContainers.cs`
- `src/Encina.Testing.Testcontainers/README.md`
- `tests/Encina.Testing.Testcontainers.Tests/` - 7 test files

**Usage Example**:

```csharp
using System.Threading.Tasks;
using Encina.Testing.Testcontainers;
using Microsoft.Data.SqlClient;
using Xunit;

public class OrderRepositoryTests : IClassFixture<SqlServerContainerFixture>
{
    private readonly SqlServerContainerFixture _db;

    public OrderRepositoryTests(SqlServerContainerFixture db) => _db = db;

    [Fact]
    public async Task CreateOrder_ShouldPersist()
    {
        await using var connection = new SqlConnection(_db.ConnectionString);
        await connection.OpenAsync();
        // Test with real SQL Server...
    }
}
```

### December 31 (Continued) - Testcontainers Base Class Refactoring

**Refactoring**: Eliminated **200+ lines of duplicate code** across 5 database container fixtures by introducing `ContainerFixtureBase<TContainer>` abstract base class.

#### Problem Addressed

All 5 database fixtures (SqlServer, PostgreSQL, MySQL, MongoDB, Redis) had nearly identical lifecycle management code:
- `_container` field initialization
- `Container` property with null checks
- `ConnectionString` property with reflection fallback to `GetConnectionString()`
- `IsRunning` property checking container state
- `InitializeAsync()` and `InitializeAsync(CancellationToken)` overloads
- `DisposeAsync()` with error handling

Each fixture repeated this pattern, violating DRY principle and increasing maintenance burden.

#### Solution: ContainerFixtureBase<TContainer>

Created abstract base class centralizing all common lifecycle logic:

```csharp
public abstract class ContainerFixtureBase<TContainer> : IAsyncLifetime
    where TContainer : class
{
    private TContainer? _container;

    /// <summary>
    /// Builds and returns a new container instance.
    /// Implementation varies by database provider.
    /// </summary>
    protected abstract TContainer BuildContainer();

    /// <summary>
    /// Gets the active container instance.
    /// </summary>
    public TContainer Container => _container ?? throw new InvalidOperationException(
        "Container not initialized. Call InitializeAsync() first.");

    /// <summary>
    /// Gets the database connection string.
    /// Inheriting classes override or use reflection-based resolution.
    /// </summary>
    public virtual string ConnectionString
    {
        get
        {
            var method = _container?.GetType().GetMethod("GetConnectionString");
            return method?.Invoke(_container, null) as string 
                ?? throw new InvalidOperationException(
                    "GetConnectionString() not found or returned null.");
        }
    }

    /// <summary>
    /// Checks if container is currently running.
    /// </summary>
    public bool IsRunning => _container?.GetType()
        .GetProperty("State")
        ?.GetValue(_container)?.Equals(TestcontainersStates.Running) ?? false;

    /// <summary>
    /// Initializes and starts the container.
    /// </summary>
    public async Task InitializeAsync()
        => await InitializeAsync(CancellationToken.None);

    /// <summary>
    /// Initializes and starts the container with cancellation support.
    /// </summary>
    public async Task InitializeAsync(CancellationToken cancellationToken)
    {
        _container = BuildContainer();
        await _container.StartAsync(cancellationToken);
    }

    /// <summary>
    /// Disposes and stops the container safely.
    /// </summary>
    public async ValueTask DisposeAsync()
    {
        if (_container is null)
            return;

        try
        {
            await _container.StopAsync();
        }
        catch (Exception ex)
        {
            // Log or track but don't throw during cleanup
            _ = ex; // Diagnostics: exception stored for analysis
        }

        try
        {
            await _container.DisposeAsync();
        }
        catch (Exception ex)
        {
            // Log or track but don't throw during cleanup
            _ = ex; // Diagnostics: exception stored for analysis
        }
    }
}
```

#### Derived Fixtures Simplified

Each fixture now only implements `BuildContainer()` override:

| Fixture | Lines Before | Lines After | Code Reduction |
|---------|:--------:|:--------:|:--------:|
| SqlServerContainerFixture | 100 | ~30 | 70% |
| PostgreSqlContainerFixture | 100 | ~30 | 70% |
| MySqlContainerFixture | 100 | ~30 | 70% |
| MongoDbContainerFixture | 100 | ~30 | 70% |
| RedisContainerFixture | 100 | ~30 | 70% |

**Example Implementation** (SqlServerContainerFixture.cs):

```csharp
public class SqlServerContainerFixture : ContainerFixtureBase<MsSqlContainer>
{
    /// <summary>
    /// SQL Server container fixture for xUnit test integration.
    /// </summary>
    protected override MsSqlContainer BuildContainer()
        => new ContainerBuilder<MsSqlContainer>()
            .WithImage("mcr.microsoft.com/mssql/server:2022-latest")
            .WithEnvironment("ACCEPT_EULA", "Y")
            .WithCleanUp(true)
            .Build();
}
```

#### Benefits

1. **Reduced Maintenance**: Single location for lifecycle management changes
2. **Consistency**: All fixtures share identical behavior
3. **Readability**: Derived fixtures show only their unique configuration
4. **Reliability**: Robust error handling in one place for all fixtures
5. **Extensibility**: Virtual `ConnectionString` property allows override if needed

#### Build Verification

- ✅ Compilation: Successful (no errors)
- ✅ XML Documentation: Fixed cref resolution issues in derived fixtures
- ✅ Tests: **33/33 passing** (all container fixture tests pass)

**Files Modified**:
- `src/Encina.Testing.Testcontainers/ContainerFixtureBase.cs` (NEW - 165 lines)
- `src/Encina.Testing.Testcontainers/SqlServerContainerFixture.cs` (refactored)
- `src/Encina.Testing.Testcontainers/PostgreSqlContainerFixture.cs` (refactored)
- `src/Encina.Testing.Testcontainers/MySqlContainerFixture.cs` (refactored)
- `src/Encina.Testing.Testcontainers/MongoDbContainerFixture.cs` (refactored)
- `src/Encina.Testing.Testcontainers/RedisContainerFixture.cs` (refactored)

### December 31 (Continued) - Respawn Integration for Testcontainers (Issue #163)

**Feature**: Added `DatabaseIntegrationTestBase<TFixture>` abstract class that combines Testcontainers with Respawn for automatic database cleanup between tests.

#### Problem Addressed

Integration tests using Testcontainers need a way to reset database state between tests without recreating containers. Manual Respawn setup required boilerplate code in each test class.

#### Solution: DatabaseIntegrationTestBase

Created abstract base class that:
1. Wraps container fixtures with Respawn integration
2. Automatically resets database before each test
3. Provides customizable cleanup options
4. Offers database-specific convenience classes

**Files Created**:
- `src/Encina.Testing.Testcontainers/DatabaseIntegrationTestBase.cs` - Generic base class
- `src/Encina.Testing.Testcontainers/SqlServerIntegrationTestBase.cs` - SQL Server specific
- `src/Encina.Testing.Testcontainers/PostgreSqlIntegrationTestBase.cs` - PostgreSQL specific
- `src/Encina.Testing.Testcontainers/MySqlIntegrationTestBase.cs` - MySQL specific

**Test Files Created**:
- `tests/Encina.Testing.Testcontainers.Tests/DatabaseIntegrationTestBaseTests.cs`
- `tests/Encina.Testing.Testcontainers.Tests/SqlServerIntegrationTestBaseTests.cs`
- `tests/Encina.Testing.Testcontainers.Tests/PostgreSqlIntegrationTestBaseTests.cs`
- `tests/Encina.Testing.Testcontainers.Tests/MySqlIntegrationTestBaseTests.cs`

**Key Features**:

```csharp
public abstract class DatabaseIntegrationTestBase<TFixture> : IAsyncLifetime
    where TFixture : class, IAsyncLifetime
{
    private readonly TFixture _fixture;
    private DatabaseRespawner? _respawner;

    // Automatic Respawn adapter detection based on fixture type
    protected RespawnAdapter RespawnAdapter => _fixture switch
    {
        SqlServerContainerFixture _ => RespawnAdapter.SqlServer,
        PostgreSqlContainerFixture _ => RespawnAdapter.PostgreSql,
        MySqlContainerFixture _ => RespawnAdapter.MySql,
        _ => throw new NotSupportedException(
            $"Unsupported fixture type '{_fixture.GetType().Name}'. " +
            "Only SqlServer, PostgreSQL, and MySQL fixtures are supported.")
    };

    // Customizable cleanup options
    protected virtual RespawnOptions RespawnOptions => new()
    {
        ResetEncinaMessagingTables = false // Exclude Encina tables by default
    };

    // Database reset before each test
    public virtual async Task InitializeAsync()
    {
        _respawner = CreateRespawner();
        await _respawner.InitializeAsync();
        await _respawner.ResetAsync();
    }

    // Mid-test reset capability
    protected async Task ResetDatabaseAsync(CancellationToken ct = default)
    {
        await _respawner!.ResetAsync(ct);
    }

    // Stubbed - implementation omitted for brevity
    private DatabaseRespawner CreateRespawner()
    {
        throw new NotImplementedException("See DatabaseIntegrationTestBase.cs for full implementation");
    }
}
```

**Usage Example**:

```csharp
public class OrderRepositoryTests : SqlServerIntegrationTestBase
{
    public OrderRepositoryTests(SqlServerContainerFixture fixture)
        : base(fixture) { }

    [Fact]
    public async Task CreateOrder_ShouldPersist()
    {
        // Database is automatically reset before this test
        await using var connection = new SqlConnection(ConnectionString);
        await connection.OpenAsync();

        // Insert test data
        await connection.ExecuteAsync(
            "INSERT INTO Orders (Id, Name) VALUES (1, 'Test')");

        // Verify
        var count = await connection.ExecuteScalarAsync<int>(
            "SELECT COUNT(*) FROM Orders");
        Assert.Equal(1, count);
    }
}
```

**Build Verification**:
- ✅ Compilation: Successful (0 errors, 0 warnings)
- ✅ Tests: **51/51 passing** (18 new tests added)

**Package Dependencies Updated**:
- `Encina.Testing.Testcontainers` now references `Encina.Testing.Respawn`

---

## Issue #169: Messaging Pattern Test Helpers

**Date**: December 31, 2025

**Summary**: Implemented BDD Given/When/Then test helpers for all messaging patterns (Outbox, Inbox, Saga, Scheduling) with comprehensive test coverage.

### Implementation Details

**New Test Helpers** (Location: `src/Encina.Testing/Messaging/`):

1. **OutboxTestHelper.cs** (~450 lines)
   - Fluent Given/When/Then API for outbox pattern testing
   - Setup: `GivenEmptyOutbox()`, `GivenMessages()`, `GivenPendingMessage()`, `GivenProcessedMessage()`, `GivenFailedMessage()`
   - Actions: `WhenMessageAdded()`, `WhenMessageProcessed()`, `WhenMessageFailed()`, `When()`, `WhenAsync()`
   - Assertions: `ThenMessageWasAdded<T>()`, `ThenOutboxContains<T>()`, `ThenMessageWasProcessed()`, `ThenNoMessagesWereAdded()`, `ThenNoException()`, `ThenThrows<T>()`
   - Time control: Uses `FakeTimeProvider` for time-travel testing

2. **InboxTestHelper.cs** (~430 lines)
   - Fluent Given/When/Then API for inbox/idempotency testing
   - Setup: `GivenEmptyInbox()`, `GivenNewMessage()`, `GivenProcessedMessage()`, `GivenFailedMessage()`
   - Actions: `WhenMessageReceived()`, `WhenMessageRegistered()`, `WhenMessageProcessed()`, `WhenMessageFailed()`
   - Assertions: `ThenMessageWasRegistered()`, `ThenMessageIsProcessed()`, `ThenCachedResponseIs<T>()`, `ThenMessageWasDuplicate()`
   - Idempotency testing: Cached response verification for replay scenarios

3. **SagaTestHelper.cs** (~570 lines)
   - Fluent Given/When/Then API for saga orchestration testing
   - Setup: `GivenNoSagas()`, `GivenNewSaga<TSaga, TData>()`, `GivenRunningSaga()`, `GivenCompletedSaga()`, `GivenFailedSaga()`, `GivenTimedOutSaga()`, `GivenCompensatingSaga()`
   - Actions: `WhenSagaStarts()`, `WhenSagaAdvancesToNextStep()`, `WhenSagaDataUpdated()`, `WhenSagaCompletes()`, `WhenSagaStartsCompensating()`, `WhenSagaFails()`, `WhenSagaTimesOut()`
   - Assertions: `ThenSagaWasStarted<TSaga>()`, `ThenSagaIsAtStep()`, `ThenSagaIsCompleted()`, `ThenSagaIsFailed()`, `ThenSagaIsCompensating()`, `ThenSagaData<TData>()`
   - Full support for saga lifecycle: Running → Completed | Compensating | Failed | TimedOut

4. **SchedulingTestHelper.cs** (~530 lines)
   - Fluent Given/When/Then API for scheduled message testing
   - Setup: `GivenNoScheduledMessages()`, `GivenScheduledMessage()`, `GivenRecurringMessage()`, `GivenDueMessage()`, `GivenProcessedMessage()`, `GivenFailedMessage()`, `GivenCancelledMessage()`
   - Actions: `WhenMessageScheduled()`, `WhenRecurringMessageScheduled()`, `WhenMessageProcessed()`, `WhenMessageFailed()`, `WhenMessageCancelled()`, `WhenMessageRescheduled()`
   - Assertions: `ThenMessageWasScheduled<T>()`, `ThenMessageIsDue<T>()`, `ThenMessageIsNotDue()`, `ThenMessageWasProcessed()`, `ThenMessageWasCancelled()`, `ThenMessageIsRecurring()`, `ThenMessageHasCron()`
   - Time control: `AdvanceTimeBy(TimeSpan)`, `AdvanceTimeByMinutes(int)`, `AdvanceTimeByHours(int)`, `AdvanceTimeByDays(int)`, `AdvanceTimeUntilDue(Guid)`, `GetDueMessagesAsync()`
   - CRON expression support for recurring messages

### Test Coverage

**Unit Tests** (Location: `tests/Encina.Testing.Tests/Messaging/`):
- `OutboxTestHelperTests.cs` - 27 tests
- `InboxTestHelperTests.cs` - 24 tests
- `SagaTestHelperTests.cs` - 29 tests
- `SchedulingTestHelperTests.cs` - 35 tests
- **Total: 115 unit tests**

**Property-Based Tests** (FsCheck):
- `MessagingTestHelpersPropertyTests.cs` - 23 properties
- Invariants tested: message tracking, time monotonicity, state transitions, ID uniqueness

**Guard Clause Tests**:
- `MessagingTestHelpersGuardClauseTests.cs` - 33 tests
- Validates `ArgumentNullException` for all null parameters

**Total Test Count**: 171 tests (all passing)

### Pattern: BDD Given/When/Then

All test helpers follow the same pattern as `AggregateTestBase<TAggregate, TId>`:

```csharp
// Example: Testing saga compensation flow
using Shouldly;

using var helper = new SagaTestHelper();
var sagaId = Guid.NewGuid();

helper
    .GivenRunningSaga<OrderSaga, OrderSagaData>(
        sagaId,
        data: new OrderSagaData { OrderId = "ORD-001" },
        currentStep: 2)
    .WhenSagaStartsCompensating(sagaId, "Payment failed")
    .ThenSagaIsCompensating(sagaId)
    .ThenSagaData<OrderSagaData>(sagaId, d => d.OrderId.ShouldBe("ORD-001"));
```

```csharp
// Example: Testing scheduled message time-travel
using var helper = new SchedulingTestHelper();
helper
    .GivenNoScheduledMessages()
    .WhenMessageScheduled(new SendReminderCommand { UserId = "123" }, TimeSpan.FromHours(24))
    .ThenMessageIsNotDue(helper.LastMessageId)
    .AdvanceTimeByHours(25)
    .When(_ => { })  // Trigger assertion refresh
    .ThenMessageIsDue<SendReminderCommand>();
```

### Integration with Existing Infrastructure

- Uses `FakeTimeProvider` from Issue #433
- Uses fake stores from `Encina.Testing.Fakes` (Issue #426):
  - `FakeOutboxStore`
  - `FakeInboxStore`
  - `FakeSagaStore`
  - `FakeScheduledMessageStore`

### Test Types Justification

| Test Type | Status | Justification |
|-----------|--------|---------------|
| Unit Tests | ✅ 115 tests | Core functionality coverage |
| Property-Based | ✅ 23 tests | Invariant verification with FsCheck |
| Guard Clause | ✅ 33 tests | Null argument validation |
| Integration | ⏭️ Not applicable | Test helpers are in-memory only, no external dependencies |
| Contract | ⏭️ Not applicable | Internal implementation, not public API contract |
| Load/Benchmark | ⏭️ Not applicable | Test helpers are for correctness, not performance |

---

Last Updated: 2025-12-31
